<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="vibe713" data-mode="aurora" aria-label="Iteration 713 — Kinetic Almanac">
  <style>
    .vibe713 {
      --ink: #ecf2ff;
      --muted: #b7c0dc;
      --line: color-mix(in oklab, var(--ink) 14%, transparent);
      --bg-1: #0b1020;
      --bg-2: #0f1a34;
      --acc-1: #72f7ff;
      --acc-2: #b59cff;
      --acc-3: #77ffb1;
      --ring: color-mix(in oklab, var(--acc-1) 24%, transparent);
      --tiltX: 0deg;
      --tiltY: 0deg;
      --shiftX: 0px;
      --shiftY: 0px;
      --speed: 0.90;
      color-scheme: dark;
      position: relative;
      isolation: isolate;
      padding: clamp(20px, 5vw, 56px);
      border-radius: 28px;
      border: 1px solid var(--line);
      background:
        radial-gradient(120% 160% at 85% -10%, color-mix(in oklab, var(--acc-1) 12%, transparent), transparent 60%),
        radial-gradient(140% 180% at -20% 100%, color-mix(in oklab, var(--acc-2) 12%, transparent), transparent 60%),
        linear-gradient(180deg, var(--bg-1), var(--bg-2));
      box-shadow: 0 34px 100px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.05);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--ink);
      overflow: hidden;
    }
    .vibe713::before {
      content: "";
      position: absolute; inset: -30% -10% -40% -10%;
      background:
        radial-gradient(60% 60% at 20% 30%, color-mix(in oklab, var(--acc-3) 20%, transparent), transparent 70%),
        radial-gradient(50% 50% at 80% 70%, color-mix(in oklab, var(--acc-2) 20%, transparent), transparent 70%);
      filter: blur(70px);
      opacity: 0.65;
      pointer-events: none;
      z-index: 0;
    }
    .vibe713 .grain {
      position: absolute; inset: 0; pointer-events: none; z-index: 0;
      background:
        repeating-linear-gradient(0deg, rgba(255,255,255,0.02) 0 1px, transparent 1px 2px),
        repeating-linear-gradient(90deg, rgba(255,255,255,0.015) 0 1px, transparent 1px 2px);
      mix-blend-mode: soft-light; opacity: 0.35;
      mask: radial-gradient(140% 140% at 60% 30%, #000 70%, transparent);
    }

    /* Modes */
    .vibe713[data-mode="aurora"] { --acc-1:#72f7ff; --acc-2:#b59cff; --acc-3:#77ffb1; --bg-1:#0a1124; --bg-2:#0f1a34; }
    .vibe713[data-mode="ember"]  { --acc-1:#ffb56b; --acc-2:#ff6d9b; --acc-3:#ffd36b; --bg-1:#1a0c12; --bg-2:#23131c; }
    .vibe713[data-mode="mono"]   { --acc-1:#9cc2ff; --acc-2:#e3e8ff; --acc-3:#b6c2ff; --bg-1:#0f1116; --bg-2:#131722; }

    /* Layout */
    .vibe713 .wrap { position: relative; z-index: 1; display: grid; gap: clamp(16px, 3vw, 26px); }
    .vibe713 .head { display: grid; gap: 6px; }
    .vibe713 .chip {
      display: inline-flex; align-items: center; gap: 10px;
      padding: 8px 12px; border-radius: 999px; border: 1px solid var(--line);
      background: color-mix(in oklab, rgba(255,255,255,0.06) 40%, transparent);
      backdrop-filter: blur(6px);
      font-weight: 900; font-size: 12px; letter-spacing: 0.28px; color: var(--muted);
      box-shadow: 0 10px 24px rgba(0,0,0,0.28);
      width: fit-content;
    }
    .vibe713 .chip::before {
      content: ""; width: 10px; height: 10px; border-radius: 50%;
      background: conic-gradient(from 180deg, var(--acc-1), var(--acc-2), var(--acc-3), var(--acc-1));
      box-shadow: 0 0 0 4px color-mix(in oklab, var(--acc-2) 22%, transparent),
                  0 0 18px color-mix(in oklab, var(--acc-1) 36%, transparent);
    }
    .vibe713 h1 {
      margin: 6px 0 2px;
      font-family: ui-serif, "Iowan Old Style", Georgia, "Times New Roman", serif;
      font-size: clamp(38px, 7.2vw, 92px);
      line-height: 0.95; letter-spacing: -0.025em; font-weight: 800;
      background: linear-gradient(90deg,
        color-mix(in oklab, var(--ink) 92%, var(--acc-2)),
        color-mix(in oklab, var(--acc-1) 50%, var(--acc-2) 12%));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-wrap: balance;
    }
    .vibe713 .lead {
      margin: 0;
      font-size: clamp(14px, 2.2vw, 18px);
      color: var(--muted);
      max-width: 72ch;
      text-wrap: pretty;
    }

    /* Controls */
    .vibe713 .controls { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; }
    .vibe713 .seg-group {
      display: inline-flex; border-radius: 14px; overflow: hidden; border: 1px solid var(--line);
      background: color-mix(in oklab, rgba(255,255,255,0.06) 70%, transparent);
      box-shadow: 0 10px 24px rgba(0,0,0,0.28);
    }
    .vibe713 .seg {
      appearance: none; border: 0; background: transparent; color: var(--ink);
      padding: 10px 14px; font-weight: 900; letter-spacing: 0.25px; cursor: pointer;
      transition: background 160ms ease, color 160ms ease;
    }
    .vibe713 .seg.active { background: color-mix(in oklab, var(--acc-2) 18%, transparent); }
    .vibe713 .knob {
      display: inline-flex; align-items: center; gap: 10px; padding: 8px 12px; border-radius: 999px;
      border: 1px solid var(--line);
      background: color-mix(in oklab, rgba(255,255,255,0.06) 60%, transparent);
      font-weight: 900; letter-spacing: 0.25px; color: var(--ink);
      box-shadow: 0 10px 24px rgba(0,0,0,0.28);
    }
    .vibe713 .range {
      appearance: none; width: 180px; height: 6px; border-radius: 999px;
      background: color-mix(in oklab, var(--muted) 30%, transparent); outline: none;
    }
    .vibe713 .range::-webkit-slider-thumb {
      appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background: linear-gradient(135deg, var(--acc-2), var(--acc-1));
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--acc-2) 18%, transparent);
      border: 0; cursor: pointer;
    }
    .vibe713 .btn {
      display: inline-flex; align-items: center; gap: 10px; cursor: pointer;
      padding: 12px 16px; border-radius: 14px; border: 1px solid var(--line);
      background: color-mix(in oklab, rgba(255,255,255,0.06) 60%, transparent); color: var(--ink);
      font-weight: 900; letter-spacing: 0.2px;
      box-shadow: 0 12px 26px rgba(0,0,0,0.28);
      transition: transform 160ms ease, box-shadow 220ms ease, background 240ms ease;
    }
    .vibe713 .btn:hover { transform: translateY(-2px); }
    .vibe713 .btn.ghost { background: transparent; }

    /* Stage */
    .vibe713 .stage {
      position: relative;
      width: min(92vw, 820px);
      aspect-ratio: 1 / 1;
      border-radius: 28px;
      border: 1px solid var(--line);
      overflow: hidden;
      background:
        radial-gradient(120% 100% at 50% 0%, color-mix(in oklab, var(--acc-2) 8%, transparent), transparent 60%),
        linear-gradient(180deg, color-mix(in oklab, var(--bg-1) 90%, #0b1224), color-mix(in oklab, var(--bg-2) 85%, #0b1224));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.06), 0 24px 60px rgba(0,0,0,0.4);
      display: grid; place-items: center;
      touch-action: none;
      transform-style: preserve-3d;
      transform: rotateX(var(--tiltY)) rotateY(calc(var(--tiltX) * -1));
      transition: transform 140ms ease-out;
      margin-top: 6px;
    }
    .vibe713 canvas.sky { width: 100%; height: 100%; display: block; filter: saturate(1.1) contrast(1.06); }
    .vibe713 .halo {
      position: absolute; inset: 8%;
      border-radius: 50%;
      border: 1px solid var(--ring);
      box-shadow:
        0 0 0 1px color-mix(in oklab, var(--acc-1) 10%, transparent) inset,
        0 0 60px color-mix(in oklab, var(--acc-1) 20%, transparent),
        0 0 140px color-mix(in oklab, var(--acc-2) 20%, transparent) inset;
      pointer-events: none;
    }
    .vibe713 .meteors { position: absolute; inset: 0; pointer-events: none; z-index: 2; }
    .vibe713 .meteor {
      position: absolute; top: -10%; left: -10%;
      width: 180px; height: 2px; border-radius: 2px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.9), transparent 70%);
      transform: rotate(20deg);
      filter: blur(0.5px); opacity: 0.45;
      animation: streak 6s linear infinite;
    }
    .vibe713 .meteor.delay1 { animation-delay: 2s; transform: rotate(28deg); }
    .vibe713 .meteor.delay2 { animation-delay: 4s; transform: rotate(14deg); }
    @keyframes streak {
      0% { transform: translate(-10%, -10%) rotate(20deg); opacity: 0; }
      10% { opacity: 0.5; }
      50% { transform: translate(120%, 80%) rotate(20deg); opacity: 0.25; }
      100% { transform: translate(140%, 100%) rotate(20deg); opacity: 0; }
    }

    /* Notes */
    .vibe713 .notes {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;
      margin-top: clamp(14px, 3vw, 22px);
    }
    @media (max-width: 760px) { .vibe713 .notes { grid-template-columns: 1fr; } }
    .vibe713 .note {
      padding: 14px; border-radius: 14px; border: 1px solid var(--line);
      background: color-mix(in oklab, rgba(255,255,255,0.06) 60%, transparent);
      box-shadow: 0 10px 24px rgba(0,0,0,0.28);
    }
    .vibe713 .note h3 { margin: 0 0 4px; font-size: 11px; font-weight: 900; letter-spacing: 0.28px; text-transform: uppercase; color: var(--muted); }
    .vibe713 .note p { margin: 0; font-size: 13px; color: var(--ink); font-weight: 800; }

    /* Footer */
    .vibe713 .foot {
      position: relative; z-index: 1; margin-top: clamp(16px, 3.2vw, 22px);
      display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: space-between;
      color: var(--muted); font-size: 12px;
    }
    .vibe713 .stamp {
      display: inline-flex; align-items: center; gap: 8px; padding: 8px 10px; border-radius: 999px;
      border: 1px solid var(--line);
      background: color-mix(in oklab, rgba(255,255,255,0.06) 60%, transparent);
      box-shadow: 0 6px 18px rgba(0,0,0,0.28);
    }
    .vibe713 .ping {
      width: 6px; height: 6px; border-radius: 50%;
      background: linear-gradient(135deg, var(--acc-2), var(--acc-1));
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--acc-2) 22%, transparent);
    }

    /* Accessibility: reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .vibe713 * { animation: none !important; transition: none !important; }
    }
  </style>

  <div class="grain" aria-hidden="true"></div>

  <div class="wrap">
    <div class="head">
      <span class="chip">Iteration 713 • Kinetic Almanac</span>
      <h1>Orbits you can feel.</h1>
      <p class="lead">Tip the vault with your cursor. Tune the drift. Watch a small universe negotiate with your touch.</p>
    </div>

    <div class="controls" role="group" aria-label="Controls">
      <div class="seg-group" role="tablist" aria-label="Mode">
        <button class="seg active" role="tab" aria-selected="true" data-mode="aurora">Aurora</button>
        <button class="seg" role="tab" aria-selected="false" data-mode="ember">Ember</button>
        <button class="seg" role="tab" aria-selected="false" data-mode="mono">Mono</button>
      </div>

      <label class="knob" title="Drift">
        Drift
        <input class="range" type="range" min="30" max="200" value="90" aria-label="Drift">
      </label>

      <button class="btn play" type="button" data-action="flow">Pause</button>
      <button class="btn ghost" type="button" data-action="burst">Burst</button>
      <button class="btn ghost" type="button" data-action="trails">Trails</button>
    </div>

    <div class="stage" role="application" aria-label="Orbital field" tabindex="0">
      <canvas class="sky" aria-hidden="true"></canvas>
      <div class="halo" aria-hidden="true"></div>
      <div class="meteors" aria-hidden="true">
        <span class="meteor"></span>
        <span class="meteor delay1"></span>
        <span class="meteor delay2"></span>
      </div>
    </div>

    <div class="notes" aria-hidden="true">
      <div class="note"><h3>Particles</h3><p class="count">—</p></div>
      <div class="note"><h3>Drift</h3><p class="drift-val">0.90×</p></div>
      <div class="note"><h3>Mode</h3><p class="mode-val">Aurora</p></div>
    </div>

    <div class="foot">
      <span class="stamp"><span class="ping" aria-hidden="true"></span><span id="last-updated">Last updated: 2025-11-18 02:18:02 EST</span></span>
      <span class="stamp"><span class="ping" aria-hidden="true"></span><span class="now">Local time — --:--:--</span></span>
    </div>
  </div>

  <script>
    (function () {
      const root = document.querySelector('.vibe713');
      const stage = root.querySelector('.stage');
      const canvas = root.querySelector('.sky');
      const ctx = canvas.getContext('2d', { alpha: true });
      const segs = root.querySelectorAll('.seg');
      const range = root.querySelector('.range');
      const flowBtn = root.querySelector('[data-action="flow"]');
      const burstBtn = root.querySelector('[data-action="burst"]');
      const trailsBtn = root.querySelector('[data-action="trails"]');
      const countEl = root.querySelector('.count');
      const driftEl = root.querySelector('.drift-val');
      const modeEl = root.querySelector('.mode-val');
      const updated = root.querySelector('#last-updated');
      const nowEl = root.querySelector('.now');

      const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      const palettes = {
        aurora: ['#72f7ff', '#b59cff', '#77ffb1', '#7ad1ff', '#ffffff'],
        ember:  ['#ffb56b', '#ff6d9b', '#ffd36b', '#ff8a6b', '#ffffff'],
        mono:   ['#e3e8ff', '#9cc2ff', '#b6c2ff', '#ffffff', '#d7e1ff']
      };

      let mode = root.dataset.mode || 'aurora';
      let palette = palettes[mode].slice();
      let speed = Number(range.value) / 100;
      root.style.setProperty('--speed', speed.toFixed(2));
      let trails = false;
      let running = true;

      let w = 0, h = 0, dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      let cx = 0, cy = 0;
      let animId = 0;
      let particles = [];
      let attract = { x: 0.5, y: 0.5, active: false };

      function setMode(m) {
        mode = m;
        root.dataset.mode = m;
        segs.forEach(b => {
          const on = b.dataset.mode === m;
          b.classList.toggle('active', on);
          b.setAttribute('aria-selected', on ? 'true' : 'false');
        });
        palette = palettes[m].slice();
        if (modeEl) modeEl.textContent = m.charAt(0).toUpperCase() + m.slice(1);
        clearCanvas(true);
      }
      segs.forEach(b => b.addEventListener('click', () => setMode(b.dataset.mode)));
      setMode(mode);

      function onDrift() {
        speed = Number(range.value) / 100; // 0.3..2.0
        root.style.setProperty('--speed', speed.toFixed(2));
        if (driftEl) driftEl.textContent = speed.toFixed(2) + '×';
      }
      range.addEventListener('input', onDrift);
      onDrift();

      function resize() {
        const r = stage.getBoundingClientRect();
        w = Math.max(1, Math.floor(r.width));
        h = Math.max(1, Math.floor(r.height));
        const cw = Math.floor(w * dpr), ch = Math.floor(h * dpr);
        canvas.width = cw; canvas.height = ch;
        canvas.style.width = w + 'px'; canvas.style.height = h + 'px';
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        cx = w / 2; cy = h / 2;
        initParticles();
        clearCanvas(true);
      }
      window.addEventListener('resize', resize, { passive: true });

      function initParticles() {
        const density = Math.round(Math.min(180, Math.max(70, w * h / 12000)));
        particles = [];
        for (let i = 0; i < density; i++) {
          const r = (Math.random() ** 0.8) * (Math.min(w, h) * 0.45) + 6;
          const a = Math.random() * Math.PI * 2;
          const sp = (Math.random() * 0.6 + 0.2) * (Math.random() < 0.5 ? -1 : 1);
          const sz = Math.random() * 1.8 + 0.6;
          const hue = palette[i % palette.length];
          particles.push({ r, a, sp, sz, hue, wobble: Math.random() * 0.8 + 0.4, life: Math.random() * 1000 });
        }
        if (countEl) countEl.textContent = particles.length.toString();
      }

      function clearCanvas(hard = false) {
        if (hard || !trails) {
          ctx.clearRect(0, 0, w, h);
        } else {
          ctx.save();
          ctx.globalCompositeOperation = 'source-over';
          ctx.fillStyle = 'rgba(0, 0, 0, 0.07)';
          ctx.fillRect(0, 0, w, h);
          ctx.restore();
        }
      }

      function hexToRgba(hex, a) {
        const h = hex.replace('#', '');
        const bigint = parseInt(h.length === 3 ? h.split('').map(x => x + x).join('') : h, 16);
        const r = (bigint >> 16) & 255;
        const g = (bigint >> 8) & 255;
        const b = bigint & 255;
        return `rgba(${r}, ${g}, ${b}, ${a})`;
      }

      function draw(ts = 0) {
        if (!running) return;
        clearCanvas(false);

        const t = ts / 1000;
        ctx.save();
        ctx.globalCompositeOperation = 'lighter';

        const ax = attract.active ? attract.x * w : cx;
        const ay = attract.active ? attract.y * h : cy;

        // soft center glow
        const grd = ctx.createRadialGradient(ax, ay, 0, ax, ay, Math.min(w, h) * 0.6);
        grd.addColorStop(0, hexToRgba(palette[0], 0.12));
        grd.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = grd;
        ctx.fillRect(0, 0, w, h);

        for (let i = 0; i < particles.length; i++) {
          const p = particles[i];
          p.a += p.sp * speed * 0.6 * (1 + Math.sin((t + p.life) * p.wobble) * 0.25);

          // Gentle attraction toward pointer/center
          const rr = p.r + Math.sin(t * 0.6 + i) * 2.2;
          const x = ax + rr * Math.cos(p.a);
          const y = ay + rr * Math.sin(p.a);

          // path as short comet
          const tail = 10 + p.sz * 12;
          const x2 = ax + (rr - tail) * Math.cos(p.a - 0.06);
          const y2 = ay + (rr - tail) * Math.sin(p.a - 0.06);

          const alpha = trails ? 0.12 : 0.22;
          ctx.strokeStyle = hexToRgba(p.hue, alpha);
          ctx.lineWidth = p.sz + (trails ? 0.4 : 0);
          ctx.beginPath();
          ctx.moveTo(x2, y2);
          ctx.lineTo(x, y);
          ctx.stroke();

          // dot
          ctx.fillStyle = hexToRgba(p.hue, 0.7);
          ctx.beginPath();
          ctx.arc(x, y, Math.max(0.6, p.sz * 0.7), 0, Math.PI * 2);
          ctx.fill();
        }

        ctx.restore();
        animId = requestAnimationFrame(draw);
      }

      function burst() {
        // Randomize radii/angles gently; create a quick flash
        for (let i = 0; i < particles.length; i++) {
          const p = particles[i];
          p.a += (Math.random() - 0.5) * Math.PI;
          p.r *= (Math.random() * 0.2 + 0.9);
          p.sp *= (Math.random() * 0.6 + 0.7) * (Math.random() < 0.5 ? -1 : 1);
        }
        // flash
        ctx.save();
        ctx.globalCompositeOperation = 'screen';
        ctx.fillStyle = 'rgba(255,255,255,0.06)';
        ctx.fillRect(0, 0, w, h);
        ctx.restore();
      }

      function play() {
        if (!running) {
          running = true;
          flowBtn.textContent = 'Pause';
          animId = requestAnimationFrame(draw);
        }
      }
      function pause() {
        running = false;
        flowBtn.textContent = 'Flow';
        cancelAnimationFrame(animId);
      }

      flowBtn.addEventListener('click', () => running ? pause() : play());
      burstBtn.addEventListener('click', burst);
      trailsBtn.addEventListener('click', () => {
        trails = !trails;
        trailsBtn.classList.toggle('active', trails);
        trailsBtn.textContent = trails ? 'Trails On' : 'Trails';
        clearCanvas(true);
      });

      function onMove(e) {
        const r = stage.getBoundingClientRect();
        const ex = (e.clientX ?? (e.touches && e.touches[0].clientX)) - r.left;
        const ey = (e.clientY ?? (e.touches && e.touches[0].clientY)) - r.top;
        const nx = Math.max(0, Math.min(r.width, ex)) / r.width;
        const ny = Math.max(0, Math.min(r.height, ey)) / r.height;

        attract.x = nx; attract.y = ny; attract.active = true;

        root.style.setProperty('--tiltX', ((nx - 0.5) * 16).toFixed(2) + 'deg');
        root.style.setProperty('--tiltY', ((0.5 - ny) * 16).toFixed(2) + 'deg');
        root.style.setProperty('--shiftX', ((nx - 0.5) * 24).toFixed(2) + 'px');
        root.style.setProperty('--shiftY', ((ny - 0.5) * 24).toFixed(2) + 'px');
      }
      function onLeave() {
        attract.active = false;
        root.style.setProperty('--tiltX', '0deg');
        root.style.setProperty('--tiltY', '0deg');
        root.style.setProperty('--shiftX', '0px');
        root.style.setProperty('--shiftY', '0px');
      }
      stage.addEventListener('pointermove', onMove, { passive: true });
      stage.addEventListener('touchmove', onMove, { passive: true });
      stage.addEventListener('pointerleave', onLeave, { passive: true });

      stage.addEventListener('keydown', (e) => {
        if (e.key === ' ') { e.preventDefault(); running ? pause() : play(); }
        if (e.key.toLowerCase() === 'b' || e.key === 'Enter') { e.preventDefault(); burst(); }
      });

      // Start
      resize();
      if (!reduce) {
        play();
      } else {
        pause();
        draw(0);
      }

      // Time + updated stamp
      function tick(){
        const now = new Date();
        const hh = now.getHours().toString().padStart(2,'0');
        const mm = now.getMinutes().toString().padStart(2,'0');
        const ss = now.getSeconds().toString().padStart(2,'0');
        if (nowEl) nowEl.textContent = `Local time — ${hh}:${mm}:${ss}`;
      }
      setInterval(tick, 1000); tick();
      try {
        const fmt = new Intl.DateTimeFormat(undefined, {
          year:'numeric', month:'short', day:'2-digit',
          hour:'2-digit', minute:'2-digit', second:'2-digit',
          hour12:false, timeZoneName:'short'
        }).format(new Date());
        updated.textContent = 'Last updated: ' + fmt;
      } catch {
        updated.textContent = 'Last updated: ' + new Date().toLocaleString();
      }

      window.addEventListener('beforeunload', () => cancelAnimationFrame(animId));
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


