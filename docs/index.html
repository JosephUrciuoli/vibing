<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="vibe1583" data-theme="dawn" aria-live="polite">
  <style>
    /* Tokens */
    #vibe1583{
      --paper:#f7f9ff;
      --ink:#0e1421;
      --muted:#5a6883;
      --edge:rgba(14,20,33,.12);

      --p1:#6b9bff; /* prism blue */
      --p2:#7effc8; /* mint */
      --p3:#ff86b7; /* bloom */
      --p4:#ffc96d; /* honey */

      --glass:linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.55));
      --blur: saturate(120%) contrast(105%);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--ink);
      border-radius:28px;
      padding:clamp(16px,3.5vw,40px);
      background:
        radial-gradient(160% 140% at 0% -20%, color-mix(in oklab, var(--p2) 16%, transparent), transparent 40%),
        radial-gradient(160% 160% at 110% 120%, color-mix(in oklab, var(--p3) 18%, transparent), transparent 46%),
        linear-gradient(180deg, #fff, var(--paper));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.8),
        0 24px 70px rgba(14,20,33,.12);
      position:relative;
      overflow:hidden;
      isolation:isolate;
    }

    /* Ambient aurora */
    #vibe1583::before,
    #vibe1583::after{
      content:"";
      position:absolute; inset:-35%;
      pointer-events:none; z-index:0;
    }
    #vibe1583::before{
      background:
        conic-gradient(from 0deg at 50% 50%, color-mix(in oklab, var(--p1) 18%, transparent), transparent 26%, color-mix(in oklab, var(--p3) 14%, transparent) 48%, transparent 70%, color-mix(in oklab, var(--p2) 16%, transparent) 88%, transparent);
      filter: blur(48px);
      opacity:.5;
      animation: aurora-pan 32s ease-in-out infinite alternate;
    }
    #vibe1583::after{
      background:
        radial-gradient(120px 120px at 15% 20%, rgba(255,255,255,.38), transparent 70%),
        radial-gradient(160px 160px at 85% 80%, rgba(255,255,255,.30), transparent 72%);
      mix-blend-mode: overlay;
      opacity:.35;
      animation: drift-bg 40s linear infinite;
    }
    @keyframes aurora-pan{
      0%{ transform: rotate(0deg) scale(1.04) translate3d(-2%,1%,0);}
      100%{ transform: rotate(18deg) scale(1.1) translate3d(2%,-2%,0);}
    }
    @keyframes drift-bg{
      0%{ transform: translate3d(0,0,0); }
      100%{ transform: translate3d(-6%, -6%, 0); }
    }

    /* Top chrome */
    #vibe1583 .bar{
      display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:14px;
      position:relative; z-index:2;
    }
    #vibe1583 .mark{
      display:inline-flex; align-items:center; gap:10px; padding:10px 14px; border-radius:14px;
      background:var(--glass); backdrop-filter: blur(8px);
      border:1px solid var(--edge);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9), 0 10px 22px rgba(14,20,33,.10);
      font-weight:900; letter-spacing:.18em; text-transform:uppercase; font-size:11px;
    }
    #vibe1583 .prism{
      width:16px; height:16px; border-radius:4px; transform: rotate(45deg);
      background:
        conic-gradient(from 0deg, var(--p1), var(--p3), var(--p4), var(--p2), var(--p1));
      box-shadow: 0 0 0 6px rgba(107,155,255,.12), 0 16px 30px rgba(14,20,33,.16);
    }
    #vibe1583 .badge{ color:var(--muted); font-weight:700; font-size:12px; opacity:.9; text-wrap:balance; }

    /* Theme pills */
    #vibe1583 .themes{ display:flex; gap:8px; }
    #vibe1583 .chip{
      appearance:none; border:1px solid var(--edge);
      background:var(--glass); color:var(--ink);
      padding:8px 12px; border-radius:999px; font-weight:900; font-size:11px; letter-spacing:.08em; text-transform:uppercase; cursor:pointer;
      box-shadow: inset 0 1px 0 rgba(255,255,255,1), 0 10px 20px rgba(14,20,33,.08);
      transition: transform 120ms ease, box-shadow 200ms ease, background 200ms ease, color 200ms ease;
    }
    #vibe1583 .chip:hover{ transform: translateY(-1px); box-shadow: inset 0 1px 0 rgba(255,255,255,1), 0 18px 36px rgba(14,20,33,.15); }
    #vibe1583 .chip[aria-checked="true"]{
      background: linear-gradient(180deg, color-mix(in oklab, var(--p2) 85%, white), white);
      color:#0d141f;
    }

    /* Hero */
    #vibe1583 .hero{ margin: clamp(10px,3vw,26px) 0 8px; z-index:2; position:relative; }
    #vibe1583 .title{
      margin:0; line-height:.88; letter-spacing:-0.02em; font-weight:1000;
      font-size: clamp(42px, 9.6vw, 128px);
      background:
        linear-gradient(90deg, var(--ink), color-mix(in oklab, var(--p1) 65%, var(--ink)) 40%, color-mix(in oklab, var(--p3) 60%, var(--ink)));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-wrap:balance;
      position:relative;
    }
    #vibe1583 .title::after{
      content:""; position:absolute; left:0; right:0; bottom:.1em; height:8px; border-radius:999px;
      background: linear-gradient(90deg, color-mix(in oklab, var(--p1) 50%, transparent), color-mix(in oklab, var(--p3) 40%, transparent), color-mix(in oklab, var(--p2) 55%, transparent));
      filter: blur(12px); opacity:.55; pointer-events:none;
      animation: underline-glow 6s ease-in-out infinite alternate;
    }
    @keyframes underline-glow{ from{opacity:.35; transform: translateX(-2%);} to{opacity:.7; transform: translateX(2%);} }
    #vibe1583 .sub{ margin:.5rem 0 0; color:var(--muted); font-size: clamp(14px,2.2vw,18px); }

    /* Stage */
    #vibe1583 .stage{
      position:relative; margin-top: clamp(18px,3.2vw,32px);
      height: clamp(380px, 56vw, 720px); border-radius:22px; overflow:hidden;
      background:
        radial-gradient(140% 120% at 50% 50%, rgba(255,255,255,.9), rgba(255,255,255,.45) 60%, rgba(255,255,255,.2) 100%);
      border:1px solid var(--edge);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.85),
        inset 0 -1px 0 rgba(255,255,255,.55),
        0 28px 70px rgba(14,20,33,.18);
      transform-style: preserve-3d;
      transition: transform 300ms cubic-bezier(.2,.8,.2,1);
    }
    #vibe1583 canvas#aurora{ position:absolute; inset:0; width:100%; height:100%; display:block; }
    #vibe1583 .grid{
      position:absolute; inset:0; z-index:1; pointer-events:none; opacity:.35;
      background-image:
        url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'><g fill='none' stroke='rgba(14,20,33,0.06)' stroke-width='1'><path d='M0 60h120M60 0v120'/><circle cx='60' cy='60' r='58' stroke-dasharray='4 6'/></g></svg>");
      background-size: 160px 160px;
      mix-blend-mode: overlay;
    }

    /* HUD */
    #vibe1583 .hud{
      position:absolute; left:12px; right:12px; bottom:12px; z-index:2;
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
      background:var(--glass); backdrop-filter: blur(10px);
      border:1px solid var(--edge);
      border-radius:14px; padding:10px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9);
    }
    #vibe1583 .group{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    #vibe1583 .btn{
      appearance:none; border:1px solid var(--edge);
      background:var(--glass); color:var(--ink);
      padding:8px 12px; border-radius:10px; font-weight:900; cursor:pointer; font-size:12px;
      box-shadow: 0 12px 24px rgba(14,20,33,.12), inset 0 1px 0 rgba(255,255,255,1);
      transition: transform 120ms ease, box-shadow 180ms ease, background 220ms ease;
    }
    #vibe1583 .btn:hover{ transform: translateY(-1px); box-shadow: 0 18px 38px rgba(14,20,33,.18), inset 0 1px 0 rgba(255,255,255,1); }

    /* Foot */
    #vibe1583 .foot{ margin-top:16px; display:flex; align-items:center; justify-content:space-between; gap:10px; color:var(--muted); font-size:12px; z-index:2; position:relative; }
    #vibe1583 #last-updated{
      font-variant-numeric: tabular-nums; font-weight:900; color:var(--ink);
      background:var(--glass); border:1px solid var(--edge);
      padding:6px 10px; border-radius:10px; box-shadow: inset 0 1px 0 rgba(255,255,255,1);
    }

    /* Themes */
    #vibe1583[data-theme="dawn"]{
      --paper:#f7f9ff; --ink:#0e1421; --muted:#5a6883; --edge:rgba(14,20,33,.12);
      --p1:#6b9bff; --p2:#7effc8; --p3:#ff86b7; --p4:#ffc96d;
    }
    #vibe1583[data-theme="dusk"]{
      --paper:#fff5fb; --ink:#1f121d; --muted:#6c5368; --edge:rgba(31,18,29,.12);
      --p1:#ff6ea2; --p2:#ffd3e8; --p3:#8af3da; --p4:#ffde8a;
    }
    #vibe1583[data-theme="midnight"]{
      --paper:#0a0f18; --ink:#e6f0ff; --muted:#9ab0d4; --edge:rgba(255,255,255,.16);
      --p1:#79a7ff; --p2:#6ef3cd; --p3:#ff8bbd; --p4:#ffd06e;
      background:
        radial-gradient(160% 140% at 10% -10%, color-mix(in oklab, var(--p2) 18%, transparent), transparent 40%),
        radial-gradient(180% 160% at 120% 120%, color-mix(in oklab, var(--p3) 18%, transparent), transparent 50%),
        linear-gradient(180deg, #0c1320, #0a0f18);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.12),
        0 24px 70px rgba(0,0,0,.45);
    }
    #vibe1583[data-theme="mint"]{
      --paper:#eefcf7; --ink:#0d1311; --muted:#4f6b61; --edge:rgba(13,19,17,.12);
      --p1:#18d4b4; --p2:#71ffd4; --p3:#2f6df6; --p4:#ffc86a;
    }

    /* Responsive */
    @media (max-width:760px){
      #vibe1583 .bar{ grid-template-columns:1fr; }
      #vibe1583 .badge{ display:none; }
      #vibe1583 .title{ font-size: clamp(40px, 12vw, 108px); }
      #vibe1583 .hud{ left:10px; right:10px; }
    }
    @media (prefers-reduced-motion: reduce){
      #vibe1583::before, #vibe1583::after{ animation:none; }
      #vibe1583 .title::after{ animation:none; }
      #vibe1583 .stage{ transition:none; }
    }
  </style>

  <div class="bar">
    <span class="mark"><span class="prism" aria-hidden="true"></span>AURORA</span>
    <div class="badge" aria-hidden="true">v1583 — Resonant Light Studio</div>
    <div class="themes" role="radiogroup" aria-label="Theme">
      <button type="button" class="chip theme" data-theme="dawn" aria-checked="true">Dawn</button>
      <button type="button" class="chip theme" data-theme="dusk" aria-checked="false">Dusk</button>
      <button type="button" class="chip theme" data-theme="midnight" aria-checked="false">Midnight</button>
      <button type="button" class="chip theme" data-theme="mint" aria-checked="false">Mint</button>
    </div>
  </div>

  <div class="hero">
    <h1 class="title" role="heading" aria-level="1">Aurora Atelier</h1>
    <p class="sub">Sketch light. Sculpt motion. Capture a poster.</p>
  </div>

  <div class="stage" role="img" aria-label="Prismatic orbits and luminous petals swirling under glass">
    <canvas id="aurora"></canvas>
    <div class="grid" aria-hidden="true"></div>
    <div class="hud" role="group" aria-label="Aurora controls">
      <div class="group" role="radiogroup" aria-label="Mode">
        <button type="button" class="chip mode" data-mode="orbit" aria-checked="true">Orbit</button>
        <button type="button" class="chip mode" data-mode="bloom" aria-checked="false">Bloom</button>
        <button type="button" class="chip mode" data-mode="trail" aria-checked="false">Trail</button>
      </div>
      <div class="group">
        <button type="button" class="btn" id="randomize">Shuffle</button>
        <button type="button" class="btn" id="toggle">Pause</button>
        <button type="button" class="btn" id="save">Save Poster</button>
      </div>
    </div>
  </div>

  <div class="foot">
    <span>“Light behaves when you invite it to play.”</span>
    <span id="last-updated">Last updated: 2025-12-28 11:22:38 EST</span>
  </div>

  <script>
    (function(){
      const root = document.getElementById('vibe1583');

      // Last updated
      const lu = root.querySelector('#last-updated');
      try{
        const now = new Date();
        const opts = { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' };
        lu.textContent = 'Updated ' + now.toLocaleString([], opts);
      }catch(e){}

      // Elements
      const stage = root.querySelector('.stage');
      const canvas = root.querySelector('#aurora');
      const ctx = canvas.getContext('2d', { alpha:true });
      let dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));

      function fit(){
        const r = stage.getBoundingClientRect();
        canvas.width = Math.floor(r.width * dpr);
        canvas.height = Math.floor(r.height * dpr);
        canvas.style.width = r.width + 'px';
        canvas.style.height = r.height + 'px';
        ctx.setTransform(1,0,0,1,0,0);
      }
      fit();
      window.addEventListener('resize', ()=>{ dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1)); fit(); initSystem(); });

      // Tilt + pointer
      const target = { x:0.5, y:0.5 };
      const center = { x:0.5, y:0.5 };
      function onPoint(e){
        const r = stage.getBoundingClientRect();
        const pt = e.touches ? e.touches[0] : e;
        target.x = Math.max(0, Math.min(1, (pt.clientX - r.left) / r.width));
        target.y = Math.max(0, Math.min(1, (pt.clientY - r.top) / r.height));
      }
      stage.addEventListener('pointermove', onPoint, { passive:true });
      stage.addEventListener('touchmove', onPoint, { passive:true });
      stage.addEventListener('pointermove', ()=>{
        const tiltX = (target.y - 0.5) * -7;
        const tiltY = (target.x - 0.5) * 10;
        stage.style.transform = `perspective(900px) rotateX(${tiltX}deg) rotateY(${tiltY}deg)`;
      });
      stage.addEventListener('pointerleave', ()=>{
        target.x = 0.5; target.y = 0.5;
        stage.style.transform = `perspective(900px) rotateX(0deg) rotateY(0deg)`;
      });

      // Theme switching
      const themes = Array.from(root.querySelectorAll('.theme'));
      function setTheme(btn){
        themes.forEach(b=>b.setAttribute('aria-checked', String(b===btn)));
        root.setAttribute('data-theme', btn.dataset.theme);
        palette = readPalette();
        flash(btn);
      }
      themes.forEach(b=>{
        b.addEventListener('click', ()=> setTheme(b));
        b.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); setTheme(b); }});
      });

      // Utilities
      function cssVar(name){ return getComputedStyle(root).getPropertyValue(name).trim() || '#ffffff'; }
      function hexToRgb(hex){
        let h = hex.replace('#','').trim();
        if(h.length===3){ h = h.split('').map(x=>x+x).join(''); }
        const n = parseInt(h,16); return [(n>>16)&255, (n>>8)&255, n&255];
      }
      function rgba(c,a){ return `rgba(${c[0]},${c[1]},${c[2]},${a})`; }
      const lerp = (a,b,t)=>a+(b-a)*t;
      function flash(el){
        el.animate([{ filter:'saturate(160%) brightness(1.06)' }, { filter:'saturate(115%) brightness(1)' }], { duration:420, easing:'cubic-bezier(.2,.8,.2,1)' });
      }

      // Palette
      function readPalette(){ return ['--p1','--p2','--p3','--p4'].map(k=>hexToRgb(cssVar(k))); }
      let palette = readPalette();

      // Modes
      const modes = Array.from(root.querySelectorAll('.mode'));
      let mode = 'orbit';
      function setMode(btn){
        modes.forEach(b=>b.setAttribute('aria-checked', String(b===btn)));
        mode = btn.dataset.mode;
        initSystem();
        flash(btn);
      }
      modes.forEach(b=>{
        b.addEventListener('click', ()=> setMode(b));
        b.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); setMode(b); }});
      });

      // System
      let seeds = {};
      let particles = [];
      function initSystem(){
        const w = canvas.width, h = canvas.height;
        particles = [];
        // Seed parameters
        seeds = {
          count: { orbit: 5 + Math.floor(Math.random()*4), bloom: 7 + Math.floor(Math.random()*5), trail: 90 + Math.floor(Math.random()*60) }[mode],
          speed: { orbit: 0.004, bloom: 0.006, trail: 0.02 }[mode],
          k: 2 + Math.floor(Math.random()*6), // for blooms
          lissa: [1+Math.floor(Math.random()*5), 2+Math.floor(Math.random()*6)], // for orbits
        };
        // Initialize particles
        for(let i=0;i<seeds.count;i++){
          const col = palette[i % palette.length];
          particles.push({
            hue: col,
            t: Math.random()*Math.PI*2,
            r: Math.min(w,h) * (mode==='trail' ? (0.08 + Math.random()*0.42) : (0.18 + i * (0.65/(seeds.count-1 || 1)))),
            w: (mode==='trail' ? (1 + Math.random()*2) : (8 - i*0.8)) * dpr,
            spin: (Math.random()*2-1) * (mode==='trail' ? 0.9 : 0.3),
            off: Math.random()*1000
          });
        }
      }

      // Buttons
      const randomBtn = root.querySelector('#randomize');
      const toggleBtn = root.querySelector('#toggle');
      const saveBtn = root.querySelector('#save');
      randomBtn.addEventListener('click', ()=>{ initSystem(); flash(randomBtn); });
      let running = true;
      toggleBtn.addEventListener('click', ()=>{
        running = !running; toggleBtn.textContent = running ? 'Pause' : 'Play';
        if(running) requestAnimationFrame(loop);
      });
      saveBtn.addEventListener('click', ()=>{
        try{
          const rect = canvas.getBoundingClientRect();
          const scale = 2;
          const off = document.createElement('canvas');
          off.width = Math.floor(rect.width*scale);
          off.height = Math.floor(rect.height*scale);
          const octx = off.getContext('2d');
          const light = root.getAttribute('data-theme')!=='midnight';
          octx.fillStyle = light ? '#ffffff' : '#0a0f18';
          octx.fillRect(0,0,off.width,off.height);
          octx.drawImage(canvas, 0, 0, off.width, off.height);
          off.toBlob((blob)=>{
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'aurora-1583.png';
            document.body.appendChild(a); a.click(); URL.revokeObjectURL(a.href); a.remove();
          });
          flash(saveBtn);
        }catch(e){}
      });

      // Draw
      let t = 0;
      let reduce = false; try{ reduce = matchMedia('(prefers-reduced-motion: reduce)').matches; }catch(_){}
      function draw(){
        const w = canvas.width, h = canvas.height;
        center.x = lerp(center.x, target.x, 0.06);
        center.y = lerp(center.y, target.y, 0.06);

        // Fade for trail mode, clear for others
        if(mode==='trail'){
          const light = root.getAttribute('data-theme')!=='midnight';
          ctx.fillStyle = light ? 'rgba(255,255,255,0.06)' : 'rgba(10,15,24,0.06)';
          ctx.fillRect(0,0,w,h);
        }else{
          ctx.clearRect(0,0,w,h);
        }

        const cx = w*0.5, cy = h*0.5;
        const px = (center.x-0.5)*2, py = (center.y-0.5)*2;
        const light = root.getAttribute('data-theme')!=='midnight';
        ctx.globalCompositeOperation = light ? 'multiply' : 'screen';

        // Central lens glow
        const iris = hexToRgb(cssVar('--p2'));
        ctx.beginPath();
        ctx.arc(cx + px*50*dpr, cy + py*50*dpr, Math.min(w,h)*0.065, 0, Math.PI*2);
        ctx.fillStyle = rgba(iris, light ? 0.08 : 0.18);
        ctx.fill();

        // Orbits / blooms / trails
        const steps = 220;
        particles.forEach((p, i)=>{
          const col = p.hue;
          const alpha = light ? 0.23 : 0.55;
          const glow = light ? 0 : 18*dpr;

          if(mode!=='trail'){
            const grad = ctx.createLinearGradient(0,0,w,0);
            grad.addColorStop(0, rgba(col, alpha*0.95));
            grad.addColorStop(0.5, rgba(col, alpha*0.65));
            grad.addColorStop(1, rgba(col, alpha*0.95));
            ctx.lineWidth = Math.max(1, p.w);
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = grad;
            ctx.shadowBlur = glow;
            ctx.shadowColor = rgba(col, light ? 0 : 0.3);
            ctx.beginPath();
          }

          for(let s=0; s<=steps; s++){
            const tt = (s/steps) * Math.PI*2;
            const ox = Math.cos(tt + p.t + p.off*0.0005);
            const oy = Math.sin(tt + p.t + p.off*0.0005);

            let x, y;
            if(mode==='orbit'){
              // Lissajous
              const a = seeds.lissa[0], b = seeds.lissa[1];
              x = cx + (Math.sin(a*tt + t*2 + px*3) * p.r * (0.8 + 0.2*Math.sin(t + i)));
              y = cy + (Math.sin(b*tt + t*2 + py*3) * p.r * (0.8 + 0.2*Math.cos(t*1.3 + i)));
            }else if(mode==='bloom'){
              // Rose curve r = sin(k*theta)
              const r = Math.sin(seeds.k * tt + t*1.2 + i) * p.r;
              x = cx + (r * Math.cos(tt + px*2));
              y = cy + (r * Math.sin(tt + py*2));
            }else{ // trail
              // Particle swirl attracted to pointer
              p.t += (p.spin*0.006) + Math.sin(t + i)*0.0004;
              const ang = t*0.8 + p.t + i*0.3;
              const rad = p.r * (0.6 + 0.4*Math.sin(t*0.6 + i));
              const tx = cx + px * w*0.28;
              const ty = cy + py * h*0.28;
              x = tx + Math.cos(ang)*rad + ox*6*dpr;
              y = ty + Math.sin(ang)*rad + oy*6*dpr;

              // Draw dot
              ctx.fillStyle = rgba(col, light ? 0.32 : 0.7);
              ctx.shadowBlur = glow*0.6;
              ctx.shadowColor = rgba(col, light ? 0 : 0.35);
              ctx.beginPath();
              ctx.arc(x, y, Math.max(0.8, p.w*0.6), 0, Math.PI*2);
              ctx.fill();
              continue;
            }

            if(s===0 && mode!=='trail') ctx.moveTo(x,y);
            else if(mode!=='trail') ctx.lineTo(x,y);
          }

          if(mode!=='trail'){
            ctx.stroke();
            if(!light){
              ctx.lineWidth = p.w*0.55;
              ctx.strokeStyle = rgba(col, 0.08);
              ctx.shadowBlur = 36*dpr;
              ctx.shadowColor = rgba(col, 0.25);
              ctx.stroke();
            }
          }

          p.t += seeds.speed;
        });

        // Halo ring
        ctx.beginPath();
        ctx.arc(cx, cy, Math.min(w,h)*0.36, 0, Math.PI*2);
        ctx.strokeStyle = rgba(hexToRgb(cssVar('--p1')), light ? 0.06 : 0.14);
        ctx.lineWidth = 2*dpr;
        ctx.stroke();

        t += reduce ? 0.003 : 0.006;
      }

      function loop(){
        if(!running) return;
        draw();
        requestAnimationFrame(loop);
      }

      // Init
      initSystem();
      requestAnimationFrame(loop);
    }());
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


