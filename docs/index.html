<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div class="vibe189" data-scene="Aurora Orrery Observatory">
  <style>
    .vibe189 {
      --bg1: #070b12;
      --bg2: #111e2b;
      --ink: #f6fbff;
      --muted: rgba(246,251,255,0.74);
      --glass: rgba(255,255,255,0.08);
      --border: rgba(255,255,255,0.16);
      --ac1: #7cf6ff;
      --ac2: #9b86ff;
      --ac3: #6af7c9;
      --ring: rgba(255,255,255,0.12);
      --play: 1;
      --t: 0;
      --rx: 0deg;
      --ry: 0deg;
      position: relative;
      color: var(--ink);
      font-family: ui-rounded, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      border-radius: 28px;
      padding: clamp(16px, 3.6vw, 40px);
      background:
        radial-gradient(1200px 900px at -20% -40%, color-mix(in oklab, var(--ac2) 22%, transparent), transparent 60%),
        radial-gradient(1300px 900px at 120% 140%, color-mix(in oklab, var(--ac3) 20%, transparent), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      border: 1px solid var(--border);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06), 0 30px 80px rgba(0,0,0,0.35);
      overflow: hidden;
      isolation: isolate;
    }

    /* Ambient layers */
    .vibe189 .aurora, .vibe189 .grain, .vibe189 .halo {
      position: absolute; inset: -20%; pointer-events: none; z-index: 0;
    }
    .vibe189 .aurora {
      background:
        conic-gradient(from calc(var(--t)*0.25deg), rgba(255,255,255,0.05), rgba(155,134,255,0.08), rgba(122,255,217,0.09), rgba(255,255,255,0.03));
      filter: blur(18px) saturate(120%);
      mix-blend-mode: screen;
      transform: rotate(8deg) scale(1.2);
      opacity: 0.5;
    }
    .vibe189 .halo {
      inset: -30%;
      background:
        radial-gradient(60% 40% at 65% 18%, rgba(255,255,255,0.08), transparent 60%),
        radial-gradient(70% 50% at 12% 85%, rgba(255,255,255,0.06), transparent 60%);
      mix-blend-mode: overlay;
    }
    .vibe189 .grain {
      inset: 0;
      opacity: 0.08;
      background-image:
        radial-gradient(1px 1px at 14% 28%, #000 55%, transparent 56%),
        radial-gradient(1px 1px at 66% 62%, #000 55%, transparent 56%),
        radial-gradient(1px 1px at 84% 14%, #000 55%, transparent 56%),
        radial-gradient(1px 1px at 32% 82%, #000 55%, transparent 56%);
      background-size: 180px 180px, 220px 220px, 200px 200px, 260px 260px;
      mix-blend-mode: soft-light;
      animation: grain189 28s linear infinite;
    }
    @keyframes grain189 { 0% { transform: translate(0,0);} 100% { transform: translate(-4%, -6%);} }

    /* Layout frame */
    .vibe189 .deck {
      position: relative;
      z-index: 2;
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: clamp(12px, 2.2vw, 20px);
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.05));
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 22px;
      padding: clamp(14px, 3.2vw, 28px);
      box-shadow: 0 40px 120px rgba(0,0,0,0.35), inset 0 0 0 1px rgba(255,255,255,0.08);
      backdrop-filter: blur(10px) saturate(125%);
      transform-style: preserve-3d;
      transform: perspective(900px) rotateX(var(--rx)) rotateY(var(--ry));
      transition: transform 160ms ease-out;
    }

    /* Header */
    .vibe189 .top {
      display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap;
    }
    .vibe189 .badge {
      font-size: 11px; letter-spacing: 0.2em; text-transform: uppercase;
      color: #0e1220; background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(255,255,255,0.78));
      border: 1px solid rgba(0,0,0,0.08); border-radius: 999px; padding: 8px 12px; white-space: nowrap;
      box-shadow: 0 3px 12px rgba(0,0,0,0.08);
    }
    .vibe189 .controls { display: inline-flex; gap: 8px; flex-wrap: wrap; }
    .vibe189 .btn {
      appearance: none; border: 0; cursor: pointer;
      font-size: 12px; font-weight: 700; letter-spacing: 0.01em;
      padding: 10px 14px; border-radius: 12px;
      color: #0e1220; background: rgba(255,255,255,0.92);
      border: 1px solid rgba(0,0,0,0.08);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.6), 0 4px 14px rgba(0,0,0,0.10);
      transition: transform 140ms ease, box-shadow 180ms ease, background 180ms ease;
    }
    .vibe189 .btn:hover { transform: translateY(-1px); }
    .vibe189 .btn:focus-visible { outline: 2px solid color-mix(in oklab, var(--ac1) 60%, transparent); outline-offset: 2px; }
    .vibe189 .btn.primary {
      background: linear-gradient(135deg, var(--ac1), var(--ac2));
      box-shadow: 0 12px 26px color-mix(in oklab, var(--ac2) 30%, transparent), inset 0 -4px 8px rgba(0,0,0,0.12);
    }

    /* Hero Copy */
    .vibe189 .copy {
      display: grid; gap: 6px;
    }
    .vibe189 .kicker {
      font-size: 12px; letter-spacing: 0.28em; text-transform: uppercase;
      color: color-mix(in oklab, var(--ink) 65%, var(--ac2));
    }
    .vibe189 .title {
      margin: 2px 0 6px;
      font-size: clamp(34px, 7.5vw, 86px);
      line-height: 0.92; letter-spacing: -0.01em;
      background: linear-gradient(120deg, var(--ink), color-mix(in oklab, var(--ac2) 55%, var(--ink)) 50%, color-mix(in oklab, var(--ac1) 70%, var(--ink)) 100%);
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-shadow: 0 1px 0 rgba(255,255,255,0.35);
    }
    .vibe189 .lede {
      font-size: clamp(14px, 2.2vw, 18px);
      color: var(--muted);
      max-width: 68ch;
    }
    .vibe189 .note {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 10px; border-radius: 12px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12);
      color: var(--muted);
      font-size: 12px;
    }
    .vibe189 .sw { width: 10px; height: 10px; border-radius: 50%; box-shadow: 0 0 0 1px rgba(0,0,0,0.15) inset; }

    /* Orrery canvas */
    .vibe189 .orrery {
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.14);
      background:
        radial-gradient(120% 100% at 50% 10%, rgba(255,255,255,0.10), rgba(255,255,255,0.03)),
        linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08), 0 16px 46px rgba(0,0,0,0.26);
      aspect-ratio: 16 / 9;
      contain: paint;
      transform: translateZ(0);
    }
    .vibe189 .orrery canvas { position: absolute; inset: 0; width: 100%; height: 100%; display: block; }
    .vibe189 .overlay-ring {
      position: absolute; inset: 0; pointer-events: none; mix-blend-mode: overlay; opacity: 0.6;
      background:
        radial-gradient(circle at 50% 50%, transparent 58%, rgba(255,255,255,0.05) 59%, transparent 60%) no-repeat,
        conic-gradient(from calc(var(--t)*0.35deg), rgba(255,255,255,0.05) 0 10deg, transparent 10deg 20deg) no-repeat;
      background-size: 100% 100%, 140% 140%;
      background-position: center;
    }
    .vibe189 .grid {
      position: absolute; inset: 0; pointer-events: none;
      background:
        repeating-linear-gradient(90deg, var(--ring) 0 1px, transparent 1px 48px),
        repeating-linear-gradient(0deg, var(--ring) 0 1px, transparent 1px 48px);
      mask-image: radial-gradient(120% 100% at 50% 30%, rgba(0,0,0,1), transparent 70%);
      opacity: 0.35;
    }

    /* Footer */
    .vibe189 .foot {
      display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap;
      font-size: 13px; color: var(--muted);
      margin-top: 6px;
    }
    .vibe189 .left { display: inline-flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    .vibe189 .right { display: inline-flex; align-items: center; gap: 12px; }
    .vibe189 .stat {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.12);
      padding: 6px 10px; border-radius: 10px;
    }
    .vibe189 .progress {
      position: relative; height: 6px; min-width: 140px; flex: 1 1 auto;
      border-radius: 999px; background: rgba(255,255,255,0.08); overflow: hidden;
      border: 1px solid rgba(0,0,0,0.08);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08);
    }
    .vibe189 .progress span {
      position: absolute; left: 0; top: 0; bottom: 0; width: 0%;
      border-radius: inherit;
      background: linear-gradient(90deg, var(--ac1), var(--ac2), var(--ac3));
      box-shadow: 0 0 16px color-mix(in oklab, var(--ac2) 40%, transparent);
      transition: width 80ms linear;
    }
  </style>

  <div class="aurora" aria-hidden="true"></div>
  <div class="halo" aria-hidden="true"></div>
  <div class="grain" aria-hidden="true"></div>

  <section class="deck" role="region" aria-label="Aurora Orrery — kinetic timepiece">
    <div class="top">
      <span class="badge">Iteration 189 — Aurora Orrery</span>
      <div class="controls" role="group" aria-label="Controls">
        <button class="btn" id="theme189" aria-pressed="true">Lunar</button>
        <button class="btn" id="motion189" aria-pressed="true">Pause</button>
        <button class="btn primary" id="add189">Add Orbit</button>
      </div>
    </div>

    <div class="copy">
      <span class="kicker">Celestial Interface</span>
      <h1 class="title">Time, in Orbits</h1>
      <p class="lede">A glassy orrery that drifts with the clock. Press and hold to warp gravity; click to spawn new bodies. Smooth. Quiet. Cosmic.</p>
      <span class="note">
        Palette: <strong id="palette189">Lunar Frost</strong>
        <span class="sw" id="sw-1" style="background: var(--ac1)"></span>
        <span class="sw" id="sw-2" style="background: var(--ac2)"></span>
        <span class="sw" id="sw-3" style="background: var(--ac3)"></span>
      </span>
    </div>

    <div class="orrery" id="wrap189" role="img" aria-label="Generative orrery that responds to time and touch">
      <canvas id="canvas189"></canvas>
      <div class="overlay-ring" aria-hidden="true"></div>
      <div class="grid" aria-hidden="true"></div>
    </div>

    <div class="foot">
      <div class="left">
        <span class="stat">Orbits: <strong id="orbits189">—</strong></span>
        <span class="stat">Bodies: <strong id="bodies189">—</strong></span>
        <span id="last-updated">Last updated: 2025-10-25 05:15:47 EST</span>
      </div>
      <div class="right" aria-hidden="true">
        <span class="progress"><span></span></span>
      </div>
    </div>
  </section>

  <script>
    (function(){
      const root = document.currentScript.closest('.vibe189');
      const deck = root.querySelector('.deck');
      const wrap = root.querySelector('#wrap189');
      const canvas = root.querySelector('#canvas189');
      const ctx = canvas.getContext('2d');

      const themeBtn = root.querySelector('#theme189');
      const motionBtn = root.querySelector('#motion189');
      const addBtn = root.querySelector('#add189');
      const barFill = root.querySelector('.progress > span');
      const orbitsEl = root.querySelector('#orbits189');
      const bodiesEl = root.querySelector('#bodies189');
      const paletteEl = root.querySelector('#palette189');

      const themes = {
        lunar: {
          bg1:'#070b12', bg2:'#111e2b', ink:'#f6fbff', muted:'rgba(246,251,255,0.74)',
          glass:'rgba(255,255,255,0.08)', border:'rgba(255,255,255,0.16)',
          ac1:'#7cf6ff', ac2:'#9b86ff', ac3:'#6af7c9', ring:'rgba(255,255,255,0.12)', name:'Lunar Frost'
        },
        solar: {
          bg1:'#fff5e8', bg2:'#ffefd6', ink:'#121416', muted:'rgba(18,20,22,0.66)',
          glass:'rgba(255,255,255,0.66)', border:'rgba(18,20,22,0.12)',
          ac1:'#ffb25b', ac2:'#ff6ea6', ac3:'#5be7ff', ring:'rgba(18,20,22,0.08)', name:'Solar Peach'
        },
        dusk: {
          bg1:'#140b1f', bg2:'#2a1846', ink:'#faf5ff', muted:'rgba(250,245,255,0.74)',
          glass:'rgba(255,255,255,0.10)', border:'rgba(255,255,255,0.18)',
          ac1:'#e0aaff', ac2:'#72efdd', ac3:'#ffd166', ring:'rgba(255,255,255,0.12)', name:'Dusk Grape'
        }
      };
      let themeOrder = ['lunar','solar','dusk'];
      let themeIndex = 0;

      function setVars(map){
        for(const k in map){
          if (k==='name') continue;
          root.style.setProperty('--' + k.replace(/[A-Z]/g,m=>'-'+m.toLowerCase()), map[k]);
        }
        paletteEl.textContent = map.name;
        root.querySelector('#sw-1').style.background = getComputedStyle(root).getPropertyValue('--ac1');
        root.querySelector('#sw-2').style.background = getComputedStyle(root).getPropertyValue('--ac2');
        root.querySelector('#sw-3').style.background = getComputedStyle(root).getPropertyValue('--ac3');
        themeBtn.textContent = themeOrder[themeIndex].charAt(0).toUpperCase() + themeOrder[themeIndex].slice(1);
        themeBtn.setAttribute('aria-pressed', themeIndex === 0 ? 'true' : 'false');
        pulseTitle();
        updateTime();
      }

      function updateTime(){
        const el = root.querySelector('#last-updated');
        try {
          const dtf = new Intl.DateTimeFormat(undefined, {
            year:'numeric', month:'short', day:'2-digit',
            hour:'2-digit', minute:'2-digit', second:'2-digit',
            timeZoneName:'short'
          });
          el.textContent = 'Updated ' + dtf.format(new Date());
        } catch {
          el.textContent = 'Updated ' + new Date().toLocaleString();
        }
      }
      function pulseTitle(){
        const title = root.querySelector('.title');
        title.style.transition = 'none';
        title.style.filter = 'brightness(1.28)';
        requestAnimationFrame(()=>{ title.style.transition = 'filter 900ms ease'; title.style.filter = ''; });
      }

      // Tilt parallax
      function tilt(e){
        const r = deck.getBoundingClientRect();
        const x = (e.clientX ?? (e.touches && e.touches[0].clientX) ?? r.left + r.width/2) - r.left;
        const y = (e.clientY ?? (e.touches && e.touches[0].clientY) ?? r.top + r.height/2) - r.top;
        const px = (x / r.width) * 2 - 1;
        const py = (y / r.height) * 2 - 1;
        root.style.setProperty('--ry', (px * 4) + 'deg');
        root.style.setProperty('--rx', (-py * 3) + 'deg');
        root.style.setProperty('--t', ((performance.now()/1000*60)%360).toFixed(2));
      }
      deck.addEventListener('pointermove', tilt, {passive:true});
      deck.addEventListener('touchmove', tilt, {passive:true});

      // Canvas setup
      let dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      let w = 0, h = 0;
      let raf = null;
      const pointer = { x:0, y:0, down:false, inside:false };
      const stars = [];
      const orbits = [];
      const bodies = [];
      let comet = null;
      let t0 = performance.now();

      function resize(){
        const rect = wrap.getBoundingClientRect();
        w = Math.max(240, rect.width);
        h = Math.max(160, rect.height);
        canvas.width = Math.floor(w*dpr);
        canvas.height = Math.floor(h*dpr);
        canvas.style.width = w + 'px';
        canvas.style.height = h + 'px';
        ctx.setTransform(dpr,0,0,dpr,0,0);
        seedStars();
      }

      function rand(a,b){ return a + Math.random()*(b-a); }
      function choice(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

      function seedStars(){
        stars.length = 0;
        const count = Math.round((w*h)/12000);
        for(let i=0;i<count;i++){
          stars.push({
            x: Math.random()*w,
            y: Math.random()*h,
            r: rand(0.4,1.6),
            tw: rand(0,Math.PI*2)
          });
        }
      }

      function addOrbit(opts = {}){
        const cx = w/2, cy = h/2;
        const maxR = Math.min(w,h)*0.46;
        const r = opts.r ?? rand(Math.min(w,h)*0.12, maxR);
        const speed = (opts.speed ?? rand(0.3,1.3)) * (Math.random()<0.5?-1:1);
        const angle = rand(0, Math.PI*2);
        const wobble = rand(0.004, 0.02);
        const phase = rand(0, 1000);
        const bodiesCount = Math.random()<0.6 ? 1 : (Math.random()<0.2 ? 3 : 2);
        const col = [getVar('--ac1'), getVar('--ac2'), getVar('--ac3')];
        orbits.push({ r, speed, angle, wobble, phase });
        for(let i=0;i<bodiesCount;i++){
          bodies.push({
            orbitIndex: orbits.length-1,
            size: rand(3, 8) * (i===0?1.2:rand(0.6,1)),
            hue: choice(col),
            offset: rand(0, Math.PI*2),
            trail: []
          });
        }
        reflectStats();
      }

      function getVar(name){ return getComputedStyle(root).getPropertyValue(name).trim(); }

      function seedSystem(){
        orbits.length = 0;
        bodies.length = 0;
        const n = Math.round(rand(4,7));
        for(let i=0;i<n;i++){ addOrbit(); }
        reflectStats();
      }

      function reflectStats(){
        orbitsEl.textContent = orbits.length;
        bodiesEl.textContent = bodies.length;
      }

      function drawStars(t){
        for(const s of stars){
          const tw = 0.5 + 0.5*Math.sin(t*0.8 + s.tw);
          ctx.globalAlpha = 0.4 + 0.6*tw;
          ctx.fillStyle = 'white';
          ctx.beginPath(); ctx.arc(s.x, s.y, s.r*(0.8+tw*0.4), 0, Math.PI*2); ctx.fill();
        }
        ctx.globalAlpha = 1;
      }

      function drawOrbits(t){
        const cx = w/2, cy = h/2;
        ctx.save();
        ctx.translate(cx, cy);
        for(let i=0;i<orbits.length;i++){
          const o = orbits[i];
          const pulse = 1 + Math.sin(t*0.8 + o.phase)*0.02;
          ctx.globalAlpha = 0.25;
          const g = ctx.createRadialGradient(0,0,0,0,0,o.r*1.02);
          g.addColorStop(0, 'rgba(255,255,255,0.0)');
          g.addColorStop(1, getVar('--ring'));
          ctx.strokeStyle = g;
          ctx.lineWidth = 1.2;
          ctx.beginPath(); ctx.arc(0,0,o.r*pulse,0,Math.PI*2); ctx.stroke();
        }
        ctx.restore();
        ctx.globalAlpha = 1;
      }

      function drawTimeArcs(t){
        const cx = w/2, cy = h/2;
        const R = Math.min(w,h)*0.36;
        const now = new Date();
        const hr = (now.getHours()%12 + now.getMinutes()/60)/12;
        const mn = (now.getMinutes() + now.getSeconds()/60)/60;
        const sc = (now.getSeconds() + now.getMilliseconds()/1000)/60;

        ctx.save();
        ctx.translate(cx, cy);
        ctx.lineCap = 'round';
        // hours
        ctx.globalAlpha = 0.85;
        ctx.strokeStyle = getVar('--ac3');
        ctx.lineWidth = 6;
        arc(-Math.PI/2, -Math.PI/2 + hr*Math.PI*2, R*0.62);
        // minutes
        ctx.globalAlpha = 0.65;
        ctx.strokeStyle = getVar('--ac2');
        ctx.lineWidth = 4;
        arc(-Math.PI/2, -Math.PI/2 + mn*Math.PI*2, R*0.82);
        // seconds
        ctx.globalAlpha = 0.55;
        ctx.strokeStyle = getVar('--ac1');
        ctx.lineWidth = 3;
        arc(-Math.PI/2, -Math.PI/2 + sc*Math.PI*2, R*1.02);
        ctx.restore();
        ctx.globalAlpha = 1;

        function arc(a0,a1,r){
          ctx.beginPath(); ctx.arc(0,0,r,a0,a1); ctx.stroke();
        }
      }

      function drawBodies(t){
        const cx = w/2, cy = h/2;
        // gravity lens when holding
        if (pointer.down && pointer.inside){
          const g = ctx.createRadialGradient(pointer.x, pointer.y, 0, pointer.x, pointer.y, Math.min(w,h)*0.25);
          g.addColorStop(0, 'rgba(255,255,255,0.08)');
          g.addColorStop(1, 'rgba(255,255,255,0)');
          ctx.fillStyle = g;
          ctx.beginPath(); ctx.arc(pointer.x, pointer.y, Math.min(w,h)*0.3, 0, Math.PI*2); ctx.fill();
        }

        // comet
        if (!comet && Math.random()<0.002){
          comet = {
            x: Math.random()<0.5 ? -50 : w+50,
            y: rand(-30, h+30),
            vx: (Math.random()<0.5 ? 1 : -1)*rand(80, 140),
            vy: rand(-30, 30),
            life: rand(1.3, 2.2),
            t: 0,
            hue: choice([getVar('--ac1'), getVar('--ac2'), getVar('--ac3')])
          };
        }
        if (comet){
          comet.t += 1/60;
          comet.x += comet.vx/60;
          comet.y += comet.vy/60;
          const trailLen = 60;
          ctx.save();
          const grad = ctx.createLinearGradient(comet.x, comet.y, comet.x - comet.vx*0.2, comet.y - comet.vy*0.2);
          grad.addColorStop(0, 'rgba(255,255,255,0.0)');
          grad.addColorStop(1, comet.hue);
          ctx.strokeStyle = grad;
          ctx.globalAlpha = 0.6;
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(comet.x, comet.y);
          ctx.lineTo(comet.x - comet.vx*comet.life*0.06, comet.y - comet.vy*comet.life*0.06);
          ctx.stroke();
          ctx.globalAlpha = 1;
          ctx.fillStyle = comet.hue;
          ctx.beginPath(); ctx.arc(comet.x, comet.y, 2.2, 0, Math.PI*2); ctx.fill();
          ctx.restore();
          if (comet.t > comet.life || comet.x < -80 || comet.x > w+80) comet = null;
        }

        // bodies along orbits
        for(const b of bodies){
          const o = orbits[b.orbitIndex];
          o.angle += (o.speed * 0.005);
          const r = o.r * (1 + Math.sin(t*0.6 + o.phase)*o.wobble);
          let x = cx + Math.cos(o.angle + b.offset)*r;
          let y = cy + Math.sin(o.angle + b.offset)*r;

          // gentle attraction to pointer when pressed
          if (pointer.down && pointer.inside){
            const dx = (pointer.x - x), dy = (pointer.y - y);
            const dist = Math.hypot(dx, dy) || 1;
            const pull = Math.min(0.06, 50/(dist*dist));
            x += dx * pull; y += dy * pull;
          }

          // trail
          b.trail.push({x,y,life:1});
          if (b.trail.length>22) b.trail.shift();

          for(let i=0;i<b.trail.length-1;i++){
            const p1 = b.trail[i], p2 = b.trail[i+1];
            const a = i/b.trail.length;
            ctx.strokeStyle = b.hue;
            ctx.globalAlpha = 0.06 + 0.28*a*a;
            ctx.lineWidth = (b.size*0.55)*(a);
            ctx.beginPath(); ctx.moveTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
          }
          ctx.globalAlpha = 1;

          // body glow
          const g = ctx.createRadialGradient(x,y,0,x,y,b.size*6);
          g.addColorStop(0, b.hue);
          g.addColorStop(1, 'rgba(0,0,0,0)');
          ctx.fillStyle = g;
          ctx.globalAlpha = 0.55;
          ctx.beginPath(); ctx.arc(x,y, b.size*4, 0, Math.PI*2); ctx.fill();
          ctx.globalAlpha = 1;

          ctx.fillStyle = 'white';
          ctx.beginPath(); ctx.arc(x,y, b.size, 0, Math.PI*2); ctx.fill();
        }
      }

      function draw(ms){
        const elapsed = (ms - t0)/1000;
        root.style.setProperty('--t', ((elapsed*60)%360).toFixed(2));

        // minute progress
        const now = new Date();
        const s = now.getSeconds() + now.getMilliseconds()/1000;
        barFill.style.width = ((s/60)*100).toFixed(2) + '%';

        ctx.clearRect(0,0,w,h);

        // vignette
        const vign = ctx.createRadialGradient(w/2, h/2, Math.min(w,h)*0.2, w/2, h/2, Math.max(w,h)*0.7);
        vign.addColorStop(0, 'rgba(0,0,0,0)');
        vign.addColorStop(1, 'rgba(0,0,0,0.18)');
        ctx.fillStyle = vign; ctx.fillRect(0,0,w,h);

        drawStars(elapsed);
        drawOrbits(elapsed);
        drawTimeArcs(elapsed);
        drawBodies(elapsed);

        if (root.style.getPropertyValue('--play') === '1'){
          raf = requestAnimationFrame(draw);
        } else {
          cancelAnimationFrame(raf); raf = null;
        }
      }

      // Interaction
      function onMove(e){
        const rect = wrap.getBoundingClientRect();
        const x = (e.clientX ?? (e.touches && e.touches[0].clientX)) - rect.left;
        const y = (e.clientY ?? (e.touches && e.touches[0].clientY)) - rect.top;
        pointer.x = x; pointer.y = y;
        pointer.inside = x>=0 && x<=rect.width && y>=0 && y<=rect.height;
      }
      function onLeave(){ pointer.inside=false; pointer.down=false; }
      function onDown(e){ pointer.down = true; }
      function onUp(){ pointer.down = false; }

      wrap.addEventListener('pointermove', onMove, {passive:true});
      wrap.addEventListener('touchmove', onMove, {passive:true});
      wrap.addEventListener('pointerleave', onLeave);
      wrap.addEventListener('pointerdown', onDown);
      window.addEventListener('pointerup', onUp);

      // Controls
      themeBtn.addEventListener('click', () => {
        themeIndex = (themeIndex + 1) % themeOrder.length;
        setVars(themes[themeOrder[themeIndex]]);
      });
      motionBtn.addEventListener('click', () => {
        const on = root.style.getPropertyValue('--play') !== '0';
        if (on) { stop(); } else { start(); }
        motionBtn.textContent = on ? 'Play' : 'Pause';
        motionBtn.setAttribute('aria-pressed', (!on).toString());
      });
      addBtn.addEventListener('click', () => {
        addOrbit();
        pulseTitle();
      });

      function start(){ if(!raf){ root.style.setProperty('--play','1'); raf = requestAnimationFrame(draw);} }
      function stop(){ root.style.setProperty('--play','0'); if(raf){ cancelAnimationFrame(raf); raf=null; } }

      window.addEventListener('resize', resize);
      window.matchMedia('(prefers-reduced-motion: reduce)').addEventListener('change', e => {
        if (e.matches) { stop(); motionBtn.textContent = 'Play'; motionBtn.setAttribute('aria-pressed','false'); }
        else { start(); motionBtn.textContent = 'Pause'; motionBtn.setAttribute('aria-pressed','true'); }
      });

      // Init
      setVars(themes[themeOrder[themeIndex]]);
      resize();
      seedSystem();
      updateTime();
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        stop(); motionBtn.textContent = 'Play'; motionBtn.setAttribute('aria-pressed','false');
      } else {
        start(); motionBtn.textContent = 'Pause'; motionBtn.setAttribute('aria-pressed','true');
      }
    })();
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


