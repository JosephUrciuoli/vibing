<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="vibe2169" aria-label="Lumen Garden">
  <style>
    /* LUMEN GARDEN — Edition 2169 */
    #vibe2169 {
      --bg0: #f6f5f2;
      --bg1: #efece6;
      --ink: #1b1f23;
      --muted: #5e6a73;
      --acc: #3aa27c;
      --a1: #ffb7a4;
      --a2: #8fdcc0;
      --a3: #8ab6ff;
      --a4: #ffd980;

      position: relative;
      display: grid;
      place-items: center;
      min-height: 760px;
      padding: clamp(28px, 6vw, 96px);
      color: var(--ink);
      border-radius: 38px;
      overflow: hidden;
      isolation: isolate;
      background:
        radial-gradient(1600px 900px at 85% -10%, rgba(255,255,255,0.65), transparent 60%),
        radial-gradient(1200px 700px at -15% 120%, rgba(255,255,255,0.55), transparent 62%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      box-shadow:
        0 50px 120px rgba(18, 20, 24, 0.14),
        inset 0 0 0 1px rgba(0, 0, 0, 0.05),
        inset 0 10px 30px rgba(255, 255, 255, 0.5);
    }

    /* Ambient glow */
    #vibe2169::before,
    #vibe2169::after {
      content: "";
      position: absolute; inset: -30%;
      pointer-events: none; z-index: 0;
    }
    #vibe2169::before {
      background:
        conic-gradient(from 0deg at 55% 45%,
          color-mix(in oklab, var(--a2), transparent 72%) 0 20%,
          transparent 20% 42%,
          color-mix(in oklab, var(--a3), transparent 75%) 42% 66%,
          transparent 66% 82%,
          color-mix(in oklab, var(--a4), transparent 72%) 82% 100%);
      filter: blur(60px) saturate(120%);
      mix-blend-mode: screen;
      opacity: .55;
      animation: revolve2169 150s linear infinite;
    }
    #vibe2169::after {
      background:
        radial-gradient(800px 520px at 25% 25%, rgba(255,255,255,0.55), transparent 60%),
        radial-gradient(620px 420px at 80% 70%, rgba(255,255,255,0.35), transparent 62%);
      mix-blend-mode: soft-light;
      opacity: .65;
    }
    @keyframes revolve2169 { to { transform: rotate(360deg) } }

    /* Canvas + film grain */
    #vibe2169 .field {
      position: absolute; inset: 0; z-index: 1; display: block;
    }
    #vibe2169 .grain {
      position: absolute; inset: 0; z-index: 1; pointer-events: none;
      opacity: .08; mix-blend-mode: multiply;
      background-image:
        radial-gradient(1px 1px at 18% 22%, rgba(0,0,0,0.08), transparent 40%),
        radial-gradient(1px 1px at 64% 44%, rgba(0,0,0,0.06), transparent 40%),
        radial-gradient(1px 1px at 82% 68%, rgba(0,0,0,0.07), transparent 40%),
        radial-gradient(1px 1px at 32% 80%, rgba(0,0,0,0.07), transparent 40%);
      animation: twinkle2169 16s ease-in-out infinite alternate;
    }
    @keyframes twinkle2169 {
      0%   { filter: brightness(100%) contrast(105%); transform: translateY(0); }
      100% { filter: brightness(110%) contrast(110%); transform: translateY(-0.6%); }
    }

    /* HUD */
    #vibe2169 .hud {
      position: relative; z-index: 2; width: min(1100px, 100%);
      display: grid; gap: clamp(14px, 2.2vw, 26px);
      place-items: center; text-align: center;
      transform: perspective(1200px) rotateX(var(--rx, 0deg)) rotateY(var(--ry, 0deg));
      transition: transform 220ms ease, filter 220ms ease;
    }
    #vibe2169 .crest {
      display: inline-flex; align-items: center; gap: 10px;
      padding: 10px 16px; border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.08);
      color: var(--muted);
      background:
        linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.6)) padding-box,
        linear-gradient(90deg, color-mix(in oklab, var(--a2), transparent 70%), color-mix(in oklab, var(--a3), transparent 70%)) border-box;
      backdrop-filter: blur(10px) saturate(140%);
      -webkit-backdrop-filter: blur(10px) saturate(140%);
      box-shadow: 0 16px 36px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.9);
      font: 700 11px/1 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      letter-spacing: 0.16em; text-transform: uppercase;
    }
    #vibe2169 .sun {
      width: 10px; height: 10px; border-radius: 50%;
      background: radial-gradient(circle at 35% 35%, #fff 20%, var(--a4) 65%, transparent 68%);
      box-shadow: 0 0 0 6px color-mix(in oklab, var(--a4), transparent 85%), 0 0 18px var(--a4);
      animation: throb2169 2.8s ease-in-out infinite;
    }
    @keyframes throb2169 { 0%,100% {transform:scale(1);opacity:1} 50%{transform:scale(1.25);opacity:.85}}

    #vibe2169 .title {
      margin: 0;
      font: 900 clamp(54px, 11vw, 140px)/0.88 ui-serif, "Iowan Old Style", Georgia, "Times New Roman", Times, serif;
      letter-spacing: -0.02em;
      background: linear-gradient(180deg,
        color-mix(in oklab, var(--ink), #000000 10%),
        color-mix(in oklab, var(--acc), #ffffff 10%) 55%,
        color-mix(in oklab, var(--a3), #ffffff 20%));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-shadow: 0 1px 0 rgba(255,255,255,0.7), 0 16px 50px rgba(0,0,0,0.12);
      position: relative;
    }
    #vibe2169 .title::after {
      content: "";
      position: absolute; left: 50%; transform: translateX(-50%); bottom: -16px;
      width: clamp(240px, 48vw, 680px); height: 10px; border-radius: 999px;
      background: linear-gradient(90deg, var(--a2), var(--a3), var(--a4));
      filter: blur(10px) saturate(150%); opacity: 0.8;
    }
    #vibe2169 .sub {
      margin: 0; color: var(--muted); max-width: 72ch;
      font: 400 clamp(16px, 2.2vw, 22px)/1.8 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    /* Panel */
    #vibe2169 .panel {
      display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
    }
    #vibe2169 .chip {
      appearance: none; border: 1px solid rgba(0,0,0,0.08);
      border-radius: 14px; padding: 12px 16px; cursor: pointer; color: var(--ink);
      background:
        linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.65)) padding-box,
        linear-gradient(90deg, color-mix(in oklab, var(--a2), transparent 70%), color-mix(in oklab, var(--a3), transparent 70%)) border-box;
      font: 700 12px/1 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      letter-spacing: .04em;
      transition: transform 160ms ease, filter 220ms ease, box-shadow 220ms ease, background 160ms ease;
      box-shadow: 0 18px 36px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.95);
      backdrop-filter: blur(8px) saturate(140%); -webkit-backdrop-filter: blur(8px) saturate(140%);
    }
    #vibe2169 .chip:hover { transform: translateY(-1px); filter: saturate(112%); }
    #vibe2169 .chip:active { transform: translateY(0); }
    #vibe2169 .chip:focus-visible { outline: 2px solid color-mix(in oklab, var(--acc), white 20%); outline-offset: 2px; }

    /* Sliders */
    #vibe2169 .sliders {
      display: flex; flex-wrap: wrap; gap: 14px; justify-content: center; align-items: center;
      background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.6));
      border: 1px solid rgba(0,0,0,0.08); border-radius: 16px;
      padding: 10px 14px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.95);
      backdrop-filter: blur(8px) saturate(140%); -webkit-backdrop-filter: blur(8px) saturate(140%);
    }
    #vibe2169 .sliders label {
      font: 600 11px/1 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      letter-spacing: .12em; text-transform: uppercase; color: var(--muted);
      display: flex; align-items: center; gap: 10px;
    }
    #vibe2169 input[type="range"] { width: 170px; accent-color: var(--acc); }

    /* Meta */
    #vibe2169 .meta {
      display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 12px;
      width: min(920px, 100%); color: var(--muted);
      font: 400 12px/1.6 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    @media (max-width: 760px) {
      #vibe2169 .meta { grid-template-columns: 1fr; justify-items: center; text-align: center; }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      #vibe2169::before { animation: none !important; }
      #vibe2169 .grain { animation: none !important; }
    }
  </style>

  <canvas class="field" aria-hidden="true"></canvas>
  <div class="grain" aria-hidden="true"></div>

  <div class="hud" role="region" aria-live="polite">
    <div class="crest"><span class="sun" aria-hidden="true"></span> Edition 2169 · Lumen Garden</div>
    <h1 class="title">GARDEN</h1>
    <p class="sub">A calm, living wallpaper. Press and drag to plant blooms. T toggles theme · B breeze · L leave trails · X clear.</p>

    <div class="panel">
      <button class="chip" data-act="theme" aria-label="Cycle theme">Theme: Dawn</button>
      <button class="chip" data-act="breeze" aria-label="Toggle breeze">Breeze: On</button>
      <button class="chip" data-act="trail" aria-label="Toggle trails">Trail: Soft</button>
      <button class="chip" data-act="clear" aria-label="Clear canvas">Clear</button>
      <button class="chip" data-act="export" aria-label="Export image">Export</button>
      <button class="chip" data-act="hud" aria-label="Hide interface">Hide UI</button>
    </div>

    <div class="sliders" role="group" aria-label="Bloom controls">
      <label>Density <input type="range" min="0" max="1" step="0.01" value="0.45" data-range="density" aria-label="Bloom density"></label>
      <label>Scale <input type="range" min="0.6" max="1.6" step="0.02" value="1.0" data-range="scale" aria-label="Bloom scale"></label>
    </div>

    <div class="meta">
      <span class="hint">“Bend with the wind, bloom in your time.” Arrow keys tilt the stage · R resets tilt.</span>
      <span id="last-updated">Last updated: 2026-01-24 14:15:36 EST</span>
    </div>
  </div>

  <script>
    (function () {
      const root = document.getElementById('vibe2169');
      const canvas = root.querySelector('.field');
      const ctx = canvas.getContext('2d');

      const btnTheme  = root.querySelector('[data-act="theme"]');
      const btnBreeze = root.querySelector('[data-act="breeze"]');
      const btnTrail  = root.querySelector('[data-act="trail"]');
      const btnClear  = root.querySelector('[data-act="clear"]');
      const btnExport = root.querySelector('[data-act="export"]');
      const btnHUD    = root.querySelector('[data-act="hud"]');
      const rDensity  = root.querySelector('[data-range="density"]');
      const rScale    = root.querySelector('[data-range="scale"]');
      const last      = root.querySelector('#last-updated');

      // Timestamp
      try {
        last.textContent = 'Last updated: ' + new Date().toLocaleString(undefined, {
          year: 'numeric', month: 'short', day: '2-digit',
          hour: '2-digit', minute: '2-digit', second: '2-digit'
        });
      } catch {
        last.textContent = 'Last updated: ' + new Date().toString();
      }

      const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      const clamp = (v,a,b)=>Math.max(a, Math.min(b, v));
      const TAU = Math.PI * 2;

      // Themes
      const themes = [
        {
          name: 'Dawn',
          bg0:'#f6f5f2', bg1:'#efece6', ink:'#1b1f23', muted:'#5e6a73', acc:'#3aa27c',
          a1:'#ffb7a4', a2:'#8fdcc0', a3:'#8ab6ff', a4:'#ffd980',
          hue:[14, 40, 132, 158, 210]
        },
        {
          name: 'Dusk',
          bg0:'#0f1220', bg1:'#171a2a', ink:'#eef2ff', muted:'#a6b1d9', acc:'#9ad1ff',
          a1:'#ff9aa2', a2:'#b19cff', a3:'#8ff9d1', a4:'#ffc6a5',
          hue:[210, 258, 168, 12, 328]
        },
        {
          name: 'Porcelain',
          bg0:'#ffffff', bg1:'#f2f2f2', ink:'#202225', muted:'#717780', acc:'#5b9bd5',
          a1:'#ffd3b6', a2:'#bfe7d0', a3:'#c3d9ff', a4:'#ffe59a',
          hue:[36, 90, 200, 150, 260]
        },
        {
          name: 'Mono',
          bg0:'#0a0a0d', bg1:'#141419', ink:'#f3f4f6', muted:'#b8bcc8', acc:'#cfd2da',
          a1:'#ffffff', a2:'#e6e6ee', a3:'#ccccdc', a4:'#f7f7ff',
          hue:[0, 0, 0, 0, 0]
        }
      ];
      let themeIndex = 0;

      function applyTheme(t) {
        root.style.setProperty('--bg0', t.bg0);
        root.style.setProperty('--bg1', t.bg1);
        root.style.setProperty('--ink', t.ink);
        root.style.setProperty('--muted', t.muted);
        root.style.setProperty('--acc', t.acc);
        root.style.setProperty('--a1', t.a1);
        root.style.setProperty('--a2', t.a2);
        root.style.setProperty('--a3', t.a3);
        root.style.setProperty('--a4', t.a4);
        btnTheme.textContent = 'Theme: ' + t.name;

        // Wipe-in harmonized base
        ctx.save();
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = t.bg1;
        ctx.globalAlpha = 1;
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.restore();
        seeds.length = 0;
      }
      applyTheme(themes[themeIndex]);

      // Scene state
      let W=1, H=1, CX=0.5, CY=0.5;
      let running = true;
      let breeze = true;
      let softTrail = true;
      let density = parseFloat(rDensity.value); // 0-1
      let scale = parseFloat(rScale.value); // bloom scale

      const pointer = { x:0.5, y:0.5, down:false };

      function resize() {
        const rect = root.getBoundingClientRect();
        W = Math.max(1, Math.floor(rect.width));
        H = Math.max(1, Math.floor(rect.height));
        canvas.width = W * DPR;
        canvas.height = H * DPR;
        canvas.style.width = W + 'px';
        canvas.style.height = H + 'px';
        ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
        CX = W/2; CY = H/2;

        // Soft base vignette to seat the canvas
        ctx.save();
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = getComputedStyle(root).getPropertyValue('--bg1').trim() || '#fff';
        ctx.fillRect(0,0,W,H);
        const g = ctx.createRadialGradient(CX, CY, 0, CX, CY, Math.max(W,H)*0.75);
        g.addColorStop(0, 'rgba(0,0,0,0.02)');
        g.addColorStop(1, 'rgba(0,0,0,0.00)');
        ctx.fillStyle = g;
        ctx.fillRect(0,0,W,H);
        ctx.restore();
      }

      // Bloom system
      const seeds = [];

      function rand(a,b){ return a + Math.random()*(b-a); }
      function pickHue() {
        const set = themes[themeIndex].hue;
        return set[Math.floor(Math.random()*set.length)];
      }

      function spawn(x, y, count=3) {
        for (let i=0;i<count;i++){
          const petals = Math.floor(rand(6, 14));
          seeds.push({
            x, y,
            vx: rand(-0.3, 0.3), vy: rand(-0.2, 0.2),
            hue: pickHue(),
            sat: rand(60, 90),
            light: rand(50, 70),
            r0: rand(6, 16) * scale,
            r1: rand(28, 70) * scale,
            petals,
            spin: rand(-0.02, 0.02),
            rot: rand(0, TAU),
            age: 0,
            life: rand(400, 900)
          });
        }
      }

      // Auto planting
      function autoPlant(t) {
        if (Math.random() < density * 0.04) {
          const rx = CX + Math.cos(t*0.0007) * (Math.min(W,H)*rand(0.12,0.38));
          const ry = CY + Math.sin(t*0.0009) * (Math.min(W,H)*rand(0.10,0.34));
          spawn(rx, ry, 1);
        }
      }

      function drawSeed(s, windX, windY) {
        s.age += 1;
        const p = s.age / s.life;
        if (p >= 1) return false;

        // Movement and breeze
        const drag = 0.98;
        s.vx = (s.vx + windX*0.02) * drag;
        s.vy = (s.vy + windY*0.02) * drag;
        s.x += s.vx;
        s.y += s.vy;

        // Growth easing
        const ease = (t)=>1 - Math.pow(1 - t, 3);
        const r = s.r0 + (s.r1 - s.r0) * ease(Math.min(p*1.2,1));
        s.rot += s.spin + (breeze ? windX*0.002 : 0);

        // Petals
        const hue = s.hue;
        const base = `hsla(${hue}, ${s.sat}%, ${s.light}%, `;
        ctx.save();
        ctx.translate(s.x, s.y);

        for (let i=0; i<s.petals; i++) {
          const a = s.rot + i * TAU / s.petals;
          const pr = r * (0.62 + 0.16*Math.sin(p*TAU + i));
          const w = Math.max(2, pr * 0.18);
          ctx.save();
          ctx.rotate(a);

          // Petal gradient
          const grad = ctx.createRadialGradient(0, 0, Math.max(1, pr*0.05), 0, 0, pr);
          grad.addColorStop(0, base + (0.65*(1-p)).toFixed(3) + ')');
          grad.addColorStop(0.6, base + (0.35*(1-p)).toFixed(3) + ')');
          grad.addColorStop(1, base + (0.0).toFixed(3) + ')');

          // Petal shape
          ctx.fillStyle = grad;
          ctx.beginPath();
          ctx.ellipse(0, pr*0.55, w*0.85, pr, 0, 0, TAU);
          ctx.fill();
          ctx.restore();
        }

        // Core
        ctx.beginPath();
        ctx.fillStyle = base + '0.35)';
        ctx.arc(0, 0, Math.max(1.5, r*0.06), 0, TAU);
        ctx.fill();

        // Halo
        ctx.globalAlpha = 0.18;
        ctx.beginPath();
        ctx.fillStyle = base + '0.15)';
        ctx.arc(0, 0, r*0.9, 0, TAU);
        ctx.fill();

        ctx.restore();
        return true;
      }

      function tick(now) {
        if (!running) return;

        // gentle trailing
        ctx.save();
        ctx.globalCompositeOperation = 'source-over';
        const bg = getComputedStyle(root).getPropertyValue('--bg1').trim();
        ctx.fillStyle = softTrail ? 'rgba(255,255,255,0.06)' : 'rgba(255,255,255,0.18)';
        if (themes[themeIndex].name !== 'Dawn' && themes[themeIndex].name !== 'Porcelain') {
          // darker theme - fade with slight dark veil
          ctx.fillStyle = softTrail ? 'rgba(0,0,0,0.06)' : 'rgba(0,0,0,0.14)';
        }
        ctx.fillRect(0,0,W,H);
        ctx.restore();

        // breeze field
        const t = now || performance.now();
        const windX = breeze ? Math.sin(t*0.0006) * 0.6 : 0;
        const windY = breeze ? Math.cos(t*0.0004) * 0.4 : 0;

        autoPlant(t);

        // draw + cull
        for (let i = seeds.length - 1; i >= 0; i--) {
          const alive = drawSeed(seeds[i], windX, windY);
          if (!alive) seeds.splice(i, 1);
        }

        requestAnimationFrame(tick);
      }

      function setTilt(clientX, clientY){
        const rect = root.getBoundingClientRect();
        const px = clamp((clientX - rect.left) / rect.width, 0, 1);
        const py = clamp((clientY - rect.top) / rect.height, 0, 1);
        root.style.setProperty('--rx', ((0.5 - py) * 4).toFixed(2) + 'deg');
        root.style.setProperty('--ry', ((px - 0.5) * 6).toFixed(2) + 'deg');
      }

      // Interactions
      root.addEventListener('pointerdown', (e) => {
        pointer.down = true;
        const r = root.getBoundingClientRect();
        setTilt(e.clientX, e.clientY);
        const x = (e.clientX - r.left);
        const y = (e.clientY - r.top);
        spawn(x, y, Math.floor(2 + density*6));
        root.setPointerCapture?.(e.pointerId);
      });
      root.addEventListener('pointermove', (e) => {
        setTilt(e.clientX, e.clientY);
        if (!pointer.down) return;
        const r = root.getBoundingClientRect();
        const x = (e.clientX - r.left);
        const y = (e.clientY - r.top);
        if (Math.random() < 0.6) spawn(x, y, 1);
      }, { passive: true });
      root.addEventListener('pointerup', (e) => {
        pointer.down = false;
        root.releasePointerCapture?.(e.pointerId);
      });
      root.addEventListener('pointerleave', () => {
        pointer.down = false;
        root.style.setProperty('--rx', '0deg');
        root.style.setProperty('--ry', '0deg');
      }, { passive: true });

      // Controls
      function cycleTheme() {
        themeIndex = (themeIndex + 1) % themes.length;
        applyTheme(themes[themeIndex]);
      }
      function toggleBreeze() {
        breeze = !breeze;
        btnBreeze.textContent = 'Breeze: ' + (breeze ? 'On' : 'Off');
      }
      function toggleTrail() {
        softTrail = !softTrail;
        btnTrail.textContent = 'Trail: ' + (softTrail ? 'Soft' : 'Bold');
      }
      function clearAll() {
        seeds.length = 0;
        ctx.save();
        ctx.globalCompositeOperation = 'source-over';
        const t = themes[themeIndex];
        ctx.fillStyle = t.bg1;
        ctx.fillRect(0,0,W,H);
        ctx.restore();
      }
      function exportPNG() {
        const a = document.createElement('a');
        a.download = 'lumen-garden-' + Date.now() + '.png';
        a.href = canvas.toDataURL('image/png');
        a.click();
      }
      function toggleHUD() {
        const hud = root.querySelector('.hud');
        if (!hud) return;
        if (hud.style.opacity === '0') {
          hud.style.opacity = ''; hud.style.pointerEvents = '';
          btnHUD.textContent = 'Hide UI';
        } else {
          hud.style.opacity = '0'; hud.style.pointerEvents = 'none';
          setTimeout(()=>{ btnHUD.textContent = 'Show UI'; }, 50);
        }
      }

      btnTheme.addEventListener('click', () => { cycleTheme(); btnTheme.blur(); });
      btnBreeze.addEventListener('click', () => { toggleBreeze(); btnBreeze.blur(); });
      btnTrail.addEventListener('click', () => { toggleTrail(); btnTrail.blur(); });
      btnClear.addEventListener('click', () => { clearAll(); btnClear.blur(); });
      btnExport.addEventListener('click', () => { exportPNG(); btnExport.blur(); });
      btnHUD.addEventListener('click', () => { toggleHUD(); });

      rDensity.addEventListener('input', () => { density = parseFloat(rDensity.value); });
      rScale.addEventListener('input', () => { scale = parseFloat(rScale.value); });

      // Keyboard
      window.addEventListener('keydown', (e) => {
        const key = e.key.toLowerCase();
        const step = 0.02;
        if (e.key === 'ArrowLeft')  { const r = root.getBoundingClientRect(); setTilt(r.left + r.width * (0.48), r.top + r.height * 0.5); }
        if (e.key === 'ArrowRight') { const r = root.getBoundingClientRect(); setTilt(r.left + r.width * (0.52), r.top + r.height * 0.5); }
        if (e.key === 'ArrowUp')    { const r = root.getBoundingClientRect(); setTilt(r.left + r.width * 0.5, r.top + r.height * (0.48)); }
        if (e.key === 'ArrowDown')  { const r = root.getBoundingClientRect(); setTilt(r.left + r.width * 0.5, r.top + r.height * (0.52)); }
        if (key === 't') cycleTheme();
        if (key === 'b') toggleBreeze();
        if (key === 'l') toggleTrail();
        if (key === 'x') clearAll();
        if (key === 'h') toggleHUD();
        if (key === 'r') { root.style.setProperty('--rx', '0deg'); root.style.setProperty('--ry', '0deg'); }
      });

      // Resize observer
      const ro = new ResizeObserver(resize);
      ro.observe(root);
      resize();

      // PRM
      const prm = window.matchMedia('(prefers-reduced-motion: reduce)');
      function applyPRM() {
        if (prm.matches) {
          breeze = false;
          btnBreeze.textContent = 'Breeze: Off';
        }
      }
      prm.addEventListener?.('change', applyPRM);
      applyPRM();

      // Idle glide for tilt
      setInterval(() => {
        const hud = root.querySelector('.hud');
        if (!running || pointer.down || hud?.style.opacity === '0') return;
        const t = Date.now() * 0.00025;
        const nx = 0.5 + Math.sin(t * 1.4) * 0.14;
        const ny = 0.5 + Math.cos(t * 1.1) * 0.10;
        const rect = root.getBoundingClientRect();
        setTilt(rect.left + rect.width * nx, rect.top + rect.height * ny);
      }, 120);

      // Kickoff
      requestAnimationFrame(tick);
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


