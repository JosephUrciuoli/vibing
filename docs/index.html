<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="halo" data-theme="dawn" aria-label="Harmonic Halo — A Generative Timepiece">
  <style>
    .halo {
      --r: 28px;
      --bg1: #fffdf8; --bg2: #f7fbff;
      --ink: #101524; --muted:#5c6477; --line: rgba(16,21,36,0.14);
      --g1:#ffb8a1; --g2:#89d6ff; --g3:#ffe78a; --g4:#9cffd2;
      position: relative;
      border-radius: var(--r);
      border: 1px solid var(--line);
      padding: clamp(16px, 3.4vw, 44px);
      color: var(--ink);
      background:
        radial-gradient(140% 130% at 10% -10%, rgba(255,184,161,0.18), transparent 55%),
        radial-gradient(140% 130% at 110% 110%, rgba(137,214,255,0.18), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.8),
        0 40px 120px rgba(20,25,40,0.16),
        0 12px 28px rgba(20,25,40,0.12);
      overflow: hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      isolation: isolate;
    }
    .halo::before {
      content:"";
      position:absolute; inset:-40% -20% auto -20%; height:62%;
      background:
        radial-gradient(60% 80% at 22% 30%, var(--g1) 0%, transparent 55%),
        radial-gradient(70% 70% at 78% 22%, var(--g2) 0%, transparent 55%),
        radial-gradient(80% 90% at 50% 88%, var(--g4) 0%, transparent 60%);
      opacity:.16; filter: blur(28px); mix-blend-mode: screen; pointer-events:none;
      animation: float-aurora 16s ease-in-out infinite alternate;
    }
    @keyframes float-aurora { to { transform: translate3d(0, 12px, 0) scale(1.04); } }

    /* THEMES */
    .halo[data-theme="dawn"] { --bg1:#fffdf8; --bg2:#f7fbff; --ink:#101524; --muted:#5c6477; --line:rgba(16,21,36,0.14); --g1:#ffb8a1; --g2:#89d6ff; --g3:#ffe78a; --g4:#9cffd2; }
    .halo[data-theme="dusk"] { --bg1:#0d0f1f; --bg2:#10142a; --ink:#eaf0ff; --muted:#9aa8cc; --line:rgba(255,255,255,0.14); --g1:#a88bff; --g2:#64d2ff; --g3:#ff9bd0; --g4:#ffe58a;
      border-color: rgba(255,255,255,0.12);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.12), 0 40px 120px rgba(0,0,0,0.45), 0 12px 30px rgba(0,0,0,0.3);
    }
    .halo[data-theme="noir"] { --bg1:#070911; --bg2:#0b0e18; --ink:#e6efff; --muted:#96a3c7; --line:rgba(255,255,255,0.12); --g1:#6ea6ff; --g2:#58ffd8; --g3:#ffd37a; --g4:#b6c7ff;
      border-color: rgba(255,255,255,0.12);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.10), 0 42px 130px rgba(0,0,0,0.5), 0 12px 32px rgba(0,0,0,0.32);
    }
    .halo[data-theme="spring"] { --bg1:#fbfffe; --bg2:#f7fff7; --ink:#10201a; --muted:#4d6a61; --line:rgba(16,32,26,0.14); --g1:#8affc6; --g2:#82b6ff; --g3:#ffdca1; --g4:#a9ffef; }

    .top {
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom: 12px;
    }
    .brand {
      display:inline-grid; grid-auto-flow:column; align-items:center; gap:12px;
      letter-spacing:.22em; text-transform:uppercase; font-weight:800; font-size:11px; color:var(--muted);
    }
    .logo {
      --s:30px; width:var(--s); height:var(--s);
      border-radius:10px; position:relative; display:grid; place-items:center; overflow:hidden;
      background:linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.35));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.8), 0 8px 20px rgba(20,25,40,0.18);
    }
    .logo::before, .logo::after {
      content:""; position:absolute; border-radius:50%; inset:6px; border:2px solid rgba(16,21,36,0.12);
    }
    .chip {
      font-size:10px; letter-spacing:.18em; text-transform:uppercase;
      padding:6px 10px; border-radius:999px; border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.5));
      color:var(--ink); box-shadow:0 12px 24px rgba(20,25,40,0.16);
    }
    .halo[data-theme="dusk"] .chip, .halo[data-theme="noir"] .chip {
      background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
      color:var(--ink);
    }

    .hero { margin: 8px 0 18px; }
    .title {
      margin:0;
      font-size: clamp(42px, 8.8vw, 118px);
      line-height:.88; font-weight:1000; letter-spacing:-0.025em;
      background: conic-gradient(from 120deg, var(--g1), var(--g2), var(--g3), var(--g4), var(--g1));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter: drop-shadow(0 10px 24px rgba(20,25,40,0.20));
    }
    .sub { margin:8px 0 0; max-width:72ch; font-size:clamp(14px, 2.2vw, 18px); color:var(--muted); }

    .stage {
      position:relative;
      min-height: clamp(520px, 64vh, 920px);
      border-radius: 24px;
      border:1px solid var(--line);
      overflow:hidden;
      transform-style: preserve-3d;
      transition: transform 220ms ease, box-shadow 220ms ease;
      background:
        radial-gradient(120% 100% at 50% -10%, rgba(255,255,255,0.55), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.45), rgba(255,255,255,0.24));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.78), 0 26px 70px rgba(20,25,40,0.18);
    }
    .halo[data-theme="dusk"] .stage, .halo[data-theme="noir"] .stage {
      background:
        radial-gradient(120% 100% at 50% -10%, rgba(255,255,255,0.12), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.25), 0 28px 80px rgba(0,0,0,0.45);
    }

    canvas.field { position:absolute; inset:0; display:block; width:100%; height:100%; }
    .grain {
      position:absolute; inset:0; pointer-events:none; opacity:.12; mix-blend-mode: overlay;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140" viewBox="0 0 140 140"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.35"/></svg>');
      background-size: 280px 280px;
      animation: gr 12s steps(2) infinite;
    }
    @keyframes gr { to { transform: translate3d(12px, -8px, 0); } }

    .orb {
      position:absolute; width: 16px; height: 16px; border-radius:50%;
      left:0; top:0; transform: translate(-200px,-200px);
      background: radial-gradient(circle at 35% 35%, #fff, #fff0 60%);
      box-shadow: 0 0 26px var(--g2), 0 0 10px var(--g3);
      pointer-events:none; mix-blend-mode: screen; opacity:0;
      transition: width 160ms ease, height 160ms ease, opacity 160ms ease;
    }

    .controls {
      margin-top: 16px;
      display:flex; flex-wrap:wrap; align-items:center; gap:10px;
      padding:10px; border-radius:16px; border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.60));
      backdrop-filter: blur(10px) saturate(1.05);
      box-shadow:0 16px 40px rgba(20,25,40,0.16);
    }
    .halo[data-theme="dusk"] .controls, .halo[data-theme="noir"] .controls {
      background:linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06));
    }

    .btn, .pill {
      appearance:none; cursor:pointer; user-select:none;
      border:1px solid var(--line); border-radius: 999px; color:var(--ink);
      background:linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.55));
      padding:8px 12px; font-size:13px; white-space:nowrap;
      transition: transform 140ms ease, background 140ms ease, color 140ms ease, box-shadow 140ms ease;
      box-shadow:0 10px 22px rgba(20,25,40,0.14);
    }
    .btn:hover, .pill:hover { transform: translateY(-2px); background:linear-gradient(180deg, #fff, rgba(255,255,255,0.65)); }
    .btn:focus-visible, .pill:focus-visible { outline:2px solid var(--g2); outline-offset:2px; }

    .slider {
      appearance:none; width: clamp(140px, 24vw, 260px); height:28px; border-radius:999px;
      border:1px solid var(--line);
      background:linear-gradient(90deg, rgba(10,18,40,0.08), rgba(10,18,40,0.02));
      box-shadow: inset 0 0 0 2px rgba(255,255,255,0.65);
    }
    .slider::-webkit-slider-thumb {
      appearance:none; width:20px; height:20px; border-radius:50%;
      background:linear-gradient(180deg, #fff, #e9eef3); border:2px solid rgba(10,18,40,0.18); box-shadow:0 2px 12px rgba(20,25,40,0.18); cursor:pointer;
    }
    .slider::-moz-range-thumb {
      width:20px; height:20px; border-radius:50%;
      background:linear-gradient(180deg, #fff, #e9eef3); border:2px solid rgba(10,18,40,0.18); box-shadow:0 2px 12px rgba(20,25,40,0.18); cursor:pointer;
    }

    .themes { display:inline-flex; gap:8px; margin-left:auto; }
    .swatch {
      width:28px; height:28px; border-radius:50%; border:1px solid var(--line);
      box-shadow:0 10px 22px rgba(20,25,40,0.18); cursor:pointer; transition: transform 140ms ease;
    }
    .swatch:hover { transform: translateY(-2px) rotate(-4deg); }
    .swatch[data-theme="dawn"] { background: conic-gradient(#ffb8a1, #89d6ff, #ffe78a, #9cffd2, #ffb8a1); }
    .swatch[data-theme="dusk"] { background: conic-gradient(#a88bff, #64d2ff, #ff9bd0, #ffe58a, #a88bff); }
    .swatch[data-theme="noir"] { background: conic-gradient(#6ea6ff, #58ffd8, #ffd37a, #b6c7ff, #6ea6ff); }
    .swatch[data-theme="spring"] { background: conic-gradient(#8affc6, #82b6ff, #ffdca1, #a9ffef, #8affc6); }

    .meta { display:flex; align-items:center; gap:12px; margin-top:10px; font-size:12px; color:var(--muted); }
    .meta .sep { opacity:.5; }
  </style>

  <div class="top">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      Atelier Lumen
    </div>
    <div class="chip" aria-hidden="true">Harmonic Halo</div>
  </div>

  <div class="hero">
    <h1 class="title">Harmonic Halo</h1>
    <p class="sub">A living timepiece. Orbits breathe, light blooms, and your cursor bends the cosmos. Tap to pulse.</p>
  </div>

  <div class="stage" aria-label="Halo Field">
    <canvas class="field" aria-hidden="true"></canvas>
    <div class="grain" aria-hidden="true"></div>
    <div class="orb" aria-hidden="true"></div>
  </div>

  <div class="controls" role="group" aria-label="Controls">
    <button type="button" class="btn play" aria-pressed="false" title="Pause/Resume">Pause</button>

    <label class="pill" style="padding:0 10px; display:inline-flex; align-items:center; gap:8px;">
      <span style="opacity:.8; font-size:12px;">Speed</span>
      <input class="slider speed" type="range" min="0.2" max="2.0" step="0.1" value="1.0" aria-label="Rotation speed">
    </label>

    <label class="pill" style="padding:0 10px; display:inline-flex; align-items:center; gap:8px;">
      <span style="opacity:.8; font-size:12px;">Bloom</span>
      <input class="slider bloom" type="range" min="0.4" max="2.0" step="0.1" value="1.0" aria-label="Glow intensity">
    </label>

    <label class="pill" style="padding:0 10px; display:inline-flex; align-items:center; gap:8px;">
      <span style="opacity:.8; font-size:12px;">Orbits</span>
      <input class="slider rings" type="range" min="3" max="12" step="1" value="7" aria-label="Orbit count">
    </label>

    <button type="button" class="btn pulse" title="Send a pulse">Pulse</button>
    <button type="button" class="btn snap" title="Save image">Capture</button>

    <div class="themes" role="group" aria-label="Theme">
      <button class="swatch" type="button" data-theme="dawn" title="Dawn"></button>
      <button class="swatch" type="button" data-theme="dusk" title="Dusk"></button>
      <button class="swatch" type="button" data-theme="noir" title="Noir"></button>
      <button class="swatch" type="button" data-theme="spring" title="Spring"></button>
    </div>
  </div>

  <div class="meta" aria-label="Meta">
    <span id="last-updated">Last updated: 2025-11-03 09:18:14 EST</span>
    <span class="sep">•</span>
    <span class="hint">Move: tilt • Click: pulse • Space: pause • S: snapshot • 1–4: theme</span>
  </div>

  <script>
    (function(){
      const root = document.currentScript.closest('.halo');
      const stage = root.querySelector('.stage');
      const canvas = root.querySelector('canvas.field');
      const ctx = canvas.getContext('2d', { alpha: true });
      const playBtn = root.querySelector('.play');
      const speedInput = root.querySelector('.speed');
      const bloomInput = root.querySelector('.bloom');
      const ringsInput = root.querySelector('.rings');
      const pulseBtn = root.querySelector('.pulse');
      const snapBtn = root.querySelector('.snap');
      const themeBtns = root.querySelectorAll('.swatch');
      const orb = root.querySelector('.orb');

      // Last updated
      const last = root.querySelector('#last-updated');
      try {
        const now = new Date();
        const fmt = new Intl.DateTimeFormat([], {
          year:'numeric', month:'short', day:'2-digit',
          hour:'2-digit', minute:'2-digit', second:'2-digit',
          hour12:true, timeZoneName:'short'
        });
        last.textContent = 'Updated ' + fmt.format(now);
      } catch { last.textContent = 'Updated ' + new Date().toLocaleString(); }

      // Theme persistence
      const savedTheme = localStorage.getItem('halo-theme');
      if (savedTheme) root.setAttribute('data-theme', savedTheme);
      themeBtns.forEach(b => b.addEventListener('click', ()=>{
        const t = b.getAttribute('data-theme');
        root.setAttribute('data-theme', t);
        localStorage.setItem('halo-theme', t);
        resize();
        seed();
      }));

      // Palettes per theme
      function palette(){
        const t = root.getAttribute('data-theme') || 'dawn';
        if (t === 'dusk') return ['#a88bff','#64d2ff','#ff9bd0','#ffe58a','#8ad8ff'];
        if (t === 'noir') return ['#6ea6ff','#58ffd8','#ffd37a','#b6c7ff','#98b8ff'];
        if (t === 'spring') return ['#8affc6','#82b6ff','#ffdca1','#a9ffef','#9df5c8'];
        return ['#ffb8a1','#89d6ff','#ffe78a','#9cffd2','#ffd2a8'];
      }

      // DPI + sizing
      const DPR = Math.min(2, window.devicePixelRatio || 1);
      let W=0, H=0, CX=0, CY=0, R=0;
      function resize(){
        const r = stage.getBoundingClientRect();
        W = Math.max(1, Math.floor(r.width));
        H = Math.max(1, Math.floor(r.height));
        CX = W/2; CY = H/2; R = Math.min(W,H)*0.38;
        canvas.width = Math.floor(W * DPR);
        canvas.height = Math.floor(H * DPR);
        canvas.style.width = W + 'px';
        canvas.style.height = H + 'px';
        ctx.setTransform(DPR,0,0,DPR,0,0);
        clearAll();
        drawBackground(true);
      }
      const ro = new ResizeObserver(resize);
      ro.observe(stage);
      window.addEventListener('orientationchange', ()=> setTimeout(resize, 120));

      // State
      let speed = parseFloat(localStorage.getItem('halo-speed') ?? '1.0');
      let bloom = parseFloat(localStorage.getItem('halo-bloom') ?? '1.0');
      let ringCount = parseInt(localStorage.getItem('halo-rings') ?? '7', 10);

      speedInput.value = String(speed);
      bloomInput.value = String(bloom);
      ringsInput.value = String(ringCount);

      speedInput.addEventListener('input', e => {
        speed = parseFloat(e.target.value || '1');
        localStorage.setItem('halo-speed', String(speed));
      });
      bloomInput.addEventListener('input', e => {
        bloom = parseFloat(e.target.value || '1');
        localStorage.setItem('halo-bloom', String(bloom));
      });
      ringsInput.addEventListener('input', e => {
        ringCount = parseInt(e.target.value || '7', 10);
        localStorage.setItem('halo-rings', String(ringCount));
        seed();
      });

      // Halos
      let rings = [];
      let sparkles = [];
      function seed(){
        rings = [];
        const P = palette();
        const base = R * 0.28;
        const gap = (R - base) / Math.max(1, ringCount-1);
        for (let i=0; i<ringCount; i++){
          const col = P[i % P.length];
          rings.push({
            r: base + gap * i,
            ang: Math.random()*Math.PI*2,
            vel: (0.2 + i*0.07) * (Math.random() > 0.5 ? 1 : -1),
            w: 1.6 + (i%2)*0.6
          , col
          });
        }
        // sparkles
        sparkles = new Array(22).fill(0).map(_=>({
          t: Math.random()*Math.PI*2,
          d: base + Math.random()*(R-base),
          life: Math.random()*1.5 + 0.5
        }));
        drawBackground(true);
      }

      // Pulses
      let pulses = [];
      function addPulse(x, y){
        pulses.push({ x, y, r: Math.min(W,H)*0.02, life: 1.0 });
        popCursor();
      }

      // Controls
      let paused = matchMedia('(prefers-reduced-motion: reduce)').matches;
      function setPaused(p){
        paused = p;
        playBtn.setAttribute('aria-pressed', String(p));
        playBtn.textContent = p ? 'Resume' : 'Pause';
      }
      playBtn.addEventListener('click', ()=> setPaused(!paused));
      setPaused(paused);

      function snapshot(){
        try {
          const link = document.createElement('a');
          link.download = 'harmonic-halo.png';
          link.href = canvas.toDataURL('image/png');
          link.click();
        } catch {}
      }
      snapBtn.addEventListener('click', snapshot);
      pulseBtn.addEventListener('click', ()=> addPulse(CX, CY));

      // Pointer/tilt
      const pointer = { x:0.5, y:0.5, inside:false };
      function setPointer(eX, eY){
        const r = stage.getBoundingClientRect();
        pointer.x = (eX - r.left) / r.width;
        pointer.y = (eY - r.top) / r.height;
        pointer.inside = true;
        orb.style.transform = `translate(${eX - r.left - 8}px, ${eY - r.top - 8}px)`;
      }
      function popCursor(){
        orb.style.width = '22px';
        orb.style.height = '22px';
        orb.style.opacity = '1';
        setTimeout(()=>{ orb.style.width = '16px'; orb.style.height = '16px'; orb.style.opacity = pointer.inside ? '0.85' : '0.0'; }, 180);
      }
      stage.addEventListener('mousemove', e => setPointer(e.clientX, e.clientY));
      stage.addEventListener('mouseenter', e => { setPointer(e.clientX, e.clientY); orb.style.opacity='0.85'; });
      stage.addEventListener('mouseleave', ()=> { pointer.inside = false; orb.style.opacity='0'; });
      stage.addEventListener('click', e => {
        const r = stage.getBoundingClientRect();
        addPulse(e.clientX - r.left, e.clientY - r.top);
      });

      // Keyboard
      root.tabIndex = 0;
      root.addEventListener('keydown', (e)=>{
        const k = e.key.toLowerCase();
        if (e.code === 'Space'){ e.preventDefault(); setPaused(!paused); }
        if (k === 's'){ snapshot(); }
        if (k === '1'){ themeBtns[0].click(); }
        if (k === '2'){ themeBtns[1].click(); }
        if (k === '3'){ themeBtns[2].click(); }
        if (k === '4'){ themeBtns[3].click(); }
      });

      // Background
      function drawBackground(hard){
        const t = root.getAttribute('data-theme') || 'dawn';
        const g = ctx.createRadialGradient(CX, CY*0.9, 0, CX, CY*0.9, Math.max(W,H)*0.9);
        if (t === 'dusk'){
          g.addColorStop(0, 'rgba(22,26,52,' + (hard? 1 : 0.16*bloom) + ')');
          g.addColorStop(1, 'rgba(9,12,26,' + (hard? 1 : 0.16*bloom) + ')');
        } else if (t === 'noir'){
          g.addColorStop(0, 'rgba(10,12,22,' + (hard? 1 : 0.16*bloom) + ')');
          g.addColorStop(1, 'rgba(6,8,16,' + (hard? 1 : 0.16*bloom) + ')');
        } else {
          g.addColorStop(0, 'rgba(255,255,255,' + (hard? 1 : 0.12*bloom) + ')');
          g.addColorStop(1, 'rgba(255,255,255,' + (hard? 1 : 0.12*bloom) + ')');
        }
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = g;
        ctx.fillRect(0,0,W,H);
      }

      function clearAll(){ ctx.clearRect(0,0,W,H); }

      // Draw helpers
      function hexToRGBA(hex, a){
        let h = hex.replace('#','');
        if (h.length === 3) h = h.split('').map(c=>c+c).join('');
        const r = parseInt(h.slice(0,2),16);
        const g = parseInt(h.slice(2,4),16);
        const b = parseInt(h.slice(4,6),16);
        return `rgba(${r},${g},${b},${a})`;
      }

      // Animation
      let t0 = performance.now();
      function tick(now){
        const dt = Math.min(0.05, (now - t0)/1000);
        t0 = now;

        // Tilt
        const nx = (pointer.inside ? (pointer.x - 0.5) : 0) * 2;
        const ny = (pointer.inside ? (pointer.y - 0.5) : 0) * 2;
        stage.style.transform = `perspective(1000px) rotateX(${ny * -5}deg) rotateY(${nx * 8}deg) translateZ(0)`;

        if (!paused){
          drawBackground(false);

          // Subtle starfield
          ctx.save();
          ctx.globalCompositeOperation = 'lighter';
          const P = palette();
          for (let i=0; i<36; i++){
            const a = i/36 * Math.PI*2 + now*0.0001;
            const rr = R*0.85 + Math.sin(now*0.0006 + i)*8;
            const x = CX + Math.cos(a)*rr * (0.98 + nx*0.04);
            const y = CY + Math.sin(a)*rr * (0.98 + ny*0.04);
            ctx.fillStyle = hexToRGBA(P[i % P.length], 0.08*bloom);
            ctx.beginPath(); ctx.arc(x, y, 1.2 + (i%3===0?0.8:0), 0, Math.PI*2); ctx.fill();
          }
          ctx.restore();

          // Halos
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round';
          for (let i=0; i<rings.length; i++){
            const ring = rings[i];
            ring.ang += ring.vel * dt * speed * 0.6;

            // dashed orbit
            ctx.save();
            ctx.translate(CX, CY);
            ctx.rotate(ring.ang);
            ctx.setLineDash([Math.max(18, ring.r*0.16), Math.max(18, ring.r*0.16)]);
            ctx.lineWidth = ring.w * bloom;
            const grad = ctx.createLinearGradient(-ring.r, 0, ring.r, 0);
            grad.addColorStop(0, hexToRGBA(ring.col, 0.08*bloom));
            grad.addColorStop(0.5, hexToRGBA(ring.col, 0.35*bloom));
            grad.addColorStop(1, hexToRGBA(ring.col, 0.08*bloom));
            ctx.strokeStyle = grad;
            ctx.globalCompositeOperation = 'lighter';
            ctx.beginPath();
            ctx.arc(0, 0, ring.r, 0, Math.PI*2);
            ctx.stroke();
            ctx.restore();

            // moving bead
            const bx = CX + Math.cos(-ring.ang*1.15 + i)*ring.r;
            const by = CY + Math.sin(-ring.ang*1.15 + i)*ring.r;
            const beadR = 2.0 + (i%3===0?1.4:0);
            const beadG = ctx.createRadialGradient(bx, by, 0, bx, by, 18*bloom);
            beadG.addColorStop(0, hexToRGBA(ring.col, 0.85));
            beadG.addColorStop(1, hexToRGBA(ring.col, 0.0));
            ctx.fillStyle = beadG;
            ctx.beginPath(); ctx.arc(bx, by, 18*bloom, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = hexToRGBA('#ffffff', 0.9);
            ctx.beginPath(); ctx.arc(bx, by, beadR, 0, Math.PI*2); ctx.fill();
          }

          // Sparkles drift
          for (let i=0; i<sparkles.length; i++){
            const s = sparkles[i];
            s.t += dt * (0.3 + (i%5)*0.05) * speed;
            s.life -= dt*0.12;
            if (s.life <= 0){ s.t = Math.random()*Math.PI*2; s.d = R*0.28 + Math.random()*(R*0.72); s.life = Math.random()*1.5 + 0.5; }
            const x = CX + Math.cos(s.t)*s.d;
            const y = CY + Math.sin(s.t)*s.d;
            const g = ctx.createRadialGradient(x, y, 0, x, y, 24*bloom);
            const col = palette()[(i+2) % palette().length];
            g.addColorStop(0, hexToRGBA(col, 0.25*s.life*bloom));
            g.addColorStop(1, hexToRGBA(col, 0));
            ctx.fillStyle = g; ctx.beginPath(); ctx.arc(x,y, 24*bloom, 0, Math.PI*2); ctx.fill();
          }

          // Pulses
          for (let i=pulses.length-1; i>=0; i--){
            const p = pulses[i];
            p.r += (140 * dt) * (0.8 + bloom*0.4);
            p.life -= dt*0.6;
            const gg = ctx.createRadialGradient(p.x, p.y, p.r*0.7, p.x, p.y, p.r);
            gg.addColorStop(0, 'rgba(255,255,255,0)');
            gg.addColorStop(1, hexToRGBA(palette()[i % palette().length], 0.18 * Math.max(0,p.life)));
            ctx.globalCompositeOperation = 'lighter';
            ctx.fillStyle = gg;
            ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
            if (p.life <= 0) pulses.splice(i,1);
          }
        }

        requestAnimationFrame(tick);
      }

      // Init
      resize();
      seed();
      requestAnimationFrame(tick);

      // Reduced motion: freeze a still composition
      if (matchMedia('(prefers-reduced-motion: reduce)').matches){
        setPaused(true);
        drawBackground(true);
        ctx.globalCompositeOperation = 'lighter';
        const P = palette();
        for (let i=0; i<ringCount; i++){
          const r = R*0.28 + (R*0.72)*(i/(ringCount-1));
          const col = P[i % P.length];
          ctx.strokeStyle = hexToRGBA(col, 0.28);
          ctx.lineWidth = 2; ctx.beginPath(); ctx.arc(CX, CY, r, 0, Math.PI*2); ctx.stroke();
        }
        ctx.globalCompositeOperation = 'source-over';
      }
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


