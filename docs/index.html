<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="vibe756" data-theme="aurora" aria-live="polite">
  <style>
    /* KALEIDO LAB — Edition 756
       A bold pivot: living kaleidoscope, liquid neon, tactile glass. */
    #vibe756 {
      --bg1: #0f1424;
      --bg2: #1a304b;
      --ink: #e9f3ff;
      --muted: #9db2c9;
      --p1: #7ae1ff;
      --p2: #a98bff;
      --p3: #6bffcf;
      --glass: rgba(255,255,255,0.14);
      --radius: 28px;
      --ring: 0 40px 120px rgba(8,16,40,0.35);
      --tiltX: 0deg;
      --tiltY: 0deg;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color: var(--ink);
      -webkit-font-smoothing: antialiased;
      letter-spacing: .2px;
    }

    /* THEMES */
    #vibe756[data-theme="aurora"] {
      --bg1: #0b1222; --bg2: #1a3a58;
      --ink: #e8f0ff; --muted: #9fb0c7;
      --p1: #6fd4ff; --p2: #a089ff; --p3: #69ffc9; --glass: rgba(255,255,255,0.12);
    }
    #vibe756[data-theme="ink"] {
      --bg1: #0c0c12; --bg2: #1a1a28;
      --ink: #f0f0ff; --muted: #b9b9d4;
      --p1: #ffffff; --p2: #a7a7ff; --p3: #6d7cff; --glass: rgba(255,255,255,0.10);
    }
    #vibe756[data-theme="quartz"] {
      --bg1: #f7fbff; --bg2: #eaf1ff;
      --ink: #0e1530; --muted: #5f6b86;
      --p1: #5f7cff; --p2: #ff7fb2; --p3: #2ad1b7; --glass: rgba(255,255,255,0.55);
      --ring: 0 40px 120px rgba(10,30,80,0.16);
    }
    #vibe756[data-theme="forest"] {
      --bg1: #071814; --bg2: #17352b;
      --ink: #eafff6; --muted: #9bd1c0;
      --p1: #8cf2cf; --p2: #4ddba0; --p3: #b7ffd7; --glass: rgba(255,255,255,0.12);
    }
    #vibe756[data-theme="ember"] {
      --bg1: #1c0d0a; --bg2: #3b1a10;
      --ink: #ffece6; --muted: #ffbfa7;
      --p1: #ff9b6f; --p2: #ffd36f; --p3: #ff6fba; --glass: rgba(255,255,255,0.12);
    }

    /* SHELL */
    #vibe756 .studio {
      position: relative;
      border-radius: var(--radius);
      padding: clamp(18px, 3.4vw, 36px);
      overflow: hidden;
      background:
        radial-gradient(1200px 900px at 80% -10%, rgba(255,255,255,0.06), transparent 50%),
        radial-gradient(900px 700px at 10% 110%, rgba(255,255,255,0.06), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      box-shadow: var(--ring);
      transform-style: preserve-3d;
      isolation: isolate;
    }
    #vibe756 .studio::before {
      /* Slow aurora veil */
      content: "";
      position: absolute; inset: -40%;
      background:
        conic-gradient(from 0deg,
          rgba(255,255,255,0.10), transparent 30%,
          rgba(255,255,255,0.08) 55%, transparent 85%),
        radial-gradient(50% 60% at 30% 40%, rgba(255,255,255,0.14), transparent 60%),
        radial-gradient(50% 60% at 70% 70%, rgba(255,255,255,0.12), transparent 60%);
      filter: blur(72px) saturate(120%);
      animation: veil 38s linear infinite;
      pointer-events: none;
      opacity: .7;
    }
    @keyframes veil { to { transform: rotate(360deg) } }
    #vibe756 .grain {
      position: absolute; inset: 0; pointer-events: none; mix-blend-mode: soft-light; opacity: .25;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140' viewBox='0 0 140 140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='3' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      background-size: 180px 180px;
      animation: noise 1.6s steps(2) infinite;
    }
    @keyframes noise { to { transform: translate3d(1px,0,0) } }

    /* MAST */
    #vibe756 .mast {
      display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap;
      transform: perspective(1200px) rotateX(var(--tiltX)) rotateY(var(--tiltY));
      transition: transform 160ms ease;
    }
    #vibe756 .logo {
      display: inline-flex; align-items: center; gap: 10px; padding: 10px 14px;
      border-radius: 999px; font-weight: 900; letter-spacing: .8px; text-transform: uppercase;
      color: var(--ink);
      background: linear-gradient(180deg, var(--glass), transparent);
      border: 1px solid rgba(255,255,255,0.15);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.8), 0 10px 24px rgba(0,0,0,0.2);
      font-size: 12px; user-select: none;
    }
    #vibe756 .themes { display: inline-flex; align-items: center; gap: 8px; }
    #vibe756 .theme {
      width: 30px; height: 30px; border-radius: 999px; cursor: pointer; border: 1px solid rgba(255,255,255,0.18);
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.35));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.85), 0 10px 26px rgba(0,0,0,0.2);
    }

    /* HERO */
    #vibe756 .hero {
      margin: 18px 0 8px;
      font-size: clamp(42px, 8.8vw, 112px);
      font-weight: 1000; line-height: .86; letter-spacing: -1px;
      background: linear-gradient(110deg, var(--p1) 0 30%, var(--p2) 60%, var(--p3) 100%);
      -webkit-background-clip: text; background-clip: text; color: transparent;
      filter: drop-shadow(0 10px 30px rgba(0,0,0,0.25));
    }
    #vibe756 .tag {
      color: var(--muted);
      font-size: clamp(14px, 2.2vw, 18px);
      letter-spacing: .2px;
    }

    /* VIEWPORT */
    #vibe756 .viewport {
      position: relative; margin-top: 18px;
      height: clamp(360px, 60vh, 780px);
      border-radius: calc(var(--radius) - 8px);
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.14);
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.18), 0 34px 100px rgba(0,0,0,0.5);
      transform: perspective(1200px) rotateX(var(--tiltX)) rotateY(var(--tiltY));
      transition: transform 160ms ease, border-color 300ms ease, background 300ms ease;
      isolation: isolate;
    }
    #vibe756 canvas#kx { position: absolute; inset: 0; width: 100%; height: 100%; display: block; }
    #vibe756 .rip {
      position: absolute; width: 16px; height: 16px; border-radius: 999px;
      border: 2px solid rgba(255,255,255,0.9); pointer-events: none;
      transform: translate(-50%,-50%) scale(.1);
      mix-blend-mode: screen;
      animation: out 1100ms ease-out forwards;
      box-shadow: 0 0 0 2px rgba(255,255,255,0.4), 0 0 24px rgba(255,255,255,0.35);
    }
    @keyframes out { to { opacity: 0; transform: translate(-50%,-50%) scale(22) } }

    /* CONTROLS */
    #vibe756 .dock {
      display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap;
      margin-top: 14px;
    }
    #vibe756 .group { display: inline-flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    #vibe756 .chip, #vibe756 .btn, #vibe756 .slider {
      appearance: none; border-radius: 999px; border: 1px solid rgba(255,255,255,0.18);
      background: linear-gradient(180deg, var(--glass), transparent);
      color: var(--ink); box-shadow: 0 10px 26px rgba(0,0,0,0.22), inset 0 1px 0 rgba(255,255,255,0.8);
      font-weight: 900; letter-spacing: .3px;
    }
    #vibe756 .btn, #vibe756 .chip { cursor: pointer; padding: 10px 14px; font-size: 14px; }
    #vibe756 .btn:hover, #vibe756 .chip:hover { transform: translateY(-1px); transition: transform 120ms ease; }
    #vibe756 .slider {
      padding: 8px 12px; font-size: 12px; color: var(--muted); display: inline-flex; align-items: center; gap: 10px;
    }
    #vibe756 input[type="range"] { width: 220px; height: 22px; background: transparent; appearance: none; }
    #vibe756 input[type="range"]::-webkit-slider-runnable-track {
      height: 6px; border-radius: 999px; background: rgba(255,255,255,0.18); border: 1px solid rgba(255,255,255,0.12);
    }
    #vibe756 input[type="range"]::-webkit-slider-thumb {
      appearance: none; width: 16px; height: 16px; border-radius: 50%;
      margin-top: -5px; background: radial-gradient(circle at 40% 40%, #fff, #c9d3ff);
      border: 1px solid rgba(0,0,0,0.12); box-shadow: 0 0 12px rgba(255,255,255,0.4);
      cursor: grab;
    }
    #vibe756 input[type="range"]::-moz-range-track { height: 6px; border-radius: 999px; background: rgba(255,255,255,0.18); border: 1px solid rgba(255,255,255,0.12); }
    #vibe756 input[type="range"]::-moz-range-thumb {
      width: 16px; height: 16px; border-radius: 50%;
      background: radial-gradient(circle at 40% 40%, #fff, #c9d3ff);
      border: 1px solid rgba(0,0,0,0.12);
      box-shadow: 0 0 12px rgba(255,255,255,0.4);
      cursor: grab;
    }

    /* FOOTER */
    #vibe756 footer {
      margin-top: 10px; display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap;
      color: var(--muted); font-size: 12px;
    }
    #vibe756 .state { display: inline-flex; align-items: center; gap: 8px; }
    #vibe756 .led {
      width: 9px; height: 9px; border-radius: 50%;
      background: radial-gradient(circle at 40% 40%, var(--p1), var(--p2));
      box-shadow: 0 0 10px rgba(255,255,255,0.45);
      animation: led 2s ease-in-out infinite;
    }
    @keyframes led { 0%,100%{ transform: scale(1); opacity: .95;} 50%{ transform: scale(1.25); opacity: .6;} }

    /* GHOST DIGITS */
    #vibe756 .ghost {
      pointer-events: none;
      position: absolute; right: -6vw; bottom: -8vw;
      font-size: clamp(120px, 30vw, 540px);
      font-weight: 1000; letter-spacing: -4px; line-height: .8;
      color: transparent;
      -webkit-text-stroke: 2px rgba(255,255,255,0.08);
      text-stroke: 2px rgba(255,255,255,0.08);
      opacity: .7;
      transform: rotate(-8deg);
      filter: drop-shadow(0 10px 40px rgba(0,0,0,0.3));
    }

    /* CALM */
    #vibe756.calm .led { animation: none !important; }
    @media (prefers-reduced-motion: reduce) {
      #vibe756 .led, #vibe756 .studio::before { animation: none !important; }
    }

    /* RESPONSIVE */
    @media (max-width: 560px) {
      #vibe756 .hero { font-size: clamp(34px, 10vw, 70px); }
      #vibe756 input[type="range"] { width: 48vw; }
      #vibe756 .ghost { right: -12vw; bottom: -14vw; }
    }
  </style>

  <section class="studio" role="region" aria-label="Kaleido Lab 756">
    <div class="grain" aria-hidden="true"></div>

    <div class="mast">
      <span class="logo">Edition 756 <em style="font-style:normal;opacity:.65;">kaleido lab</em></span>
      <span class="themes" aria-label="Themes">
        <button class="theme" data-theme="aurora" title="Aurora" style="background: radial-gradient(circle at 30% 30%, #fff, #6fd4ff);"></button>
        <button class="theme" data-theme="ink" title="Ink" style="background: radial-gradient(circle at 30% 30%, #fff, #1a1a28);"></button>
        <button class="theme" data-theme="quartz" title="Quartz" style="background: radial-gradient(circle at 30% 30%, #fff, #eaf1ff);"></button>
        <button class="theme" data-theme="forest" title="Forest" style="background: radial-gradient(circle at 30% 30%, #fff, #1b4a3b);"></button>
        <button class="theme" data-theme="ember" title="Ember" style="background: radial-gradient(circle at 30% 30%, #fff, #4b2015);"></button>
      </span>
    </div>

    <h1 class="hero">Folded light.</h1>
    <p class="tag">A generative kaleidoscope. Drag to tilt. Touch to ripple.</p>

    <div class="viewport" id="viewport" aria-hidden="true">
      <canvas id="kx"></canvas>
      <div class="ghost" aria-hidden="true">756</div>
    </div>

    <div class="dock">
      <div class="group">
        <label for="sym" class="slider"><span>Symmetry</span><input id="sym" type="range" min="3" max="24" value="12" aria-label="Symmetry"></label>
        <label for="flow" class="slider"><span>Flow</span><input id="flow" type="range" min="1" max="200" value="90" aria-label="Flow Speed"></label>
        <label for="sat" class="slider"><span>Saturation</span><input id="sat" type="range" min="10" max="200" value="120" aria-label="Saturation"></label>
      </div>
      <div class="group">
        <button class="btn" id="pulse">Pulse</button>
        <button class="btn" id="pause">Pause</button>
        <button class="chip" id="shuffle">Shuffle</button>
      </div>
    </div>

    <footer>
      <div class="state">
        <span class="led" aria-hidden="true"></span>
        <span id="status">Theme: Aurora • Sym: 12 • Flow: 90 • Motion: On</span>
      </div>
      <span id="last-updated">Last updated: 2025-11-20 02:17:46 EST</span>
    </footer>
  </section>

  <script>
    (function(){
      const root = document.getElementById('vibe756');
      const frame = root.querySelector('.studio');
      const view = root.querySelector('#viewport');
      const canvas = root.querySelector('#kx');
      const ctx = canvas.getContext('2d');
      const sym = root.querySelector('#sym');
      const flow = root.querySelector('#flow');
      const sat = root.querySelector('#sat');
      const pulseBtn = root.querySelector('#pulse');
      const pauseBtn = root.querySelector('#pause');
      const shuffleBtn = root.querySelector('#shuffle');
      const themes = root.querySelectorAll('.theme');
      const status = root.querySelector('#status');
      const lu = root.querySelector('#last-updated');

      // Timestamp
      try {
        const now = new Date();
        lu.textContent = now.toLocaleString(undefined, {
          year: 'numeric', month: 'short', day: '2-digit',
          hour: '2-digit', minute: '2-digit'
        });
      } catch(e){}

      // Tilt + spotlight
      function move(e) {
        const r = frame.getBoundingClientRect();
        const x = e.clientX - r.left, y = e.clientY - r.top;
        const nx = x / r.width - 0.5, ny = y / r.height - 0.5;
        root.style.setProperty('--tiltX', (-ny * 6).toFixed(2) + 'deg');
        root.style.setProperty('--tiltY', ( nx * 8).toFixed(2) + 'deg');
        mouse.x = x; mouse.y = y; mouse.active = true;
      }
      frame.addEventListener('pointermove', move);
      frame.addEventListener('pointerleave', () => {
        root.style.setProperty('--tiltX', '0deg');
        root.style.setProperty('--tiltY', '0deg');
        mouse.active = false;
      });

      // Canvas sizing
      let w=0,h=0,dpr=1;
      function resize() {
        const rect = canvas.getBoundingClientRect();
        w = Math.max(1, Math.floor(rect.width));
        h = Math.max(1, Math.floor(rect.height));
        dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }
      resize();
      window.addEventListener('resize', resize);

      // Field primitives
      const rng = (seed => () => (seed = (seed*9301+49297)%233280)/233280)(Math.floor(Math.random()*99999)+1);
      let seed = Math.floor(rng()*1e6);
      const TAU = Math.PI*2;
      let running = true;
      let pulse = 0;
      const mouse = { x: w/2, y: h/2, active: false };

      // Update status
      function updateStatus(){
        const themeName = ({
          aurora: 'Aurora', ink: 'Ink', quartz: 'Quartz', forest: 'Forest', ember: 'Ember'
        }[root.dataset.theme] || 'Aurora');
        status.textContent = `Theme: ${themeName} • Sym: ${sym.value} • Flow: ${flow.value} • Motion: ${running ? 'On' : 'Off'}`;
      }

      function css(name) { return getComputedStyle(root).getPropertyValue(name).trim(); }
      function map(n,a,b,c,d){ return (n-a)*(d-c)/(b-a)+c; }
      function lerp(a,b,t){ return a + (b-a)*t; }

      // Main draw
      let tPrev = performance.now();
      function draw(now){
        if(!running) return;
        const dt = Math.min(32, now - tPrev); tPrev = now;
        const speed = Number(flow.value)/80;
        const satur = Number(sat.value)/100;

        // fade trail
        ctx.globalCompositeOperation = 'source-over';
        const fade = root.dataset.theme === 'quartz' ? 0.08 : 0.12;
        ctx.fillStyle = `rgba(0,0,0,${fade})`;
        if (root.dataset.theme === 'quartz') ctx.fillStyle = `rgba(255,255,255,${fade*0.75})`;
        ctx.fillRect(0,0,w,h);

        const cx = w/2, cy = h/2;
        ctx.save();
        ctx.translate(cx, cy);

        // palette
        const p1 = css('--p1') || '#66f';
        const p2 = css('--p2') || '#a6f';
        const p3 = css('--p3') || '#6fc';

        // composite
        ctx.globalCompositeOperation = 'lighter';

        // parameters
        const k = Math.floor(Number(sym.value));
        const baseR = Math.min(w,h) * 0.18;
        const amp = Math.min(w,h) * 0.32 * (0.5 + 0.5*Math.sin(now*0.0006 + seed));
        const t = now * 0.001 * speed;

        // multi-trace
        const traces = 38;
        for (let i=0;i<traces;i++){
          const fi = i/traces;
          // spiro-ish param
          const a = t*TAU*0.07 + fi*TAU*2 + seed*0.00001;
          const r = baseR + amp * (0.35 + 0.65*Math.sin(a*2.3 + Math.sin(a*0.7+fi*3)));
          const px = r * Math.cos(a + Math.sin(a*0.9+fi*5)*0.6);
          const py = r * Math.sin(a + Math.cos(a*0.6+fi*4)*0.6);

          // color gradient by radius and index
          const mix = Math.min(1, Math.max(0, (r - baseR) / (amp+1)));
          const col = i%3===0 ? p1 : (i%3===1 ? p2 : p3);
          ctx.fillStyle = col;
          let size = 1.5 + 1.6*Math.sin(t*2 + i) + 2.0*pulse;
          size = Math.max(0.8, size);

          // draw k rotations + mirror
          for (let m=0; m<k; m++){
            ctx.save();
            ctx.rotate(TAU * m / k);
            // normal
            dot(px, py, size, mix, satur);
            // mirror
            ctx.scale(-1, 1);
            dot(px, py, size*0.96, mix, satur);
            ctx.restore();
          }
        }

        ctx.restore();

        // decay pulse
        pulse *= 0.92;

        raf = requestAnimationFrame(draw);
      }

      function dot(x, y, r, mix, sat){
        const g = ctx.createRadialGradient(x, y, 0, x, y, r*8);
        // Base color with saturation factor
        const c1 = css('--p1'), c2 = css('--p2'), c3 = css('--p3');
        const pick = Math.random();
        const base = pick < 0.33 ? c1 : pick < 0.66 ? c2 : c3;
        g.addColorStop(0, `hsla(${hueOf(base)}, 100%, ${lerp(60, 85, sat)}%, ${lerp(0.9,1, mix)})`);
        g.addColorStop(0.6, `hsla(${hueOf(base)}, ${lerp(60, 95, sat)}%, ${lerp(45,70,mix)}%, 0.28)`);
        g.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.beginPath();
        ctx.fillStyle = g;
        ctx.arc(x, y, r*8, 0, TAU);
        ctx.fill();
      }

      // crude hue extractor from hex
      function hueOf(hex){
        try{
          const c = hex.replace('#','');
          const bigint = parseInt(c.length===3 ? c.split('').map(x=>x+x).join('') : c, 16);
          const r = (bigint >> 16) & 255, g = (bigint >> 8) & 255, b = bigint & 255;
          return rgbToHsl(r,g,b)[0];
        }catch(e){ return 200; }
      }
      function rgbToHsl(r,g,b){
        r/=255; g/=255; b/=255;
        const max=Math.max(r,g,b), min=Math.min(r,g,b);
        let h,s,l=(max+min)/2;
        if(max===min){ h=s=0; }
        else{
          const d=max-min;
          s=l>0.5? d/(2-max-min) : d/(max+min);
          switch(max){
            case r: h=(g-b)/d+(g<b?6:0); break;
            case g: h=(b-r)/d+2; break;
            case b: h=(r-g)/d+4; break;
          }
          h/=6;
        }
        return [Math.round(h*360), Math.round(s*100), Math.round(l*100)];
      }

      // Interactions
      function ping(x, y){
        const rect = view.getBoundingClientRect();
        const wave = document.createElement('span');
        wave.className = 'rip';
        wave.style.left = x + 'px';
        wave.style.top = y + 'px';
        view.appendChild(wave);
        setTimeout(() => wave.remove(), 1100);
        pulse = 1.2;
        // Tiny frame throb
        try {
          frame.animate([{ transform: 'scale(1)' }, { transform: 'scale(1.016)' }, { transform: 'scale(1)' }], { duration: 260, easing: 'ease-out' });
        } catch(e){}
      }
      view.addEventListener('pointerdown', (e) => {
        const r = view.getBoundingClientRect();
        ping(e.clientX - r.left, e.clientY - r.top);
      });

      // Controls
      function resetSeed(){ seed = Math.floor(rng()*1e6); }
      sym.addEventListener('input', updateStatus);
      flow.addEventListener('input', updateStatus);
      sat.addEventListener('input', updateStatus);

      pulseBtn.addEventListener('click', () => { pulse = 1.2; updateStatus(); });

      pauseBtn.addEventListener('click', () => {
        if (running) {
          running = false;
          root.classList.add('calm');
          cancelAnimationFrame(raf);
          pauseBtn.textContent = 'Resume';
        } else {
          running = true;
          root.classList.remove('calm');
          tPrev = performance.now();
          raf = requestAnimationFrame(draw);
          pauseBtn.textContent = 'Pause';
        }
        updateStatus();
      });

      shuffleBtn.addEventListener('click', () => {
        resetSeed();
        pulse = 1.2;
        updateStatus();
      });

      themes.forEach(btn => {
        btn.addEventListener('click', () => {
          root.dataset.theme = btn.getAttribute('data-theme');
          try {
            status.animate([{ filter:'brightness(1)' }, { filter:'brightness(1.4)' }, { filter:'brightness(1)'}], { duration: 340, easing: 'ease-out' });
          } catch(e){}
          updateStatus();
        });
      });

      // Init
      let raf = requestAnimationFrame(draw);
      updateStatus();

      // Accessibility: reduced motion
      try {
        const mq = window.matchMedia('(prefers-reduced-motion: reduce)');
        if (mq.matches) {
          flow.value = Math.max(1, Math.round(flow.max*0.35));
          updateStatus();
        }
      } catch(e){}
    })();
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


