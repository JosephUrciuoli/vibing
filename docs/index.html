<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="aurora" aria-label="Aurora Loom">
  <style>
    /* Scope everything to #aurora */
    #aurora {
      --bg0: #07090f;
      --bg1: #0f1320;
      --fg: #eef3ff;
      --muted: #98a6c7;
      --a1: #8ad8ff;
      --a2: #a1ffdd;
      --a3: #c7b5ff;
      --grain: .25;
      --rad: 22px;
      color: var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
      border-radius: var(--rad);
      border: 1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(140% 120% at 15% -10%, color-mix(in oklab, var(--a3), transparent 88%) 0%, transparent 60%),
        radial-gradient(120% 120% at 100% 120%, color-mix(in oklab, var(--a1), transparent 88%) 0%, transparent 68%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.08),
        0 30px 80px -30px rgba(0,0,0,.65),
        0 14px 38px -22px rgba(0,0,0,.6);
      position: relative;
      overflow: clip;
      isolation: isolate;
    }
    #aurora::before {
      content: "";
      position: absolute; inset: -40% -20%;
      background:
        conic-gradient(from var(--spin,0deg) at 60% 30%,
          color-mix(in oklab, var(--a1), transparent 70%) 0 12%,
          transparent 16% 32%,
          color-mix(in oklab, var(--a2), transparent 70%) 36% 56%,
          transparent 60% 76%,
          color-mix(in oklab, var(--a3), transparent 70%) 80% 100%);
      filter: blur(110px) saturate(120%);
      opacity: .65;
      animation: roll 48s linear infinite;
      pointer-events: none;
      z-index: 0;
    }
    @keyframes roll { to { --spin: 360deg; } }
    #aurora::after {
      content: "";
      position: absolute; inset: 0;
      background:
        repeating-linear-gradient(0deg, rgba(255,255,255,.02) 0 1px, transparent 1px 2px),
        repeating-linear-gradient(90deg, rgba(255,255,255,.012) 0 1px, transparent 1px 2px);
      mix-blend-mode: soft-light;
      opacity: var(--grain);
      transition: opacity .3s ease;
      z-index: 0;
      pointer-events:none;
    }

    /* Layout */
    #aurora .shell {
      position: relative;
      display: grid;
      grid-template-columns: 1.1fr .9fr;
      gap: clamp(14px, 2.6vw, 24px);
      padding: clamp(16px, 2.2vw, 24px);
      z-index: 1;
    }
    #aurora .panel,
    #aurora .stage {
      border-radius: clamp(16px, 2vw, 20px);
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08), 0 18px 46px -28px rgba(0,0,0,.8);
      backdrop-filter: blur(14px) saturate(140%);
    }

    /* Header block */
    #aurora .panel {
      display: grid;
      grid-template-rows: auto 1fr auto;
      overflow: clip;
    }
    #aurora .head {
      display: flex; align-items: center; justify-content: space-between; gap: 10px;
      padding: clamp(16px, 2vw, 18px) clamp(18px, 2.4vw, 22px);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    #aurora .brand {
      display: grid; grid-template-columns: auto 1fr; gap: 10px; align-items: center;
      user-select: none;
    }
    #aurora .glyph {
      width: 34px; height: 34px; border-radius: 12px;
      background:
        radial-gradient(80% 80% at 25% 30%, var(--a1), transparent 60%),
        radial-gradient(80% 80% at 75% 70%, var(--a2), transparent 60%),
        linear-gradient(180deg, color-mix(in oklab, var(--a3), #000 24%), color-mix(in oklab, var(--a1), #000 18%));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.8), 0 18px 42px -22px rgba(0,0,0,.7);
    }
    #aurora .title {
      display: flex; flex-direction: column; line-height: 1.1;
    }
    #aurora .title strong {
      font-weight: 900;
      letter-spacing: .06em;
      text-transform: uppercase;
      font-size: clamp(12px, 1.6vw, 14px);
      opacity: .95;
    }
    #aurora .title span { color: var(--muted); font-size: 12px; }

    /* Themes */
    #aurora .themes {
      display: flex; gap: 8px; align-items: center; padding: 6px;
      background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.12); border-radius: 999px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
    }
    #aurora .pill {
      appearance: none; border: 1px solid rgba(255,255,255,.18);
      padding: 8px 12px; border-radius: 999px; cursor: pointer;
      background:
        radial-gradient(80% 80% at 30% 30%, var(--a1), transparent 70%),
        radial-gradient(80% 80% at 70% 70%, var(--a2), transparent 70%),
        linear-gradient(180deg, color-mix(in oklab, var(--a3), #000 18%), color-mix(in oklab, var(--a1), #000 22%));
      color: #0b1220; font-weight: 900; font-size: 12px; letter-spacing: .04em;
      box-shadow: 0 14px 28px -14px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.8);
      transition: transform .12s ease, box-shadow .22s ease, opacity .2s ease, filter .2s ease;
    }
    #aurora .pill[aria-pressed="true"] { transform: translateY(-2px) scale(1.04); box-shadow: 0 16px 38px -18px rgba(0,0,0,.7), inset 0 1px 0 rgba(255,255,255,.9); }

    /* Body of panel */
    #aurora .body {
      display: grid; gap: clamp(10px, 2vw, 14px);
      padding: clamp(16px, 2vw, 22px);
    }
    #aurora .h1 {
      margin: 0;
      font-size: clamp(28px, 6.4vw, 64px);
      line-height: .95;
      letter-spacing: -.02em;
      background: linear-gradient(92deg, var(--fg), color-mix(in oklab, var(--a1), var(--fg) 50%) 55%, var(--a2) 100%);
      -webkit-background-clip: text; background-clip: text; color: transparent;
      filter: drop-shadow(0 12px 30px rgba(0,0,0,.5));
    }
    #aurora .lede { color: var(--muted); margin: 0; font-size: clamp(12px, 2vw, 16px); line-height: 1.6; text-wrap: balance; }

    /* Controls */
    #aurora .controls {
      display: grid; gap: 10px; grid-auto-rows: min-content;
      padding: 0 clamp(16px, 2vw, 22px) clamp(16px, 2vw, 22px);
    }
    #aurora .row { display: flex; flex-wrap: wrap; align-items: center; gap: 10px; }
    #aurora .btn {
      appearance: none; border: 0; cursor: pointer; font-weight: 900; font-size: 13px; border-radius: 14px;
      padding: 10px 14px; color: #0b1220;
      background: linear-gradient(90deg, var(--a2), var(--a1));
      box-shadow: 0 14px 28px -14px color-mix(in oklab, var(--a1), black 26%), inset 0 1px 0 rgba(255,255,255,.75);
      transition: transform .12s ease, box-shadow .22s ease, opacity .2s ease;
    }
    #aurora .btn:hover { transform: translateY(-2px); }
    #aurora .unit {
      display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 8px; color: var(--muted); font-weight: 700; font-size: 12px;
      padding: 8px 10px; border-radius: 12px; background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.12);
    }
    #aurora input[type="range"] {
      -webkit-appearance: none; appearance: none; width: 200px; height: 10px; border-radius: 999px; outline: none;
      background: rgba(255,255,255,.12); border: 1px solid rgba(255,255,255,.14);
    }
    #aurora input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background: linear-gradient(180deg,#fff,rgba(255,255,255,.7));
      border: 1px solid rgba(255,255,255,.25);
      box-shadow: 0 12px 24px -12px rgba(0,0,0,.6), inset 0 1px 0 #fff;
    }
    #aurora .toggle {
      display: grid; grid-auto-flow: column; align-items: center; gap: 8px; color: var(--muted); font-weight: 700; font-size: 12px; user-select: none;
    }
    #aurora .toggle input { accent-color: var(--a2); width: 18px; height: 18px; }

    /* Stage */
    #aurora .stage {
      position: relative; overflow: hidden; min-height: clamp(360px, 48vw, 560px);
      display: grid; place-items: center;
      transform: perspective(1000px);
      transition: transform .4s ease;
    }
    #aurora .stage:hover { }
    #aurora canvas { width: 100%; height: 100%; display: block; }
    #aurora .overlay-time {
      position: absolute; inset: auto 0 6% 0; display: flex; justify-content: center; align-items: baseline; gap: .2em;
      font-variant-numeric: tabular-nums; font-weight: 900;
      text-shadow: 0 6px 20px rgba(0,0,0,.6);
      pointer-events: none;
    }
    #aurora .overlay-time span {
      background: linear-gradient(90deg, var(--fg), color-mix(in oklab, var(--a1), var(--fg) 30%));
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    #aurora .overlay-time .hh, #aurora .overlay-time .mm { font-size: clamp(38px, 11vw, 104px); line-height: .8; }
    #aurora .overlay-time .colon { font-size: clamp(28px, 8vw, 64px); opacity: .9; }
    #aurora .overlay-time .ampm { font-size: clamp(10px, 2.3vw, 14px); letter-spacing: .22em; text-transform: uppercase; align-self: center; color: var(--muted); }

    /* Footer/meta */
    #aurora .meta {
      display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 10px;
      border-top: 1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      padding: clamp(10px,1.6vw,14px) clamp(14px,2vw,20px);
      color: var(--muted); font-size: 12px;
    }
    #aurora .progress {
      position: relative; height: 6px; background: rgba(255,255,255,.08);
      border-radius: 999px; overflow: hidden; border: 1px solid rgba(255,255,255,.12);
      flex: 1 1 auto; min-width: 160px;
    }
    #aurora .progress > i {
      display: block; height: 100%; width: var(--p, 0%); border-radius: inherit;
      background: linear-gradient(90deg, var(--a2), var(--a1));
      box-shadow: 0 10px 20px -14px color-mix(in oklab, var(--a1), black 28%);
      transition: width .2s ease;
    }

    /* Responsive */
    @media (max-width: 980px) {
      #aurora .shell { grid-template-columns: 1fr; }
      #aurora .overlay-time { inset: auto 0 4% 0; }
    }
    @media (prefers-reduced-motion: reduce) {
      #aurora::before { animation: none !important; }
      #aurora .stage { transition: none !important; }
      #aurora .btn:hover { transform: none !important; }
    }
  </style>

  <div class="shell">
    <div class="panel">
      <div class="head">
        <div class="brand" aria-label="Aurora Loom">
          <div class="glyph" aria-hidden="true"></div>
          <div class="title">
            <strong>AURORA LOOM</strong>
            <span>Weave light. Tame time.</span>
          </div>
        </div>
        <div class="themes" role="group" aria-label="Themes">
          <button class="pill" data-key="nocturne" aria-pressed="true">Nocturne</button>
          <button class="pill" data-key="meadow" aria-pressed="false">Meadow</button>
          <button class="pill" data-key="solaris" aria-pressed="false">Solaris</button>
          <button class="pill" data-key="glacier" aria-pressed="false">Glacier</button>
        </div>
      </div>

      <div class="body">
        <h1 class="h1">Threads of calm in a noisy minute.</h1>
        <p class="lede">Ribbons of color breathe across the canvas. Nudge the weave, change the air, or pause to feel the hush.</p>
      </div>

      <div class="controls">
        <div class="row">
          <button class="btn" id="toggle">Pause</button>
          <label class="toggle"><input type="checkbox" id="grain" checked> Grain</label>
          <label class="toggle"><input type="checkbox" id="bloom" checked> Bloom</label>
        </div>
        <div class="row">
          <div class="unit">
            <label for="tempo">Tempo</label>
            <input type="range" id="tempo" min="10" max="220" value="120" step="1" aria-label="Tempo">
            <span id="tempoVal">1.20x</span>
          </div>
          <div class="unit">
            <label for="weave">Weave</label>
            <input type="range" id="weave" min="3" max="14" value="7" step="1" aria-label="Weave density">
            <span id="weaveVal">7</span>
          </div>
        </div>
      </div>

      <div class="meta">
        <span id="themeName">Theme: Nocturne</span>
        <div class="progress" aria-label="Seconds in minute"><i id="secbar" style="--p:0%"></i></div>
        <span id="last-updated">Last updated: 2025-12-18 14:16:29 EST</span>
      </div>
    </div>

    <div class="stage" id="stage" aria-label="Generative aurora canvas">
      <canvas id="loom" role="img" aria-label="Flowing ribbons of light"></canvas>
      <div class="overlay-time" aria-live="polite" aria-atomic="true">
        <span class="hh" id="hh">12</span><span class="colon">:</span><span class="mm" id="mm">00</span>
        <span class="ampm" id="ampm">AM</span>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const root = document.getElementById('aurora');
      const stage = document.getElementById('stage');
      const canvas = document.getElementById('loom');
      const ctx = canvas.getContext('2d');

      const pills = root.querySelectorAll('.pill');
      const themeName = document.getElementById('themeName');

      const tempo = document.getElementById('tempo');
      const weave = document.getElementById('weave');
      const tempoVal = document.getElementById('tempoVal');
      const weaveVal = document.getElementById('weaveVal');
      const toggle = document.getElementById('toggle');
      const grain = document.getElementById('grain');
      const bloom = document.getElementById('bloom');

      const hh = document.getElementById('hh');
      const mm = document.getElementById('mm');
      const ampm = document.getElementById('ampm');
      const secbar = document.getElementById('secbar');
      const updated = document.getElementById('last-updated');

      // Timestamp
      try {
        const now = new Date();
        const fmt = new Intl.DateTimeFormat(undefined, { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit', second:'2-digit' });
        const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'local';
        updated.textContent = `Updated ${fmt.format(now)} â€¢ ${tz}`;
      } catch {
        updated.textContent = 'Updated just now';
      }

      // Themes
      const THEMES = {
        nocturne: { name:'Nocturne', bg0:'#07090f', bg1:'#0f1320', fg:'#eef3ff', muted:'#98a6c7', a1:'#8ad8ff', a2:'#a1ffdd', a3:'#c7b5ff' },
        meadow:   { name:'Meadow',   bg0:'#08100b', bg1:'#0f1a13', fg:'#f2fff5', muted:'#a7c4b2', a1:'#7dffa6', a2:'#d5ff92', a3:'#7de6ff' },
        solaris:  { name:'Solaris',  bg0:'#0f0b07', bg1:'#20160e', fg:'#fff7ea', muted:'#d2c3a9', a1:'#ffbf6f', a2:'#ffd39a', a3:'#ffa7c9' },
        glacier:  { name:'Glacier',  bg0:'#071016', bg1:'#0e1a24', fg:'#eaf6ff', muted:'#a0bfd7', a1:'#8bc7ff', a2:'#7df1ff', a3:'#b6e4ff' }
      };
      let active = 'nocturne';
      function applyTheme(key) {
        const t = THEMES[key] || THEMES.nocturne;
        root.style.setProperty('--bg0', t.bg0);
        root.style.setProperty('--bg1', t.bg1);
        root.style.setProperty('--fg',  t.fg);
        root.style.setProperty('--muted', t.muted);
        root.style.setProperty('--a1', t.a1);
        root.style.setProperty('--a2', t.a2);
        root.style.setProperty('--a3', t.a3);
        themeName.textContent = `Theme: ${t.name}`;
        pills.forEach(p => p.setAttribute('aria-pressed', String(p.dataset.key === key)));
        active = key;
        refreshColors();
      }
      pills.forEach(p => p.addEventListener('click', () => applyTheme(p.dataset.key)));

      // Auto theme by hour
      const hr = new Date().getHours();
      if (hr >= 6 && hr < 12) applyTheme('meadow');
      else if (hr >= 12 && hr < 18) applyTheme('glacier');
      else applyTheme('nocturne');

      // Grain & Bloom
      function setGrain(on){ root.style.setProperty('--grain', on ? '.25' : '0'); }
      setGrain(grain.checked);
      grain.addEventListener('change', () => setGrain(grain.checked));

      let bloomOn = true;
      bloomOn = bloom.checked;
      bloom.addEventListener('change', () => bloomOn = bloom.checked);

      // Tempo & Weave
      let speed = +tempo.value / 100;
      tempoVal.textContent = `${speed.toFixed(2)}x`;
      tempo.addEventListener('input', () => {
        speed = +tempo.value / 100;
        tempoVal.textContent = `${speed.toFixed(2)}x`;
      });

      let bands = +weave.value | 0;
      weaveVal.textContent = `${bands}`;
      weave.addEventListener('input', () => {
        bands = +weave.value | 0;
        weaveVal.textContent = `${bands}`;
        reseed();
      });

      // Time + seconds bar
      function tickClock() {
        const now = new Date();
        let h = now.getHours(); const m = now.getMinutes(); const s = now.getSeconds();
        const am = h < 12 ? 'AM' : 'PM';
        h = h % 12; if (h === 0) h = 12;
        hh.textContent = String(h).padStart(2, '0');
        mm.textContent = String(m).padStart(2, '0');
        ampm.textContent = am;
        const p = ((s % 60) / 60) * 100;
        secbar.style.setProperty('--p', `${p}%`);
      }
      tickClock();
      setInterval(tickClock, 1000);

      // Motion preferences
      const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      // Toggle play/pause
      let running = !reduce;
      toggle.textContent = running ? 'Pause' : 'Play';
      toggle.addEventListener('click', () => {
        running = !running;
        toggle.textContent = running ? 'Pause' : 'Play';
        if (running) requestAnimationFrame(loop);
      });

      // Keys
      window.addEventListener('keydown', (e) => {
        if (e.code === 'Space') { e.preventDefault(); toggle.click(); }
        if (e.key === '1') applyTheme('nocturne');
        if (e.key === '2') applyTheme('meadow');
        if (e.key === '3') applyTheme('solaris');
        if (e.key === '4') applyTheme('glacier');
      });

      // Tilt
      function tilt(e){
        const r = stage.getBoundingClientRect();
        const x = (e.clientX - r.left)/r.width - 0.5;
        const y = (e.clientY - r.top)/r.height - 0.5;
        stage.style.transform = `perspective(1000px) rotateX(${(-y*4).toFixed(2)}deg) rotateY(${(x*5).toFixed(2)}deg)`;
      }
      function untilt(){ stage.style.transform = 'perspective(1000px)'; }
      if(!reduce){
        stage.addEventListener('mousemove', tilt);
        stage.addEventListener('mouseleave', untilt);
      }

      // Canvas sizing
      let DPR = Math.min(2, window.devicePixelRatio || 1), W=0, H=0;
      function resize() {
        const r = canvas.getBoundingClientRect();
        W = Math.max(320, Math.floor(r.width));
        H = Math.max(260, Math.floor(r.height));
        canvas.width = Math.floor(W * DPR);
        canvas.height = Math.floor(H * DPR);
        ctx.setTransform(DPR,0,0,DPR,0,0);
      }
      const ro = new ResizeObserver(resize); ro.observe(canvas);

      // Colors
      const C = { a1:'#8ad8ff', a2:'#a1ffdd', a3:'#c7b5ff', fg:'#ffffff' };
      function refreshColors(){
        const cs = getComputedStyle(root);
        C.a1 = cs.getPropertyValue('--a1').trim() || C.a1;
        C.a2 = cs.getPropertyValue('--a2').trim() || C.a2;
        C.a3 = cs.getPropertyValue('--a3').trim() || C.a3;
        C.fg = cs.getPropertyValue('--fg').trim()  || C.fg;
      }
      refreshColors();

      // Aurora ribbons
      let t = 0;
      const pointer = { x: 0, y: 0, active: false };
      canvas.addEventListener('pointermove', e => {
        const r = canvas.getBoundingClientRect();
        pointer.x = e.clientX - r.left; pointer.y = e.clientY - r.top; pointer.active = true;
      }, { passive: true });
      canvas.addEventListener('pointerleave', () => pointer.active = false);

      let seeds = [];
      function reseed() {
        seeds = Array.from({ length: bands }).map((_, i) => ({
          amp: (H || 500) * (0.08 + 0.06 * Math.random()),
          base: (H || 500) * (0.25 + 0.5 * (i/(bands-1 || 1))),
          freq: 0.002 + Math.random() * 0.004,
          drift: Math.random() * Math.PI * 2,
          thick: 10 + i*0.6 + Math.random()*4,
          hueShift: i / Math.max(1, bands-1)
        }));
      }

      function grad(x0,y0,x1,y1) {
        const g = ctx.createLinearGradient(x0,y0,x1,y1);
        g.addColorStop(0, C.a1);
        g.addColorStop(0.5, C.a2);
        g.addColorStop(1, C.a3);
        return g;
      }

      function drawAurora() {
        ctx.clearRect(0,0,W,H);

        // Subtle vignette
        const vg = ctx.createRadialGradient(W/2, H/2, Math.min(W,H)*0.1, W/2, H/2, Math.max(W,H)*0.8);
        vg.addColorStop(0, 'rgba(255,255,255,0.06)');
        vg.addColorStop(1, 'rgba(0,0,0,0.00)');
        ctx.fillStyle = vg; ctx.fillRect(0,0,W,H);

        ctx.save();
        ctx.globalCompositeOperation = 'lighter';
        for (let i=0;i<seeds.length;i++) {
          const s = seeds[i];
          const phase = t * (0.9 + i*0.08) * speed + s.drift;
          const sway = Math.sin(phase * 0.7) * 0.6 + Math.cos(phase * 0.3) * 0.4;

          // Point attractor
          const attract = pointer.active ? (1 - Math.min(1, Math.hypot(pointer.x - W/2, pointer.y - s.base)/Math.max(160, W*0.3))) : 0;
          const amp = s.amp * (1 + attract*0.9);
          const baseY = s.base + sway * 14;

          ctx.lineWidth = s.thick + attract * 10;
          ctx.strokeStyle = grad(0, baseY-40, W, baseY+40);
          ctx.globalAlpha = 0.65 - i * (0.4/Math.max(1,seeds.length));

          ctx.beginPath();
          for (let x=0; x<=W; x+=2) {
            const y = baseY
              + Math.sin(x * s.freq + phase) * amp * (0.55 + 0.45*Math.cos(phase + x*0.0015))
              + Math.cos(x * s.freq * 0.6 - phase*0.7) * amp * 0.28;
            if (x===0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          }
          ctx.stroke();

          if (bloomOn) {
            // Soft glow
            ctx.globalAlpha *= 0.6;
            ctx.lineWidth *= 2.2;
            ctx.stroke();
          }
        }

        // Floating motes
        const moteN = 28;
        for (let i=0; i<moteN; i++) {
          const a = t*0.4*speed + i;
          const x = (i*i*91 % W) + Math.sin(a*0.7+i)*40;
          const y = (i*i*53 % H) + Math.cos(a*0.9+i)*30;
          const r = 1.4 + (i%5)*0.3;
          const lg = ctx.createRadialGradient(x,y,0,x,y, r*10);
          lg.addColorStop(0, i%2 ? C.a2 : C.a1);
          lg.addColorStop(1, 'rgba(255,255,255,0)');
          ctx.globalAlpha = 0.25;
          ctx.fillStyle = lg;
          ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
        }

        ctx.restore();
      }

      function loop() {
        if (running && !reduce) t += 0.016;
        drawAurora();
        if (!reduce) requestAnimationFrame(loop);
      }

      // Init
      resize();
      reseed();
      if (reduce) {
        drawAurora();
      } else {
        requestAnimationFrame(loop);
      }

      // Reseed on resize to keep spacing pleasant
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => { resize(); reseed(); }, 120);
      });

      // Cleanup observers if removed
      const obs = new MutationObserver(() => {
        if (!document.body.contains(root)) { obs.disconnect(); ro.disconnect(); }
      });
      obs.observe(document.body, { childList: true, subtree: true });
    }());
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


