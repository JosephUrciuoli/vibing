<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="vibe-1525" data-season="spring" aria-label="A living, generative flower garden">
  <style>
    /* Scope everything to #vibe-1525 */
    #vibe-1525 {
      --bg1: #f8fbff;
      --bg2: #ffffff;
      --ink: #0b1220;
      --muted: #5b6474;
      --ring: rgba(15, 23, 42, 0.12);

      --sun: #ffd166;
      --grass: #c9f7c6;

      --mx: 50%;
      --my: 50%;
      --breezeX: 0;
      --breezeY: 0;

      color: var(--ink);
      background: radial-gradient(1200px 700px at var(--mx) var(--my), rgba(94,234,212,0.14), transparent 60%), linear-gradient(140deg, var(--bg1), var(--bg2));
      border-radius: 28px;
      border: 1px solid rgba(15, 23, 42, 0.08);
      box-shadow: 0 16px 50px rgba(15,23,42,0.10), inset 0 1px 0 rgba(255,255,255,0.6);
      padding: 28px;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      position: relative;
      overflow: hidden;
      isolation: isolate;
      transition: background .6s ease, color .3s ease, box-shadow .3s ease;
    }

    /* Paper grain */
    #vibe-1525::before {
      content: "";
      position: absolute; inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence baseFrequency='.8' numOctaves='2' stitchTiles='stitch' type='fractalNoise'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.035'/%3E%3C/svg%3E");
      mix-blend-mode: soft-light;
      pointer-events: none;
      z-index: 0;
    }

    /* Seasonal palettes */
    #vibe-1525[data-season="spring"] {
      --bg1: #f9fbff;
      --bg2: #ffffff;
      --ink: #131a2a;
      --muted: #5a6273;
      --sun: #ffd166;
      --grass: #c8f7c5;
    }
    #vibe-1525[data-season="summer"] {
      --bg1: #e7fff6;
      --bg2: #ffffff;
      --ink: #082019;
      --muted: #315b51;
      --sun: #ffe066;
      --grass: #b8f5b0;
    }
    #vibe-1525[data-season="autumn"] {
      --bg1: #fff7ef;
      --bg2: #fff1e6;
      --ink: #20140b;
      --muted: #6c5547;
      --sun: #ffb703;
      --grass: #f9e3b7;
    }
    #vibe-1525[data-season="winter"] {
      --bg1: #eef6ff;
      --bg2: #ffffff;
      --ink: #0b1320;
      --muted: #4c5a6f;
      --sun: #cde5ff;
      --grass: #e4f0ff;
    }

    /* Masthead */
    #vibe-1525 .mast {
      position: relative; z-index: 2;
      display: grid; gap: 10px; justify-items: center; text-align: center;
      margin-bottom: 18px;
    }
    #vibe-1525 .eyebrow {
      font-size: 12px; letter-spacing: .22em; text-transform: uppercase;
      color: var(--muted);
      display: inline-flex; gap: 10px; align-items: center;
      padding: 6px 12px; border-radius: 999px;
      background: linear-gradient(180deg, rgba(0,0,0,0.045), rgba(0,0,0,0.02));
      border: 1px solid var(--ring);
      box-shadow: 0 1px 0 rgba(255,255,255,0.75) inset;
    }
    #vibe-1525 .spark {
      width: 8px; height: 8px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,0.4));
      box-shadow: 0 0 12px rgba(255, 209, 102, 0.6);
    }
    #vibe-1525 h1 {
      margin: 0;
      font-size: clamp(32px, 7.5vw, 68px);
      line-height: 1.02; font-weight: 900; letter-spacing: -0.02em;
      background: linear-gradient(100deg, var(--ink), #0ea5e9, #22c55e, #f97316, #a855f7);
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    #vibe-1525 .lead {
      margin: 0; color: var(--muted); font-size: clamp(14px, 2vw, 16px);
    }

    /* Garden stage */
    #vibe-1525 .stage {
      position: relative; z-index: 1;
      margin: 18px auto 10px;
      width: min(92vw, 1000px);
      aspect-ratio: 16/10;
      border-radius: 26px;
      border: 1px solid var(--ring);
      background:
        radial-gradient(800px 420px at var(--mx) var(--my), rgba(255,255,255,0.7), rgba(255,255,255,0.2) 60%, transparent 100%),
        linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.45));
      box-shadow: 0 16px 36px rgba(15,23,42,0.10), inset 0 1px 0 rgba(255,255,255,0.7);
      overflow: hidden;
      transform-style: preserve-3d;
    }

    /* Sky adornments */
    #vibe-1525 .sky {
      position: absolute; inset: 0; pointer-events: none;
    }
    #vibe-1525 .sun {
      position: absolute;
      width: 120px; height: 120px; border-radius: 50%;
      right: 6%; top: 6%;
      background: radial-gradient(circle at 30% 30%, #fff, var(--sun) 60%, rgba(255,183,3,0.6));
      mix-blend-mode: screen;
      filter: blur(2px) saturate(110%);
      opacity: 0.85;
      transform: translateZ(0);
      animation: floatSun 18s ease-in-out infinite;
    }
    @keyframes floatSun {
      0%,100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }

    /* Ground */
    #vibe-1525 .ground {
      position: absolute; left: -2%; right: -2%; bottom: -1%;
      height: 46%;
      background:
        radial-gradient(120% 60% at 50% 10%, rgba(0,0,0,0.06), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.0), rgba(0,0,0,0.03) 40%),
        linear-gradient(0deg, var(--grass), color-mix(in hsl, var(--grass) 70%, #fff) 60%);
      border-top-left-radius: 60% 22%;
      border-top-right-radius: 60% 22%;
      box-shadow: 0 -10px 30px rgba(0,0,0,0.06) inset;
    }

    /* Flowers */
    #vibe-1525 .flower {
      position: absolute;
      left: var(--x); top: var(--y);
      transform: translate(-50%, 0) scale(var(--s));
      transform-origin: 50% 100%;
      will-change: transform;
      filter: drop-shadow(0 12px 22px rgba(15,23,42,0.16));
      pointer-events: none;
    }
    #vibe-1525 .stem {
      position: absolute; left: 50%; bottom: 0; transform: translateX(-50%);
      width: 8px; height: var(--stemH, 160px);
      background: linear-gradient(180deg, #19c37d, #15803d);
      border-radius: 999px;
      box-shadow: 0 0 0 1px rgba(0,0,0,0.05) inset;
      animation: swayStem calc(7s + var(--j) * .4s) ease-in-out infinite;
      transform-origin: 50% 100%;
    }
    @keyframes swayStem {
      0%,100% { transform: translateX(-50%) rotate(calc(-2deg + var(--breezeX)*-1deg)); }
      50% { transform: translateX(-50%) rotate(calc(2deg + var(--breezeX)*1deg)); }
    }
    #vibe-1525 .head {
      position: absolute; left: 50%; bottom: var(--stemH, 160px);
      transform: translate(-50%, 12px);
      width: var(--w, 120px); height: var(--h, 120px);
    }
    #vibe-1525 .petal {
      position: absolute; left: 50%; top: 50%;
      width: var(--pw, 42px); height: var(--ph, 88px);
      transform-origin: 50% 86%;
      transform:
        translate(-50%, -86%)
        rotate(calc(var(--i) * var(--step)))
        translateY(calc(var(--ph) * -0.08));
      border-radius: 52% 52% 44% 44% / 68% 68% 32% 32%;
      background:
        radial-gradient(circle at 50% 30%, hsl(var(--h), 90%, 96%), hsla(var(--h), 90%, 96%, .0) 60%),
        linear-gradient(180deg, hsl(calc(var(--h) + 10), 85%, 70%), hsl(calc(var(--h) - 8), 72%, 52%));
      box-shadow: 0 4px 10px rgba(0,0,0,0.10);
      animation: flutter calc(6.5s + var(--j) * .35s) ease-in-out infinite;
      mix-blend-mode: screen;
      opacity: .98;
    }
    @keyframes flutter {
      0%,100% { transform: translate(-50%, -86%) rotate(calc(var(--i) * var(--step))) translateY(calc(var(--ph) * -0.08)) rotate(calc(var(--breezeX) * .8deg)); }
      50% { transform: translate(-50%, -86%) rotate(calc(var(--i) * var(--step) + 4deg)) translateY(calc(var(--ph) * -0.12)) rotate(calc(var(--breezeX) * 1.6deg)); }
    }
    #vibe-1525 .core {
      position: absolute; left: 50%; top: 50%;
      width: 38px; height: 38px; transform: translate(-50%, -50%);
      border-radius: 50%;
      background: radial-gradient(circle at 35% 35%, #fff, #fed766 55%, #e0a800 100%);
      box-shadow: 0 0 0 2px rgba(255,255,255,0.7) inset, 0 6px 14px rgba(0,0,0,0.18);
      animation: wobble 8s ease-in-out infinite;
    }
    @keyframes wobble {
      0%,100% { transform: translate(-50%, -50%) rotate(0deg) }
      50% { transform: translate(-50%, -52%) rotate(.8deg) }
    }
    #vibe-1525 .leaf {
      position: absolute; bottom: 24%; left: 50%;
      width: 42px; height: 22px;
      background: linear-gradient(90deg, #34d399, #059669);
      border-radius: 999px 0 999px 0;
      transform-origin: 0% 50%;
      filter: brightness(1.05);
      opacity: .9;
      box-shadow: 0 3px 8px rgba(0,0,0,.1);
      animation: leaf 7s ease-in-out infinite;
    }
    #vibe-1525 .leaf.r { transform: translateX(2px) rotate(26deg); }
    #vibe-1525 .leaf.l { transform: translateX(-42px) rotate(-166deg); }
    @keyframes leaf {
      0%,100% { transform: translateX(-42px) rotate(calc(-166deg + var(--breezeX) * -2deg)); }
      50% { transform: translateX(-44px) rotate(calc(-174deg + var(--breezeX) * 2deg)); }
    }
    #vibe-1525 .leaf.r { animation-name: leafR; }
    @keyframes leafR {
      0%,100% { transform: translateX(2px) rotate(calc(26deg + var(--breezeX) * 2deg)); }
      50% { transform: translateX(4px) rotate(calc(32deg + var(--breezeX) * -2deg)); }
    }

    /* Pollen canvas sits above plants, below UI */
    #vibe-1525 canvas.pollen {
      position: absolute; inset: 0;
      z-index: 1;
      mix-blend-mode: screen;
      pointer-events: none;
      filter: blur(.25px) saturate(110%);
      opacity: .85;
    }

    /* Controls */
    #vibe-1525 .controls {
      position: relative; z-index: 3;
      display: flex; flex-wrap: wrap; gap: 10px 12px;
      justify-content: center; align-items: center;
      margin: 16px 0 6px;
    }
    #vibe-1525 .chip {
      -webkit-tap-highlight-color: transparent;
      appearance: none; border: 1px solid rgba(15,23,42,0.14);
      background: linear-gradient(180deg, rgba(0,0,0,0.04), rgba(0,0,0,0.02));
      color: var(--ink);
      padding: 10px 14px; border-radius: 999px;
      font-size: 13px; font-weight: 700; letter-spacing: .02em;
      cursor: pointer;
      transition: transform .15s ease, border-color .2s ease, background .3s ease, color .3s ease;
      box-shadow: 0 1px 0 rgba(255,255,255,0.7) inset, 0 8px 16px rgba(15,23,42,0.08);
    }
    #vibe-1525 .chip:hover { transform: translateY(-2px); border-color: rgba(15,23,42,0.26); }
    #vibe-1525 .chip[aria-pressed="true"] {
      background: linear-gradient(90deg, #22c55e, #0ea5e9, #f59e0b, #a855f7);
      color: #071824; border-color: transparent;
      box-shadow: 0 14px 28px rgba(34,197,94,.22), 0 1px 0 rgba(255,255,255,0.7) inset;
    }
    #vibe-1525 .knob {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 12px; border-radius: 999px;
      border: 1px solid var(--ring);
      background: linear-gradient(180deg, rgba(0,0,0,0.04), rgba(0,0,0,0.02));
      box-shadow: 0 1px 0 rgba(255,255,255,0.6) inset;
      color: var(--muted);
      font-size: 12px;
    }
    #vibe-1525 input[type="range"] { width: 140px; height: 24px; background: transparent; cursor: pointer; }
    #vibe-1525 input[type="range"]::-webkit-slider-runnable-track {
      height: 6px; border-radius: 6px;
      background: linear-gradient(90deg, #22c55e, #0ea5e9, #f59e0b, #a855f7);
      box-shadow: 0 0 0 1px rgba(0,0,0,0.06) inset;
    }
    #vibe-1525 input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 16px; height: 16px; border-radius: 50%;
      background: #fff; border: 1px solid rgba(0,0,0,0.12); margin-top: -5px;
      box-shadow: 0 4px 10px rgba(15,23,42,0.18);
    }
    #vibe-1525 input[type="range"]::-moz-range-track { height: 6px; border-radius: 6px; background: linear-gradient(90deg, #22c55e, #0ea5e9, #f59e0b, #a855f7); }
    #vibe-1525 input[type="range"]::-moz-range-thumb { width: 16px; height: 16px; border-radius: 50%; background: #fff; border: 1px solid rgba(0,0,0,0.12); box-shadow: 0 4px 10px rgba(15,23,42,0.18); }

    /* Meta */
    #vibe-1525 .meta {
      display: flex; align-items: center; justify-content: space-between;
      gap: 12px; color: var(--muted); font-size: 12px; margin-top: 8px;
    }
    #vibe-1525 .legend {
      display: inline-flex; gap: 8px; align-items: center; opacity: 0.9;
    }
    #vibe-1525 .legend .glyph {
      width: 10px; height: 10px; border-radius: 50%;
      background: radial-gradient(circle at 35% 35%, #fff, #22c55e);
      box-shadow: 0 0 12px rgba(34,197,94,.22);
    }

    /* Pause state */
    #vibe-1525[data-paused="true"] .petal,
    #vibe-1525[data-paused="true"] .stem,
    #vibe-1525[data-paused="true"] .core,
    #vibe-1525[data-paused="true"] .sun { animation-play-state: paused; }
    #vibe-1525[data-paused="true"] .stage { box-shadow: 0 10px 24px rgba(15,23,42,0.08); }

    @media (prefers-reduced-motion: reduce) {
      #vibe-1525 .petal,
      #vibe-1525 .stem,
      #vibe-1525 .core,
      #vibe-1525 .sun { animation: none !important; }
    }
  </style>

  <div class="mast">
    <span class="eyebrow"><span class="spark" aria-hidden="true"></span> Edition 1525</span>
    <h1>ChronoBloom Garden</h1>
    <p class="lead">A paper-soft garden that sways with your breeze.</p>
  </div>

  <div class="stage" id="garden-stage" aria-live="polite">
    <div class="sky" aria-hidden="true">
      <div class="sun"></div>
    </div>
    <div class="ground" aria-hidden="true"></div>
    <canvas class="pollen" id="pollen"></canvas>
    <!-- Flowers are generated by script -->
  </div>

  <div class="controls" role="group" aria-label="Season, bloom and motion controls">
    <button class="chip season" data-season="spring" aria-pressed="true" type="button">Spring</button>
    <button class="chip season" data-season="summer" aria-pressed="false" type="button">Summer</button>
    <button class="chip season" data-season="autumn" aria-pressed="false" type="button">Autumn</button>
    <button class="chip season" data-season="winter" aria-pressed="false" type="button">Winter</button>

    <span class="knob">
      Bloom
      <input id="bloom" type="range" min="6" max="42" value="18" aria-label="Bloom density">
    </span>

    <button class="chip" id="shuffle" type="button">Shuffle</button>
    <button class="chip" id="pause" type="button" aria-pressed="false">Pause breeze</button>
  </div>

  <div class="meta">
    <span id="last-updated">Last updated: 2025-12-25 16:17:21 EST</span>
    <span class="legend"><span class="glyph" aria-hidden="true"></span> tip: move pointer to blow wind</span>
  </div>

  <script>
    (function () {
      const root = document.getElementById('vibe-1525');
      const stage = root.querySelector('#garden-stage');
      const updated = root.querySelector('#last-updated');
      const bloom = root.querySelector('#bloom');
      const shuffle = root.querySelector('#shuffle');
      const pauseBtn = root.querySelector('#pause');
      const seasonBtns = root.querySelectorAll('.season');
      const canvas = root.querySelector('#pollen');
      const ctx = canvas.getContext('2d', { alpha: true });

      // Timestamp
      const now = new Date();
      try {
        updated.textContent = 'Last updated: ' + now.toLocaleString(undefined, {
          year: 'numeric', month: 'short', day: '2-digit',
          hour: '2-digit', minute: '2-digit', second: '2-digit'
        });
      } catch (e) {
        updated.textContent = 'Last updated: ' + now.toString();
      }

      // Seasons -> petal hue ranges
      const seasonHues = {
        spring: [322, 356, 24],   // pinks to peach
        summer: [45, 135, 200],   // warm yellow to teal/blue
        autumn: [18, 32, 12],     // ambers
        winter: [195, 210, 240]   // icy blues
      };

      // State
      let flowers = [];
      let pollen = [];
      let paused = false;
      let autoTick = 0;
      let breeze = { x: 0, y: 0 };
      let pointer = null;

      // Init
      setSeasonByTime();
      resizeCanvas();
      generate(Number(bloom.value));
      makePollen(160);

      // Event wiring
      seasonBtns.forEach(btn => {
        btn.addEventListener('click', () => setSeason(btn.getAttribute('data-season')));
      });
      bloom.addEventListener('input', () => generate(Number(bloom.value)));
      shuffle.addEventListener('click', () => generate(Number(bloom.value), true));
      pauseBtn.addEventListener('click', togglePause);

      window.addEventListener('resize', () => {
        resizeCanvas();
        // re-place flowers proportionally
        flowers.forEach(f => positionFlower(f.el, f.x, f.y));
      });

      // Pointer breeze
      const updateMouse = (clientX, clientY) => {
        const r = stage.getBoundingClientRect();
        const x = (clientX - r.left) / r.width;
        const y = (clientY - r.top) / r.height;
        root.style.setProperty('--mx', (x * 100) + '%');
        root.style.setProperty('--my', (y * 100) + '%');
        const bx = (x - 0.5) * 6;      // -3..3
        const by = (0.5 - y) * 6;      // -3..3
        breeze.x = bx;
        breeze.y = by;
        root.style.setProperty('--breezeX', bx.toFixed(3));
        root.style.setProperty('--breezeY', by.toFixed(3));
      };

      stage.addEventListener('mousemove', (e) => {
        pointer = { x: e.clientX, y: e.clientY };
        updateMouse(e.clientX, e.clientY);
      });
      stage.addEventListener('mouseleave', () => {
        pointer = null;
        breeze.x = 0; breeze.y = 0;
        root.style.setProperty('--breezeX', '0');
        root.style.setProperty('--breezeY', '0');
        root.style.setProperty('--mx', '50%');
        root.style.setProperty('--my', '50%');
      });
      stage.addEventListener('touchmove', (e) => {
        const t = e.touches[0];
        if (!t) return;
        pointer = { x: t.clientX, y: t.clientY };
        updateMouse(t.clientX, t.clientY);
      }, { passive: true });
      stage.addEventListener('touchend', () => {
        pointer = null;
        breeze.x = 0; breeze.y = 0;
        root.style.setProperty('--breezeX', '0');
        root.style.setProperty('--breezeY', '0');
      });

      // Animation loop (pollen + auto breeze)
      let rafId = null;
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      function loop() {
        if (!paused && !prefersReduced) {
          autoTick += 0.005;
          if (!pointer) {
            const ax = Math.sin(autoTick * 1.7) * 1.5;
            const ay = Math.cos(autoTick * 1.1) * 1.2;
            breeze.x = ax;
            breeze.y = ay;
            root.style.setProperty('--breezeX', ax.toFixed(3));
            root.style.setProperty('--breezeY', ay.toFixed(3));
          }
          drawPollen();
        }
        rafId = requestAnimationFrame(loop);
      }
      rafId = requestAnimationFrame(loop);

      // Functions
      function setSeasonByTime() {
        const h = now.getHours();
        const guess =
          h >= 4 && h < 11 ? 'spring' :
          h >= 11 && h < 17 ? 'summer' :
          h >= 17 && h < 21 ? 'autumn' : 'winter';
        setSeason(guess);
      }

      function setSeason(season) {
        root.setAttribute('data-season', season);
        seasonBtns.forEach(b => b.setAttribute('aria-pressed', String(b.getAttribute('data-season') === season)));
        // redraw petals with new hues
        flowers.forEach(f => recolor(f.el, season));
      }

      function togglePause() {
        paused = !paused;
        root.setAttribute('data-paused', String(paused));
        pauseBtn.setAttribute('aria-pressed', String(paused));
        pauseBtn.textContent = paused ? 'Resume breeze' : 'Pause breeze';
      }

      function resizeCanvas() {
        const r = stage.getBoundingClientRect();
        canvas.width = Math.max(1, Math.floor(r.width));
        canvas.height = Math.max(1, Math.floor(r.height));
      }

      function generate(count, reshuffle=false) {
        // clear old flowers
        flowers.forEach(f => f.el.remove());
        flowers = [];
        const rect = stage.getBoundingClientRect();
        const w = rect.width, h = rect.height;
        for (let i = 0; i < count; i++) {
          const x = 8 + Math.random() * 84;
          const y = 60 + Math.random() * 36; // plant in lower half
          const s = 0.7 + Math.random() * 0.8;
          const pCount = 6 + Math.floor(Math.random() * 7); // 6..12
          const el = makeFlower(pCount, s, i);
          positionFlower(el, x, y);
          stage.appendChild(el);
          flowers.push({ el, x, y, s, pCount, j: i });
        }
        if (reshuffle) jitter();
      }

      function jitter() {
        flowers.forEach(f => {
          const dx = (Math.random() * 2 - 1) * 2.5;
          const dy = (Math.random() * 2 - 1) * 2.5;
          f.x = Math.max(6, Math.min(94, f.x + dx));
          f.y = Math.max(50, Math.min(96, f.y + dy));
          positionFlower(f.el, f.x, f.y);
        });
      }

      function positionFlower(el, x, y) {
        el.style.setProperty('--x', x + '%');
        el.style.setProperty('--y', y + '%');
      }

      function makeFlower(petalCount, scale, index) {
        const el = document.createElement('div');
        el.className = 'flower';
        el.style.setProperty('--s', scale.toFixed(3));
        el.style.setProperty('--j', index);
        const stemH = 120 + Math.random() * 120;
        el.style.setProperty('--stemH', stemH.toFixed(1) + 'px');
        // head size roughly tied to scale
        const w = 80 + Math.random() * 60;
        const h = w;
        const pw = 22 + Math.random() * 28;
        const ph = 60 + Math.random() * 36;

        const head = document.createElement('div');
        head.className = 'head';
        head.style.setProperty('--w', w.toFixed(1) + 'px');
        head.style.setProperty('--h', h.toFixed(1) + 'px');

        const step = (360 / petalCount) + 'deg';

        for (let i = 0; i < petalCount; i++) {
          const p = document.createElement('div');
          p.className = 'petal';
          p.style.setProperty('--i', i);
          p.style.setProperty('--step', step);
          p.style.setProperty('--pw', pw.toFixed(1) + 'px');
          p.style.setProperty('--ph', ph.toFixed(1) + 'px');
          head.appendChild(p);
        }

        const core = document.createElement('div');
        core.className = 'core';
        head.appendChild(core);

        const stem = document.createElement('div'); stem.className = 'stem';
        const leafL = document.createElement('div'); leafL.className = 'leaf l';
        const leafR = document.createElement('div'); leafR.className = 'leaf r';

        el.appendChild(stem);
        el.appendChild(head);
        el.appendChild(leafL);
        el.appendChild(leafR);

        recolor(el, root.getAttribute('data-season') || 'spring');

        return el;
      }

      function recolor(el, season) {
        // Choose a pleasing hue for this flower
        const base = seasonHues[season] || seasonHues.spring;
        const pick = Array.isArray(base) ? base[Math.floor(Math.random() * base.length)] : base;
        const jitter = (Math.random() * 16) - 8;
        const h = Math.max(0, (pick + jitter) % 360);
        el.querySelectorAll('.petal').forEach(p => p.style.setProperty('--h', h.toFixed(1)));
      }

      // Pollen
      function makePollen(n) {
        pollen = [];
        const w = canvas.width, h = canvas.height;
        for (let i = 0; i < n; i++) {
          pollen.push({
            x: Math.random() * w,
            y: h * (.55 + Math.random() * .45),
            r: 0.6 + Math.random() * 1.8,
            a: .08 + Math.random() * .12,
            vx: (-.2 + Math.random() * .4),
            vy: (-.3 + Math.random() * .6)
          });
        }
      }

      function drawPollen() {
        const w = canvas.width, h = canvas.height;
        ctx.clearRect(0, 0, w, h);
        for (let i = 0; i < pollen.length; i++) {
          const p = pollen[i];
          // move
          p.vx += breeze.x * 0.02;
          p.vy += breeze.y * 0.015;
          p.vx *= 0.98;
          p.vy *= 0.985;
          p.x += p.vx + Math.sin((p.y + i) * 0.003) * 0.2;
          p.y += p.vy + Math.cos((p.x + i) * 0.003) * 0.15;
          // wrap within lower half
          if (p.x < -5) p.x = w + 5;
          if (p.x > w + 5) p.x = -5;
          if (p.y < h * 0.45) p.y = h * 0.97;
          if (p.y > h + 5) p.y = h * 0.55;

          // draw
          const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r * 6);
          grad.addColorStop(0, `rgba(255,255,255,${p.a + 0.1})`);
          grad.addColorStop(1, `rgba(34,197,94,0)`);
          ctx.fillStyle = grad;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r * 3, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      // Utilities
      // Rebuild pollen when density changes a lot (on regenerate)
      function regenPollen() {
        resizeCanvas();
        makePollen(160);
      }

      // Initial pollen draw
      drawPollen();

      // Accessibility: start paused if prefers-reduced-motion
      if (prefersReduced) {
        paused = true;
        root.setAttribute('data-paused', 'true');
        pauseBtn.setAttribute('aria-pressed', 'true');
        pauseBtn.textContent = 'Resume breeze';
      }

      // Clean up RAF if removed
      const observer = new MutationObserver(() => {
        if (!document.body.contains(root) && rafId) cancelAnimationFrame(rafId);
      });
      observer.observe(document.body, { childList: true, subtree: true });

      // Regenerate on shuffle and also refresh pollen
      shuffle.addEventListener('click', regenPollen);
    })();
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


