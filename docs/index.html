<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="cosma-522" aria-label="Nocturne Lab">
  <style>
    .cosma-522 {
      --h: 268;                /* accent hue */
      --ink: hsl(222 38% 90%); /* primary text on dark */
      --muted: hsl(222 16% 72%);
      --deep: hsl(222 30% 7%);
      --panel: hsl(222 32% 10% / .85);
      --edge: hsla(0 0% 100% / .06);
      color: var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      position: relative;
      border-radius: 28px;
      overflow: hidden;
      background:
        radial-gradient(1200px 900px at 120% -10%, hsla(calc(var(--h) - 40) 95% 60% / .18), transparent 50%),
        radial-gradient(1000px 800px at -20% 120%, hsla(calc(var(--h) + 60) 95% 60% / .16), transparent 52%),
        radial-gradient(2200px 1400px at 50% 0%, hsla(var(--h) 90% 50% / .08), transparent 55%),
        linear-gradient(180deg, hsl(222 34% 7%), hsl(222 36% 5%));
      box-shadow:
        inset 0 1px 0 hsla(0 0% 100% / .06),
        0 30px 90px rgba(0,0,0,.45),
        0 8px 24px rgba(0,0,0,.25);
      isolation: isolate;
    }
    .cosma-522::before {
      content: "";
      position: absolute;
      inset: -1px;
      pointer-events: none;
      border-radius: 28px;
      background:
        conic-gradient(from 0deg,
          hsla(var(--h) 100% 60% / .22),
          hsla(calc(var(--h) + 80) 100% 60% / .12),
          hsla(calc(var(--h) + 160) 100% 60% / .16),
          hsla(var(--h) 100% 60% / .22));
      -webkit-mask: radial-gradient(closest-side, transparent 96%, black 98%);
              mask: radial-gradient(closest-side, transparent 96%, black 98%);
      filter: blur(12px) saturate(120%);
      mix-blend-mode: screen;
      opacity: .6;
      z-index: 0;
    }

    .frame {
      position: relative;
      z-index: 1;
      padding: clamp(22px, 3.8vw, 44px);
      transform: perspective(1200px) rotateX(var(--rx, 0deg)) rotateY(var(--ry, 0deg));
      transition: transform 420ms cubic-bezier(.2,.8,.2,1);
    }

    .bar {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 12px;
      margin-bottom: 2px;
      color: var(--muted);
    }
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      font-size: 11px;
      letter-spacing: .16em;
      text-transform: uppercase;
      background: linear-gradient(180deg, hsl(222 14% 18% / .9), hsl(222 14% 14% / .88));
      border: 1px solid var(--edge);
      box-shadow:
        inset 0 1px 0 hsla(0 0% 100% / .06),
        0 6px 16px rgba(0,0,0,.28);
      user-select: none;
      white-space: nowrap;
    }
    .brand {
      justify-self: center;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-weight: 800;
      letter-spacing: .02em;
    }
    .brand svg {
      width: 22px; height: 22px;
      filter: drop-shadow(0 10px 24px hsla(var(--h) 100% 65% / .38));
    }

    .title {
      margin: clamp(10px, 2.2vw, 18px) 0 0;
      text-align: center;
      font-weight: 900;
      letter-spacing: -0.02em;
      line-height: .9;
      font-size: clamp(42px, 7.4vw, 110px);
      color: transparent;
      background:
        radial-gradient(120% 160% at 50% 0%,
          hsl(calc(var(--h) - 20) 100% 70%),
          hsl(var(--h) 100% 65%) 35%,
          hsl(calc(var(--h) + 60) 90% 55%) 60%,
          hsl(calc(var(--h) + 120) 90% 60%) 90%);
      -webkit-background-clip: text;
              background-clip: text;
      filter: drop-shadow(0 18px 40px hsla(var(--h) 100% 60% / .20));
    }
    .lede {
      margin: 10px auto 18px;
      max-width: 70ch;
      text-align: center;
      font-size: clamp(15px, 2.1vw, 19px);
      line-height: 1.75;
      color: var(--muted);
    }

    .stage {
      position: relative;
      margin-top: clamp(18px, 3.6vw, 36px);
      border-radius: 22px;
      overflow: hidden;
      border: 1px solid var(--edge);
      background:
        radial-gradient(600px 380px at 10% 10%, hsla(var(--h) 100% 60% / .15), transparent 60%),
        radial-gradient(800px 600px at 90% 80%, hsla(calc(var(--h) + 80) 100% 60% / .12), transparent 60%),
        linear-gradient(180deg, hsl(222 32% 10%), hsl(222 34% 9%));
      box-shadow:
        inset 0 1px 0 hsla(0 0% 100% / .05),
        inset 0 -40px 120px hsla(0 0% 0% / .35),
        0 24px 80px rgba(0,0,0,.35);
      height: clamp(280px, 48vh, 580px);
    }
    .sky {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
    }
    .stage::after {
      content: "";
      position: absolute;
      inset: 0;
      background:
        repeating-linear-gradient(0deg, hsla(0 0% 100% / .02) 0 1px, transparent 1px 3px),
        radial-gradient(40% 60% at 60% -10%, hsla(var(--h) 100% 66% / .08), transparent 55%);
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .controls {
      display: grid;
      grid-template-columns: minmax(200px, 300px) 1fr auto;
      gap: clamp(14px, 3.2vw, 28px);
      align-items: center;
      margin-top: clamp(16px, 3.6vw, 28px);
    }
    @media (max-width: 920px) { .controls { grid-template-columns: 1fr; } }

    .dial {
      --pct: .5;
      position: relative;
      width: clamp(200px, 28vw, 280px);
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      border: 1px solid var(--edge);
      background:
        radial-gradient(circle at 50% 50%, hsl(222 24% 16%), hsl(222 26% 12%));
      box-shadow:
        inset 0 1px 0 hsla(0 0% 100% / .05),
        inset 0 0 160px hsla(var(--h) 100% 60% / .06),
        0 18px 42px rgba(0,0,0,.35);
      display: grid;
      place-items: center;
      cursor: pointer;
      overflow: hidden;
      touch-action: none;
    }
    .dial .ring {
      position: absolute; inset: 12%;
      border-radius: 50%;
      background: conic-gradient(
        from -90deg,
        hsl(0 100% 60%),
        hsl(60 100% 60%),
        hsl(120 95% 55%),
        hsl(180 95% 55%),
        hsl(240 100% 60%),
        hsl(300 100% 60%),
        hsl(360 100% 60%)
      );
      -webkit-mask: radial-gradient(closest-side, transparent 63%, #000 64% 100%);
              mask: radial-gradient(closest-side, transparent 63%, #000 64% 100%);
      filter: blur(1px) saturate(140%);
      opacity: .85;
    }
    .dial .marker {
      position: absolute;
      width: 54%;
      height: 54%;
      transform: rotate(calc(var(--angle, 0deg)));
      transform-origin: center;
    }
    .dial .marker::before {
      content: "";
      position: absolute; left: 50%; top: 2%;
      transform: translate(-50%, -50%);
      width: 12px; height: 12px; border-radius: 50%;
      background: radial-gradient(circle at 40% 40%, #fff, hsl(var(--h) 100% 64%));
      border: 1px solid hsl(var(--h) 90% 60%);
      box-shadow:
        0 0 0 6px hsla(var(--h) 100% 60% / .10),
        0 14px 28px hsla(var(--h) 90% 60% / .32),
        inset 0 1px 0 hsla(0 0% 100% / .9);
    }
    .dial .dial-label {
      position: absolute; bottom: 10%; left: 50%; transform: translateX(-50%);
      color: var(--muted);
      font-size: 11px;
      letter-spacing: .16em;
      text-transform: uppercase;
      background: linear-gradient(180deg, hsl(222 14% 18% / .9), hsl(222 14% 14% / .88));
      border: 1px solid var(--edge);
      padding: 6px 10px;
      border-radius: 999px;
    }

    .sliders { display: grid; gap: 14px; align-content: start; }
    .group { display: grid; gap: 8px; }
    .group label {
      color: var(--muted);
      font-size: 12px;
      letter-spacing: .16em;
      text-transform: uppercase;
    }
    .slider {
      --pct: .5;
      position: relative;
      height: 36px;
      border-radius: 12px;
      background: linear-gradient(180deg, hsl(222 18% 16% / .9), hsl(222 18% 14% / .85));
      border: 1px solid var(--edge);
      display: grid;
      align-items: center;
      padding: 0 10px;
      box-shadow: inset 0 1px 0 hsla(0 0% 100% / .06);
    }
    .slider::before {
      content: "";
      position: absolute;
      left: 10px; right: 10px; top: 50%;
      transform: translateY(-50%);
      height: 6px;
      border-radius: 6px;
      background: linear-gradient(90deg, hsla(var(--h) 100% 60% / .35), hsla(calc(var(--h) + 80) 100% 60% / .35));
      box-shadow: inset 0 0 0 1px hsla(0 0% 100% / .08);
    }
    .slider .thumb {
      position: absolute;
      left: calc(10px + (var(--pct) * (100% - 20px)));
      top: 50%;
      transform: translate(-50%, -50%);
      width: 18px; height: 18px; border-radius: 50%;
      background: radial-gradient(circle at 40% 40%, #fff, hsl(var(--h) 100% 62%));
      border: 1px solid hsl(var(--h) 90% 60%);
      box-shadow:
        0 0 0 6px hsla(var(--h) 100% 60% / .10),
        0 10px 22px hsla(var(--h) 90% 60% / .24),
        inset 0 1px 0 hsla(0 0% 100% / .9);
      pointer-events: none;
    }
    .slider input[type="range"] {
      appearance: none;
      width: 100%; height: 100%;
      background: transparent; outline: none; margin: 0; padding: 0;
      cursor: pointer;
    }
    .slider input[type="range"]::-webkit-slider-thumb { appearance: none; width: 0; height: 0; }
    .slider input[type="range"]::-moz-range-thumb { width: 0; height: 0; border: 0; }

    .actions {
      display: grid;
      grid-template-columns: repeat(2, minmax(120px, auto));
      gap: 10px;
      justify-content: end;
      align-content: start;
    }
    @media (max-width: 920px) { .actions { grid-template-columns: 1fr 1fr; } }
    .btn {
      appearance: none;
      border: 1px solid var(--edge);
      color: var(--ink);
      background: linear-gradient(180deg, hsl(222 18% 16% / .9), hsl(222 18% 14% / .85));
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 800;
      letter-spacing: .02em;
      cursor: pointer;
      box-shadow:
        0 10px 26px rgba(0,0,0,.35),
        inset 0 1px 0 hsla(0 0% 100% / .06);
      transition: transform 160ms ease, box-shadow 240ms ease, border-color 240ms ease, background 240ms ease, filter 240ms ease;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
      will-change: transform;
    }
    .btn::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(160px 100px at var(--sx, 10%) -20%, hsla(0 0% 100% / .18), transparent 60%);
      mix-blend-mode: screen;
      opacity: .7;
      pointer-events: none;
      transition: opacity 200ms ease;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 18px 36px rgba(0,0,0,.44); }
    .btn:hover::after { opacity: 1; }
    .btn.primary {
      border-color: hsla(var(--h) 100% 60% / .35);
      background: linear-gradient(180deg, hsla(var(--h) 100% 65% / .12), hsl(222 18% 14% / .9));
      filter: saturate(120%);
    }

    .tiles {
      list-style: none;
      margin: clamp(18px, 3.2vw, 26px) 0 0;
      padding: 0;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: clamp(12px, 2.4vw, 18px);
    }
    @media (max-width: 900px) { .tiles { grid-template-columns: 1fr; } }
    .tile {
      position: relative;
      border-radius: 16px;
      padding: clamp(14px, 2vw, 18px);
      background: linear-gradient(180deg, hsl(222 18% 16% / .9), hsl(222 18% 14% / .85));
      border: 1px solid var(--edge);
      box-shadow:
        0 12px 30px rgba(0,0,0,.30),
        inset 0 1px 0 hsla(0 0% 100% / .05);
      transition: transform 240ms cubic-bezier(.2,.7,.2,1), box-shadow 240ms ease, border-color 240ms ease;
    }
    .tile::before {
      content: "";
      position: absolute; inset: 0; border-radius: inherit;
      background: linear-gradient(90deg, hsla(var(--h) 100% 60% / .14), transparent 30%, transparent 70%, hsla(calc(var(--h) + 80) 100% 60% / .12));
      opacity: .65;
      pointer-events: none;
    }
    .tile:hover {
      transform: translateY(-6px);
      border-color: hsla(var(--h) 100% 60% / .35);
      box-shadow: 0 22px 44px rgba(0,0,0,.38);
    }
    .tile h3 {
      margin: 8px 0 6px;
      font-size: clamp(16px, 2.2vw, 20px);
      letter-spacing: -0.01em;
      color: var(--ink);
    }
    .tile p {
      margin: 0;
      color: var(--muted);
      line-height: 1.7;
      font-size: 14.5px;
    }
    .ico {
      width: 28px; height: 28px;
      filter: drop-shadow(0 10px 22px hsla(var(--h) 100% 65% / .26));
    }

    .meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      margin-top: 18px;
      color: var(--muted);
      font-size: 12.5px;
      flex-wrap: wrap;
    }
    #last-updated {
      color: var(--ink);
      background: linear-gradient(180deg, hsl(222 18% 16% / .9), hsl(222 18% 14% / .85));
      border: 1px solid var(--edge);
      padding: 6px 10px;
      border-radius: 10px;
      box-shadow: inset 0 1px 0 hsla(0 0% 100% / .06);
      white-space: nowrap;
    }

    @media (prefers-reduced-motion: reduce) {
      .frame { transition: none !important; }
      .stage::after { display: none !important; }
      .btn::after { display: none !important; }
    }
  </style>

  <div class="frame" role="region" aria-label="Nocturne Console">
    <div class="bar">
      <span class="chip">Iteration 522</span>
      <span class="brand" aria-hidden="true">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <defs>
            <linearGradient id="g522" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="hsl(var(--h) 95% 60%)"/>
              <stop offset="1" stop-color="hsl(calc(var(--h) + 80) 85% 56%)"/>
            </linearGradient>
          </defs>
          <circle cx="12" cy="12" r="7.2" fill="none" stroke="url(#g522)" stroke-width="2"/>
          <circle cx="12" cy="12" r="3.6" fill="url(#g522)"/>
        </svg>
        Nocturne Lab
      </span>
      <span class="chip">Orbit mode</span>
    </div>

    <h1 class="title">Lumen Orbit</h1>
    <p class="lede">A kinetic poster. Orbits, light, and gentle gravity. Touch to bend space; the sky answers softly.</p>

    <div class="stage" id="stage" aria-label="Interactive orbitarium">
      <canvas class="sky" aria-hidden="true"></canvas>
    </div>

    <div class="controls">
      <div class="dial" id="dial" tabindex="0" role="slider" aria-label="Accent hue" aria-valuemin="0" aria-valuemax="360" aria-valuenow="268" aria-valuetext="Hue 268 degrees">
        <div class="ring" aria-hidden="true"></div>
        <div class="marker" aria-hidden="true"></div>
        <div class="dial-label" aria-hidden="true">Turn to color</div>
      </div>

      <div class="sliders">
        <div class="group">
          <label for="gravity">Gravity</label>
          <div class="slider" style="--pct: .6;">
            <span class="thumb" aria-hidden="true"></span>
            <input id="gravity" type="range" min="0" max="100" value="60" aria-label="Gravity">
          </div>
        </div>
        <div class="group">
          <label for="trail">Trail</label>
          <div class="slider" style="--pct: .7;">
            <span class="thumb" aria-hidden="true"></span>
            <input id="trail" type="range" min="0" max="100" value="70" aria-label="Trail persistence">
          </div>
        </div>
        <div class="group">
          <label for="sparks">Sparks</label>
          <div class="slider" style="--pct: .5;">
            <span class="thumb" aria-hidden="true"></span>
            <input id="sparks" type="range" min="30" max="400" value="200" aria-label="Sparks count">
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" type="button" id="pulse">Pulse</button>
        <button class="btn" type="button" id="palette">Palette</button>
      </div>
    </div>

    <ul class="tiles" aria-label="Principles">
      <li class="tile">
        <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="12" cy="12" r="5" fill="hsl(var(--h) 80% 58%)"/>
          <path d="M2 12h6M16 12h6" stroke="hsl(calc(var(--h) + 80) 80% 60%)" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <h3>1 — Quiet Drama</h3>
        <p>Darkness as canvas; color as whisper. Energy without noise.</p>
      </li>
      <li class="tile">
        <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 3a9 9 0 1 0 0 18a9 9 0 1 0 0-18Z" fill="none" stroke="hsl(var(--h) 85% 60%)" stroke-width="2"/>
          <circle cx="12" cy="7" r="2" fill="hsl(calc(var(--h) + 60) 90% 60%)"/>
        </svg>
        <h3>2 — Living Physics</h3>
        <p>Motion follows rules you can feel. Your touch bends the field.</p>
      </li>
      <li class="tile">
        <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 12h14M12 5v14" stroke="hsl(var(--h) 85% 60%)" stroke-linecap="round" stroke-width="2"/>
          <circle cx="12" cy="12" r="3" fill="hsl(calc(var(--h) + 100) 85% 55%)"/>
        </svg>
        <h3>3 — Kind Contrast</h3>
        <p>Readable by default. Glow accents carry mood; type carries meaning.</p>
      </li>
    </ul>

    <div class="meta">
      <span class="note">Hue <strong><span id="hue-out">268</span>°</strong> • Gravity <strong><span id="g-out">60</span>%</strong> • Trail <strong><span id="t-out">70</span>%</strong> • Sparks <strong><span id="s-out">200</span></strong></span>
      <span id="last-updated">Last updated: 2025-11-09 07:32:49 EST</span>
    </div>
  </div>

  <script>
    (function () {
      const root = document.currentScript.closest('.cosma-522');
      if (!root) return;

      // timestamp
      const last = root.querySelector('#last-updated');
      try {
        const now = new Date();
        const opts = { dateStyle: 'medium', timeStyle: 'short' };
        last.textContent = 'Updated: ' + now.toLocaleString(undefined, opts);
      } catch { last.textContent = 'Updated: just now'; }

      // tilt + magnetic buttons
      const frame = root.querySelector('.frame');
      frame.addEventListener('pointermove', (e) => {
        const r = frame.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width - 0.5;
        const y = (e.clientY - r.top) / r.height - 0.5;
        frame.style.setProperty('--rx', (-y * 5).toFixed(2) + 'deg');
        frame.style.setProperty('--ry', (x * 7).toFixed(2) + 'deg');
        root.querySelectorAll('.btn').forEach(btn => {
          const bx = (x * 8).toFixed(2);
          const by = (y * 8).toFixed(2);
          btn.style.transform = `translate(${bx}px, ${by}px)`;
          btn.style.setProperty('--sx', (x * 50 + 50) + '%');
        });
      });
      frame.addEventListener('pointerleave', () => {
        frame.style.setProperty('--rx', '0deg');
        frame.style.setProperty('--ry', '0deg');
        root.querySelectorAll('.btn').forEach(btn => btn.style.transform = '');
      });

      // hue dial
      const dial = root.querySelector('#dial');
      const hueOut = root.querySelector('#hue-out');
      const setHue = (h) => {
        const hue = Math.round(Math.max(0, Math.min(360, h)));
        root.style.setProperty('--h', hue);
        dial.style.setProperty('--angle', hue + 'deg');
        dial.setAttribute('aria-valuenow', String(hue));
        dial.setAttribute('aria-valuetext', 'Hue ' + hue + ' degrees');
        hueOut.textContent = hue;
      };
      const getAngle = (clientX, clientY) => {
        const rect = dial.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top + rect.height / 2;
        const rad = Math.atan2(clientY - cy, clientX - cx);
        let deg = (rad * 180 / Math.PI) + 90; // start at top
        if (deg < 0) deg += 360;
        return deg % 360;
      };
      const initH = parseInt(getComputedStyle(root).getPropertyValue('--h')) || 268;
      setHue(initH);

      let dragging = false;
      const onMove = (e) => { if (!dragging) return; setHue(getAngle(e.clientX, e.clientY)); };
      dial.addEventListener('pointerdown', (e) => {
        dragging = true;
        dial.setPointerCapture(e.pointerId);
        setHue(getAngle(e.clientX, e.clientY));
      });
      dial.addEventListener('pointermove', onMove);
      dial.addEventListener('pointerup', (e) => { dragging = false; try { dial.releasePointerCapture(e.pointerId); } catch {} });
      dial.addEventListener('pointercancel', () => { dragging = false; });
      dial.addEventListener('keydown', (e) => {
        const step = e.shiftKey ? 15 : 5;
        const current = parseInt(dial.getAttribute('aria-valuenow') || '0', 10);
        if (e.key === 'ArrowRight' || e.key === 'ArrowUp') { e.preventDefault(); setHue(current + step); }
        if (e.key === 'ArrowLeft' || e.key === 'ArrowDown') { e.preventDefault(); setHue(current - step); }
        if (e.key === 'Home') { e.preventDefault(); setHue(0); }
        if (e.key === 'End') { e.preventDefault(); setHue(360); }
      });

      // sliders
      const gEl = root.querySelector('#gravity');
      const tEl = root.querySelector('#trail');
      const sEl = root.querySelector('#sparks');
      const gOut = root.querySelector('#g-out');
      const tOut = root.querySelector('#t-out');
      const sOut = root.querySelector('#s-out');
      const setSliderPct = (el, v, min = 0, max = 100) => {
        const pct = (v - min) / (max - min);
        el.closest('.slider').style.setProperty('--pct', Math.max(0, Math.min(1, pct)).toFixed(3));
      };
      const applyG = (v) => { gOut.textContent = v; setSliderPct(gEl, v); };
      const applyT = (v) => { tOut.textContent = v; setSliderPct(tEl, v); };
      const applyS = (v) => { sOut.textContent = v; setSliderPct(sEl, v, 30, 400); reseed(); };
      applyG(parseInt(gEl.value, 10));
      applyT(parseInt(tEl.value, 10));
      applyS(parseInt(sEl.value, 10));
      gEl.addEventListener('input', (e) => applyG(parseInt(e.target.value, 10)));
      tEl.addEventListener('input', (e) => applyT(parseInt(e.target.value, 10)));
      sEl.addEventListener('input', (e) => applyS(parseInt(e.target.value, 10)));

      // palette cycle + pulse
      const palettes = [268, 200, 146, 32, 8, 312];
      let pi = palettes.indexOf(initH); if (pi < 0) pi = 0;
      root.querySelector('#palette')?.addEventListener('click', () => {
        pi = (pi + 1) % palettes.length;
        setHue(palettes[pi]);
        pulse(1.2);
      });

      // Canvas: orbital field
      const stage = root.querySelector('#stage');
      const canvas = root.querySelector('.sky');
      const ctx = canvas.getContext('2d', { alpha: true });
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      let dpr = Math.max(1, window.devicePixelRatio || 1);
      let w = 1, h = 1, cx = 0.5, cy = 0.5;
      let orbs = [];
      const rings = [];
      function sizeCanvas() {
        const r = stage.getBoundingClientRect();
        w = Math.max(1, Math.floor(r.width));
        h = Math.max(1, Math.floor(r.height));
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
      }
      window.addEventListener('resize', () => { sizeCanvas(); reseed(); });
      sizeCanvas();

      function rand(a, b) { return a + Math.random() * (b - a); }

      function reseed() {
        orbs.length = 0;
        const count = parseInt(sEl.value, 10);
        for (let i = 0; i < count; i++) {
          const radius = rand(20, Math.min(w, h) * 0.48) * dpr;
          const theta = Math.random() * Math.PI * 2;
          const speed = rand(0.0006, 0.0022) * (Math.random() < 0.5 ? -1 : 1);
          orbs.push({
            r: radius,
            t: theta,
            s: speed,
            e: rand(0.0, 0.28), // eccentricity
            sz: rand(0.7, 2.2) * dpr,
            hueOff: rand(-30, 30),
          });
        }
      }
      reseed();

      // pointer gravity center
      let target = { x: 0.5, y: 0.5 };
      stage.addEventListener('pointermove', (e) => {
        const r = stage.getBoundingClientRect();
        target.x = (e.clientX - r.left) / r.width;
        target.y = (e.clientY - r.top) / r.height;
      });
      stage.addEventListener('pointerleave', () => {
        target.x = 0.5; target.y = 0.5;
      });

      // pulse rings
      function pulse(scale = 1) {
        const hue = parseInt(getComputedStyle(root).getPropertyValue('--h')) || 268;
        rings.push({
          x: cx * canvas.width, y: cy * canvas.height,
          r: 6 * dpr, v: 3.4 * dpr * scale,
          a: 0.9, hue
        });
      }
      root.querySelector('#pulse')?.addEventListener('click', () => pulse());

      // loop
      let rafId = 0;
      function loop() {
        const hue = parseInt(getComputedStyle(root).getPropertyValue('--h')) || 268;
        const grav = parseInt(gEl.value, 10) / 100;
        const trail = parseInt(tEl.value, 10) / 100;

        // lerp center toward target
        cx += (target.x - cx) * (0.06 + grav * 0.2);
        cy += (target.y - cy) * (0.06 + grav * 0.2);

        // fade frame for trails
        const fade = prefersReduced ? 1 : Math.max(0.06, 1 - trail);
        if (!prefersReduced) {
          ctx.fillStyle = `rgba(10,12,18,${fade})`;
          ctx.fillRect(0, 0, canvas.width, canvas.height);
        } else {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // subtle background wash
        const wash = ctx.createRadialGradient(
          cx * canvas.width, cy * canvas.height, 0,
          cx * canvas.width, cy * canvas.height, Math.max(canvas.width, canvas.height) * 0.6
        );
        wash.addColorStop(0, `hsla(${(hue + 40) % 360}, 90%, 60%, 0.08)`);
        wash.addColorStop(1, `hsla(${(hue + 140) % 360}, 90%, 60%, 0.00)`);
        ctx.fillStyle = wash;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // draw orbits and satellites
        const CCX = cx * canvas.width;
        const CCY = cy * canvas.height;

        // orbit rings guide
        ctx.save();
        ctx.globalAlpha = 0.08 + grav * 0.08;
        ctx.strokeStyle = `hsla(${hue}, 100%, 65%, ${0.12 + grav * 0.08})`;
        ctx.lineWidth = 1 * dpr;
        for (let k = 0; k < 4; k++) {
          const rr = (Math.min(canvas.width, canvas.height) * (0.15 + k * 0.14));
          ctx.beginPath();
          ctx.ellipse(CCX, CCY, rr, rr * (1 - 0.08 * k), 0, 0, Math.PI * 2);
          ctx.stroke();
        }
        ctx.restore();

        // satellites
        for (let i = 0; i < orbs.length; i++) {
          const o = orbs[i];
          o.t += o.s * (prefersReduced ? 0 : 1);

          const a = o.t;
          const ex = o.e;
          const rx = o.r * (1 + ex);
          const ry = o.r * (1 - ex);

          const x = CCX + Math.cos(a) * rx;
          const y = CCY + Math.sin(a) * ry;

          // trail line segment
          if (!prefersReduced) {
            ctx.beginPath();
            ctx.moveTo(CCX, CCY);
            ctx.lineTo(x, y);
            const segHue = (hue + o.hueOff + 360) % 360;
            ctx.strokeStyle = `hsla(${segHue}, 100%, 60%, ${0.04 + grav * 0.06})`;
            ctx.lineWidth = 0.6 * dpr;
            ctx.stroke();
          }

          // glow dot
          ctx.beginPath();
          ctx.arc(x, y, o.sz, 0, Math.PI * 2);
          const g = ctx.createRadialGradient(x, y, 0, x, y, o.sz * 4);
          const dh = (hue + o.hueOff + 360) % 360;
          g.addColorStop(0, `hsla(${dh}, 100%, 65%, .95)`);
          g.addColorStop(1, `hsla(${dh}, 100%, 60%, .0)`);
          ctx.fillStyle = g;
          ctx.fill();
        }

        // center nucleus
        const N = Math.max(6 * dpr, 8 * dpr + grav * 10 * dpr);
        const grad = ctx.createRadialGradient(CCX, CCY, 0, CCX, CCY, N * 6);
        grad.addColorStop(0, `hsla(${hue}, 100%, 65%, .9)`);
        grad.addColorStop(1, `hsla(${(hue + 120) % 360}, 90%, 60%, 0)`);
        ctx.beginPath();
        ctx.arc(CCX, CCY, N, 0, Math.PI * 2);
        ctx.fillStyle = grad;
        ctx.fill();

        // pulse rings
        for (let i = rings.length - 1; i >= 0; i--) {
          const ring = rings[i];
          ring.r += ring.v;
          ring.a *= 0.965;
          ctx.beginPath();
          ctx.arc(ring.x, ring.y, ring.r, 0, Math.PI * 2);
          ctx.strokeStyle = `hsla(${ring.hue}, 100%, 62%, ${ring.a})`;
          ctx.lineWidth = 2 * dpr;
          ctx.stroke();
          if (ring.a < 0.02) rings.splice(i, 1);
        }

        rafId = requestAnimationFrame(loop);
      }
      if (!prefersReduced) rafId = requestAnimationFrame(loop);
      else { // still frame
        loop(); cancelAnimationFrame(rafId);
      }

      // DPI observer
      let dprCheck = dpr;
      setInterval(() => {
        const nowDpr = Math.max(1, window.devicePixelRatio || 1);
        if (nowDpr !== dprCheck) {
          dpr = nowDpr;
          sizeCanvas(); reseed();
          dprCheck = nowDpr;
        }
      }, 1000);
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


