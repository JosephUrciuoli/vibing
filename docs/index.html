<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="vibe2323" role="region" aria-label="Daydream Sundial — kinetic light studio" data-scheme="light">
  <style>
    /* ========== Tokens ========== */
    #vibe2323{
      --h: 206;
      --bg0: #f7faff;
      --bg1: #e9f0fb;
      --ink: #0b1220;
      --muted: #5b6a85;
      --line: color-mix(in oklab, #0b1220 14%, transparent);
      --glass: rgba(255,255,255,0.6);
      --r: 26px;
      color-scheme: light;
      color: var(--ink);
      font: 600 14px/1.6 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      border-radius: var(--r);
      padding: clamp(22px, 4vw, 36px);
      background:
        radial-gradient(140% 120% at 0% -10%, hsl(var(--h),85%,85%) 0%, transparent 40%),
        radial-gradient(140% 120% at 120% 120%, hsl(calc(var(--h) + 60),85%,86%) 0%, transparent 40%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.75), 0 40px 120px rgba(13,24,45,0.12);
      position: relative;
      isolation: isolate;
      overflow: hidden;
    }
    #vibe2323[data-scheme="dark"]{
      --bg0: #0a0f16;
      --bg1: #0c141e;
      --ink: #eaf2ff;
      --muted: #9bb0c8;
      --line: color-mix(in oklab, #eaf2ff 16%, transparent);
      --glass: rgba(12,20,30,0.55);
      color-scheme: dark;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), 0 60px 180px rgba(0,0,0,0.6);
    }

    /* Ambient ribbons */
    #vibe2323::before, #vibe2323::after{
      content:""; position:absolute; inset:-35%;
      background:
        conic-gradient(from 110deg at 40% 30%, rgba(255,255,255,0.12), transparent 28% 72%, rgba(255,255,255,0.1) 0),
        radial-gradient(65% 45% at 70% 70%, color-mix(in oklab, hsl(var(--h),85%,70%) 26%, transparent), transparent 60%);
      mix-blend-mode: soft-light;
      filter: blur(10px) saturate(1.05);
      pointer-events:none;
      opacity:.7;
    }
    #vibe2323::before{ animation: v23-sway1 52s ease-in-out infinite; }
    #vibe2323::after{ animation: v23-sway2 68s ease-in-out infinite; }
    @keyframes v23-sway1{ 50%{ transform: translate3d(1.2%,-0.8%,0) rotate(.7deg) scale(1.02); } }
    @keyframes v23-sway2{ 50%{ transform: translate3d(-1.1%,1.1%,0) rotate(-.6deg) scale(1.03); } }

    /* ========== Header ========== */
    #vibe2323 .bar{
      display:flex; align-items:center; justify-content:space-between; gap:14px;
      margin-bottom: clamp(12px, 3vw, 26px);
    }
    #vibe2323 .brand{ display:grid; grid-auto-flow:column; gap:12px; align-items:center; user-select:none; }
    #vibe2323 .mark{
      width:36px; height:36px; border-radius:12px; position:relative; overflow:hidden;
      background: linear-gradient(160deg, hsl(var(--h),90%,55%), hsl(calc(var(--h) + 70),90%,60%));
      box-shadow: inset 0 1px 8px rgba(255,255,255,.55), 0 10px 22px rgba(0,0,0,.12);
    }
    #vibe2323 .mark::after{
      content:""; position:absolute; inset:1px; border-radius:10px;
      background:
        radial-gradient(120% 80% at -10% 0%, rgba(255,255,255,.8), transparent 50%),
        radial-gradient(80% 120% at 100% 100%, rgba(255,255,255,.25), transparent 60%);
      mix-blend-mode: overlay; animation: v23-breathe 6s ease-in-out infinite;
    }
    @keyframes v23-breathe{ 50%{ transform: translateY(1px) scale(1.02); filter: brightness(1.06);} }
    #vibe2323 h1{ margin:0; font-size:12px; letter-spacing:.28em; text-transform:uppercase; color:var(--muted); }
    #vibe2323 .actions{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    #vibe2323 .btn{
      appearance:none; border:1px solid var(--line); border-radius:999px; padding:8px 12px; cursor:pointer;
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.6));
      color:var(--ink); font-weight:800; letter-spacing:.02em;
      box-shadow: 0 10px 18px rgba(0,0,0,0.08);
      transition: transform .14s ease, filter .18s ease, box-shadow .18s ease, background .18s ease;
    }
    #vibe2323[data-scheme="dark"] .btn{
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      box-shadow: 0 10px 18px rgba(0,0,0,0.25); color: var(--ink);
    }
    #vibe2323 .btn:hover{ transform: translateY(-1px); filter: brightness(1.06); }
    #vibe2323 .btn:active{ transform: translateY(0); filter: brightness(.98); }
    #vibe2323 .btn.primary{
      border:none; color:#fff; text-shadow:0 1px 0 rgba(0,0,0,0.25);
      background: linear-gradient(90deg, hsl(var(--h),90%,55%), hsl(calc(var(--h) + 70),90%,60%));
      box-shadow: 0 16px 30px rgba(47,108,255,.22);
    }

    /* ========== Stage ========== */
    #vibe2323 .stage{
      position:relative; overflow:visible;
      border-radius: clamp(20px,3.4vw,30px);
      min-height: clamp(520px, 66vh, 900px);
      border: 1px solid var(--line);
      background:
        radial-gradient(55% 44% at 50% 0%, color-mix(in oklab, var(--bg1) 65%, transparent), transparent 65%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.5), 0 24px 70px rgba(0,0,0,.12);
      display:grid; place-items:center;
    }

    /* Sundial */
    #vibe2323 .sundial{
      --size: min(72vmin, 800px);
      width: var(--size); aspect-ratio: 1;
      position: relative; border-radius: 50%;
      background:
        radial-gradient(120% 120% at 50% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0.35) 40%, transparent 60%),
        radial-gradient(circle at 50% 60%, hsl(var(--h), 85%, 96%), hsl(var(--h), 85%, 92%) 40%, hsl(var(--h), 65%, 88%) 70%);
      border: 1px solid var(--line);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.8),
        inset 0 -30px 80px rgba(0,0,0,0.06),
        0 24px 60px rgba(0,0,0,0.12);
      overflow: hidden;
      cursor: grab;
      touch-action: none;
    }
    #vibe2323[data-scheme="dark"] .sundial{
      background:
        radial-gradient(120% 120% at 50% 30%, rgba(255,255,255,0.08), rgba(255,255,255,0.02) 40%, transparent 60%),
        radial-gradient(circle at 50% 60%, hsl(var(--h), 35%, 16%), hsl(var(--h), 35%, 14%) 40%, hsl(var(--h), 25%, 10%) 70%);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.08),
        inset 0 -30px 80px rgba(0,0,0,0.35),
        0 32px 90px rgba(0,0,0,0.4);
    }
    #vibe2323 .sundial .ring{
      position:absolute; inset:3.5%; border-radius:50%;
      border: 1px dashed color-mix(in oklab, var(--ink) 30%, transparent);
      mask: radial-gradient(circle at 50% 50%, black 52%, transparent 53%),
            radial-gradient(circle at 50% 50%, transparent 67%, black 68%),
            linear-gradient(#000,#000);
      -webkit-mask-composite: source-in, xor, source-over;
              mask-composite: intersect, exclude, add;
      pointer-events:none;
    }
    #vibe2323 .sundial canvas.caustic{
      position:absolute; inset:0; width:100%; height:100%; display:block;
      mix-blend-mode: soft-light; opacity: .85;
    }
    #vibe2323[data-scheme="dark"] .sundial canvas.caustic{ mix-blend-mode: screen; opacity:.5; }

    /* Gnomon (needle) */
    #vibe2323 .needle{
      --angle: 0deg;
      position:absolute; inset:0; display:grid; place-items:center; pointer-events:none;
      transform: rotate(var(--angle));
      transition: filter .25s ease;
    }
    #vibe2323 .needle::before{
      content:""; width: 46%; height: 2px; border-radius: 2px;
      background: linear-gradient(90deg, hsl(var(--h),90%,55%), hsl(calc(var(--h) + 70), 90%, 60%));
      box-shadow: 0 0 0 1px rgba(255,255,255,.6) inset, 0 4px 18px rgba(0,0,0,.12);
      transform-origin: right center;
    }
    #vibe2323 .needle .tip{
      position:absolute; right: 6%; top: 50%; transform: translate(50%,-50%);
      width: 14px; height:14px; border-radius: 50%;
      background: radial-gradient(circle at 35% 35%, #fff, #e6edf7);
      border:1px solid var(--line); box-shadow:0 6px 12px rgba(0,0,0,.18);
    }

    /* Orbiting markers */
    #vibe2323 .orbit{
      --r1: 40%;
      --r2: 58%;
      position:absolute; inset:0; pointer-events:none;
    }
    #vibe2323 .orbit .layer{
      position:absolute; inset:0; transform-origin: 50% 50%;
      animation: v23-spin linear infinite;
    }
    #vibe2323 .orbit .layer.slow{ animation-duration: 64s; }
    #vibe2323 .orbit .layer.mid{  animation-duration: 38s; }
    #vibe2323 .orbit .layer.fast{ animation-duration: 22s; }
    @keyframes v23-spin{ to{ transform: rotate(360deg); } }
    #vibe2323 .dot{
      position:absolute; left:50%; top:50%;
      width:10px; height:10px; border-radius:50%;
      background: hsl(var(--h), 90%, 60%); box-shadow: 0 6px 14px hsl(var(--h), 90%, 60%, .4);
      transform: translate(-50%, calc(-50% - var(--offset))) scale(var(--s,1));
    }
    #vibe2323 .dot.alt{
      background: hsl(calc(var(--h)+70), 90%, 60%); box-shadow: 0 6px 14px hsl(calc(var(--h)+70), 90%, 60%, .4);
    }

    /* Readout */
    #vibe2323 .readout{
      position:absolute; inset:0; display:grid; place-items:center; pointer-events:none;
      font-weight:900; text-align:center;
      color: color-mix(in oklab, var(--ink) 74%, transparent);
    }
    #vibe2323 .readout h2{
      margin:0; line-height:.9; letter-spacing:-.02em; text-transform: lowercase;
      font-size: clamp(42px, 8.8vw, 120px);
      background: linear-gradient(110deg, hsl(var(--h),90%,55%), hsl(calc(var(--h) + 70),90%,60%));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter: drop-shadow(0 1px 0 rgba(255,255,255,.4));
    }
    #vibe2323 .readout p{ margin:.6em 0 0; font-size:13px; color:var(--muted); }

    /* Dock */
    #vibe2323 .dock{
      position:relative; z-index:3; margin-top: clamp(16px, 3vw, 26px);
      display:grid; gap:12px; width: min(1000px, 100%);
      padding: clamp(12px,2vw,16px);
      background: var(--glass);
      border: 1px solid var(--line);
      border-radius: 18px;
      box-shadow: 0 18px 50px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.22);
      backdrop-filter: blur(14px) saturate(1.08);
    }
    #vibe2323 .dock .grid{ display:grid; grid-template-columns: repeat(5, minmax(0,1fr)); gap:10px; }
    @media (max-width:900px){ #vibe2323 .dock .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); } }
    @media (max-width:560px){ #vibe2323 .dock .grid{ grid-template-columns: 1fr 1fr; } }
    @media (max-width:420px){ #vibe2323 .dock .grid{ grid-template-columns: 1fr; } }
    #vibe2323 label{ display:grid; gap:6px; font-size:11px; color:var(--muted); letter-spacing:.08em; text-transform:uppercase; }
    #vibe2323 input[type="range"]{
      -webkit-appearance:none; appearance:none; width:100%; height:12px;
      border-radius:999px; border:1px solid var(--line);
      background:
        linear-gradient(90deg, hsl(var(--h),90%,55%), hsl(calc(var(--h)+70),90%,60%)) left/var(--pct,50%) 100% no-repeat,
        rgba(0,0,0,.08);
      box-shadow: inset 0 2px 6px rgba(0,0,0,.12);
      outline:none;
    }
    #vibe2323 input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none; appearance:none; width:18px; height:18px; border-radius:50%;
      background: radial-gradient(circle at 35% 35%, #fff, #e6edf7);
      border:1px solid var(--line); box-shadow:0 6px 12px rgba(0,0,0,.18); cursor:pointer;
    }
    #vibe2323 input[type="range"]::-moz-range-thumb{
      width:18px; height:18px; border-radius:50%;
      background: radial-gradient(circle at 35% 35%, #fff, #e6edf7);
      border:1px solid var(--line); box-shadow:0 6px 12px rgba(0,0,0,.18); cursor:pointer;
    }
    #vibe2323 .row{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    #vibe2323 .chip{
      appearance:none; border:1px solid var(--line); border-radius:999px; padding:8px 12px; cursor:pointer;
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.6));
      color:var(--ink); font-weight:800; letter-spacing:.02em;
      box-shadow: 0 8px 16px rgba(0,0,0,0.08);
      transition: transform .14s ease, background .18s ease, box-shadow .18s ease;
    }
    #vibe2323[data-scheme="dark"] .chip{
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    #vibe2323 .chip[aria-pressed="true"]{
      border-color: transparent;
      background: linear-gradient(90deg, hsl(var(--h),90%,55%), hsl(calc(var(--h)+70),90%,60%));
      color:#fff; text-shadow:0 1px 0 rgba(0,0,0,0.25);
      box-shadow: 0 14px 24px rgba(47,108,255,.22);
    }
    #vibe2323 .meta{ display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap; font-size:12px; color:var(--muted); }

    /* Focus */
    #vibe2323 .btn:focus, #vibe2323 .chip:focus, #vibe2323 input:focus{ outline: 2px solid hsl(var(--h),90%,60%); outline-offset: 2px; }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      #vibe2323 *, #vibe2323::before, #vibe2323::after{ animation:none !important; transition:none !important; }
    }
  </style>

  <div class="bar" aria-label="Top bar">
    <div class="brand">
      <div class="mark" aria-hidden="true"></div>
      <h1>Daydream Sundial</h1>
    </div>
    <div class="actions">
      <button class="btn" id="theme2323" type="button" aria-pressed="false" title="Toggle theme">Dark</button>
      <button class="btn primary" id="capture2323" type="button" title="Save caustics image">Capture</button>
      <button class="btn" id="reset2323" type="button" title="Reset">Reset</button>
    </div>
  </div>

  <section class="stage" aria-label="Sundial canvas. Drag to steer the light. Space to pause. T for theme.">
    <div class="sundial" id="dial2323">
      <canvas class="caustic"></canvas>
      <div class="ring" aria-hidden="true"></div>

      <div class="orbit" aria-hidden="true">
        <div class="layer slow">
          <div class="dot" style="--offset: calc(var(--r1)); --s:1;"></div>
          <div class="dot alt" style="--offset: calc(var(--r1) * 0.62); --s:0.9;"></div>
        </div>
        <div class="layer mid">
          <div class="dot alt" style="--offset: calc(var(--r2)); --s:1.1;"></div>
          <div class="dot" style="--offset: calc(var(--r2) * 0.7); --s:0.85;"></div>
        </div>
        <div class="layer fast">
          <div class="dot" style="--offset: calc(var(--r1) * 0.8); --s:0.9;"></div>
        </div>
      </div>

      <div class="needle"><span class="tip" aria-hidden="true"></span></div>

      <div class="readout" aria-live="polite">
        <h2 id="headline2323">light, kept.</h2>
        <p id="sub2323">A quiet orbit of color and time.</p>
      </div>
    </div>

    <aside class="dock" aria-label="Controls">
      <div class="grid">
        <label for="warmth2323">Warmth
          <input id="warmth2323" type="range" min="0" max="360" step="1" value="206" aria-valuemin="0" aria-valuemax="360" aria-valuenow="206">
        </label>
        <label for="intense2323">Intensity
          <input id="intense2323" type="range" min="2" max="18" step="1" value="10" aria-valuemin="2" aria-valuemax="18" aria-valuenow="10">
        </label>
        <label for="speed2323">Speed
          <input id="speed2323" type="range" min="0" max="100" step="1" value="55" aria-valuemin="0" aria-valuemax="100" aria-valuenow="55">
        </label>
        <label for="grain2323">Grain
          <input id="grain2323" type="range" min="0" max="100" step="1" value="18" aria-valuemin="0" aria-valuemax="100" aria-valuenow="18">
        </label>
        <label for="shift2323">Shift
          <input id="shift2323" type="range" min="0" max="100" step="1" value="42" aria-valuemin="0" aria-valuemax="100" aria-valuenow="42">
        </label>
      </div>
      <div class="row">
        <button class="chip" id="auto2323" type="button" aria-pressed="true" title="Follow local time">Auto Time</button>
        <button class="chip" id="glow2323" type="button" aria-pressed="true" title="Toggle glow">Glow On</button>
        <button class="chip" id="pause2323" type="button" aria-pressed="false" title="Pause animation">Pause</button>
        <button class="chip" id="mono2323" type="button" aria-pressed="false" title="Mono palette">Mono</button>
      </div>
      <div class="meta" role="contentinfo">
        <span class="hint">Tip: Drag the dial to steer color. Press S to save, T to toggle theme.</span>
        <span id="last-updated">Last updated: 2026-01-31 21:09:28 EST</span>
      </div>
    </aside>
  </section>

  <script>
    (function(){
      const root = document.getElementById('vibe2323');
      const dial = root.querySelector('#dial2323');
      const canvas = dial.querySelector('canvas.caustic');
      const ctx = canvas.getContext('2d', { alpha: true, desynchronized: true });
      const themeBtn = root.querySelector('#theme2323');
      const captureBtn = root.querySelector('#capture2323');
      const resetBtn = root.querySelector('#reset2323');

      const warmth = root.querySelector('#warmth2323');
      const intense = root.querySelector('#intense2323');
      const speed = root.querySelector('#speed2323');
      const grain = root.querySelector('#grain2323');
      const shift = root.querySelector('#shift2323');

      const autoBtn = root.querySelector('#auto2323');
      const glowBtn = root.querySelector('#glow2323');
      const pauseBtn = root.querySelector('#pause2323');
      const monoBtn = root.querySelector('#mono2323');

      const needle = root.querySelector('.needle');
      const headline = root.querySelector('#headline2323');
      const sub = root.querySelector('#sub2323');
      const updated = root.querySelector('#last-updated');

      // Last updated
      function fmt(d){
        try{
          return new Intl.DateTimeFormat(undefined,{
            year:'numeric', month:'short', day:'2-digit',
            hour:'2-digit', minute:'2-digit', second:'2-digit'
          }).format(d);
        }catch{ return d.toLocaleString(); }
      }
      updated.textContent = 'Last updated: ' + fmt(new Date());

      // Range fill helper
      function fillRange(el){
        const min = +el.min, max = +el.max, val = +el.value;
        const pct = ((val - min) / (max - min)) * 100;
        el.style.setProperty('--pct', pct + '%');
        el.setAttribute('aria-valuenow', String(val));
      }
      [warmth,intense,speed,grain,shift].forEach(r => { fillRange(r); r.addEventListener('input', ()=>fillRange(r)); });

      // Theme
      function toggleTheme(){
        const dark = root.getAttribute('data-scheme') === 'dark';
        root.setAttribute('data-scheme', dark ? 'light' : 'dark');
        themeBtn.textContent = dark ? 'Dark' : 'Light';
        themeBtn.setAttribute('aria-pressed', (!dark).toString());
        clearCanvas();
      }
      themeBtn.addEventListener('click', toggleTheme);

      // Sizing
      let dpr = Math.min(3, window.devicePixelRatio || 1);
      function size(){
        const r = canvas.getBoundingClientRect();
        canvas.width = Math.max(1, Math.floor(r.width * dpr));
        canvas.height = Math.max(1, Math.floor(r.height * dpr));
        ctx.setTransform(1,0,0,1,0,0);
        ctx.scale(dpr, dpr);
        clearCanvas();
      }
      const ro = new ResizeObserver(size);
      ro.observe(canvas);
      let rsT=0;
      window.addEventListener('resize', ()=>{ clearTimeout(rsT); rsT=setTimeout(size, 80); });

      // Canvas helpers
      function clearCanvas(){
        const r = canvas.getBoundingClientRect();
        ctx.globalCompositeOperation='source-over';
        const scheme = root.getAttribute('data-scheme');
        ctx.fillStyle = scheme==='dark' ? 'rgba(10,15,22,1)' : 'rgba(247,250,255,1)';
        ctx.fillRect(0,0,r.width,r.height);
      }

      // State
      let t = 0, prev = performance.now(), rafId = 0, paused=false;
      let autoTime = true, glowOn = true, mono = false;
      let angleDeg = 0; // for needle + palette
      let dragging = false;

      // Init hue
      root.style.setProperty('--h', warmth.value);

      // Interactions: drag dial to set angle
      function setAngleFromPointer(e){
        const r = dial.getBoundingClientRect();
        const cx = r.left + r.width/2;
        const cy = r.top + r.height/2;
        const dx = e.clientX - cx;
        const dy = e.clientY - cy;
        let a = Math.atan2(dy, dx) * 180/Math.PI; // -180..180
        a = (a + 360) % 360;
        angleDeg = a;
        needle.style.setProperty('--angle', a + 'deg');
        // Map angle to hue shift when not mono
        if(!mono){
          const baseHue = (+warmth.value + (a/360)*120) % 360;
          root.style.setProperty('--h', baseHue);
        }
      }
      dial.addEventListener('pointerdown', (e)=>{ dragging = true; dial.style.cursor='grabbing'; setAngleFromPointer(e); });
      window.addEventListener('pointermove', (e)=>{ if(dragging){ autoTime=false; autoBtn.setAttribute('aria-pressed','false'); setAngleFromPointer(e);} }, {passive:true});
      window.addEventListener('pointerup', ()=>{ dragging = false; dial.style.cursor='grab'; });

      // Buttons
      autoBtn.addEventListener('click', ()=>{
        autoTime = !autoTime;
        autoBtn.setAttribute('aria-pressed', String(autoTime));
      });
      glowBtn.addEventListener('click', ()=>{
        glowOn = !glowOn;
        glowBtn.setAttribute('aria-pressed', String(glowOn));
      });
      monoBtn.addEventListener('click', ()=>{
        mono = !mono;
        monoBtn.setAttribute('aria-pressed', String(mono));
      });
      pauseBtn.addEventListener('click', ()=>{
        paused = !paused;
        pauseBtn.setAttribute('aria-pressed', String(paused));
        pauseBtn.textContent = paused ? 'Resume' : 'Pause';
        if(!paused){ prev = performance.now(); rafId = requestAnimationFrame(frame); }
      });
      resetBtn.addEventListener('click', ()=>{
        warmth.value = '206'; intense.value='10'; speed.value='55'; grain.value='18'; shift.value='42';
        [warmth,intense,speed,grain,shift].forEach(fillRange);
        root.style.setProperty('--h', warmth.value);
        mono=false; monoBtn.setAttribute('aria-pressed','false');
        autoTime=true; autoBtn.setAttribute('aria-pressed','true');
        glowOn=true; glowBtn.setAttribute('aria-pressed','true');
        angleDeg=0; needle.style.setProperty('--angle', '0deg');
        headline.textContent='light, kept.'; sub.textContent='A quiet orbit of color and time.';
        clearCanvas();
      });

      // Sliders
      warmth.addEventListener('input', ()=>{ root.style.setProperty('--h', warmth.value); });
      // Grain overlay via CSS filter-like noise drawn in canvas path; we’ll use shaderless trick

      // Keyboard
      root.addEventListener('keydown', (e)=>{
        if(e.code==='Space'){ e.preventDefault(); pauseBtn.click(); }
        if(e.key.toLowerCase()==='t'){ e.preventDefault(); themeBtn.click(); }
        if(e.key.toLowerCase()==='s'){ e.preventDefault(); captureBtn.click(); }
      });

      // Capture canvas
      captureBtn.addEventListener('click', ()=>{
        try{
          const a = document.createElement('a');
          a.download = `sundial-${new Date().toISOString().replace(/[:.]/g,'-')}.png`;
          a.href = canvas.toDataURL('image/png');
          a.click();
        }catch(e){}
      });

      // Caustic renderer (low-res upsample)
      const off = document.createElement('canvas');
      const octx = off.getContext('2d', { alpha: false });
      function caustic(tms){
        const r = canvas.getBoundingClientRect();
        const W = Math.max(180, Math.floor(r.width/4));
        const H = Math.max(180, Math.floor(r.height/4));
        if(off.width !== W || off.height !== H){ off.width=W; off.height=H; }
        const img = octx.createImageData(W, H);
        const data = img.data;

        const spd = +speed.value / 50; // 0..2
        const k1 = 0.8 + (+shift.value/100)*1.6; // 0.8..2.4
        const k2 = 1.2 + (+intense.value/10)*0.6; // 1.2..2.28
        const t = tms * 0.001 * spd;

        const hue = parseFloat(getComputedStyle(root).getPropertyValue('--h')) || 206;
        const s1 = mono ? 0 : 0.55;
        const s2 = mono ? 0 : 0.85;

        let i=0;
        for(let y=0;y<H;y++){
          for(let x=0;x<W;x++){
            const nx = x/W - 0.5, ny = y/H - 0.5;
            const r2 = Math.hypot(nx, ny);
            const ang = Math.atan2(ny, nx) + (angleDeg*Math.PI/180);
            // layered cheap "noise"
            const v =
              Math.sin((nx*k1 + Math.cos(t*0.7))*8 + t*1.1) * 0.5 +
              Math.cos((ny*k2 + Math.sin(t*0.5))*9 - t*0.9) * 0.5 +
              Math.sin((nx+ny)*6 + t*0.3) * 0.4;

            // vignette & radial caustic falloff
            const fall = Math.exp(-r2*3.4);
            let lum = (v*0.5 + 0.5) * fall;

            // grain
            const g = (+grain.value/100) * (Math.random()*0.15);
            lum = Math.min(1, Math.max(0, lum + g));

            // palette mapping
            const l = 65 + lum*30;
            const c1 = hslToRgb(hue, s1, l/100);
            const c2 = hslToRgb(hue+70, s2, (l+lum*8)/100);

            // simple mix
            const m = 0.5 + lum*0.5;
            const rC = c1[0]*(1-m) + c2[0]*m;
            const gC = c1[1]*(1-m) + c2[1]*m;
            const bC = c1[2]*(1-m) + c2[2]*m;

            data[i++] = rC;
            data[i++] = gC;
            data[i++] = bC;
            data[i++] = 255;
          }
        }
        octx.putImageData(img,0,0);
        ctx.globalCompositeOperation = 'source-over';
        ctx.drawImage(off, 0, 0, r.width, r.height);

        // optional glow glaze
        if(glowOn){
          ctx.globalCompositeOperation = 'lighter';
          ctx.filter = `blur(${2 + (+intense.value/2)}px)`;
          ctx.drawImage(off, 0, 0, r.width, r.height);
          ctx.filter = 'none';
        }
      }

      // HSL -> RGB helper
      function hslToRgb(h, s, l){
        h = ((h%360)+360)%360;
        const C = (1 - Math.abs(2*l - 1)) * s;
        const Hp = h/60;
        const X = C * (1 - Math.abs((Hp % 2) - 1));
        let r=0,g=0,b=0;
        if(0<=Hp && Hp<1){ r=C; g=X; b=0; }
        else if(1<=Hp && Hp<2){ r=X; g=C; b=0; }
        else if(2<=Hp && Hp<3){ r=0; g=C; b=X; }
        else if(3<=Hp && Hp<4){ r=0; g=X; b=C; }
        else if(4<=Hp && Hp<5){ r=X; g=0; b=C; }
        else if(5<=Hp && Hp<6){ r=C; g=0; b=X; }
        const m = l - C/2;
        return [
          Math.round((r+m)*255),
          Math.round((g+m)*255),
          Math.round((b+m)*255)
        ];
      }

      // Loop
      function frame(now){
        const dt = Math.min(50, now - prev);
        prev = now;

        if(autoTime){
          const d = new Date();
          const secs = d.getHours()*3600 + d.getMinutes()*60 + d.getSeconds();
          const a = (secs / 86400) * 360;
          angleDeg = a;
          needle.style.setProperty('--angle', a + 'deg');
          if(!mono){
            const baseHue = (+warmth.value + (a/360)*120) % 360;
            root.style.setProperty('--h', baseHue);
          }
          headline.textContent = d.toLocaleTimeString([], { hour: '2-digit', minute:'2-digit' });
          sub.textContent = d.toLocaleDateString([], { weekday:'long', month:'short', day:'numeric' });
        }

        t += dt;
        caustic(t);
        if(!paused) rafId = requestAnimationFrame(frame);
      }

      // Reduced motion + visibility
      const media = matchMedia('(prefers-reduced-motion: reduce)');
      media.addEventListener?.('change', ()=>{
        if(media.matches){ cancelAnimationFrame(rafId); }
        else if(!paused){ prev = performance.now(); rafId = requestAnimationFrame(frame); }
      });
      document.addEventListener('visibilitychange', ()=>{
        if(document.hidden) cancelAnimationFrame(rafId);
        else if(!paused) rafId = requestAnimationFrame(frame);
      });

      // Init
      function init(){
        size();
        cancelAnimationFrame(rafId);
        paused = false;
        pauseBtn.textContent = 'Pause';
        prev = performance.now();
        rafId = requestAnimationFrame(frame);
      }
      init();
    })();
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


