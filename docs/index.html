<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="vibe2038" role="region" aria-label="Orbit Garden — living poster 2038">
  <style>
    /* Orbit Garden — 2038 (scoped) */
    #vibe2038{
      --ink:#0d1420;
      --muted: color-mix(in oklab, var(--ink), transparent 45%);
      --bg0:#f9fcff; --bg1:#eef6ff;
      --p1:#6bd4ff; --p2:#9cffd2; --p3:#a8a3ff; --p4:#ffd39c;
      --glass: rgba(255,255,255,0.55);
      --panel: rgba(255,255,255,0.72);
      --line: color-mix(in oklab, var(--ink), transparent 86%);

      position:relative;
      display:grid;
      gap: clamp(14px, 2.8vmin, 28px);
      padding: clamp(18px, 5.2vmin, 54px);
      border-radius: 28px;
      color: var(--ink);
      background:
        radial-gradient(160% 120% at var(--mx,70%) var(--my,20%), color-mix(in oklab, var(--p2), transparent 88%), transparent 58%),
        radial-gradient(140% 120% at 14% 86%, color-mix(in oklab, var(--p3), transparent 90%), transparent 52%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      border: 1px solid var(--line);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.75),
        0 100px 260px rgba(8,12,20,0.16);
      overflow: clip;
      isolation:isolate;
    }

    /* Themes */
    #vibe2038[data-theme="dawn"]{
      --ink:#141118; --muted: color-mix(in oklab, #141118, transparent 45%);
      --bg0:#fff8fb; --bg1:#ffeef6;
      --p1:#ff9ec2; --p2:#ffa86b; --p3:#ffd49c; --p4:#a6b4ff;
      --glass: rgba(255,255,255,0.58);
      --panel: rgba(255,255,255,0.78);
      --line: color-mix(in oklab, #141118, transparent 82%);
    }
    #vibe2038[data-theme="mist"]{
      --ink:#0e1b20; --muted: color-mix(in oklab, #0e1b20, transparent 44%);
      --bg0:#f4feff; --bg1:#eaf7ff;
      --p1:#6bd4ff; --p2:#93ffe0; --p3:#b0e0ff; --p4:#ffd39c;
      --glass: rgba(255,255,255,0.56);
      --panel: rgba(255,255,255,0.75);
    }
    #vibe2038[data-theme="bloom"]{
      --ink:#24161a; --muted: color-mix(in oklab, #24161a, transparent 42%);
      --bg0:#fff6fb; --bg1:#ffe9f4;
      --p1:#ff7fb6; --p2:#ffb6e4; --p3:#a6a2ff; --p4:#a8ffd7;
      --glass: rgba(255,255,255,0.6);
      --panel: rgba(255,255,255,0.78);
    }
    #vibe2038[data-theme="void"]{
      --ink:#eaf2ff; --muted: color-mix(in oklab, #eaf2ff, transparent 42%);
      --bg0:#080b12; --bg1:#0b1220;
      --p1:#7ea3ff; --p2:#77ffd0; --p3:#ffa0db; --p4:#ffe08f;
      --glass: rgba(255,255,255,0.12);
      --panel: rgba(255,255,255,0.12);
      --line: rgba(255,255,255,0.14);
      border-color: var(--line);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.08),
        0 120px 360px rgba(0,0,0,0.66),
        0 180px 480px color-mix(in oklab, var(--p3), transparent 88%);
    }

    /* Header */
    #vibe2038 .top{
      display:grid; gap: clamp(10px, 2vmin, 16px);
    }
    #vibe2038 .brand{
      display:flex; align-items:center; gap:10px;
      width:max-content;
      padding:10px 14px;
      border:1px solid var(--line);
      border-radius: 16px;
      background: linear-gradient(180deg, var(--panel), rgba(255,255,255,0.06));
      backdrop-filter: blur(10px) saturate(160%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.65), 0 14px 28px rgba(6,10,22,0.18);
      font: 800 11px/1 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      letter-spacing:0.14em; text-transform:uppercase;
    }
    #vibe2038 .glyph{
      width:22px; height:22px; border-radius:10px; position:relative; overflow:clip;
      background:
        radial-gradient(90% 90% at 30% 30%, var(--p1), transparent 60%),
        radial-gradient(90% 90% at 70% 70%, var(--p3), transparent 66%),
        conic-gradient(from 0deg, var(--p2), var(--p4), var(--p1));
      animation: spin38 18s linear infinite;
      box-shadow: 0 6px 14px color-mix(in oklab, var(--p1), transparent 70%);
    }
    @keyframes spin38{ to{ transform: rotate(360deg);} }

    #vibe2038 .hero{
      position:relative;
      padding: clamp(14px, 3vmin, 22px);
      border-radius: 18px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--glass), rgba(255,255,255,0.04));
      backdrop-filter: blur(10px) saturate(160%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.55), 0 16px 44px rgba(6,10,22,0.18);
    }
    #vibe2038 .kicker{
      display:block; margin-bottom:6px; color:var(--muted);
      font: 800 12px/1.2 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      letter-spacing:0.14em; text-transform:uppercase;
    }
    #vibe2038 h1{
      margin:0 0 8px;
      font: 900 clamp(34px, 8.5vw, 120px)/0.9 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      letter-spacing:-0.02em;
      color: transparent;
      background: linear-gradient(90deg, var(--p2), var(--p1), var(--p3), var(--p4));
      background-size: 260% 100%;
      -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
      animation: shimmer38 16s ease-in-out infinite;
      filter: drop-shadow(0 6px 14px color-mix(in oklab, var(--p1), transparent 84%));
      cursor: pointer;
    }
    @keyframes shimmer38{ 0%,100%{ background-position:0% 50%; } 50%{ background-position:100% 50%; } }
    #vibe2038 .lead{
      margin:0; color:var(--muted);
      font: 500 clamp(14px, 2.1vw, 18px)/1.7 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }

    /* Controls */
    #vibe2038 .controls{
      display:flex; flex-wrap:wrap; gap:8px; margin-top:8px;
    }
    #vibe2038 .pill{
      appearance:none; cursor:pointer; user-select:none;
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--panel), rgba(255,255,255,0.02));
      color:inherit;
      padding:10px 14px; border-radius:999px;
      font: 800 11px/1 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      letter-spacing:0.1em; text-transform:uppercase;
      transition: transform .14s ease, box-shadow .22s ease, background .22s ease, color .22s ease;
      box-shadow: 0 10px 22px rgba(6,10,22,0.18);
    }
    #vibe2038 .pill:hover{ transform: translateY(-1px); box-shadow: 0 18px 44px rgba(6,10,22,0.24); }
    #vibe2038 .pill[aria-pressed="true"]{
      background: linear-gradient(90deg, var(--p1), var(--p4));
      border-color: transparent;
      color: color-mix(in oklab, var(--ink), #000 30%);
    }

    /* Stage */
    #vibe2038 .stage{
      position:relative; display:grid; place-items:center; min-height:64vh; z-index:1;
    }
    #vibe2038 .frame{
      position:relative; width:min(96vw, 1160px); aspect-ratio: 1/1; border-radius: 36px; overflow:hidden;
      border:1px solid var(--line);
      background:
        radial-gradient(140% 120% at 50% 28%, color-mix(in oklab, var(--p1), transparent 88%), transparent 60%),
        radial-gradient(120% 140% at 50% 82%, color-mix(in oklab, var(--p3), transparent 88%), transparent 58%),
        linear-gradient(180deg, color-mix(in oklab, var(--bg0), white 10%), color-mix(in oklab, var(--bg1), white 2%));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.55),
        0 44px 160px rgba(0,0,0,0.18),
        0 84px 260px color-mix(in oklab, var(--p1), transparent 86%);
      transform: rotateX(var(--rx,0deg)) rotateY(var(--ry,0deg));
      transition: transform 180ms ease;
      will-change: transform;
    }
    #vibe2038 canvas#canvas38{ position:absolute; inset:0; width:100%; height:100%; display:block; z-index:1; }

    #vibe2038 .ring{
      position:absolute; inset:6%; border-radius: 999px; z-index:2; pointer-events:none;
      border:1px dashed color-mix(in oklab, var(--ink), transparent 76%);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.25);
      mask: radial-gradient(circle at 50% 50%, rgba(0,0,0,0) 48%, rgba(0,0,0,1) 49.5%, rgba(0,0,0,1) 50.5%, rgba(0,0,0,0) 52%);
      opacity:0.7;
    }
    #vibe2038 .seal{
      position:absolute; right:6%; top:6%; z-index:3;
      padding:9px 12px; border-radius: 12px;
      border: 1px dashed color-mix(in oklab, var(--ink), transparent 74%);
      background: linear-gradient(180deg, rgba(255,255,255,0.50), rgba(255,255,255,0.06));
      backdrop-filter: blur(6px) saturate(150%);
      font: 800 12px/1.1 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial; color:var(--muted);
      pointer-events:none;
    }
    #vibe2038 .note{
      position:absolute; left:6%; bottom:6%; z-index:3;
      padding: 12px 14px; border-radius: 14px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--glass), rgba(255,255,255,0.06));
      backdrop-filter: blur(8px) saturate(150%);
      font: 500 12px/1.5 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial; color:var(--muted);
    }

    /* Footer */
    #vibe2038 .meta{
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
      color:var(--muted); font:500 12px/1.4 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      z-index:4;
    }
    #vibe2038 #last-updated{ opacity:0.9; }

    /* Motion reduction */
    @media (prefers-reduced-motion: reduce){
      #vibe2038 h1{ animation: none !important; }
      #vibe2038 .glyph{ animation: none !important; }
    }
  </style>

  <div class="top">
    <div class="brand">
      <span class="glyph" aria-hidden="true"></span>
      Orbit Garden — 2038
    </div>

    <div class="hero">
      <span class="kicker">Living Poster</span>
      <h1 id="title38" title="Click to rename">Orbit Garden</h1>
      <p class="lead">A luminous orrery. Drag to steer gravity. Space to pulse. Keys: T theme, P play, D density, S snapshot.</p>
      <div class="controls" aria-label="Controls">
        <button class="pill" id="theme38" type="button" aria-pressed="false" aria-label="Cycle theme">Mist</button>
        <button class="pill" id="play38" type="button" aria-pressed="true" aria-label="Toggle motion">Play</button>
        <button class="pill" id="dens38" type="button" aria-pressed="false" aria-label="Cycle density">Density: M</button>
        <button class="pill" id="snap38" type="button" aria-pressed="false" aria-label="Save poster">Snapshot</button>
      </div>
    </div>
  </div>

  <div class="stage" id="stage38" aria-live="polite" aria-label="Orbital poster. Drag to tilt, space to emit pulse.">
    <div class="frame" id="frame38">
      <canvas id="canvas38" role="img" aria-label="Luminous orbits and pulses"></canvas>
      <div class="ring" aria-hidden="true"></div>
      <div class="seal">Edition 2038 — Orbital Almanac</div>
      <div class="note">Tip: aim the cursor slightly off-center to coax spirals. Space to drop a golden pulse.</div>
    </div>
  </div>

  <div class="meta">
    <span class="hint">Shortcuts: T • P • D • S • Space</span>
    <span id="last-updated">Last updated: 2026-01-18 10:17:53 EST</span>
  </div>

  <script>
    (function(){
      const root   = document.getElementById('vibe2038');
      const stage  = document.getElementById('stage38');
      const frame  = document.getElementById('frame38');
      const canvas = document.getElementById('canvas38');
      const ctx    = canvas.getContext('2d', { alpha:true });

      const btnTheme = document.getElementById('theme38');
      const btnPlay  = document.getElementById('play38');
      const btnDens  = document.getElementById('dens38');
      const btnSnap  = document.getElementById('snap38');
      const title    = document.getElementById('title38');
      const updated  = document.getElementById('last-updated');

      // Timestamp
      try{
        const now = new Date();
        updated.textContent = 'Updated: ' + now.toLocaleString(undefined, {
          year:'numeric', month:'short', day:'2-digit',
          hour:'2-digit', minute:'2-digit', second:'2-digit'
        });
      }catch(e){ updated.textContent = 'Updated: just now'; }

      // Theme
      const THEMES = ['mist','dawn','bloom','void'];
      const LABELS = { mist:'Mist', dawn:'Dawn', bloom:'Bloom', void:'Void' };
      let themeIndex = (matchMedia && matchMedia('(prefers-color-scheme: dark)').matches) ? 3 : 0;
      function setTheme(i){
        const t = THEMES[i % THEMES.length];
        root.dataset.theme = t;
        btnTheme.textContent = LABELS[t];
        btnTheme.setAttribute('aria-pressed', String(t !== 'mist'));
        drawOnce();
      }
      setTheme(themeIndex);

      // Motion + density
      let motion = !matchMedia('(prefers-reduced-motion: reduce)').matches;
      btnPlay.textContent = motion ? 'Play' : 'Pause';
      btnPlay.setAttribute('aria-pressed', String(motion));
      root.setAttribute('data-motion', motion ? 'on':'off');

      const DSET = [0.6, 1.0, 1.6]; // L, M, H
      const DLABELS = ['L','M','H'];
      let dIndex = 1;
      btnDens.textContent = 'Density: ' + DLABELS[dIndex];
      btnDens.setAttribute('aria-pressed', String(dIndex>1));

      // Pointer tilt / gravity
      const ptr = { x:0.52, y:0.48, tx:0.52, ty:0.48, down:false };
      function clamp(n,a,b){ return Math.max(a, Math.min(b, n)); }
      stage.addEventListener('pointermove', (e)=>{
        const r = frame.getBoundingClientRect();
        const x = clamp((e.clientX - r.left)/r.width, 0, 1);
        const y = clamp((e.clientY - r.top)/r.height, 0, 1);
        ptr.tx = x; ptr.ty = y;
      });
      stage.addEventListener('pointerdown', ()=>{ ptr.down=true; pulse(); });
      stage.addEventListener('pointerup',   ()=>{ ptr.down=false; });
      stage.addEventListener('pointerleave',()=>{ ptr.down=false; });

      // Title shuffle
      const names = ['Orbit Garden','Halo Print','Aster Field','Quiet Orrery','Lumen Wheel'];
      title.addEventListener('click', ()=>{
        title.textContent = names[Math.floor(Math.random()*names.length)];
      });

      // Size
      let W=0, H=0, DPR=Math.min(2, window.devicePixelRatio || 1);
      function size(){
        const r = frame.getBoundingClientRect();
        canvas.width  = Math.floor(r.width * DPR);
        canvas.height = Math.floor(r.height * DPR);
        canvas.style.width = r.width + 'px';
        canvas.style.height= r.height + 'px';
        ctx.setTransform(DPR,0,0,DPR,0,0);
        W = r.width; H = r.height;
        resetScene();
        drawOnce();
      }
      const ro = new ResizeObserver(size); ro.observe(frame); size();

      function css(name){ return getComputedStyle(root).getPropertyValue(name).trim(); }
      function palette(){ return [css('--p1')||'#7ed8ff', css('--p2')||'#90ffd1', css('--p3')||'#b6a2ff', css('--p4')||'#ffd59a']; }

      // Scene
      let last = performance.now(), t = 0, raf = null;
      let orbits = [];
      let pulses = [];

      function resetScene(){
        const cols = palette();
        const baseCount = 90;
        const areaScale = Math.sqrt((W*H)/(900*900));
        const count = Math.max(24, Math.floor(baseCount * DSET[dIndex] * areaScale));
        orbits = [];
        for(let i=0;i<count;i++){
          const col = cols[i % cols.length];
          orbits.push(makeOrbit(col, i, count));
        }
      }

      function makeOrbit(color, idx, total){
        const s = (idx/Math.max(1,total)) + Math.random()*0.01;
        const r0 = Math.min(W,H)* (0.06 + s*0.44) * (0.92 + Math.random()*0.18);
        const e  = 0.5 + Math.random()*0.45; // ellipse eccentricity
        const ang= Math.random()*Math.PI*2;
        return {
          color,
          radius: r0,
          ecc: e,
          spin: (Math.random()<0.5?-1:1) * (0.08 + Math.random()*0.45),
          phase: ang,
          width: 0.6 + Math.random()*1.6,
          glow: 12 + Math.random()*34
        };
      }

      function tilt(){
        ptr.x += (ptr.tx - ptr.x)*0.08;
        ptr.y += (ptr.ty - ptr.y)*0.08;
        const tx = (ptr.y - 0.5) * -10;
        const ty = (ptr.x - 0.5) * 10;
        frame.style.setProperty('--rx', tx.toFixed(2)+'deg');
        frame.style.setProperty('--ry', ty.toFixed(2)+'deg');
        root.style.setProperty('--mx', (ptr.x*100)+'%');
        root.style.setProperty('--my', (ptr.y*100)+'%');
      }

      function clearFrame(){
        if(motion){
          ctx.globalCompositeOperation = 'source-over';
          const theme = root.dataset.theme;
          const fade = theme==='void' ? 'rgba(8,12,20,0.12)' : 'rgba(255,255,255,0.10)';
          ctx.fillStyle = fade;
          ctx.fillRect(0,0,W,H);
        }else{
          ctx.clearRect(0,0,W,H);
          const base = root.dataset.theme==='void' ? '#0b1220' : '#ffffff';
          ctx.fillStyle = base; ctx.fillRect(0,0,W,H);
        }
      }

      function drawGrid(){
        ctx.save();
        const g = ctx.createLinearGradient(0,0,W,H);
        g.addColorStop(0, css('--p1'));
        g.addColorStop(1, css('--p3'));
        ctx.globalAlpha = 0.06;
        ctx.strokeStyle = g;
        ctx.lineWidth = 1;
        const step = Math.max(28, Math.min(64, Math.floor(Math.min(W,H)/18)));
        for(let a=0; a<Math.PI*2; a+=Math.PI/18){
          const cx=W/2, cy=H/2;
          const r = Math.max(W,H);
          ctx.beginPath();
          ctx.moveTo(cx, cy);
          ctx.lineTo(cx + Math.cos(a)*r, cy + Math.sin(a)*r);
          ctx.stroke();
        }
        ctx.globalAlpha = 0.06;
        for(let r=step; r<Math.max(W,H); r+=step){
          ctx.beginPath();
          ctx.arc(W/2, H/2, r, 0, Math.PI*2);
          ctx.stroke();
        }
        ctx.restore();
      }

      function drawOrbits(){
        tilt();
        const cx = W*0.5 + (ptr.x-0.5)*W*0.12;
        const cy = H*0.5 + (ptr.y-0.5)*H*0.12;

        ctx.save();
        ctx.globalCompositeOperation = 'lighter';

        for(const o of orbits){
          o.phase += o.spin * 0.008;
          const a = o.phase + t*o.spin*0.4;
          const rx = o.radius;
          const ry = o.radius * o.ecc;

          const x = cx + Math.cos(a)*rx;
          const y = cy + Math.sin(a)*ry;

          // trail arc
          ctx.beginPath();
          ctx.ellipse(cx, cy, rx, ry, 0, a-0.4, a+0.4);
          ctx.strokeStyle = o.color;
          ctx.lineWidth = o.width * 1.2;
          ctx.globalAlpha = 0.08;
          ctx.shadowBlur = 0;
          ctx.stroke();

          // glow comet
          ctx.beginPath();
          ctx.arc(x, y, 2 + o.width*0.8, 0, Math.PI*2);
          ctx.fillStyle = o.color;
          ctx.globalAlpha = 0.9;
          ctx.shadowColor = o.color;
          ctx.shadowBlur = o.glow;
          ctx.fill();

          // inner spark
          ctx.shadowBlur = 0;
          ctx.globalAlpha = 0.7;
          ctx.fillStyle = 'rgba(255,255,255,0.9)';
          ctx.beginPath(); ctx.arc(x, y, 1.2, 0, Math.PI*2); ctx.fill();
        }

        ctx.restore();
      }

      function pulse(){
        const r = frame.getBoundingClientRect();
        const x = r.width*ptr.x;
        const y = r.height*ptr.y;
        pulses.push({ x, y, t:0, life:1 });
      }

      function drawPulses(dt){
        for(let i=pulses.length-1;i>=0;i--){
          const p = pulses[i];
          p.t += dt*1.2;
          p.life -= dt*0.5;
          if(p.life<=0){ pulses.splice(i,1); continue; }
          const R = 10 + p.t*280;
          const g = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, R);
          g.addColorStop(0, 'rgba(255,255,255,'+(0.25*p.life).toFixed(3)+')');
          g.addColorStop(1, 'rgba(255,255,255,0.0)');
          ctx.globalCompositeOperation = 'lighter';
          ctx.globalAlpha = 0.8*p.life;
          ctx.fillStyle = g;
          ctx.beginPath(); ctx.arc(p.x, p.y, R, 0, Math.PI*2); ctx.fill();
        }
      }

      function drawOnce(){ draw(true); }
      function draw(staticOnly){
        clearFrame();
        drawGrid();
        drawOrbits();
        drawPulses(staticOnly?0:0.016);
      }

      function tick(now){
        if(!motion) return;
        const dt = Math.min(50, now - last)/1000;
        last = now; t += dt;
        if(ptr.down && Math.random() < 0.025) pulse();
        draw();
        raf = requestAnimationFrame(tick);
      }

      // Init
      resetScene();
      if(motion){ last = performance.now(); raf = requestAnimationFrame(tick); }
      else { drawOnce(); }

      // Interactions
      btnTheme.addEventListener('click', ()=>{
        themeIndex = (themeIndex + 1) % THEMES.length;
        setTheme(themeIndex);
        resetScene();
      });
      btnPlay.addEventListener('click', ()=>{
        motion = !motion;
        root.setAttribute('data-motion', motion ? 'on' : 'off');
        btnPlay.textContent = motion ? 'Play' : 'Pause';
        btnPlay.setAttribute('aria-pressed', String(motion));
        if(motion){ last = performance.now(); raf = requestAnimationFrame(tick); }
        else { drawOnce(); }
      });
      btnDens.addEventListener('click', ()=>{
        dIndex = (dIndex + 1) % DSET.length;
        btnDens.textContent = 'Density: ' + DLABELS[dIndex];
        btnDens.setAttribute('aria-pressed', String(dIndex>1));
        resetScene(); drawOnce();
      });
      btnSnap.addEventListener('click', ()=>{
        try{
          const link = document.createElement('a');
          link.download = (title.textContent || 'orbit-garden') + '.png';
          link.href = canvas.toDataURL('image/png');
          link.click();
        }catch(e){}
      });

      // Keyboard
      root.tabIndex = 0;
      root.addEventListener('keydown', (e)=>{
        const k = e.key.toLowerCase();
        if(k==='t') btnTheme.click();
        if(k==='p') btnPlay.click();
        if(k==='d') btnDens.click();
        if(k==='s') btnSnap.click();
        if(k===' '){ e.preventDefault(); pulse(); }
      });

      // Resize + visibility
      window.addEventListener('resize', ()=>{ resetScene(); drawOnce(); });
      document.addEventListener('visibilitychange', ()=>{
        if(document.hidden && raf){ cancelAnimationFrame(raf); }
        else if(!document.hidden && motion){ last = performance.now(); raf = requestAnimationFrame(tick); }
      });
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


