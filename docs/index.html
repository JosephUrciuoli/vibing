<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<style>
  .k821 {
    --ink: hsl(220 20% 96%);
    --muted: hsl(220 10% 78%);
    --bg1: hsl(245 65% 8%);
    --bg2: hsl(260 55% 12%);
    --edge: hsl(0 0% 100% / .18);
    --p1: 200 100% 60%;
    --p2: 310 90% 60%;
    --p3: 25 95% 56%;
    --depth: 16px;
    position: relative;
    color: var(--ink);
    border-radius: 32px;
    padding: clamp(20px, 4vw, 44px);
    background:
      radial-gradient(1400px 800px at -20% 120%, hsl(var(--p1) / .12), transparent 60%),
      radial-gradient(1200px 800px at 120% -20%, hsl(var(--p2) / .12), transparent 60%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
    box-shadow:
      0 60px 200px hsl(240 80% 4% / .55),
      inset 0 0 0 1px var(--edge);
    overflow: hidden;
    isolation: isolate;
  }
  .k821[data-theme="light"]{
    --ink: hsl(220 18% 12%);
    --muted: hsl(220 10% 40%);
    --bg1: hsl(220 60% 98%);
    --bg2: hsl(210 55% 94%);
    --edge: hsl(220 8% 25% / .16);
    box-shadow:
      0 40px 160px hsl(220 30% 30% / .18),
      inset 0 0 0 1px var(--edge);
  }
  .k821::after{
    content:"";
    position:absolute; inset:-35%;
    background:
      conic-gradient(from 0deg at 50% 50%,
        hsl(0 0% 100% / .06),
        transparent 20%,
        hsl(0 0% 100% / .08) 40%,
        transparent 66%,
        hsl(0 0% 100% / .06) 85%,
        transparent);
    filter: blur(18px);
    mix-blend-mode: soft-light;
    pointer-events:none;
  }

  /* Top */
  .k821-top{
    display:grid; grid-template-columns: 1fr auto; gap: 16px; align-items:center; position:relative; z-index:3;
  }
  .k821-title{ display:grid; gap: 8px; }
  .k821-title h1{
    margin:0;
    display:flex; align-items:baseline; gap:.4ch; flex-wrap:wrap;
    font: 900 clamp(28px, 8vw, 92px)/.9 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    letter-spacing:-.02em;
    background:
      linear-gradient(90deg, hsl(0 0% 100% / .96), hsl(0 0% 100% / .7)) padding-box,
      linear-gradient(120deg, hsl(var(--p1)), hsl(var(--p2)), hsl(var(--p3))) text;
    -webkit-background-clip: padding-box, text; background-clip: padding-box, text;
    color: transparent; -webkit-text-fill-color: transparent;
  }
  .k821-title h1 em{
    font-style: normal; opacity:.7;
    background: linear-gradient(120deg, hsl(var(--p2)), hsl(var(--p3))); -webkit-background-clip:text; background-clip:text;
  }
  .k821-title p{ margin:0; color: var(--muted); font: 600 clamp(12px, 1.6vw, 18px)/1.6 ui-sans, system-ui; }

  .k821-controls{ display:grid; grid-auto-flow:column; gap:10px; align-items:center; justify-content:end; }
  .k821 .pill{
    appearance:none; border:0; cursor:pointer; position:relative;
    display:inline-grid; grid-auto-flow:column; gap:8px; align-items:center;
    padding: 11px 14px; border-radius: 999px;
    color: var(--ink);
    background: linear-gradient(180deg, hsl(0 0% 100% / .12), hsl(0 0% 100% / .06));
    border: 1px solid var(--edge);
    box-shadow: 0 16px 34px hsl(240 80% 4% / .45), inset 0 1px 0 hsl(0 0% 100% / .18);
    font: 800 12px/1 ui-sans-serif, system-ui;
    transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
  }
  .k821[data-theme="light"] .pill{
    background: linear-gradient(180deg, hsl(0 0% 100% / .65), hsl(0 0% 100% / .35));
    box-shadow: 0 16px 30px hsl(220 40% 20% / .10), inset 0 1px 0 hsl(0 0% 100% / .55);
  }
  .k821 .pill:hover{ transform: translateY(-2px); }
  .k821 .pill .ink{ position:absolute; inset:0; border-radius:inherit; pointer-events:none; opacity:0; transition:opacity .16s ease;
    background: radial-gradient(200px 200px at var(--mx,50%) var(--my,50%), hsl(0 0% 100% / .22), transparent 60%); }
  .k821 .pill:hover .ink{ opacity:1; }

  .k821 .knob{
    display:inline-grid; grid-template-columns:auto 1fr; gap:10px; align-items:center;
    padding: 8px 12px; border-radius: 14px;
    background: linear-gradient(180deg, hsl(0 0% 100% / .10), hsl(0 0% 100% / .05));
    border:1px solid var(--edge);
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .25);
    color: var(--ink);
    font: 700 12px/1 ui-sans-serif, system-ui;
  }
  .k821 input[type="range"]{ -webkit-appearance:none; appearance:none; width: 140px; height: 28px; background: transparent; }
  .k821 input[type="range"]::-webkit-slider-runnable-track{
    height:8px; border-radius:999px; background: linear-gradient(90deg, hsl(var(--p1)), hsl(var(--p2)), hsl(var(--p3)));
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .4);
  }
  .k821 input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none; appearance:none; width:18px; height:18px; border-radius:50%;
    background:white; border:1px solid var(--edge); margin-top:-5px;
    box-shadow: 0 6px 14px hsl(240 30% 6% / .35);
  }
  .k821 input[type="range"]::-moz-range-track{ height:8px; border-radius:999px; background: linear-gradient(90deg, hsl(var(--p1)), hsl(var(--p2)), hsl(var(--p3))); }
  .k821 input[type="range"]::-moz-range-thumb{ width:18px; height:18px; border-radius:50%; background:white; border:1px solid var(--edge); }

  /* Stage */
  .k821-stage{
    position: relative; margin-top: clamp(10px, 2vw, 20px);
    min-height: min(78vh, 740px);
    border-radius: 24px; overflow:hidden;
    border: 1px solid var(--edge);
    background: linear-gradient(180deg, hsl(0 0% 100% / .06), hsl(0 0% 0% / .12));
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .14), 0 40px 140px hsl(240 60% 4% / .25);
  }
  .k821[data-theme="light"] .k821-stage{
    background: linear-gradient(180deg, hsl(0 0% 100% / .65), hsl(0 0% 100% / .35));
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .55), 0 34px 120px hsl(220 30% 30% / .16);
  }

  /* Stars canvas */
  .k821-stars{ position:absolute; inset:0; z-index:0; opacity:.9; }

  /* Orbital sculpture */
  .orb{
    --tiltX: 0deg; --tiltY: 0deg; --z: translateZ(0);
    position:absolute; inset: 10% 10% auto auto; left: 50%; top: 52%;
    width: clamp(260px, 32vmin, 420px); aspect-ratio: 1 / 1; border-radius: 50%;
    transform: translate(-50%, -50%) rotateX(var(--tiltY)) rotateY(var(--tiltX));
    transform-style: preserve-3d;
    display:grid; place-items:center;
    z-index:2;
  }
  .orb .glow{
    position:absolute; inset:8%;
    border-radius:50%;
    background:
      radial-gradient(closest-side at 50% 45%, hsl(var(--p1) / .45), transparent 70%),
      radial-gradient(closest-side at 40% 60%, hsl(var(--p2) / .45), transparent 70%),
      radial-gradient(closest-side at 60% 50%, hsl(var(--p3) / .45), transparent 80%);
    filter: blur(10px) saturate(120%);
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .25), 0 40px 120px hsl(240 60% 4% / .35);
    border: 1px solid var(--edge);
    background-blend-mode: screen;
  }
  .ring{
    position:absolute; inset:0; border-radius:50%;
    background:
      conic-gradient(from 0deg, hsl(var(--p1) / .8), hsl(var(--p2) / .8), hsl(var(--p3) / .8), hsl(var(--p1) / .8));
    mask: radial-gradient(closest-side, transparent calc(50% - 2px), white calc(50% - 1px));
    opacity:.9; filter: saturate(120%) brightness(1.05);
    transform: translateZ(1px);
  }
  .ring.r1{ inset: -2%; }
  .ring.r2{ inset: -10%; opacity:.7; filter: blur(0.2px) saturate(130%); }
  .ring.r3{ inset: -18%; opacity:.5; filter: blur(0.6px) saturate(150%); }

  .node{
    position:absolute; width: 12px; height:12px; border-radius:50%;
    background: white; box-shadow: 0 0 0 2px hsl(0 0% 100% / .4), 0 12px 24px hsl(240 70% 4% / .6);
    transform: translate(-50%, -50%);
  }
  .n1{ left: 50%; top: 6%; background: hsl(var(--p1)); }
  .n2{ left: 92%; top: 50%; background: hsl(var(--p2)); }
  .n3{ left: 50%; top: 94%; background: hsl(var(--p3)); }

  .orb .label{
    position:absolute; inset:auto; bottom:-56px; left:50%; transform: translateX(-50%);
    font: 800 clamp(12px, 1.6vw, 14px)/1 ui-sans-serif, system-ui; letter-spacing:.22em;
    color: var(--muted);
    background: linear-gradient(90deg, hsl(var(--p1) / .9), hsl(var(--p2) / .9), hsl(var(--p3) / .9));
    -webkit-background-clip: text; background-clip: text; color: transparent; -webkit-text-fill-color: transparent;
  }

  /* Caption card */
  .caption{
    position: absolute; z-index:3; left: 50%; bottom: clamp(18px, 4vw, 40px); transform: translateX(-50%);
    display:grid; gap: clamp(8px, 2vw, 16px); text-align:center;
    padding: clamp(16px, 3vw, 24px) clamp(18px, 3vw, 30px);
    border-radius: 16px; border: 1px solid var(--edge);
    background: linear-gradient(180deg, hsl(0 0% 100% / .08), hsl(0 0% 0% / .10));
    box-shadow: 0 24px 60px hsl(240 60% 4% / .30), inset 0 1px 0 hsl(0 0% 100% / .18);
    backdrop-filter: blur(6px) saturate(120%);
    max-width: min(90%, 800px);
  }
  .k821[data-theme="light"] .caption{
    background: linear-gradient(180deg, hsl(0 0% 100% / .65), hsl(0 0% 100% / .45));
    box-shadow: 0 24px 60px hsl(220 40% 30% / .12), inset 0 1px 0 hsl(0 0% 100% / .55);
  }
  .caption h2{
    margin:0;
    font: 900 clamp(22px, 6vw, 56px)/1.02 ui-sans-serif, system-ui;
    letter-spacing:-0.01em;
    background: linear-gradient(90deg, hsl(var(--p1)), hsl(var(--p2)), hsl(var(--p3)));
    -webkit-background-clip: text; background-clip:text; color: transparent; -webkit-text-fill-color: transparent;
  }
  .caption p{ margin:0; color: var(--muted); font: 600 clamp(13px, 1.6vw, 18px)/1.6 ui-sans-serif, system-ui; }
  .actions{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }

  /* Ripples */
  .pulse{
    position:absolute; border: 2px solid hsl(var(--h, var(--p2)) / .45);
    border-radius:50%; pointer-events:none; mix-blend-mode: overlay; z-index:2;
    left:var(--rx); top:var(--ry); width:2px; height:2px; transform: translate(-50%, -50%);
    animation: ring 1400ms ease-out forwards;
  }
  @keyframes ring{
    from{ opacity:.45; transform: translate(-50%,-50%) scale(1); }
    to{ opacity:0; transform: translate(-50%,-50%) scale(200); }
  }

  /* Footer */
  .k821-foot{
    position:relative; z-index:3; margin-top: clamp(16px, 3vw, 24px);
    display:flex; justify-content:space-between; align-items:center; gap:12px;
    color: var(--muted); font: 500 12px/1.4 ui-sans-serif, system-ui;
  }
  .hint{
    font: 700 11px/1 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    background: hsl(0 0% 100% / .10);
    border: 1px solid var(--edge);
    padding: 6px 8px; border-radius: 8px; color: var(--ink);
  }
  .k821[data-theme="light"] .hint{ background: hsl(0 0% 0% / .06); }

  /* Tooltips */
  .k821 .pill[data-tip]::after{
    content: attr(data-tip);
    position:absolute; bottom: calc(100% + 8px); left:50%; transform: translate(-50%, 4px);
    background: hsl(0 0% 0% / .8); color: white; padding:6px 8px; border-radius:6px;
    font: 700 10px/1 ui-sans-serif; opacity:0; pointer-events:none; white-space:nowrap;
    transition: opacity .18s ease, transform .18s ease;
  }
  .k821 .pill:hover::after{ opacity:1; transform: translate(-50%, 0); }
</style>

<div class="k821" id="k821" data-theme="dark" aria-live="polite">
  <div class="k821-top">
    <div class="k821-title">
      <h1><span>KINETIC</span> <em>821</em></h1>
      <p>Generative motion poster. Tilt, orbit, and pulse the light.</p>
    </div>
    <div class="k821-controls" role="group" aria-label="Controls">
      <button class="pill" id="k821-theme" type="button" data-tip="Toggle theme"><span class="ink" aria-hidden="true"></span>Day / Night</button>
      <button class="pill" id="k821-pal" type="button" data-tip="Cycle palettes"><span class="ink" aria-hidden="true"></span>Palette</button>
      <span class="knob" aria-label="Tempo">
        <span>Tempo</span>
        <input id="k821-tempo" type="range" min="0" max="100" value="58" aria-label="Animation tempo">
      </span>
      <button class="pill" id="k821-freeze" type="button" aria-pressed="false" data-tip="Pause / Resume"><span class="ink" aria-hidden="true"></span>Freeze</button>
    </div>
  </div>

  <div class="k821-stage" id="k821-stage" aria-label="Kinetic stage">
    <canvas class="k821-stars" id="k821-stars" aria-hidden="true"></canvas>

    <div class="orb" id="k821-orb" aria-hidden="true">
      <div class="ring r1"></div>
      <div class="ring r2"></div>
      <div class="ring r3"></div>
      <div class="glow"></div>
      <div class="node n1"></div>
      <div class="node n2"></div>
      <div class="node n3"></div>
      <div class="label">DRIFT</div>
    </div>

    <div class="caption" aria-live="polite">
      <h2>Drift. Orbit. Repeat.</h2>
      <p>Press Pulse to send a shockwave. Drag across the field to tilt the orbit.</p>
      <div class="actions">
        <button class="pill" id="k821-pulse" type="button"><span class="ink" aria-hidden="true"></span>Pulse</button>
        <button class="pill" id="k821-scramble" type="button"><span class="ink" aria-hidden="true"></span>Scramble</button>
      </div>
    </div>
  </div>

  <div class="k821-foot">
    <span class="hint" aria-hidden="true">Tip: Higher Tempo speeds orbit and star drift. Pulse near the edges for dramatic rings.</span>
    <span id="last-updated">Last updated: 2025-11-23 02:16:47 EST</span>
  </div>
</div>

<script>
(function(){
  const root = document.getElementById('k821');
  const stage = document.getElementById('k821-stage');
  const orb = document.getElementById('k821-orb');
  const stars = document.getElementById('k821-stars');
  const ctx = stars.getContext('2d');
  const tempo = document.getElementById('k821-tempo');
  const updated = document.getElementById('last-updated');

  const btnTheme = document.getElementById('k821-theme');
  const btnPal = document.getElementById('k821-pal');
  const btnFreeze = document.getElementById('k821-freeze');
  const btnPulse = document.getElementById('k821-pulse');
  const btnScramble = document.getElementById('k821-scramble');

  // Timestamp
  try{
    const now = new Date();
    const opts = { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' };
    updated.textContent = 'Last updated: ' + now.toLocaleString(undefined, opts);
  }catch{ updated.textContent = 'Last updated: just now'; }

  // Palettes
  const palettes = [
    { name:'Ion', p1:[200,100,60], p2:[310,90,60], p3:[25,95,56], bg1:'hsl(245 65% 8%)', bg2:'hsl(260 55% 12%)' },
    { name:'Quartz', p1:[280,90,66], p2:[180,85,56], p3:[340,85,62], bg1:'hsl(252 60% 96%)', bg2:'hsl(210 55% 94%)' },
    { name:'Verdigris', p1:[170,85,50], p2:[200,90,58], p3:[45,95,56], bg1:'hsl(165 50% 95%)', bg2:'hsl(190 55% 92%)' },
    { name:'Magma', p1:[18,95,56], p2:[12,90,60], p3:[320,90,64], bg1:'hsl(22 65% 96%)', bg2:'hsl(10 60% 94%)' },
    { name:'Ultraviolet', p1:[260,95,62], p2:[300,88,60], p3:[190,88,56], bg1:'hsl(258 50% 95%)', bg2:'hsl(240 55% 92%)' }
  ];
  let palIndex = 0;
  function setPalette(p){
    root.style.setProperty('--p1', `${p.p1[0]} ${p.p1[1]}% ${p.p1[2]}%`);
    root.style.setProperty('--p2', `${p.p2[0]} ${p.p2[1]}% ${p.p2[2]}%`);
    root.style.setProperty('--p3', `${p.p3[0]} ${p.p3[1]}% ${p.p3[2]}%`);
    if (root.getAttribute('data-theme') === 'light'){
      root.style.setProperty('--bg1', p.bg1);
      root.style.setProperty('--bg2', p.bg2);
    }
  }
  setPalette(palettes[palIndex]);

  // Button ink hover
  function ink(e){
    const b = e.currentTarget.getBoundingClientRect();
    e.currentTarget.style.setProperty('--mx', ((e.clientX - b.left)/b.width)*100 + '%');
    e.currentTarget.style.setProperty('--my', ((e.clientY - b.top)/b.height)*100 + '%');
  }
  root.querySelectorAll('.pill').forEach(b => b.addEventListener('pointermove', ink, { passive:true }));

  // Canvas stars
  let DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  let W = 0, H = 0, STAR_COUNT = 0, field = [];
  let parX = 0, parY = 0;

  function resize(){
    const r = stage.getBoundingClientRect();
    W = Math.floor(r.width); H = Math.floor(r.height);
    DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    stars.width = W * DPR; stars.height = H * DPR;
    stars.style.width = W + 'px'; stars.style.height = H + 'px';
    ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
    STAR_COUNT = Math.floor((W*H) / 9000);
    field = new Array(STAR_COUNT).fill(0).map(()=>({
      x: Math.random()*W,
      y: Math.random()*H,
      s: Math.random()*1.2 + 0.3,
      v: Math.random()*0.2 + 0.05,
      hue: Math.random()
    }));
  }
  window.addEventListener('resize', resize);
  resize();

  function drawStars(dt, speed){
    const dark = root.getAttribute('data-theme') !== 'light';
    ctx.clearRect(0,0,W,H);
    for (let i=0;i<field.length;i++){
      const st = field[i];
      st.x += st.v * (0.4 + speed*0.6);
      st.y += Math.sin((st.x + st.y)*0.002) * 0.08;
      if (st.x > W + 20) st.x = -20;
      const sx = st.x + (parX - W/2) * 0.02;
      const sy = st.y + (parY - H/2) * 0.02;

      const color = dark ? `hsla(${(st.hue*360)|0} 40% 70% / .9)` : `hsla(${(st.hue*360)|0} 30% 35% / .8)`;
      ctx.beginPath();
      ctx.fillStyle = color;
      ctx.arc(sx, sy, st.s*(dark?1.0:0.8), 0, Math.PI*2);
      ctx.fill();
    }
  }

  // Motion loop
  let paused = false;
  let rot1 = Math.random()*360, rot2 = Math.random()*360, rot3 = Math.random()*360;
  let last = performance.now();
  function tick(now){
    const dt = Math.min(0.033, (now - last)/1000);
    last = now;
    if(!paused){
      const spd = 0.2 + (parseInt(tempo.value,10)/100) * 2.0;
      rot1 += 8 * spd * dt;
      rot2 -= 12 * spd * dt;
      rot3 += 18 * spd * dt;
      orb.querySelector('.r1').style.transform = `translateZ(1px) rotate(${rot1}deg)`;
      orb.querySelector('.r2').style.transform = `translateZ(2px) rotate(${rot2}deg) scale(1.04)`;
      orb.querySelector('.r3').style.transform = `translateZ(3px) rotate(${rot3}deg) scale(1.08)`;
      drawStars(dt, spd);
    }
    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);

  // Tilt with pointer
  let active = false;
  stage.addEventListener('pointerenter', ()=> active = true, { passive:true });
  stage.addEventListener('pointerleave', ()=> { active = false; orb.style.setProperty('--tiltX', '0deg'); orb.style.setProperty('--tiltY', '0deg'); }, { passive:true });
  stage.addEventListener('pointermove', (e)=>{
    const r = stage.getBoundingClientRect();
    parX = e.clientX - r.left; parY = e.clientY - r.top;
    if(!active) return;
    const nx = (parX / r.width - 0.5);
    const ny = (parY / r.height - 0.5);
    orb.style.setProperty('--tiltX', (nx * 10) + 'deg');
    orb.style.setProperty('--tiltY', (-ny * 10) + 'deg');
  }, { passive:true });

  // Pulse
  function pulseAt(x, y){
    const ring = document.createElement('span');
    ring.className = 'pulse';
    ring.style.setProperty('--rx', x + 'px');
    ring.style.setProperty('--ry', y + 'px');
    const pick = ['var(--p1)','var(--p2)','var(--p3)'][Math.floor(Math.random()*3)];
    ring.style.setProperty('--h', pick);
    stage.appendChild(ring);
    ring.addEventListener('animationend', ()=> ring.remove());
  }
  btnPulse.addEventListener('click', ()=>{
    const r = stage.getBoundingClientRect();
    pulseAt(r.width/2, r.height*0.55);
  });
  stage.addEventListener('pointerdown', (e)=>{
    const r = stage.getBoundingClientRect();
    pulseAt(e.clientX - r.left, e.clientY - r.top);
  });

  // Theme toggle
  btnTheme.addEventListener('click', ()=>{
    const isLight = root.getAttribute('data-theme') === 'light';
    root.setAttribute('data-theme', isLight ? 'dark' : 'light');
    // Refresh palette BG bindings for light
    setPalette(palettes[palIndex]);
  });

  // Palette cycle
  btnPal.addEventListener('click', ()=>{
    palIndex = (palIndex + 1) % palettes.length;
    setPalette(palettes[palIndex]);
  });

  // Freeze
  btnFreeze.addEventListener('click', ()=>{
    paused = !paused;
    btnFreeze.setAttribute('aria-pressed', String(paused));
    btnFreeze.textContent = paused ? 'Resume' : 'Freeze';
    const ink = document.createElement('span'); ink.className = 'ink'; btnFreeze.prepend(ink);
  });

  // Scramble
  btnScramble.addEventListener('click', ()=>{
    tempo.value = Math.floor(Math.random()*101);
    palIndex = Math.floor(Math.random()*palettes.length);
    setPalette(palettes[palIndex]);
    // random kicks for ring angles
    rot1 = Math.random()*360; rot2 = Math.random()*360; rot3 = Math.random()*360;
  });

  // Reduced motion
  const media = window.matchMedia('(prefers-reduced-motion: reduce)');
  function setReduced(state){
    paused = !!state;
    btnFreeze.setAttribute('aria-pressed', String(paused));
    btnFreeze.textContent = paused ? 'Resume' : 'Freeze';
  }
  setReduced(media.matches);
  media.addEventListener?.('change', e => setReduced(e.matches));
})();
</script>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


