<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="observatory" aria-label="Lucid Observatory">
  <style>
    /* Scope everything to #observatory */
    #observatory {
      --bg-1: hsl(220 60% 98%);
      --bg-2: hsl(204 100% 96%);
      --ink: hsl(222 21% 12%);
      --muted: hsl(222 12% 40%);
      --card: hsl(0 0% 100% / .55);
      --stroke: hsl(220 20% 20% / .08);
      --accent: 268;
      --glow: 0 18px 40px hsl(0 0% 0% / .18), inset 0 1px 0 hsl(0 0% 100% / .6);
      position: relative;
      min-height: 72vh;
      border-radius: 32px;
      overflow: hidden;
      padding: clamp(18px, 3.6vw, 36px);
      color: var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Text", Inter, Segoe UI, Roboto, Arial;
      letter-spacing: .1px;
      background:
        radial-gradient(1200px 900px at 120% -10%, hsl(calc(var(--accent)+40) 100% 90% / .55), transparent 60%),
        radial-gradient(1000px 1000px at -20% 120%, hsl(calc(var(--accent)-60) 100% 88% / .45), transparent 55%),
        linear-gradient(180deg, var(--bg-1), var(--bg-2));
      isolation: isolate;
    }

    /* Ambient rings */
    #observatory .ambient { position: absolute; inset: -10% -20%; z-index: 0; pointer-events: none; filter: blur(40px) saturate(110%); }
    #observatory .ring {
      position: absolute; aspect-ratio: 1; border-radius: 50%;
      background: conic-gradient(from 0deg,
        hsl(calc(var(--accent) + 20) 90% 70% / .5),
        hsl(calc(var(--accent) + 120) 90% 72% / .5),
        hsl(calc(var(--accent) + 240) 80% 68% / .5),
        hsl(calc(var(--accent) + 20) 90% 70% / .5));
      opacity: .25; mix-blend-mode: multiply;
      animation: orbit 38s linear infinite;
    }
    #observatory .ring.r1 { width: 80vmax; left: -20vmax; top: -30vmax; }
    #observatory .ring.r2 { width: 60vmax; right: -15vmax; bottom: -20vmax; animation-duration: 54s; }
    @keyframes orbit { to { transform: rotate(360deg); } }

    /* Topbar */
    #observatory .top {
      position: relative; z-index: 2;
      display: grid; grid-template-columns: 1fr auto; gap: 14px; align-items: center;
      margin-bottom: clamp(8px, 2vw, 16px);
    }
    #observatory .brand {
      display: inline-flex; align-items: center; gap: 12px; text-transform: uppercase; font-weight: 800;
      font-size: 12px; letter-spacing: .5px; opacity: .92;
    }
    #observatory .compass {
      width: 22px; height: 22px; border-radius: 12px; position: relative;
      background: radial-gradient(circle at 35% 35%, #fff 0 20%, hsl(var(--accent) 80% 70%) 55%, hsl(var(--accent) 80% 58%));
      box-shadow: 0 0 0 1px hsl(0 0% 100% / .65) inset, 0 0 22px hsl(var(--accent) 100% 58% / .45);
      overflow: hidden;
    }
    #observatory .compass::after {
      content: ""; position: absolute; inset: 2px; border-radius: 50%;
      border: 2px solid hsl(0 0% 100% / .65); border-top-color: transparent; border-right-color: transparent;
      animation: spin 14s linear infinite;
      filter: drop-shadow(0 0 6px hsl(var(--accent) 90% 60% / .6));
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Control panel */
    #observatory .panel {
      display: inline-flex; align-items: center; gap: 12px; flex-wrap: wrap;
      padding: 10px 12px; border-radius: 16px;
      background: var(--card); border: 1px solid var(--stroke);
      backdrop-filter: blur(12px) saturate(140%); box-shadow: var(--glow);
    }
    #observatory .panel label {
      display: inline-flex; align-items: center; gap: 8px; color: var(--muted); font-size: 12px; white-space: nowrap;
    }
    #observatory input[type="range"] {
      appearance: none; width: 140px; height: 4px; border-radius: 999px; background: hsl(0 0% 0% / .12); outline: none;
    }
    #observatory input[type="range"]::-webkit-slider-thumb {
      appearance: none; width: 16px; height: 16px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, white 0 15%, hsl(var(--accent) 90% 65%) 55%, hsl(var(--accent) 90% 55%));
      border: 1px solid hsl(0 0% 100% / .5); box-shadow: 0 6px 16px hsl(var(--accent) 70% 50% / .35); cursor: pointer;
    }
    #observatory .toggle {
      appearance: none; width: 44px; height: 24px; border-radius: 999px; position: relative; outline: none; cursor: pointer;
      background: hsl(0 0% 0% / .12); border: 1px solid var(--stroke);
      transition: background .2s ease, box-shadow .2s ease;
    }
    #observatory .toggle::after {
      content: ""; position: absolute; top: 50%; left: 3px; transform: translateY(-50%);
      width: 18px; height: 18px; border-radius: 50%;
      background: linear-gradient(180deg, #fff, #eaeaea);
      box-shadow: 0 2px 6px hsl(0 0% 0% / .2);
      transition: left .22s ease, background .22s ease;
    }
    #observatory .toggle:checked { background: hsl(var(--accent) 80% 60% / .7); box-shadow: 0 8px 18px hsl(var(--accent) 80% 50% / .35); }
    #observatory .toggle:checked::after { left: 23px; background: #fff; }

    #observatory .btn {
      position: relative; overflow: hidden; border-radius: 12px; border: 1px solid var(--stroke);
      padding: 10px 14px; font-weight: 700; letter-spacing: .2px; cursor: pointer;
      background: hsl(0 0% 0% / .06); color: var(--ink);
      transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
      user-select: none;
    }
    #observatory .btn.primary {
      background: linear-gradient(180deg, hsl(var(--accent) 85% 55%), hsl(var(--accent) 85% 50%));
      color: white; box-shadow: 0 12px 28px hsl(var(--accent) 80% 50% / .35), inset 0 1px 0 hsl(0 0% 100% / .3);
    }
    #observatory .btn:hover { transform: translateY(-1px); box-shadow: 0 12px 24px hsl(0 0% 0% / .18); }

    /* Hero */
    #observatory .hero { position: relative; z-index: 2; margin: 6px 0 14px; }
    #observatory .title {
      margin: 0; line-height: .96;
      font-size: clamp(40px, 6.6vw, 92px); letter-spacing: .3px; font-weight: 900;
      background: linear-gradient(90deg, hsl(220 22% 20%), hsl(calc(var(--accent)-30) 35% 24%) 60%, hsl(210 28% 22%));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      filter: drop-shadow(0 14px 32px hsl(var(--accent) 70% 52% / .2));
    }
    #observatory .subtitle { margin: 8px 0 0; color: var(--muted); font-size: clamp(14px, 2.1vw, 18px); max-width: 72ch; }

    /* Stage: hex glass */
    #observatory .stage {
      position: relative; z-index: 2; margin-top: 10px;
      border-radius: 26px; overflow: visible;
      transform-style: preserve-3d; perspective: 1000px;
    }
    #observatory .frame {
      position: relative; border-radius: 24px; padding: clamp(10px, 1.8vw, 16px);
      background: var(--card); border: 1px solid var(--stroke);
      box-shadow: 0 22px 44px hsl(0 0% 0% / .16), inset 0 1px 0 hsl(0 0% 100% / .5);
      transition: transform .25s ease;
    }
    #observatory .hex {
      position: relative; width: 100%; aspect-ratio: 5 / 3; border-radius: 20px; overflow: hidden;
      clip-path: polygon(8% 0, 92% 0, 100% 50%, 92% 100%, 8% 100%, 0 50%);
      background: radial-gradient(120% 120% at 50% 20%, hsl(0 0% 100% / .1), transparent 60%);
    }
    #observatory canvas.sky {
      position: absolute; inset: 0; width: 100%; height: 100%; display: block;
    }
    #observatory .grid {
      position: absolute; inset: 0; pointer-events: none; opacity: .18; mix-blend-mode: multiply;
      background:
        linear-gradient(to right, rgba(0,0,0,.07) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(0,0,0,.07) 1px, transparent 1px);
      background-size: 60px 100%, 100% 60px;
    }
    #observatory .rim {
      position: absolute; inset: 8px; border-radius: 18px; pointer-events: none;
      box-shadow: inset 0 0 0 1px hsl(0 0% 100% / .6), inset 0 0 0 2px hsl(0 0% 0% / .04);
      clip-path: polygon(8% 0, 92% 0, 100% 50%, 92% 100%, 8% 100%, 0 50%);
    }

    /* Actions */
    #observatory .actions { position: relative; z-index: 2; display: flex; gap: 10px; flex-wrap: wrap; margin-top: 12px; }

    /* Footer */
    #observatory .foot {
      position: relative; z-index: 2; margin-top: 14px; color: hsl(222 14% 26% / .9);
      display: flex; align-items: center; gap: 10px; flex-wrap: wrap; font-size: 12px;
    }
    #observatory .chip {
      padding: 8px 10px; border-radius: 999px; background: var(--card);
      border: 1px solid var(--stroke); color: var(--muted); font-size: 12px; backdrop-filter: blur(8px);
    }

    /* Night theme */
    #observatory.night {
      --bg-1: hsl(235 50% 7%);
      --bg-2: hsl(235 50% 5%);
      --ink: hsl(0 0% 98%);
      --muted: hsl(0 0% 90% / .78);
      --card: hsl(0 0% 100% / .06);
      --stroke: hsl(0 0% 100% / .12);
      background:
        radial-gradient(1100px 900px at -20% -10%, hsl(calc(var(--accent) + 60) 80% 14% / .55), transparent 55%),
        radial-gradient(1100px 900px at 120% 130%, hsl(calc(var(--accent) - 60) 80% 16% / .55), transparent 55%),
        linear-gradient(180deg, var(--bg-1), var(--bg-2));
    }
    #observatory.night .grid { opacity: .28; mix-blend-mode: screen; }
    #observatory.night .btn { background: hsl(0 0% 100% / .08); }

    /* Responsive */
    @media (max-width: 760px) {
      #observatory .panel { width: 100%; justify-content: space-between; }
      #observatory input[type="range"] { width: 110px; }
      #observatory .hex { aspect-ratio: 4 / 3; }
    }
    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      #observatory .ring, #observatory .compass::after { animation: none !important; }
    }
  </style>

  <div class="ambient" aria-hidden="true">
    <div class="ring r1"></div>
    <div class="ring r2"></div>
  </div>

  <div class="top">
    <div class="brand" aria-label="Lucid Observatory">
      <span class="compass" aria-hidden="true"></span>
      <span>Observatory</span>
    </div>
    <div class="panel" role="group" aria-label="Controls">
      <label for="dens">Density
        <input id="dens" type="range" min="10" max="100" value="55" aria-label="Star density">
      </label>
      <label for="grav">Gravity
        <input id="grav" type="range" min="0" max="100" value="40" aria-label="Pointer gravity">
      </label>
      <label for="link">Link Radius
        <input id="link" type="range" min="20" max="200" value="120" aria-label="Connection radius">
      </label>
      <label for="constellate">Constellate
        <input id="constellate" class="toggle" type="checkbox" checked aria-label="Toggle constellations">
      </label>
      <button class="btn" id="theme" title="Toggle day/night">Night</button>
    </div>
  </div>

  <section class="hero" aria-label="Intro">
    <h1 class="title">Lucid Constellations</h1>
    <p class="subtitle">An interactive starfield in a glass hexagon. Pull space with your cursor; click to launch meteors. Pure canvas—no libraries.</p>
  </section>

  <div class="stage" id="stage" aria-label="Interactive Starfield">
    <div class="frame" id="frame">
      <div class="hex">
        <canvas class="sky"></canvas>
        <div class="grid"></div>
        <div class="rim"></div>
      </div>
    </div>
  </div>

  <div class="actions">
    <button class="btn primary" id="pause" data-ripple>Pause</button>
    <button class="btn" id="shuffle" data-ripple>Shuffle Hue</button>
    <button class="btn" id="reset" data-ripple>Reset</button>
    <button class="btn" id="save" data-ripple>Snapshot</button>
  </div>

  <div class="foot">
    <span class="chip">Glass Hex Frame</span>
    <span class="chip">Constellation Links</span>
    <span class="chip">Day/Night</span>
    <span class="chip">Reduced Motion Friendly</span>
    <span style="margin-left:auto;color:var(--muted);">Refreshed</span>
    <span id="last-updated">Last updated: 2025-11-01 04:20:16 EST</span>
  </div>

  <script>
    (() => {
      const root = document.getElementById('observatory');
      const frame = root.querySelector('#frame');
      const stage = root.querySelector('#stage');
      const canvas = root.querySelector('canvas.sky');
      const ctx = canvas.getContext('2d', { alpha: true });

      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      const reduced = window.matchMedia?.('(prefers-reduced-motion: reduce)')?.matches;

      // Controls
      const densEl = root.querySelector('#dens');
      const gravEl = root.querySelector('#grav');
      const linkEl = root.querySelector('#link');
      const constelEl = root.querySelector('#constellate');
      const themeBtn = root.querySelector('#theme');
      const pauseBtn = root.querySelector('#pause');
      const shuffleBtn = root.querySelector('#shuffle');
      const resetBtn = root.querySelector('#reset');
      const saveBtn = root.querySelector('#save');

      // Timestamp
      const stamp = root.querySelector('#last-updated');
      try {
        const now = new Date();
        stamp.textContent = new Intl.DateTimeFormat(undefined, {
          year: 'numeric', month: 'short', day: '2-digit',
          hour: '2-digit', minute: '2-digit', second: '2-digit',
          hour12: false, timeZoneName: 'short'
        }).format(now);
      } catch { stamp.textContent = new Date().toLocaleString(); }

      // Params
      let W = 0, H = 0, running = true, t0 = 0;
      let density = (+densEl.value) / 100;  // 0.1..1.0
      let gravity = (+gravEl.value) / 100;  // 0..1
      let linkR = (+linkEl.value);          // px
      let doLinks = constelEl.checked;

      const pointer = { x: 0, y: 0, active: false };
      let hue = +getComputedStyle(root).getPropertyValue('--accent') || 268;

      // Stars
      let N = 0;
      let stars = [];
      let streaks = [];

      function randRange(a, b) { return a + Math.random() * (b - a); }

      function seedStars() {
        stars.length = 0;
        const base = 0.00022; // density per px^2
        N = Math.floor((W * H) * base * (0.4 + density * 1.6));
        N = Math.max(180, Math.min(2600, N));
        for (let i = 0; i < N; i++) {
          const s = {
            x: Math.random() * W,
            y: Math.random() * H,
            vx: randRange(-0.25, 0.25),
            vy: randRange(-0.25, 0.25),
            r: randRange(0.6, 1.8) * (reduced ? 0.8 : 1),
            tw: Math.random() * Math.PI * 2, // twinkle phase
            o: randRange(0.4, 0.9)
          };
          stars.push(s);
        }
      }

      function sizeCanvas() {
        const rect = frame.getBoundingClientRect();
        W = Math.max(320, Math.floor(rect.width - 20));
        H = Math.max(240, Math.floor(rect.height - 20));
        canvas.width = Math.floor(W * dpr);
        canvas.height = Math.floor(H * dpr);
        canvas.style.width = W + 'px';
        canvas.style.height = H + 'px';
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        ctx.clearRect(0, 0, W, H);
        seedStars();
      }

      function softClear() {
        // leave gentle trails in night; cleaner in day
        const isNight = root.classList.contains('night');
        const alpha = isNight ? 0.08 : 0.16;
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = `rgba(0,0,0,${alpha})`;
        ctx.fillRect(0, 0, W, H);
      }

      function drawStar(s, t) {
        const twinkle = 0.6 + 0.4 * Math.sin(s.tw + t * 0.002 + s.x * 0.002 + s.y * 0.002);
        const a = Math.min(1, s.o * twinkle);
        ctx.globalAlpha = a;
        ctx.fillStyle = `hsl(${hue + (s.x + s.y) * 0.01}, 90%, 70%)`;
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fill();

        // halo
        ctx.globalAlpha = a * 0.35;
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r * 3, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
      }

      function linkStars(s, others) {
        if (!doLinks) return;
        const r2 = linkR * linkR;
        for (let j = 0; j < others.length; j++) {
          const o = others[j];
          const dx = s.x - o.x;
          const dy = s.y - o.y;
          const d2 = dx * dx + dy * dy;
          if (d2 < r2) {
            const d = Math.sqrt(d2) || 1;
            const a = 1 - (d / linkR);
            ctx.globalAlpha = 0.12 + a * 0.28;
            ctx.strokeStyle = `hsl(${hue}, 90%, 60%)`;
            ctx.lineWidth = 0.6 + a * 1.2;
            ctx.beginPath();
            ctx.moveTo(s.x, s.y);
            ctx.lineTo(o.x, o.y);
            ctx.stroke();
            ctx.globalAlpha = 1;
          }
        }
      }

      function updateStars(dt) {
        const g = gravity * 0.18 * (reduced ? 0.3 : 1);
        for (let i = 0; i < stars.length; i++) {
          const s = stars[i];
          // micro drift
          s.vx += Math.sin((s.x + s.y + performance.now() * 0.02) * 0.0006) * 0.02;
          s.vy += Math.cos((s.x - s.y + performance.now() * 0.02) * 0.0006) * 0.02;

          // pointer gravity
          if (pointer.active && g > 0) {
            const dx = pointer.x - s.x;
            const dy = pointer.y - s.y;
            const d2 = dx * dx + dy * dy + 30;
            s.vx += (dx / d2) * (g * 240);
            s.vy += (dy / d2) * (g * 240);
          }

          // integrate
          s.x += s.vx * (dt * 0.06);
          s.y += s.vy * (dt * 0.06);
          s.vx *= 0.985; s.vy *= 0.985;

          // wrap softly
          if (s.x < -2) s.x = W + 2;
          if (s.y < -2) s.y = H + 2;
          if (s.x > W + 2) s.x = -2;
          if (s.y > H + 2) s.y = -2;
        }
      }

      // Meteors
      function spawnMeteor(x, y) {
        const angle = Math.random() * Math.PI * 2;
        const speed = randRange(6, 12);
        streaks.push({
          x, y,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          life: 1,
          hue: hue + randRange(-20, 20)
        });
      }

      function updateMeteors(dt) {
        for (let i = streaks.length - 1; i >= 0; i--) {
          const m = streaks[i];
          m.x += m.vx * (dt * 0.05);
          m.y += m.vy * (dt * 0.05);
          m.vx *= 0.996; m.vy *= 0.996;
          m.life -= 0.012 * (reduced ? 2 : 1);
          if (m.life <= 0 || m.x < -20 || m.y < -20 || m.x > W + 20 || m.y > H + 20) streaks.splice(i, 1);
        }
      }

      function drawMeteors() {
        for (const m of streaks) {
          ctx.globalCompositeOperation = 'lighter';
          const len = 18;
          ctx.strokeStyle = `hsl(${m.hue}, 100%, 65%)`;
          ctx.globalAlpha = Math.max(0, m.life) * 0.9;
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(m.x, m.y);
          ctx.lineTo(m.x - m.vx * 1.2 - len, m.y - m.vy * 1.2 - len);
          ctx.stroke();
          ctx.globalCompositeOperation = 'source-over';
          ctx.globalAlpha = 1;
        }
      }

      function tick(now) {
        if (!running) return;
        const dt = t0 ? Math.min(32, now - t0) : 16;
        t0 = now;

        softClear();

        // Links pass first for nice glow layering
        if (doLinks) {
          ctx.globalCompositeOperation = 'lighter';
          for (let i = 0; i < stars.length; i += 2) {
            linkStars(stars[i], stars.slice(i + 1, i + 28)); // local neighborhood
          }
          ctx.globalCompositeOperation = 'source-over';
        }

        // Stars
        for (let i = 0; i < stars.length; i++) drawStar(stars[i], now);

        // Meteors
        updateMeteors(dt);
        drawMeteors();

        // Physics
        updateStars(dt);

        requestAnimationFrame(tick);
      }

      // Interactions
      function handleMove(e) {
        const r = frame.getBoundingClientRect();
        pointer.x = (e.clientX - r.left - 10);
        pointer.y = (e.clientY - r.top - 10);
        pointer.active = true;

        // tilt
        const tx = (e.clientX - r.left) / r.width - 0.5;
        const ty = (e.clientY - r.top) / r.height - 0.5;
        const tilt = 8;
        if (!reduced) frame.style.transform = `rotateX(${(-ty * tilt).toFixed(2)}deg) rotateY(${(tx * tilt).toFixed(2)}deg)`;
      }
      function resetTilt() {
        pointer.active = false;
        frame.style.transform = 'rotateX(0deg) rotateY(0deg)';
      }
      stage.addEventListener('pointermove', handleMove, { passive: true });
      stage.addEventListener('pointerleave', resetTilt);

      stage.addEventListener('pointerdown', (e) => {
        const r = frame.getBoundingClientRect();
        const x = (e.clientX - r.left - 10);
        const y = (e.clientY - r.top - 10);
        for (let i = 0; i < 3; i++) spawnMeteor(x, y);
      });

      // Controls wiring
      densEl.addEventListener('input', e => { density = (+e.target.value) / 100; seedStars(); });
      gravEl.addEventListener('input', e => { gravity = (+e.target.value) / 100; });
      linkEl.addEventListener('input', e => { linkR = (+e.target.value); });
      constelEl.addEventListener('change', e => { doLinks = e.target.checked; });

      themeBtn.addEventListener('click', () => {
        root.classList.toggle('night');
        themeBtn.textContent = root.classList.contains('night') ? 'Day' : 'Night';
        const h = Math.floor(Math.random() * 360);
        hue = h;
        root.style.setProperty('--accent', h);
      });

      pauseBtn.addEventListener('click', () => {
        running = !running;
        pauseBtn.textContent = running ? 'Pause' : 'Resume';
        if (running) requestAnimationFrame(tick);
      });

      shuffleBtn.addEventListener('click', () => {
        hue = Math.floor(Math.random() * 360);
        root.style.setProperty('--accent', hue);
      });

      resetBtn.addEventListener('click', () => {
        ctx.clearRect(0, 0, W, H);
        seedStars();
      });

      saveBtn.addEventListener('click', () => {
        try {
          const link = document.createElement('a');
          link.download = `lucid-constellations-${Date.now()}.png`;
          link.href = canvas.toDataURL('image/png');
          link.click();
        } catch (e) { console.warn('Save failed:', e); }
      });

      // Button ripples
      root.querySelectorAll('[data-ripple]').forEach(btn => {
        btn.addEventListener('pointerdown', (e) => {
          const rect = btn.getBoundingClientRect();
          const r = Math.max(rect.width, rect.height);
          const ripple = document.createElement('span');
          Object.assign(ripple.style, {
            position: 'absolute',
            left: (e.clientX - rect.left - r/2) + 'px',
            top: (e.clientY - rect.top - r/2) + 'px',
            width: r + 'px', height: r + 'px', borderRadius: '50%',
            background: 'radial-gradient(circle, rgba(255,255,255,0.75) 0, rgba(255,255,255,0.35) 35%, rgba(255,255,255,0) 70%)',
            transform: 'scale(0.2)', opacity: '0.9', pointerEvents: 'none',
            transition: 'transform 520ms ease, opacity 640ms ease'
          });
          btn.appendChild(ripple);
          requestAnimationFrame(() => { ripple.style.transform = 'scale(1.6)'; ripple.style.opacity = '0'; });
          setTimeout(() => ripple.remove(), 720);
        });
      });

      // Resize
      function onResize() { sizeCanvas(); }
      window.addEventListener('resize', onResize, { passive: true });
      onResize();

      // Start
      if (!reduced) requestAnimationFrame(tick);
    })();
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


