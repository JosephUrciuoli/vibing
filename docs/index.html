<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="vibe542" aria-label="Kinetic Poster — Soft Machines">
  <style>
    /* Kinetic Poster — Iteration 542 (scoped) */
    #vibe542 {
      --ink: #0a1022;
      --muted: #5b668a;
      --ring: rgba(11,16,34,.16);

      --bg1: #f7fbff;
      --bg2: #eaf2ff;

      --a1: #6d5efc;
      --a2: #1ed6d3;
      --a3: #ffb648;

      --glass: color-mix(in srgb, #ffffff 78%, transparent);

      position: relative;
      min-height: 92vh;
      display: grid;
      place-items: center;
      padding: clamp(18px, 4vw, 48px);
      color: var(--ink);
      font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      border-radius: 34px;
      isolation: isolate;
      overflow: hidden;
      background:
        radial-gradient(140% 120% at 80% -10%, var(--bg1) 0%, var(--bg2) 60%, #deebff 100%);
      box-shadow: 0 110px 320px rgba(8, 12, 24, .14);
    }
    #vibe542[data-theme="night"] {
      --ink: #e7eeff;
      --muted: #a3b2d7;
      --ring: rgba(255,255,255,.22);
      --bg1: #050916;
      --bg2: #0b1233;
      --glass: color-mix(in srgb, #0d1336 56%, transparent);
      background:
        radial-gradient(200% 160% at 10% -10%, #0a1436 0%, #050a1b 55%, #04070f 100%);
      box-shadow: 0 110px 330px rgba(0,0,0,.76);
    }

    /* Ambient aurora */
    #vibe542::before {
      content:"";
      position:absolute; inset:-30% -10% -20% -10%;
      background:
        conic-gradient(from 230deg at 20% 20%, color-mix(in srgb, var(--a2), transparent 86%), transparent 30%),
        conic-gradient(from 50deg at 80% 70%, color-mix(in srgb, var(--a1), transparent 88%), transparent 30%),
        conic-gradient(from 150deg at 40% 90%, color-mix(in srgb, var(--a3), transparent 88%), transparent 30%);
      filter: blur(120px) saturate(130%);
      mix-blend-mode: soft-light;
      opacity:.6;
      transform: rotate(-6deg) scale(1.05);
      animation: v542-aurora 34s ease-in-out infinite alternate;
      pointer-events:none;
      z-index:0;
    }
    @keyframes v542-aurora {
      0%{ transform: rotate(-6deg) scale(1.05); opacity:.56;}
      50%{ transform: rotate(-2deg) scale(1.07); opacity:.72;}
      100%{ transform: rotate(-9deg) scale(1.06); opacity:.54;}
    }

    /* Shell */
    #vibe542 .frame {
      position: relative; z-index:1;
      width: min(1200px, 96vw);
      border-radius: 28px;
      padding: clamp(20px, 3.6vw, 40px);
      background: var(--glass);
      border: 1px solid rgba(2,6,23,.08);
      backdrop-filter: blur(14px) saturate(125%);
      -webkit-backdrop-filter: blur(14px) saturate(125%);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.85),
        0 50px 140px rgba(2,6,23,.14);
    }
    #vibe542[data-theme="night"] .frame {
      border-color: rgba(255,255,255,.10);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.08),
        0 70px 180px rgba(0,0,0,.6);
    }

    /* Header */
    #vibe542 .top {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 16px;
      margin-bottom: clamp(14px, 2.6vw, 28px);
    }
    #vibe542 .brand {
      display: inline-grid; grid-auto-flow: column; gap: 12px; align-items: center;
      font-weight: 900; font-size: 11px; letter-spacing: .18em; text-transform: uppercase;
      opacity:.9; user-select:none;
    }
    #vibe542 .glyph {
      width: 22px; height: 22px; border-radius: 7px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.35)) padding-box,
        conic-gradient(from 0deg, var(--a1), var(--a2), var(--a3), var(--a1)) border-box;
      border: 2px solid transparent;
      box-shadow: 0 0 0 3px rgba(0,0,0,.04), 0 0 26px color-mix(in srgb, var(--a2), transparent 48%);
    }

    #vibe542 .tools { display:flex; flex-wrap:wrap; align-items:center; gap:10px; }
    #vibe542 .chip {
      appearance:none; -webkit-appearance:none; cursor:pointer;
      padding:10px 16px; border-radius:999px; font-weight:800; font-size:12px;
      color: var(--ink);
      border: 1px solid rgba(2,6,23,.10);
      background:
        linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.25)) padding-box,
        linear-gradient(90deg, var(--a1), var(--a2)) border-box;
      transition: transform .15s ease, box-shadow .15s ease, opacity .2s ease;
      box-shadow: 0 14px 30px rgba(2,6,23,.10);
    }
    #vibe542[data-theme="night"] .chip {
      background:
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05)) padding-box,
        linear-gradient(90deg, var(--a1), var(--a2)) border-box;
      box-shadow: 0 18px 38px rgba(0,0,0,.45);
      color:var(--ink);
    }
    #vibe542 .chip:hover { transform: translateY(-1px); }
    #vibe542 .chip:active { transform: translateY(0); }

    #vibe542 .swatchbar { display:inline-flex; gap:8px; align-items:center; }
    #vibe542 .swatch {
      width:22px; height:22px; border-radius:6px; cursor:pointer;
      border:1px solid rgba(2,6,23,.10);
      background:#ddd; box-shadow:0 8px 18px rgba(2,6,23,.12);
      transition: transform .15s ease;
    }
    #vibe542 .swatch:hover { transform: translateY(-1px) scale(1.03); }
    #vibe542 .swatch:focus-visible { outline:2px solid var(--ring); outline-offset:4px; }

    /* Layout */
    #vibe542 .grid {
      display:grid;
      grid-template-columns: 1.1fr 1fr;
      gap: clamp(18px, 4vw, 48px);
      align-items: center;
    }
    @media (max-width: 960px) { #vibe542 .grid { grid-template-columns: 1fr; } }

    /* Copy */
    #vibe542 h1 {
      margin: 0 0 12px 0;
      font-size: clamp(46px, 8.6vw, 112px);
      line-height: .86; letter-spacing: -.02em; text-wrap: balance;
      background: linear-gradient(100deg,
        color-mix(in srgb, var(--ink), var(--a1) 22%),
        color-mix(in srgb, var(--ink), var(--a2) 18%),
        color-mix(in srgb, var(--ink), var(--a3) 16%));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-shadow: 0 1px 0 rgba(255,255,255,.18);
    }
    #vibe542[data-theme="night"] h1 { text-shadow: 0 1px 0 rgba(255,255,255,.06); }
    #vibe542 .lead { margin: 8px 0 16px 0; color: var(--muted); font-size: clamp(14px, 2.2vw, 18px); max-width: 62ch; }
    #vibe542 .micro { color: var(--muted); font-size: 12px; }

    /* Canvas stage */
    #vibe542 .stage {
      position: relative;
      width: min(720px, 86vw);
      aspect-ratio: 4 / 3;
      border-radius: 22px;
      overflow: hidden;
      border: 1px solid rgba(2,6,23,.10);
      background:
        radial-gradient(120% 120% at 50% 50%, rgba(255,255,255,.96), rgba(255,255,255,.24));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.80),
        0 34px 120px rgba(2,6,23,.18);
      transform-style: preserve-3d;
      transition: transform .2s ease;
    }
    #vibe542[data-theme="night"] .stage {
      background:
        radial-gradient(120% 120% at 50% 50%, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border-color: rgba(255,255,255,.10);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.08),
        0 60px 160px rgba(0,0,0,.55);
    }

    /* Grid overlay */
    #vibe542 .gridfx {
      position:absolute; inset:0; pointer-events:none; opacity:.24; mix-blend-mode: overlay;
      background:
        linear-gradient(transparent 63%, rgba(0,0,0,.05) 64%, transparent 65%) 0 0/100% 24px,
        linear-gradient(90deg, transparent 63%, rgba(0,0,0,.05) 64%, transparent 65%) 0 0/24px 100%;
    }
    #vibe542[data-theme="night"] .gridfx {
      opacity:.18; background:
        linear-gradient(transparent 63%, rgba(255,255,255,.08) 64%, transparent 65%) 0 0/100% 24px,
        linear-gradient(90deg, transparent 63%, rgba(255,255,255,.08) 64%, transparent 65%) 0 0/24px 100%;
    }

    #vibe542 canvas { position:absolute; inset:0; display:block; width:100%; height:100%; }

    /* Dock controls */
    #vibe542 .dock {
      position: absolute; left: 50%; bottom: 12px; transform: translateX(-50%);
      display: flex; flex-wrap: wrap; align-items: center; gap: 10px;
      padding: 10px 12px; border-radius: 14px;
      border: 1px solid rgba(2,6,23,.08);
      background: rgba(255,255,255,.70);
      backdrop-filter: blur(10px) saturate(130%);
      -webkit-backdrop-filter: blur(10px) saturate(130%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.75), 0 14px 30px rgba(2,6,23,.12);
    }
    #vibe542[data-theme="night"] .dock {
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.10);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08), 0 26px 60px rgba(0,0,0,.45);
    }
    #vibe542 .dock label {
      font-size: 10px; letter-spacing: .14em; text-transform: uppercase; font-weight: 900; opacity: .7; margin-right: 8px;
    }
    #vibe542 input[type="range"] {
      -webkit-appearance: none; appearance: none;
      width: 150px; height: 26px; border-radius: 999px; padding: 0 10px;
      border: 1px solid rgba(2,6,23,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.25));
    }
    #vibe542[data-theme="night"] input[type="range"] {
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
      border-color: rgba(255,255,255,.10);
    }
    #vibe542 input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background:
        linear-gradient(#fff, #fff) padding-box,
        conic-gradient(var(--a1), var(--a2), var(--a3), var(--a1)) border-box;
      border: 2px solid transparent; box-shadow: 0 8px 18px rgba(2,6,23,.18); cursor: pointer;
    }
    #vibe542 input[type="range"]::-moz-range-thumb {
      width: 18px; height: 18px; border: none; border-radius: 50%; background: #fff; cursor: pointer;
    }

    /* Footer */
    #vibe542 .foot {
      display: flex; align-items: center; justify-content: space-between; gap: 10px;
      margin-top: clamp(16px, 2.6vw, 24px); color: var(--muted); font-size: 12px;
    }
    #vibe542 .pulse {
      width: 10px; height: 10px; border-radius: 50%;
      background: radial-gradient(circle at 50% 50%, var(--a2), var(--a1));
      box-shadow: 0 0 0 0 rgba(71,255,209,.0);
      animation: v542-pulse 2.8s ease-in-out infinite;
    }
    @keyframes v542-pulse {
      0%{ box-shadow:0 0 0 0 rgba(71,255,209, .20); transform: scale(1);}
      70%{ box-shadow:0 0 0 14px rgba(71,255,209,0); transform: scale(1.06);}
      100%{ box-shadow:0 0 0 0 rgba(71,255,209,0); transform: scale(1);}
    }

    /* Focus glow */
    #vibe542 .frame:focus-within {
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.85),
        0 0 0 2px var(--ring),
        0 34px 110px rgba(0,0,0,.28);
    }

    /* Iteration tag */
    #vibe542 .iter {
      position: absolute; inset: auto 14px 12px auto; z-index: 3;
      opacity: .35; font-size: 10px; letter-spacing: .1em; text-transform: uppercase; user-select: none;
    }

    @media (prefers-reduced-motion: reduce) {
      #vibe542::before, #vibe542 .pulse { animation: none !important; }
      #vibe542 .stage { transition: none !important; }
    }
  </style>

  <div class="frame" role="region" aria-label="Kinetic canvas and controls">
    <div class="top">
      <div class="brand"><span class="glyph" aria-hidden="true"></span> Kinetic Atelier · Iteration 542</div>
      <div class="tools">
        <button class="chip" id="theme542" type="button" aria-label="Toggle theme" aria-pressed="false">Theme</button>
        <div class="swatchbar" role="group" aria-label="Palettes">
          <button class="swatch" data-palette="prism" aria-label="Palette: Prism" style="background: radial-gradient(circle at 30% 30%, #6d5efc, #1ed6d3);"></button>
          <button class="swatch" data-palette="lagoon" aria-label="Palette: Lagoon" style="background: radial-gradient(circle at 30% 30%, #22d3ee, #0ea5e9);"></button>
          <button class="swatch" data-palette="ember" aria-label="Palette: Ember" style="background: radial-gradient(circle at 30% 30%, #fb7185, #f59e0b);"></button>
          <button class="swatch" data-palette="orchid" aria-label="Palette: Orchid" style="background: radial-gradient(circle at 30% 30%, #a78bfa, #f472b6);"></button>
          <button class="swatch" data-palette="moss" aria-label="Palette: Moss" style="background: radial-gradient(circle at 30% 30%, #34d399, #84cc16);"></button>
        </div>
        <button class="chip" id="bloom542" type="button" aria-pressed="true" aria-label="Toggle bloom glow">Bloom</button>
        <button class="chip" id="pause542" type="button" aria-pressed="false" aria-label="Pause animation">Pause</button>
      </div>
    </div>

    <div class="grid">
      <div class="copy">
        <h1>Softer machines. Brighter edges.</h1>
        <p class="lead">A kinetic horizon painted with ribbons of color. Nudge the wind, change the pigment, tune the motion—watch the poster breathe.</p>
        <p class="micro">No libraries—just Canvas, CSS, and a few careful gradients. Day or night, the lines stay kind.</p>
      </div>

      <figure class="stage" role="img" aria-label="An animated field of gradient ribbons that respond to your touch">
        <canvas id="flow542"></canvas>
        <div class="gridfx" aria-hidden="true"></div>

        <div class="dock" aria-label="Canvas controls">
          <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
            <label for="speed542">Motion</label>
            <input id="speed542" type="range" min="0" max="200" value="110" />
          </div>
          <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
            <label for="amp542">Amplitude</label>
            <input id="amp542" type="range" min="2" max="100" value="44" />
          </div>
          <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
            <label for="detail542">Detail</label>
            <input id="detail542" type="range" min="2" max="12" value="6" />
          </div>
        </div>
      </figure>
    </div>

    <div class="foot">
      <div style="display:flex; align-items:center; gap:10px;">
        <span class="pulse" aria-hidden="true"></span>
        <span>Canvas alive</span>
      </div>
      <span id="last-updated">Last updated: 2025-11-10 05:20:46 EST</span>
    </div>
  </div>

  <span class="iter" aria-hidden="true">Iteration 542</span>

  <script>
    (function () {
      const root = document.getElementById('vibe542');
      const canvas = root.querySelector('#flow542');
      const ctx = canvas.getContext('2d');

      const rSpeed = root.querySelector('#speed542');
      const rAmp = root.querySelector('#amp542');
      const rDetail = root.querySelector('#detail542');

      const btnTheme = root.querySelector('#theme542');
      const btnPause = root.querySelector('#pause542');
      const btnBloom = root.querySelector('#bloom542');
      const swatches = Array.from(root.querySelectorAll('.swatch'));

      const stamp = root.querySelector('#last-updated');

      // Timestamp
      try {
        const now = new Date();
        const parts = new Intl.DateTimeFormat(undefined, {
          year: 'numeric', month: 'short', day: '2-digit',
          hour: '2-digit', minute: '2-digit', second: '2-digit',
          timeZoneName: 'short'
        }).format(now);
        stamp.textContent = 'Last updated: ' + parts;
      } catch {
        stamp.textContent = 'Last updated just now';
      }

      // Theme
      const hour = (new Date()).getHours();
      const timeTheme = (hour >= 7 && hour < 19) ? 'day' : 'night';
      const savedTheme = localStorage.getItem('v542-theme');
      const startTheme = savedTheme || (timeTheme === 'night' ? 'night' : 'day');
      root.dataset.theme = startTheme;
      btnTheme.setAttribute('aria-pressed', String(startTheme === 'night'));
      btnTheme.addEventListener('click', () => {
        const next = root.dataset.theme === 'night' ? 'day' : 'night';
        root.dataset.theme = next;
        localStorage.setItem('v542-theme', next);
        btnTheme.setAttribute('aria-pressed', String(next === 'night'));
        // repaint to adapt contrast
        draw(true);
      });

      // Palettes
      const palettes = {
        prism:  ['#6d5efc','#1ed6d3','#ffb648'],
        lagoon: ['#22d3ee','#0ea5e9','#7dd3fc'],
        ember:  ['#fb7185','#f59e0b','#fde047'],
        orchid: ['#a78bfa','#f472b6','#f5d0fe'],
        moss:   ['#34d399','#84cc16','#a7f3d0']
      };
      function setPalette(name) {
        const [a,b,c] = palettes[name] || palettes.prism;
        root.style.setProperty('--a1', a);
        root.style.setProperty('--a2', b);
        root.style.setProperty('--a3', c);
        draw(true);
        try { localStorage.setItem('v542-palette', name); } catch {}
      }
      const savedPalette = localStorage.getItem('v542-palette');
      setPalette(savedPalette || 'prism');
      swatches.forEach(btn => btn.addEventListener('click', () => setPalette(btn.dataset.palette)));

      // Bloom toggle
      function setBloom(on) {
        btnBloom.setAttribute('aria-pressed', String(on));
        btnBloom.textContent = on ? 'Bloom' : 'Bloom Off';
      }
      setBloom(true);
      btnBloom.addEventListener('click', () => setBloom(btnBloom.getAttribute('aria-pressed') !== 'true' ? true : false));

      // Pointer parallax
      const pointer = { x: .5, y: .5 };
      const stage = canvas.parentElement;
      function applyTilt() {
        const rx = (0.5 - pointer.y) * 8;
        const ry = (pointer.x - 0.5) * 12;
        if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
          stage.style.transform = `perspective(1100px) rotateX(${rx}deg) rotateY(${ry}deg)`;
        }
      }
      stage.addEventListener('pointermove', (e) => {
        const r = stage.getBoundingClientRect();
        pointer.x = (e.clientX - r.left) / r.width;
        pointer.y = (e.clientY - r.top) / r.height;
        applyTilt();
      });
      stage.addEventListener('pointerleave', () => { pointer.x = .5; pointer.y = .5; stage.style.transform=''; });

      // Canvas sizing
      const DPR = Math.min(2, window.devicePixelRatio || 1);
      function size() {
        const rect = canvas.getBoundingClientRect();
        canvas.width = Math.floor(rect.width * DPR);
        canvas.height = Math.floor(rect.height * DPR);
        ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      }
      size();
      addEventListener('resize', () => { size(); draw(true); }, { passive: true });

      // Ribbons config
      const ribbons = [
        { color: () => getComputedStyle(root).getPropertyValue('--a1').trim(), thick: 28, phase: Math.random()*1000 },
        { color: () => getComputedStyle(root).getPropertyValue('--a2').trim(), thick: 20, phase: Math.random()*1000 + 40 },
        { color: () => getComputedStyle(root).getPropertyValue('--a3').trim(), thick: 16, phase: Math.random()*1000 + 80 }
      ];

      function speedFactor(){ return Number(rSpeed.value) / 100; }
      function ampFactor(){ return Number(rAmp.value); }
      function detail(){ return Number(rDetail.value); }

      // Draw
      let t0 = performance.now();
      const state = { paused: false };
      btnPause.addEventListener('click', () => {
        const pressed = btnPause.getAttribute('aria-pressed') === 'true';
        const next = !pressed;
        btnPause.setAttribute('aria-pressed', String(next));
        btnPause.textContent = next ? 'Play' : 'Pause';
        state.paused = next;
        if (!next && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
          t0 = performance.now();
          loop(t0);
        }
      });

      [rSpeed, rAmp, rDetail].forEach(r => r.addEventListener('input', () => draw(true)));

      function clear() {
        const { width: W, height: H } = canvas;
        // backdrop
        ctx.clearRect(0,0,W,H);
        const theme = root.dataset.theme;
        const soft = theme === 'night'
          ? ctx.createLinearGradient(0,0,0,H)
          : ctx.createLinearGradient(0,0,0,H);
        if (theme === 'night') {
          soft.addColorStop(0, '#0a122d');
          soft.addColorStop(1, '#040916');
        } else {
          soft.addColorStop(0, '#ffffff');
          soft.addColorStop(1, '#f6fbff');
        }
        ctx.fillStyle = soft;
        ctx.fillRect(0,0,W,H);
      }

      function draw(skipMotion=false, now=performance.now()) {
        const rect = canvas.getBoundingClientRect();
        const W = rect.width, H = rect.height;

        clear();

        const baseY = H * (.50 + (pointer.y - .5) * .06);
        const amp = ampFactor() * 0.8;
        const spd = speedFactor() * 0.008;
        const step = Math.max(2, 12 - detail()); // smaller -> more points

        const bloomOn = btnBloom.getAttribute('aria-pressed') === 'true';

        for (let i=0;i<ribbons.length;i++){
          const rb = ribbons[i];
          const hue = rb.color();
          const phase = rb.phase;
          const t = skipMotion ? 0 : (now - t0) * spd + i * 120;

          ctx.lineJoin = 'round';
          ctx.lineCap = 'round';
          ctx.lineWidth = rb.thick;
          ctx.strokeStyle = hue;
          ctx.globalAlpha = 0.85;
          ctx.globalCompositeOperation = 'lighter';

          if (bloomOn) {
            ctx.shadowColor = hue;
            ctx.shadowBlur = 24;
          } else {
            ctx.shadowBlur = 0;
          }

          ctx.beginPath();
          for (let x= -20; x<=W+20; x+=step){
            const nx = (x / W) * Math.PI * 2;
            const y =
              baseY
              + Math.sin(nx * (1.2 + i*0.18) + t/160 + phase) * (amp + i*6)
              + Math.cos(nx * (2.4 + i*0.14) - t/220 + phase) * (amp*.5 + i*4)
              + (pointer.x - .5) * 16 * (i+1);
            if (x === -20) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          }
          ctx.stroke();

          // sprinkle pebbles along ribbon
          if (detail() >= 6) {
            ctx.save();
            ctx.globalAlpha = 0.20;
            ctx.shadowBlur = bloomOn ? 10 : 0;
            for (let k=0;k<14;k++){
              const px = (k/13) * W + (i*17)%20;
              const nx = (px / W) * Math.PI * 2;
              const py =
                baseY
                + Math.sin(nx * (1.2 + i*0.18) + t/160 + phase) * (amp + i*6)
                + Math.cos(nx * (2.4 + i*0.14) - t/220 + phase) * (amp*.5 + i*4);
              ctx.fillStyle = hue;
              ctx.beginPath();
              ctx.arc(px, py, 2 + i*0.6, 0, Math.PI*2);
              ctx.fill();
            }
            ctx.restore();
          }
        }

        // soft vignette
        const g = ctx.createRadialGradient(W/2, H/2, Math.min(W,H)*0.2, W/2, H/2, Math.max(W,H)*0.7);
        if (root.dataset.theme === 'night') {
          g.addColorStop(0, 'rgba(0,0,0,0)');
          g.addColorStop(1, 'rgba(0,0,0,0.22)');
        } else {
          g.addColorStop(0, 'rgba(255,255,255,0)');
          g.addColorStop(1, 'rgba(0,0,0,0.06)');
        }
        ctx.globalCompositeOperation = 'multiply';
        ctx.fillStyle = g;
        ctx.fillRect(0,0,W,H);
        ctx.globalCompositeOperation = 'source-over';
      }

      function loop(now) {
        if (state.paused || window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
        draw(false, now);
        requestAnimationFrame(loop);
      }

      // Initial paint
      draw(true);
      if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        t0 = performance.now();
        loop(t0);
      }
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


