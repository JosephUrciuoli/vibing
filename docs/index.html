<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="weave-333" class="weave-333" data-theme="dusk" role="region" aria-label="Auraline — Kinetic Weave">
  <style>
    .weave-333 {
      --ink: #eaf2ff;
      --muted: #b7c5da;
      --bg0: #050612;
      --bg1: #0b1326;
      --bg2: #0e1a39;
      --line: rgba(255,255,255,0.12);
      --a: #7af3ff;
      --b: #ffa8f0;
      --c: #9dff7c;
      --mx: 50%;
      --my: 50%;
      --rx: 0deg;
      --ry: 0deg;
      --radius: 28px;
      position: relative;
      max-width: 1120px;
      margin: 0 auto;
      padding: 26px 24px 18px 24px;
      color: var(--ink);
      border-radius: var(--radius);
      background:
        radial-gradient(120% 140% at 120% -20%, rgba(255,168,240,0.14), transparent 55%),
        radial-gradient(120% 140% at -20% 120%, rgba(122,243,255,0.12), transparent 60%),
        linear-gradient(160deg, var(--bg0), var(--bg1) 45%, var(--bg2));
      box-shadow:
        0 28px 70px rgba(5, 8, 18, 0.75),
        inset 0 0 0 1px rgba(255,255,255,0.05);
      transform: perspective(1100px) rotateX(var(--rx)) rotateY(var(--ry));
      transition: transform 240ms ease, background 420ms ease, color 300ms ease, box-shadow 300ms ease;
      isolation: isolate;
      overflow: clip;
    }
    .weave-333::before,
    .weave-333::after {
      content: "";
      position: absolute; inset: 0;
      pointer-events: none;
    }
    .weave-333::before {
      background:
        radial-gradient(600px 320px at var(--mx) var(--my), rgba(255,255,255,0.18), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.04), transparent 40%, transparent 70%, rgba(255,255,255,0.03));
      mix-blend-mode: screen;
      opacity: 0.9;
      z-index: 0;
      transition: opacity 200ms ease;
    }
    .weave-333::after {
      background:
        radial-gradient(1800px 800px at -20% 0%, rgba(122,243,255,0.06), transparent 60%),
        radial-gradient(1800px 800px at 120% 100%, rgba(157,255,124,0.05), transparent 60%);
      z-index: 0;
    }
    .weave-333[data-theme="dawn"] {
      --ink: #0b1728;
      --muted: #4a5c75;
      --bg0: #f6fbff;
      --bg1: #eaf3ff;
      --bg2: #dbe9ff;
      --line: rgba(0,0,0,0.14);
      box-shadow:
        0 18px 54px rgba(26, 56, 100, 0.25),
        inset 0 0 0 1px rgba(0,0,0,0.05);
      background:
        radial-gradient(120% 140% at 120% -20%, rgba(255,168,240,0.22), transparent 55%),
        radial-gradient(120% 140% at -20% 120%, rgba(122,243,255,0.18), transparent 60%),
        linear-gradient(160deg, var(--bg0), var(--bg1) 45%, var(--bg2));
    }

    .weave-333__wrap { position: relative; z-index: 2; }

    .weave-333__head {
      display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: start;
    }
    .weave-333 h1 {
      margin: 0;
      font: 900 56px/1.02 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      letter-spacing: 0.2px;
      background: linear-gradient(92deg, var(--ink), #e7f0ff 55%, #c7dbff 85%);
      -webkit-background-clip: text; background-clip: text; color: transparent;
      filter: drop-shadow(0 24px 64px rgba(122,243,255,0.35));
    }
    .weave-333[data-theme="dawn"] h1 {
      background: linear-gradient(92deg, #0b1a2a, #35517a 60%, #476da1 85%);
      -webkit-background-clip: text; background-clip: text;
    }
    .weave-333 p.lead {
      margin: 12px 0 8px 0;
      max-width: 60ch;
      color: var(--muted);
      font: 500 16px/1.65 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    }

    .chips { display: flex; flex-wrap: wrap; gap: 10px; justify-content: end; align-content: start; }
    .chip {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 10px 12px; border-radius: 999px;
      font: 800 11px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      letter-spacing: 0.35px; color: var(--ink);
      background:
        linear-gradient(var(--bg1), var(--bg1)) padding-box,
        linear-gradient(120deg, var(--a), var(--b) 50%, var(--c)) border-box;
      border: 1px solid transparent;
      box-shadow: 0 10px 26px rgba(0,0,0,0.22);
      white-space: nowrap;
    }
    .chip svg { width: 14px; height: 14px; opacity: 0.9; }

    .panel {
      position: relative;
      margin-top: 20px;
      border-radius: 20px;
      padding: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      box-shadow:
        0 12px 28px rgba(0,0,0,0.22),
        inset 0 0 0 1px var(--line);
      overflow: hidden;
      transform: translateZ(0);
    }

    .gridlines {
      position: absolute; inset: 0; pointer-events: none;
      background:
        radial-gradient(circle at var(--mx) var(--my), rgba(255,255,255,0.06), transparent 60%),
        repeating-linear-gradient(90deg, rgba(255,255,255,0.04), rgba(255,255,255,0.04) 1px, transparent 1px, transparent 36px),
        repeating-linear-gradient(0deg, rgba(255,255,255,0.04), rgba(255,255,255,0.04) 1px, transparent 1px, transparent 36px);
      mask: linear-gradient(180deg, transparent, #000 10%, #000 90%, transparent);
      z-index: 1;
    }

    .weave-333 svg {
      position: relative; display: block; width: 100%;
      height: clamp(340px, 46vw, 520px);
      border-radius: 12px;
      background: radial-gradient(120% 120% at var(--mx) var(--my), rgba(255,255,255,0.06), transparent 60%);
      outline: 1px dashed var(--line);
      outline-offset: -6px;
    }

    .controls { position: relative; z-index: 3; display: flex; flex-wrap: wrap; gap: 10px; margin-top: 14px; }
    .weave-333 .btn {
      --bg: linear-gradient(135deg, var(--a), var(--b));
      color: #0a1220;
      font: 800 13px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      padding: 12px 16px; border-radius: 14px; border: 0; background: var(--bg);
      box-shadow: 0 10px 28px rgba(122,243,255,0.35);
      cursor: pointer;
      transition: transform 160ms ease, box-shadow 160ms ease, filter 160ms ease, opacity 160ms ease;
    }
    .weave-333 .btn:hover { transform: translateY(-1px); filter: saturate(1.05); }
    .weave-333 .btn:active { transform: translateY(0); }
    .weave-333 .btn.ghost {
      background: transparent; color: var(--ink); border: 1px solid var(--line);
      box-shadow: 0 8px 22px rgba(0,0,0,0.18); backdrop-filter: blur(2px);
    }

    .dock {
      margin-top: 16px; padding-top: 12px; border-top: 1px dashed var(--line);
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      color: var(--muted);
      font: 500 12px/1.6 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      position: relative; z-index: 3;
    }
    .stat { display: inline-flex; align-items: center; gap: 10px; }
    .beacon {
      width: 10px; height: 10px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, white, #a5f4ff);
      box-shadow: 0 0 0 0 rgba(110,240,255,0.55);
      animation: pulse-333 2.6s ease-out infinite;
    }
    .weave-333.paused .beacon { animation-play-state: paused; }
    @keyframes pulse-333 {
      0% { box-shadow: 0 0 0 0 rgba(110,240,255,0.55); }
      70% { box-shadow: 0 0 0 10px rgba(110,240,255,0); }
      100% { box-shadow: 0 0 0 0 rgba(110,240,255,0); }
    }

    @media (max-width: 760px) {
      .weave-333 { padding: 22px 18px 16px 18px; }
      .weave-333 h1 { font-size: 40px; line-height: 1.06; }
      .chips { justify-content: start; }
    }

    @media (prefers-reduced-motion: reduce) {
      .weave-333 { transition: none; transform: none !important; }
      .beacon { animation: none !important; }
    }
  </style>

  <div class="weave-333__wrap">
    <div class="weave-333__head">
      <div>
        <h1>Auraline</h1>
        <p class="lead">Drawn by wind and light. Ribbons listen to your cursor, weaving gentle waves of color.</p>
      </div>
      <div class="chips" aria-label="Highlights">
        <span class="chip" title="Vector ribbons">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M4 12c4-6 12 6 16 0"/></svg>
          ribbons
        </span>
        <span class="chip" title="Parallax depth">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3 7h18M6 12h12M9 17h6"/></svg>
          parallax
        </span>
        <span class="chip" title="Tactile control">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>
          tactile
        </span>
      </div>
    </div>

    <div class="panel" id="panel-333" aria-label="Generative ribbon field">
      <div class="gridlines" aria-hidden="true"></div>
      <svg id="weave-svg" viewBox="0 0 1100 520" role="img" aria-label="Flowing color ribbons">
        <defs>
          <filter id="glow-333" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="6" result="blur"/>
            <feMerge>
              <feMergeNode in="blur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
          <linearGradient id="grad-a-333" x1="0" y1="0" x2="1100" y2="0" gradientUnits="userSpaceOnUse">
            <stop offset="0%" stop-color="#ffffff" stop-opacity="0.85"/>
            <stop offset="35%" stop-color="var(--a)" stop-opacity="0.9"/>
            <stop offset="100%" stop-color="transparent" stop-opacity="0.0"/>
          </linearGradient>
          <linearGradient id="grad-b-333" x1="0" y1="0" x2="1100" y2="0" gradientUnits="userSpaceOnUse">
            <stop offset="0%" stop-color="#ffffff" stop-opacity="0.85"/>
            <stop offset="35%" stop-color="var(--b)" stop-opacity="0.9"/>
            <stop offset="100%" stop-color="transparent" stop-opacity="0.0"/>
          </linearGradient>
          <linearGradient id="grad-c-333" x1="0" y1="0" x2="1100" y2="0" gradientUnits="userSpaceOnUse">
            <stop offset="0%" stop-color="#ffffff" stop-opacity="0.85"/>
            <stop offset="35%" stop-color="var(--c)" stop-opacity="0.9"/>
            <stop offset="100%" stop-color="transparent" stop-opacity="0.0"/>
          </linearGradient>
        </defs>
        <g id="ribbon-layer" filter="url(#glow-333)" style="mix-blend-mode:screen"></g>
        <g id="orb-layer" style="mix-blend-mode:screen"></g>
      </svg>
    </div>

    <div class="controls">
      <button class="btn" id="weave-add">Weave Line</button>
      <button class="btn ghost" id="weave-pause" aria-pressed="false">Pause</button>
      <button class="btn ghost" id="weave-theme" aria-pressed="false">Dawn/Dusk</button>
      <button class="btn ghost" id="weave-energy" aria-pressed="false">Calm/Alive</button>
      <button class="btn ghost" id="weave-reset">Reset</button>
    </div>

    <div class="dock">
      <div class="stat">
        <span class="beacon" aria-hidden="true"></span>
        Lines: <span id="weave-count">0</span> • Mode: <span id="weave-mode">alive</span>
      </div>
      <span id="last-updated">Last updated: 2025-10-31 15:12:54 EST</span>
    </div>
  </div>

  <script>
    (function () {
      const root = document.getElementById('weave-333');
      const svg = root.querySelector('#weave-svg');
      const rLayer = svg.querySelector('#ribbon-layer');
      const oLayer = svg.querySelector('#orb-layer');

      const addBtn = root.querySelector('#weave-add');
      const pauseBtn = root.querySelector('#weave-pause');
      const themeBtn = root.querySelector('#weave-theme');
      const energyBtn = root.querySelector('#weave-energy');
      const resetBtn = root.querySelector('#weave-reset');
      const countEl = root.querySelector('#weave-count');
      const modeEl = root.querySelector('#weave-mode');
      const updated = root.querySelector('#last-updated');

      const VB = { w: 1100, h: 520 };

      let rafId = null;
      let paused = false;
      let lively = true;
      let t = 0;

      let ribbons = [];
      let orbs = [];
      let pointer = { x: VB.w * 0.5, y: VB.h * 0.5, active: false };

      function fmt(d) {
        try { return new Intl.DateTimeFormat(undefined, { dateStyle: 'medium', timeStyle: 'short' }).format(d); }
        catch { return d.toLocaleString(); }
      }
      function setUpdated(msg) {
        updated.textContent = (msg ? msg + ' • ' : '') + fmt(new Date());
      }
      setUpdated('Ready');

      function rand(min, max) { return min + Math.random() * (max - min); }
      function clamp(n, a, b) { return Math.max(a, Math.min(b, n)); }

      function gradIdPick() {
        const ids = ['grad-a-333','grad-b-333','grad-c-333'];
        return ids[Math.floor(Math.random() * ids.length)];
      }

      function makeRibbon(yBase, thickness) {
        const count = Math.floor(rand(7, 11));
        const dx = VB.w / (count - 1);
        const points = [];
        const seed = Math.random() * 1000;
        for (let i = 0; i < count; i++) {
          points.push({
            x: i * dx,
            baseY: yBase + rand(-24, 24),
            y: yBase,
            phase: rand(0, Math.PI * 2),
            amp: rand(18, 48),
          });
        }
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('fill', 'none');
        path.setAttribute('stroke', `url(#${gradIdPick()})`);
        path.setAttribute('stroke-width', thickness.toFixed(2));
        path.setAttribute('stroke-linecap', 'round');
        path.setAttribute('stroke-linejoin', 'round');
        path.setAttribute('opacity', '0.92');
        rLayer.appendChild(path);

        const z = rand(0.6, 1.3); // depth factor for parallax
        return { points, path, seed, speed: rand(0.6, 1.2), ampMul: rand(0.9, 1.4), z };
      }

      function catmullRomPath(pts, tension = 1) {
        if (pts.length < 2) return '';
        const d = [];
        d.push('M', pts[0].x.toFixed(2), pts[0].y.toFixed(2));
        for (let i = 0; i < pts.length - 1; i++) {
          const p0 = pts[i - 1] || pts[i];
          const p1 = pts[i];
          const p2 = pts[i + 1];
          const p3 = pts[i + 2] || p2;
          const c1x = p1.x + (p2.x - p0.x) / 6 * tension;
          const c1y = p1.y + (p2.y - p0.y) / 6 * tension;
          const c2x = p2.x - (p3.x - p1.x) / 6 * tension;
          const c2y = p2.y - (p3.y - p1.y) / 6 * tension;
          d.push('C',
            c1x.toFixed(2), c1y.toFixed(2),
            c2x.toFixed(2), c2y.toFixed(2),
            p2.x.toFixed(2), p2.y.toFixed(2)
          );
        }
        return d.join(' ');
      }

      function addRibbon(y) {
        const yBase = y ?? rand(VB.h * 0.3, VB.h * 0.7);
        const thickness = rand(6, 14);
        const r = makeRibbon(yBase, thickness);
        ribbons.push(r);
        countEl.textContent = ribbons.length;
        return r;
      }

      function addOrb() {
        const node = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        node.setAttribute('r', rand(2.5, 4.5).toFixed(2));
        node.setAttribute('fill', 'white');
        node.setAttribute('opacity', '0.85');
        oLayer.appendChild(node);
        const o = {
          node,
          angle: rand(0, Math.PI * 2),
          radius: rand(40, 120),
          speed: rand(0.6, 1.6),
          offsetX: rand(VB.w*0.2, VB.w*0.8),
          offsetY: rand(VB.h*0.25, VB.h*0.75),
        };
        orbs.push(o);
      }

      function resetWeave() {
        ribbons = [];
        rLayer.innerHTML = '';
        orbs = [];
        oLayer.innerHTML = '';
        // seed with a trio
        addRibbon(VB.h * 0.40);
        addRibbon(VB.h * 0.52);
        addRibbon(VB.h * 0.64);
        for (let i = 0; i < 8; i++) addOrb();
        setUpdated('Reset');
      }

      function step(dt) {
        const time = t * 0.001;
        const energy = lively ? 1.0 : 0.35;
        const pointerPull = pointer.active ? 1.0 : 0.5;

        for (const r of ribbons) {
          const ampBase = 22 * r.ampMul * energy;
          const speed = r.speed * (0.8 + energy * 0.4);
          for (let i = 0; i < r.points.length; i++) {
            const p = r.points[i];
            const px = p.x / VB.w;
            const pointerInfluence = pointer.active
              ? (Math.exp(-Math.abs((p.x - pointer.x)) / (220 * r.z)) * 26 * pointerPull)
              : 0;
            const wave = Math.sin(time * speed + p.phase + px * 4 + r.seed) * (p.amp + ampBase);
            const centerEase = Math.sin(px * Math.PI); // taper ends
            p.y = p.baseY + wave * centerEase + pointerInfluence * Math.sin(time * 1.8 + i);
            // parallax depth shift toward pointer
            const towardX = (pointer.x - p.x) * 0.02 * (r.z - 1);
            const towardY = (pointer.y - p.baseY) * 0.02 * (r.z - 1);
            p.xEff = p.x + towardX;
            p.yEff = p.y + towardY;
          }
          // build path from effective points
          const eff = r.points.map(q => ({ x: q.xEff ?? q.x, y: q.yEff ?? q.y }));
          const d = catmullRomPath(eff, 1);
          r.path.setAttribute('d', d);
          r.path.setAttribute('stroke-width', clamp(6 * r.z, 3.5, 16).toFixed(2));
          r.path.setAttribute('opacity', clamp(0.75 + (r.z - 0.6) * 0.3, 0.5, 0.95).toFixed(2));
        }

        // orbs
        for (const o of orbs) {
          o.angle += 0.008 * o.speed * (0.6 + energy * 0.8);
          const px = pointer.active ? pointer.x : o.offsetX;
          const py = pointer.active ? pointer.y : o.offsetY;
          const x = px + Math.cos(o.angle) * o.radius;
          const y = py + Math.sin(o.angle * 1.2) * (o.radius * 0.6);
          o.node.setAttribute('cx', x.toFixed(2));
          o.node.setAttribute('cy', y.toFixed(2));
          o.node.setAttribute('fill', Math.random() > 0.66 ? 'var(--a)' : (Math.random() > 0.5 ? 'var(--b)' : 'var(--c)'));
          o.node.setAttribute('opacity', (0.65 + 0.35 * Math.sin(o.angle + t*0.001)).toFixed(2));
        }
      }

      let last = performance.now();
      function loop(now) {
        const dt = now - last; last = now; t += dt;
        step(dt);
        rafId = requestAnimationFrame(loop);
      }

      function start() {
        if (!paused) return;
        paused = false;
        root.classList.remove('paused');
        last = performance.now();
        rafId = requestAnimationFrame(loop);
      }
      function stop() {
        paused = true;
        root.classList.add('paused');
        if (rafId) cancelAnimationFrame(rafId);
      }

      function updateModeLabel() {
        modeEl.textContent = lively ? 'alive' : 'calm';
      }

      function panelRect() { return svg.getBoundingClientRect(); }
      function toViewBox(clientX, clientY) {
        const rect = panelRect();
        const x = ((clientX - rect.left) / rect.width) * VB.w;
        const y = ((clientY - rect.top) / rect.height) * VB.h;
        return { x, y };
      }

      root.addEventListener('pointermove', (e) => {
        const rect = root.getBoundingClientRect();
        const x = Math.min(Math.max((e.clientX - rect.left) / rect.width, 0), 1);
        const y = Math.min(Math.max((e.clientY - rect.top) / rect.height, 0), 1);
        root.style.setProperty('--mx', (x * 100).toFixed(2) + '%');
        root.style.setProperty('--my', (y * 100).toFixed(2) + '%');
        const rx = (-(y - 0.5) * 6).toFixed(2) + 'deg';
        const ry = ((x - 0.5) * 10).toFixed(2) + 'deg';
        root.style.setProperty('--rx', rx);
        root.style.setProperty('--ry', ry);
        const v = toViewBox(e.clientX, e.clientY);
        pointer.x = v.x; pointer.y = v.y; pointer.active = true;
      }, { passive: true });

      root.addEventListener('pointerleave', () => {
        pointer.active = false;
        root.style.setProperty('--mx', '50%');
        root.style.setProperty('--my', '50%');
        root.style.setProperty('--rx', '0deg');
        root.style.setProperty('--ry', '0deg');
      });

      root.addEventListener('pointerdown', (e) => {
        const v = toViewBox(e.clientX, e.clientY);
        addRibbon(v.y);
        setUpdated('Line woven');
      });

      addBtn.addEventListener('click', () => {
        addRibbon();
        setUpdated('Line woven');
      });

      pauseBtn.addEventListener('click', () => {
        if (paused) {
          start();
          pauseBtn.textContent = 'Pause';
          pauseBtn.setAttribute('aria-pressed', 'false');
          setUpdated('Resumed');
        } else {
          stop();
          pauseBtn.textContent = 'Resume';
          pauseBtn.setAttribute('aria-pressed', 'true');
          setUpdated('Paused');
        }
      });

      themeBtn.addEventListener('click', () => {
        const next = root.getAttribute('data-theme') === 'dusk' ? 'dawn' : 'dusk';
        root.setAttribute('data-theme', next);
        themeBtn.setAttribute('aria-pressed', String(next === 'dawn'));
        setUpdated(next === 'dawn' ? 'Dawn mode' : 'Dusk mode');
      });

      energyBtn.addEventListener('click', () => {
        lively = !lively;
        energyBtn.setAttribute('aria-pressed', String(!lively));
        updateModeLabel();
        setUpdated(lively ? 'Alive' : 'Calm');
      });

      resetBtn.addEventListener('click', resetWeave);

      // Motion preference
      const mq = window.matchMedia('(prefers-reduced-motion: reduce)');
      function applyMotionPref() {
        if (mq.matches) {
          stop();
          pauseBtn.textContent = 'Resume';
          pauseBtn.setAttribute('aria-pressed', 'true');
        } else {
          start();
          pauseBtn.textContent = 'Pause';
          pauseBtn.setAttribute('aria-pressed', 'false');
        }
      }
      mq.addEventListener ? mq.addEventListener('change', applyMotionPref) : mq.addListener(applyMotionPref);

      // Setup
      resetWeave();
      applyMotionPref();
      updateModeLabel();
      countEl.textContent = ribbons.length;

      // Kick loop if motion allowed
      if (!mq.matches) {
        last = performance.now();
        rafId = requestAnimationFrame(loop);
      }
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


