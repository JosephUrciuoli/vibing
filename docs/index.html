<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="loom2264" data-theme="dark" aria-label="Nocturne Atelier — Edition 2264">
  <style>
    /* Design tokens */
    #loom2264{
      --r: 28px;
      --pad: clamp(18px, 5vw, 56px);
      --ink: #e8f1ff;
      --muted: color-mix(in hsl, var(--ink) 58%, transparent);
      --edge: rgba(255,255,255,0.12);
      --bg-1: #0b0e14;
      --bg-2: #0f1522;
      --p1: 198 92% 56%;
      --p2: 272 84% 62%;
      --p3: 16 86% 62%;
      --glass: 18,20,28;
      --glow: 16;
      color-scheme: dark;
      position: relative; isolation:isolate;
      border-radius: var(--r);
      padding: var(--pad);
      overflow: clip;
      font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial, system-ui;
      color: var(--ink);
      background:
        radial-gradient(140% 110% at 20% -10%, hsl(var(--p1) / .18), transparent 40%),
        radial-gradient(140% 110% at 120% 120%, hsl(var(--p2) / .18), transparent 50%),
        linear-gradient(180deg, var(--bg-1), var(--bg-2));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.06),
        0 40px 120px rgba(0,0,0,.28);
    }
    #loom2264[data-theme="light"]{
      --ink: #0f1320;
      --muted: color-mix(in hsl, var(--ink) 54%, transparent);
      --edge: rgba(0,0,0,0.12);
      --bg-1: #f7fbff;
      --bg-2: #eaf1fb;
      color-scheme: light;
      background:
        radial-gradient(140% 110% at 20% -10%, hsl(var(--p1) / .20), transparent 40%),
        radial-gradient(140% 110% at 120% 120%, hsl(var(--p3) / .20), transparent 50%),
        linear-gradient(180deg, var(--bg-1), var(--bg-2));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.80),
        0 40px 120px rgba(0,0,0,.12);
    }

    /* Ambient aurora veil */
    #loom2264::before{
      content:""; position:absolute; inset:-20%;
      background:
        conic-gradient(from 0deg at 60% 40%, hsl(var(--p1) / .22), transparent 35% 70%, hsl(var(--p2) / .20), transparent),
        conic-gradient(from 180deg at 35% 70%, hsl(var(--p3) / .18), transparent 40% 80%, hsl(var(--p1) / .14));
      filter: blur(70px) saturate(140%);
      mix-blend-mode: overlay; pointer-events:none; opacity:.40;
      animation: aurora2264 60s linear infinite;
    }
    @keyframes aurora2264 { to{ transform: rotate(360deg) scale(1.02); } }

    /* Header */
    #loom2264 .bar{
      display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom: clamp(16px, 4vw, 28px);
      position:relative; z-index:2;
    }
    #loom2264 .badge{
      display:flex; align-items:center; gap:14px;
      padding:12px 16px; border-radius:999px; font-weight:900; letter-spacing:.02em;
      background: rgba(var(--glass), .25);
      backdrop-filter: blur(14px) saturate(180%);
      box-shadow: inset 0 0 0 1px var(--edge), 0 12px 32px rgba(0,0,0,.18);
    }
    #loom2264 .glyph{
      width:28px; height:28px; border-radius:10px; position:relative; overflow:hidden; display:grid; place-items:center;
      background:
        radial-gradient(20px 20px at 25% 25%, hsl(var(--p1)), transparent 60%),
        radial-gradient(16px 16px at 75% 75%, hsl(var(--p2)), transparent 60%);
      transform: rotate(10deg);
      box-shadow: inset 0 0 0 1px var(--edge), 0 6px 18px rgba(0,0,0,.20);
    }
    #loom2264 .actions{ display:flex; gap:10px; flex-wrap:wrap; }
    #loom2264 .chip, #loom2264 .btn{
      appearance:none; border:0; cursor:pointer; user-select:none;
      font-weight:850; font-size:14px; letter-spacing:.02em;
      padding:11px 14px; border-radius:14px;
      background: rgba(var(--glass), .26); color: var(--ink);
      box-shadow: inset 0 0 0 1px var(--edge), 0 10px 26px rgba(0,0,0,.16);
      backdrop-filter: blur(10px) saturate(160%);
      transition: transform .14s ease, background .25s ease, box-shadow .25s ease;
    }
    #loom2264 .chip:hover, #loom2264 .btn:hover{ transform: translateY(-1px); background: rgba(var(--glass), .36); }

    /* Hero */
    #loom2264 .hero{ position:relative; z-index:2; margin-bottom: clamp(12px, 4vw, 22px); }
    #loom2264 h1{
      margin:0; line-height:.88; letter-spacing:-0.01em; font-weight:1000;
      font-size: clamp(52px, 8.8vw, 140px);
      color: transparent;
      background: linear-gradient(100deg, hsl(var(--p1)), hsl(var(--p2)), hsl(var(--p3)));
      background-size: 220% 220%;
      -webkit-background-clip:text; background-clip:text;
      animation: titleShift2264 14s ease-in-out infinite;
      filter: drop-shadow(0 8px 28px rgba(0,0,0,.28));
      text-wrap: balance;
    }
    @keyframes titleShift2264 { 50%{ background-position: 100% 0%; } }
    #loom2264 .lede{ margin:8px 0 0; color: var(--muted); font-size: clamp(14px, 2vw, 18px); text-wrap: pretty; }

    /* Stage */
    #loom2264 .stage{
      --w: min(96vw, 1120px);
      width: var(--w); aspect-ratio: 1/1; margin: clamp(14px, 4vw, 26px) auto;
      border-radius: clamp(22px, 4vw, 40px);
      position:relative; z-index:2; overflow:hidden; display:grid; place-items:center; cursor: crosshair;
      background:
        radial-gradient(100% 80% at 50% 0%, rgba(255,255,255,.06), transparent 70%),
        linear-gradient(180deg, color-mix(in hsl, hsl(var(--p1) / 10%), transparent), transparent 60%);
      box-shadow:
        inset 0 0 0 1px var(--edge),
        inset 0 0 160px rgba(255,255,255,0.06),
        0 40px 120px rgba(0,0,0,.28);
      transform-style: preserve-3d; transition: transform 160ms ease;
    }
    #loom2264 .ring{
      content:""; position:absolute; inset:6%; border-radius:inherit; pointer-events:none; z-index:1;
      background:
        radial-gradient(closest-side, transparent calc(100% - 2px), color-mix(in hsl, hsl(var(--p1) / 40%), transparent) calc(100% - 2px), transparent 100%),
        radial-gradient(closest-side, transparent calc(100% - 40px), color-mix(in hsl, hsl(var(--p2) / 36%), transparent) calc(100% - 40px), transparent 100%),
        radial-gradient(closest-side, transparent calc(100% - 80px), color-mix(in hsl, hsl(var(--p3) / 36%), transparent) calc(100% - 80px), transparent 100%);
      opacity:.55;
      mask: radial-gradient(90% 90% at 50% 50%, #000 60%, transparent);
    }
    #loom2264 canvas{ width:100%; height:100%; display:block; position:relative; z-index:2; }

    #loom2264 .grain{
      position:absolute; inset:0; pointer-events:none; z-index:3;
      background:
        repeating-linear-gradient(90deg, rgba(255,255,255,.02) 0 1px, transparent 1px 3px),
        repeating-linear-gradient(0deg, rgba(255,255,255,.015) 0 1px, transparent 1px 3px);
      mix-blend-mode: soft-light; opacity:.10;
      animation: grain2264 22s linear infinite;
    }
    @keyframes grain2264 { to{ background-position: 260px 0, 0 260px; } }

    /* Palette dock */
    #loom2264 .dock{
      display:flex; flex-wrap:wrap; align-items:center; justify-content:center;
      gap: 12px 14px; margin: clamp(16px, 3.2vw, 28px) auto 0; position:relative; z-index:2;
    }
    #loom2264 .seg{ display:inline-flex; padding:4px; border-radius:14px; background: rgba(var(--glass), .26);
      box-shadow: inset 0 0 0 1px var(--edge); backdrop-filter: blur(10px) saturate(160%); }
    #loom2264 .sw{
      border:0; background:transparent; color: var(--ink); font-weight:900; font-size:13px; padding:8px 12px; border-radius:12px; cursor:pointer;
      display:inline-flex; align-items:center; gap:8px; transition: background .2s ease, transform .16s ease;
    }
    #loom2264 .sw[aria-pressed="true"]{ background: color-mix(in hsl, hsl(var(--p2) / 16%), transparent); box-shadow: inset 0 0 0 1px var(--edge); }
    #loom2264 .dot{ width:12px; height:12px; border-radius:50%;
      background: conic-gradient(from 0deg, hsl(var(--p1)), hsl(var(--p2)), hsl(var(--p3)), hsl(var(--p1)));
      box-shadow: 0 0 0 3px color-mix(in hsl, hsl(var(--p1) / 30%), transparent);
    }

    /* Slider */
    #loom2264 .group{
      display:inline-flex; align-items:center; gap:10px;
      padding: 8px 10px; border-radius:14px; font-weight:800; font-size:14px;
      color: var(--muted); background: rgba(var(--glass), .26);
      box-shadow: inset 0 0 0 1px var(--edge); backdrop-filter: blur(10px) saturate(160%);
    }
    #loom2264 input[type="range"]{
      -webkit-appearance:none; appearance:none; width:min(44vw, 320px); height:24px; background:transparent; cursor:pointer;
    }
    #loom2264 input[type="range"]::-webkit-slider-runnable-track,
    #loom2264 input[type="range"]::-moz-range-track{
      height:6px; border-radius:999px;
      background: linear-gradient(90deg, hsl(var(--p1)), hsl(var(--p2)), hsl(var(--p3)));
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.10);
    }
    #loom2264 input[type="range"]::-webkit-slider-thumb,
    #loom2264 input[type="range"]::-moz-range-thumb{
      width:18px; height:18px; border-radius:50%;
      background: #fff; border:2px solid hsl(var(--p2));
      box-shadow: 0 4px 12px rgba(0,0,0,0.18);
      -webkit-appearance:none; appearance:none; margin-top:-6px;
    }

    /* Footer */
    #loom2264 .meta{
      display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between; gap:12px;
      margin-top: clamp(18px, 3.6vw, 26px);
      padding-top: 14px; border-top: 1px solid var(--edge);
      color: var(--muted); font-size:12.5px; position:relative; z-index:2;
    }
    #loom2264 .live{ display:inline-flex; align-items:center; gap:8px; }
    #loom2264 .pulse{
      width:9px; height:9px; border-radius:50%;
      background: hsl(var(--p1));
      box-shadow: 0 0 0 0 color-mix(in hsl, hsl(var(--p1) / 55%), transparent);
      animation: pulse2264 2s ease-out infinite;
    }
    @keyframes pulse2264{ 0%{ box-shadow: 0 0 0 0 color-mix(in hsl, hsl(var(--p1) / 55%), transparent);} 100%{ box-shadow: 0 0 0 14px transparent;} }

    /* Motion safety */
    @media (prefers-reduced-motion: reduce){
      #loom2264 *{ animation: none !important; transition: none !important; }
    }
  </style>

  <div class="bar">
    <div class="badge">
      <span class="glyph" aria-hidden="true"></span>
      Nocturne Atelier
      <span style="opacity:.6; font-weight:800; font-size:12px; letter-spacing:.18em; text-transform:uppercase; margin-left:6px;">Edition 2264</span>
    </div>
    <div class="actions">
      <button id="theme2264" class="chip" aria-pressed="true" title="Toggle light/dark">Dark</button>
      <button id="form2264" class="chip" aria-pressed="true" title="Switch form">Lotus</button>
      <button id="shot2264" class="chip" title="Save snapshot">Capture</button>
      <button id="seed2264" class="btn" aria-pressed="false">Randomize</button>
    </div>
  </div>

  <div class="hero">
    <h1>Sculpted silence</h1>
    <p class="lede">A living print. Drag across the field—petals, halos, or fabric answer in light.</p>
  </div>

  <div class="stage" id="stage2264" aria-label="Generative canvas">
    <canvas id="canvas2264" role="img" aria-label="Luminous petals and halos morphing on a soft gradient field"></canvas>
    <div class="ring" aria-hidden="true"></div>
    <div class="grain" aria-hidden="true"></div>
  </div>

  <div class="dock" aria-label="Controls">
    <div class="seg" role="tablist" aria-label="Palettes">
      <button class="sw" id="palA2264" role="tab" aria-pressed="true">
        <span class="dot" aria-hidden="true"></span>
        Aster
      </button>
      <button class="sw" id="palB2264" role="tab" aria-pressed="false">
        <span class="dot" aria-hidden="true" style="background: conic-gradient(from 0deg, hsl(190 88% 50%), hsl(160 78% 50%), hsl(220 86% 60%), hsl(190 88% 50%)); box-shadow: 0 0 0 3px color-mix(in hsl, hsl(190 88% 50% / 30%), transparent);"></span>
        Lagoon
      </button>
      <button class="sw" id="palC2264" role="tab" aria-pressed="false">
        <span class="dot" aria-hidden="true" style="background: conic-gradient(from 0deg, hsl(14 86% 58%), hsl(344 86% 62%), hsl(40 88% 58%), hsl(14 86% 58%)); box-shadow: 0 0 0 3px color-mix(in hsl, hsl(14 86% 58% / 30%), transparent);"></span>
        Rose
      </button>
      <button class="sw" id="palD2264" role="tab" aria-pressed="false">
        <span class="dot" aria-hidden="true" style="background: conic-gradient(from 0deg, hsl(0 0% 92%), hsl(0 0% 60%), hsl(0 0% 24%), hsl(0 0% 92%)); box-shadow: 0 0 0 3px color-mix(in hsl, hsl(0 0% 70% / 30%), transparent);"></span>
        Graphite
      </button>
    </div>

    <div class="group" aria-label="Density">
      Density
      <input id="density2264" type="range" min="6" max="48" value="18" aria-valuemin="6" aria-valuemax="48" aria-valuenow="18" aria-label="Detail density">
    </div>
    <div class="group" aria-label="Glow">
      Glow
      <input id="glow2264" type="range" min="0" max="36" value="16" aria-valuemin="0" aria-valuemax="36" aria-valuenow="16" aria-label="Bloom strength">
    </div>
  </div>

  <div class="meta">
    <div class="live"><span class="pulse" aria-hidden="true"></span> Studio is live</div>
    <span id="last-updated">Last updated: 2026-01-29 01:43:29 EST</span>
  </div>

  <script>
    (function(){
      const root = document.getElementById('loom2264');
      const stage = document.getElementById('stage2264');
      const canvas = document.getElementById('canvas2264');
      const ctx = canvas.getContext('2d', { alpha: true });

      const themeBtn = document.getElementById('theme2264');
      const formBtn = document.getElementById('form2264');
      const shotBtn = document.getElementById('shot2264');
      const seedBtn = document.getElementById('seed2264');

      const palA = document.getElementById('palA2264');
      const palB = document.getElementById('palB2264');
      const palC = document.getElementById('palC2264');
      const palD = document.getElementById('palD2264');

      const densityEl = document.getElementById('density2264');
      const glowEl = document.getElementById('glow2264');

      // Last updated
      const updated = document.getElementById('last-updated');
      try{
        const now = new Date();
        const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'local';
        const fmt = { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' };
        updated.textContent = `Updated ${now.toLocaleString(undefined, fmt)} (${tz})`;
      }catch(_){ updated.textContent = 'Updated just now'; }

      // Palettes
      const palettes = {
        aster:   { p1:[198,92,56], p2:[272,84,62], p3:[16,86,62] },
        lagoon:  { p1:[190,88,50], p2:[160,78,50], p3:[220,86,60] },
        rose:    { p1:[14,86,58],  p2:[344,86,62], p3:[40,88,58] },
        graphite:{ p1:[0,0,92],    p2:[0,0,60],    p3:[0,0,24]   }
      };
      let pal = palettes.aster;
      function setPalette(p){
        pal = p;
        root.style.setProperty('--p1', `${p.p1[0]} ${p.p1[1]}% ${p.p1[2]}%`);
        root.style.setProperty('--p2', `${p.p2[0]} ${p.p2[1]}% ${p.p2[2]}%`);
        root.style.setProperty('--p3', `${p.p3[0]} ${p.p3[1]}% ${p.p3[2]}%`);
        [palA,palB,palC,palD].forEach(b=>b.setAttribute('aria-pressed','false'));
        const map = new Map([[palA,palettes.aster],[palB,palettes.lagoon],[palC,palettes.rose],[palD,palettes.graphite]]);
        for(const [btn, pv] of map){ if(p===pv) btn.setAttribute('aria-pressed','true'); }
      }
      palA.addEventListener('click', ()=>setPalette(palettes.aster));
      palB.addEventListener('click', ()=>setPalette(palettes.lagoon));
      palC.addEventListener('click', ()=>setPalette(palettes.rose));
      palD.addEventListener('click', ()=>setPalette(palettes.graphite));
      setPalette(palettes.aster);

      // State
      let form = 'lotus'; // 'lotus' | 'halo' | 'fabric'
      let density = parseInt(densityEl.value,10) || 18;
      let glow = parseInt(glowEl.value,10) || 16;
      let tiltX=0, tiltY=0;
      densityEl.addEventListener('input', e=>{ density = Math.max(6, Math.min(48, parseInt(e.target.value,10)||18)); densityEl.setAttribute('aria-valuenow', String(density)); });
      glowEl.addEventListener('input', e=>{ glow = Math.max(0, Math.min(36, parseInt(e.target.value,10)||16)); glowEl.setAttribute('aria-valuenow', String(glow)); root.style.setProperty('--glow', glow); });

      // Theme
      themeBtn.addEventListener('click', ()=>{
        const next = root.getAttribute('data-theme')==='light' ? 'dark' : 'light';
        root.setAttribute('data-theme', next);
        themeBtn.textContent = next.charAt(0).toUpperCase() + next.slice(1);
        themeBtn.setAttribute('aria-pressed', next==='dark' ? 'true' : 'false');
        clear(true);
      });

      // Form toggle
      formBtn.addEventListener('click', ()=>{
        form = (form==='lotus') ? 'halo' : (form==='halo' ? 'fabric' : 'lotus');
        formBtn.textContent = form.charAt(0).toUpperCase() + form.slice(1);
        formBtn.setAttribute('aria-pressed', form==='lotus' ? 'true' : 'false');
        reseed(); clear(true);
      });

      // Seeded randomness
      let seed = Math.random()*10000;
      function rnd(){ const x = Math.sin(seed+=0.12345)*43758.5453; return x-Math.floor(x); }
      function reseed(){ seed = Math.random()*10000; }

      seedBtn.addEventListener('click', ()=>{ reseed(); });

      // Resize & DPR
      let dpr = Math.min(2, window.devicePixelRatio || 1);
      function resize(){
        const r = stage.getBoundingClientRect();
        canvas.width = Math.max(2, Math.floor(r.width * dpr));
        canvas.height = Math.max(2, Math.floor(r.height * dpr));
        canvas.style.width = r.width + 'px';
        canvas.style.height = r.height + 'px';
        ctx.setTransform(1,0,0,1,0,0);
        ctx.scale(dpr, dpr);
        clear(true);
      }
      function clear(hard){
        const r = stage.getBoundingClientRect();
        const isLight = root.getAttribute('data-theme')==='light';
        ctx.globalCompositeOperation = 'source-over';
        ctx.globalAlpha = 1;
        ctx.fillStyle = isLight ? '#f7fbff' : '#0b0e14';
        ctx.fillRect(0,0,r.width,r.height);
        if(!hard){
          const cg = ctx.createRadialGradient(r.width/2, r.height/2, Math.min(r.width,r.height)*0.10, r.width/2, r.height/2, Math.max(r.width,r.height)*0.8);
          if(isLight){
            cg.addColorStop(0, 'rgba(255,255,255,0.35)');
            cg.addColorStop(1, 'rgba(255,255,255,0)');
          }else{
            cg.addColorStop(0, 'rgba(255,255,255,0.08)');
            cg.addColorStop(1, 'rgba(0,0,0,0)');
          }
          ctx.fillStyle = cg; ctx.fillRect(0,0,r.width,r.height);
        }
      }
      resize();
      addEventListener('resize', ()=>{ dpr = Math.min(2, window.devicePixelRatio || 1); resize(); });

      // Pointer
      let mx=0.5, my=0.5, pointerDown=false;
      stage.addEventListener('pointermove', (e)=>{
        const r = stage.getBoundingClientRect();
        mx = Math.min(1, Math.max(0, (e.clientX - r.left)/r.width));
        my = Math.min(1, Math.max(0, (e.clientY - r.top)/r.height));
        tiltY = (mx - 0.5) * 8;
        tiltX = -(my - 0.5) * 6;
        stage.style.transform = `rotateX(${tiltX}deg) rotateY(${tiltY}deg)`;
      }, {passive:true});
      stage.addEventListener('pointerleave', ()=>{ stage.style.transform = 'rotateX(0deg) rotateY(0deg)'; pointerDown=false; });
      stage.addEventListener('pointerdown', ()=>{ pointerDown=true; });
      stage.addEventListener('pointerup', ()=>{ pointerDown=false; });

      // Animation forms
      function hsla(h,s,l,a=1){ return `hsla(${h}, ${s}%, ${l}%, ${a})`; }
      function lerp(a,b,t){ return a+(b-a)*t; }

      function drawLotus(t,time){
        const r = stage.getBoundingClientRect();
        const w = r.width, h = r.height, cx=w/2, cy=h/2;
        const petals = Math.max(6, Math.floor(density * 0.8));
        const rot = time*0.12 + (mx-0.5)*0.6;
        const base = Math.min(w,h)*0.23;
        const amp = Math.min(w,h)*(0.08 + (my)*0.12);
        const layers = 4;

        ctx.globalCompositeOperation = 'source-over';
        ctx.globalAlpha = 0.10;
        ctx.fillStyle = root.getAttribute('data-theme')==='light' ? 'rgba(255,255,255,0.10)' : 'rgba(10,14,21,0.12)';
        ctx.fillRect(0,0,w,h);

        ctx.globalCompositeOperation = 'lighter';
        for(let L=0; L<layers; L++){
          const twist = rot + L*0.08 + Math.sin(time*0.25 + L)*0.06;
          const localAmp = amp * (1 + L*0.15);
          const localBase = base + L*20;
          const hue = [pal.p1[0], pal.p2[0], pal.p3[0]][L%3];
          const sat = [pal.p1[1], pal.p2[1], pal.p3[1]][L%3];
          const lum = [pal.p1[2], pal.p2[2], pal.p3[2]][L%3];

          const grad = ctx.createRadialGradient(cx, cy, 0, cx, cy, localBase + localAmp + 80);
          grad.addColorStop(0, hsla((hue+8)%360, sat, Math.min(92, lum+20), 0.35));
          grad.addColorStop(1, hsla((hue+48)%360, sat, Math.max(28, lum-20), 0));
          ctx.fillStyle = grad;
          ctx.shadowColor = hsla(hue, sat, Math.min(85, lum+10), 0.6);
          ctx.shadowBlur = glow + L*2;

          ctx.beginPath();
          const steps = Math.max(320, petals*40);
          for(let i=0;i<=steps;i++){
            const theta = (i/steps) * Math.PI*2;
            const r0 = localBase + localAmp * Math.pow(Math.sin((petals)* (theta*0.5 + twist)), 2);
            const x = cx + Math.cos(theta + twist) * r0;
            const y = cy + Math.sin(theta + twist) * r0;
            if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
          }
          ctx.closePath();
          ctx.fill();
        }

        // delicate veins
        ctx.shadowBlur = 0;
        ctx.globalCompositeOperation = 'screen';
        ctx.lineWidth = 1;
        for(let i=0;i<petals;i++){
          const a = rot + (i/petals)*Math.PI*2;
          const hue = pal.p2[0];
          ctx.strokeStyle = hsla(hue, pal.p2[1], Math.min(88, pal.p2[2]+16), 0.18);
          ctx.beginPath();
          ctx.moveTo(cx, cy);
          ctx.quadraticCurveTo(
            cx + Math.cos(a+0.4)*base*0.6,
            cy + Math.sin(a+0.4)*base*0.6,
            cx + Math.cos(a)* (base + amp*0.9),
            cy + Math.sin(a)* (base + amp*0.9)
          );
          ctx.stroke();
        }
      }

      function drawHalo(t,time){
        const r = stage.getBoundingClientRect();
        const w = r.width, h = r.height, cx=w/2, cy=h/2;
        const rings = Math.max(8, Math.floor(density*0.8));
        const base = Math.min(w,h)*0.18;
        const spread = Math.min(w,h)*0.5;
        ctx.globalCompositeOperation = 'source-over';
        ctx.globalAlpha = 0.12;
        ctx.fillStyle = root.getAttribute('data-theme')==='light' ? 'rgba(255,255,255,0.10)' : 'rgba(10,14,21,0.12)';
        ctx.fillRect(0,0,w,h);

        ctx.globalCompositeOperation = 'lighter';
        for(let i=0;i<rings;i++){
          const k = i/(rings-1);
          const rr = base + k*spread + Math.sin(time*0.8 + k*6 + mx*2.2)*10;
          const hue = lerp(pal.p1[0], pal.p3[0], k);
          const sat = lerp(pal.p1[1], pal.p3[1], k);
          const lum = lerp(pal.p1[2], pal.p3[2], k);
          ctx.beginPath();
          ctx.lineWidth = 2 + Math.sin(time*0.6 + k*8 + my*3.4)*1.2;
          ctx.strokeStyle = hsla(hue, sat, lum, 0.55);
          ctx.shadowColor = hsla(hue, sat, Math.min(90, lum+10), 0.7);
          ctx.shadowBlur = glow + 2;
          ctx.arc(cx, cy, rr, 0, Math.PI*2);
          ctx.stroke();
        }

        // sweeping arc
        const sweep = Math.PI*1.2 + Math.sin(time*0.5)*0.6;
        const ang = time*0.4 + (mx-0.5)*2.2;
        const hue = pal.p2[0];
        ctx.lineWidth = 8;
        ctx.strokeStyle = hsla(hue, pal.p2[1], Math.min(82, pal.p2[2]+6), 0.35);
        ctx.shadowColor = hsla(hue, pal.p2[1], Math.min(88, pal.p2[2]+14), 0.6);
        ctx.shadowBlur = glow + 6;
        ctx.beginPath();
        ctx.arc(cx, cy, base+spread*0.46, ang, ang + sweep);
        ctx.stroke();
      }

      function drawFabric(t,time){
        const r = stage.getBoundingClientRect();
        const w = r.width, h = r.height;
        ctx.globalCompositeOperation = 'source-over';
        ctx.globalAlpha = 0.10;
        ctx.fillStyle = root.getAttribute('data-theme')==='light' ? 'rgba(255,255,255,0.10)' : 'rgba(10,14,21,0.12)';
        ctx.fillRect(0,0,w,h);

        ctx.globalCompositeOperation = 'lighter';
        const bands = Math.max(4, Math.floor(density/4));
        for(let b=0;b<bands;b++){
          const k = b/(bands-1);
          const hue = [pal.p1[0], pal.p2[0], pal.p3[0]][b%3];
          const sat = [pal.p1[1], pal.p2[1], pal.p3[1]][b%3];
          const lum = [pal.p1[2], pal.p2[2], pal.p3[2]][b%3];
          const amp = 40 + k*80 + my*60;
          const freq = 0.003 + k*0.004;
          const phase = time*(0.8 + k*0.4) + mx*3 + rnd()*6;

          ctx.lineWidth = 6 + k*10;
          ctx.strokeStyle = hsla(hue, sat, lum, 0.45);
          ctx.shadowColor = hsla(hue, sat, Math.min(90, lum+10), 0.65);
          ctx.shadowBlur = glow + 4;

          ctx.beginPath();
          for(let x=-40; x<=w+40; x+=12){
            const y = h*0.5 + Math.sin(x*freq + phase) * amp + Math.sin(x*freq*0.7 + phase*0.6)*amp*0.3;
            if(x===-40) ctx.moveTo(x,y); else ctx.lineTo(x,y);
          }
          ctx.stroke();
        }
      }

      // Snapshot
      function snapshotName(){ return `nocturne-atelier-2264.png`; }
      shotBtn.addEventListener('click', ()=>{
        try{
          const rect = stage.getBoundingClientRect();
          const tmp = document.createElement('canvas');
          const tctx = tmp.getContext('2d');
          const scale = Math.min(2, window.devicePixelRatio || 1);
          tmp.width = Math.floor(rect.width * scale);
          tmp.height = Math.floor(rect.height * scale);
          tctx.scale(scale, scale);

          const isLight = root.getAttribute('data-theme')==='light';
          tctx.fillStyle = isLight ? '#f7fbff' : '#0b0e14';
          tctx.fillRect(0,0,rect.width,rect.height);
          tctx.drawImage(canvas, 0, 0, rect.width, rect.height);
          const a = document.createElement('a');
          a.href = tmp.toDataURL('image/png');
          a.download = snapshotName();
          document.body.appendChild(a); a.click(); a.remove();
        }catch(_){}
      });

      // Keyboard shortcuts
      window.addEventListener('keydown', (e)=>{
        const k = e.key.toLowerCase();
        if(k==='t') themeBtn.click();
        if(k==='m') formBtn.click();
        if(k==='s') shotBtn.click();
        if(k==='r') seedBtn.click();
        if(k==='1') palA.click();
        if(k==='2') palB.click();
        if(k==='3') palC.click();
        if(k==='4') palD.click();
      });

      // Animate
      let t0 = performance.now();
      function frame(now){
        const r = stage.getBoundingClientRect();
        const w = r.width, h = r.height;
        const dt = Math.min(32, now - t0) * 0.016;
        const time = now*0.001;

        // subtle trail
        ctx.globalCompositeOperation = 'source-over';
        ctx.globalAlpha = 0.05;
        const isLight = root.getAttribute('data-theme')==='light';
        ctx.fillStyle = isLight ? 'rgba(247,251,255,0.05)' : 'rgba(11,14,20,0.06)';
        ctx.fillRect(0,0,w,h);

        if(form==='lotus') drawLotus(dt,time);
        else if(form==='halo') drawHalo(dt,time);
        else drawFabric(dt,time);

        t0 = now;
        requestAnimationFrame(frame);
      }

      // Start
      clear(true);
      requestAnimationFrame(frame);

      // Respect reduced motion: render a handful of frames
      const prefersReduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
      if(prefersReduce){
        for(let i=0;i<80;i++){ frame(performance.now()+i*16); }
      }
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


