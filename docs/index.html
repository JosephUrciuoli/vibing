<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="vibe1585" data-theme="dawn" aria-live="polite">
  <style>
    /* Aurora Dial — v1585 */
    #vibe1585{
      --paper:#fbf9ff;
      --ink:#0d1321;
      --muted:#5a647a;
      --edge:rgba(13,19,33,.16);
      --p1:#6e8bff; --p2:#ffa3c3; --p3:#ffd57a; --p4:#8cf1cf;

      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
      color:var(--ink);
      padding:clamp(14px,3.4vw,40px);
      border-radius:30px;
      background:
        radial-gradient(120% 140% at 10% -10%, rgba(140,241,207,.18), transparent 40%),
        radial-gradient(150% 140% at 120% 120%, rgba(255,163,195,.14), transparent 45%),
        linear-gradient(180deg, #ffffff 0%, var(--paper) 100%);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.85),
        0 28px 80px rgba(13,19,33,.14);
      position:relative;
      overflow:hidden;
      isolation:isolate;
    }
    #vibe1585::before{
      /* fiber shimmer */
      content:""; position:absolute; inset:-20% -10%; pointer-events:none; z-index:0;
      background:
        repeating-linear-gradient(115deg, rgba(255,255,255,.06) 0 2px, transparent 2px 6px);
      transform: rotate(1deg);
      opacity:.32; mix-blend-mode:overlay;
    }

    /* Top bar */
    #vibe1585 .bar{ display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:14px; position:relative; z-index:2; }
    #vibe1585 .mark{
      display:inline-flex; align-items:center; gap:10px; padding:10px 14px; border-radius:14px;
      background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.65));
      border:1px solid var(--edge);
      font-weight:900; letter-spacing:.16em; text-transform:uppercase; font-size:11px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,1), 0 12px 26px rgba(13,19,33,.10);
    }
    #vibe1585 .orb{
      width:18px; height:18px; border-radius:50%;
      background:
        radial-gradient(circle at 30% 30%, var(--p3), transparent 60%),
        radial-gradient(circle at 70% 70%, var(--p1), transparent 65%),
        conic-gradient(from 0deg, var(--p1), var(--p2), var(--p3), var(--p4), var(--p1));
      box-shadow: 0 0 0 6px rgba(110,139,255,.12), 0 12px 28px rgba(13,19,33,.18);
    }
    #vibe1585 .badge{ color:var(--muted); font-weight:700; font-size:12px; opacity:.95; text-align:center; }
    #vibe1585 .themes{ display:flex; gap:8px; }
    #vibe1585 .chip{
      appearance:none; border:1px solid var(--edge);
      background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.65));
      color:var(--ink);
      padding:8px 12px; border-radius:999px; font-weight:900; font-size:11px; letter-spacing:.08em; text-transform:uppercase; cursor:pointer;
      box-shadow: inset 0 1px 0 rgba(255,255,255,1), 0 10px 22px rgba(13,19,33,.08);
      transition: transform 120ms ease, box-shadow 200ms ease, background 200ms ease, color 200ms ease, opacity 200ms ease;
      will-change: transform;
    }
    #vibe1585 .chip:hover{ transform: translateY(-1px); box-shadow: inset 0 1px 0 rgba(255,255,255,1), 0 18px 36px rgba(13,19,33,.16); }
    #vibe1585 .chip[aria-checked="true"]{
      background:linear-gradient(180deg, rgba(140,241,207,.55), rgba(255,255,255,.9));
      color:#0a1222;
    }

    /* Hero */
    #vibe1585 .hero{ margin: clamp(10px,3vw,24px) 0 4px; position:relative; z-index:2; }
    #vibe1585 .title{
      margin:0; line-height:.86; letter-spacing:-0.02em; font-weight:1000;
      font-size: clamp(48px, 9.8vw, 128px);
      background:
        linear-gradient(90deg, var(--ink), #2b3d7f 30%, #a23ea6 55%, #f0922e 80%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-wrap:balance;
    }
    #vibe1585 .sub{ margin:.55rem 0 0; color:var(--muted); font-size: clamp(14px,2vw,18px); }

    /* Dial stage */
    #vibe1585 .dial-wrap{ margin-top: clamp(16px,3.2vw,34px); display:grid; place-items:center; }
    #vibe1585 .dial{
      position:relative; width:min(84vw, 880px); aspect-ratio:1/1; border-radius:50%;
      border:1px solid var(--edge); overflow:hidden;
      background:
        radial-gradient(60% 60% at 50% 50%, rgba(255,255,255,.95), rgba(255,255,255,.6) 60%, rgba(255,255,255,.35) 100%);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.85),
        inset 0 -1px 0 rgba(255,255,255,.55),
        0 28px 76px rgba(13,19,33,.18);
      backdrop-filter: blur(2px);
      isolation:isolate;
    }
    #vibe1585 canvas#dial{ position:absolute; inset:0; width:100%; height:100%; display:block; z-index:1; }

    /* Tick rings */
    #vibe1585 .rings{
      position:absolute; inset:0; z-index:2; pointer-events:none; opacity:.25; mix-blend-mode:overlay;
      background:
        radial-gradient(circle at 50% 50%, rgba(0,0,0,.06) 1px, transparent 1px) 0 0/10px 10px,
        conic-gradient(from 0deg, rgba(0,0,0,.06) 0 2deg, transparent 2deg 8deg) 0 0/100% 100%;
      mask: radial-gradient(50% 50% at 50% 50%, #000 70%, transparent 100%);
    }

    /* HUD */
    #vibe1585 .hud{
      position:absolute; left:12px; right:12px; bottom:12px; z-index:3;
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:center;
      background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.65));
      backdrop-filter: blur(10px);
      border:1px solid var(--edge);
      border-radius:14px; padding:10px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,1);
    }
    #vibe1585 .group{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    #vibe1585 .btn{
      appearance:none; border:1px solid var(--edge);
      background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.7)); color:var(--ink);
      padding:8px 12px; border-radius:10px; font-weight:900; cursor:pointer; font-size:12px;
      box-shadow: 0 12px 24px rgba(13,19,33,.12), inset 0 1px 0 rgba(255,255,255,1);
      transition: transform 120ms ease, box-shadow 180ms ease, background 220ms ease, color 200ms ease;
    }
    #vibe1585 .btn:hover{ transform: translateY(-1px); box-shadow: 0 18px 38px rgba(13,19,33,.18), inset 0 1px 0 rgba(255,255,255,1); }
    #vibe1585 .range{
      display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:10px; border:1px solid var(--edge);
      background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.65));
      box-shadow: inset 0 1px 0 rgba(255,255,255,1);
      font-weight:800; font-size:12px; color:var(--muted);
    }
    #vibe1585 input[type="range"]{
      appearance:none; height:6px; width:140px; background:linear-gradient(90deg, var(--p1), var(--p2), var(--p3)); border-radius:999px; outline:none;
    }
    #vibe1585 input[type="range"]::-webkit-slider-thumb{
      appearance:none; width:16px; height:16px; border-radius:50%; background: white; border:1px solid var(--edge); box-shadow:0 2px 6px rgba(13,19,33,.2);
    }
    #vibe1585 .val{ font-variant-numeric: tabular-nums; color:var(--ink); }

    /* Footer */
    #vibe1585 .foot{ margin-top:16px; display:flex; align-items:center; justify-content:space-between; gap:10px; color:var(--muted); font-size:12px; z-index:2; position:relative; }
    #vibe1585 #last-updated{
      font-variant-numeric: tabular-nums; font-weight:900; color:var(--ink);
      background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.7));
      border:1px solid var(--edge);
      padding:6px 10px; border-radius:10px; box-shadow: inset 0 1px 0 rgba(255,255,255,1);
    }

    /* Themes */
    #vibe1585[data-theme="dawn"]{
      --paper:#fbf9ff; --ink:#0d1321; --muted:#5a647a; --edge:rgba(13,19,33,.16);
      --p1:#6e8bff; --p2:#ffa3c3; --p3:#ffd57a; --p4:#8cf1cf;
    }
    #vibe1585[data-theme="obsidian"]{
      --paper:#0c0f14; --ink:#e9f0ff; --muted:#9fb3d4; --edge:rgba(255,255,255,.16);
      --p1:#79a7ff; --p2:#ff8bbd; --p3:#ffd06e; --p4:#6ef3cd;
      background:
        radial-gradient(160% 140% at 10% -10%, rgba(110,243,205,.18), transparent 40%),
        radial-gradient(180% 160% at 120% 120%, rgba(255,139,189,.18), transparent 50%),
        linear-gradient(180deg, #0d121a, #0c0f14);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.08),
        0 28px 80px rgba(0,0,0,.5);
    }
    #vibe1585[data-theme="neomint"]{
      --paper:#ecfff7; --ink:#0f1320; --muted:#4d6a66; --edge:rgba(15,19,32,.14);
      --p1:#2fd2a0; --p2:#65e9d0; --p3:#b6ffd6; --p4:#79a2ff;
    }
    #vibe1585[data-theme="sunset"]{
      --paper:#fff3ec; --ink:#1a1310; --muted:#6d5a52; --edge:rgba(26,19,16,.14);
      --p1:#ff7a3a; --p2:#ffb0a1; --p3:#ffd27a; --p4:#7ec8ff;
    }

    /* Responsive */
    @media (max-width:760px){
      #vibe1585 .bar{ grid-template-columns:1fr; }
      #vibe1585 .badge{ display:none; }
      #vibe1585 input[type="range"]{ width:100px; }
    }
    @media (prefers-reduced-motion: reduce){
      #vibe1585 .title{ transition:none; }
    }
  </style>

  <div class="bar">
    <span class="mark"><span class="orb" aria-hidden="true"></span>STUDIO 1585</span>
    <div class="badge" aria-hidden="true">Aurora Dial — sculpted light + time</div>
    <div class="themes" role="radiogroup" aria-label="Theme">
      <button type="button" class="chip theme" data-theme="dawn" aria-checked="true">Dawn</button>
      <button type="button" class="chip theme" data-theme="obsidian" aria-checked="false">Obsidian</button>
      <button type="button" class="chip theme" data-theme="neomint" aria-checked="false">NeoMint</button>
      <button type="button" class="chip theme" data-theme="sunset" aria-checked="false">Sunset</button>
    </div>
  </div>

  <div class="hero">
    <h1 class="title" role="heading" aria-level="1">AURORA DIAL</h1>
    <p class="sub">Spin threads of light. Touch the dial to bend the flow.</p>
  </div>

  <div class="dial-wrap">
    <div class="dial" role="img" aria-label="Circular aurora made of flowing colored filaments, responsive to touch">
      <canvas id="dial"></canvas>
      <div class="rings" aria-hidden="true"></div>
      <div class="hud" role="group" aria-label="Controls">
        <div class="group" role="radiogroup" aria-label="Style">
          <button type="button" class="chip mode" data-mode="weave" aria-checked="true">Weave</button>
          <button type="button" class="chip mode" data-mode="bloom" aria-checked="false">Bloom</button>
          <button type="button" class="chip mode" data-mode="orbit" aria-checked="false">Orbit</button>
        </div>
        <div class="group">
          <label class="range" for="tempo">Tempo <span class="val" id="tempoVal">1.0x</span>
            <input id="tempo" type="range" min="0.5" max="2.5" step="0.1" value="1.0" aria-label="Animation tempo">
          </label>
          <label class="range" for="glow">Glow <span class="val" id="glowVal">0.30</span>
            <input id="glow" type="range" min="0.1" max="0.6" step="0.01" value="0.30" aria-label="Trail persistence">
          </label>
          <label class="range" for="density">Threads <span class="val" id="densityVal">1100</span>
            <input id="density" type="range" min="300" max="2400" step="100" value="1100" aria-label="Thread density">
          </label>
        </div>
        <div class="group">
          <button type="button" class="btn" id="shuffle">Calibrate</button>
          <button type="button" class="btn" id="toggle">Pause</button>
          <button type="button" class="btn" id="save">Snap</button>
          <button type="button" class="btn" id="record">Record 5s</button>
        </div>
      </div>
    </div>
  </div>

  <div class="foot">
    <span>“Time is the brush; motion, the color.”</span>
    <span id="last-updated">Last updated: 2025-12-28 13:27:04 EST</span>
  </div>

  <script>
    (function(){
      const root = document.getElementById('vibe1585');

      // Last updated
      const lu = root.querySelector('#last-updated');
      try{
        const now = new Date();
        const opts = { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' };
        lu.textContent = 'Updated ' + now.toLocaleString([], opts);
      }catch(e){}

      // Elements
      const canvas = root.querySelector('#dial');
      const ctx = canvas.getContext('2d', { alpha:true });
      const dial = root.querySelector('.dial');
      let dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));

      function fit(){
        const r = dial.getBoundingClientRect();
        canvas.width = Math.floor(r.width * dpr);
        canvas.height = Math.floor(r.height * dpr);
        canvas.style.width = r.width + 'px';
        canvas.style.height = r.height + 'px';
        ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
        reset(true);
      }
      fit();
      window.addEventListener('resize', ()=>{ dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1)); fit(); });

      // Utilities
      const lerp = (a,b,t)=>a+(b-a)*t;
      function cssVar(name){ return getComputedStyle(root).getPropertyValue(name).trim() || '#ffffff'; }
      function hexToRgb(hex){ let h = hex.replace('#','').trim(); if(h.length===3){ h=h.split('').map(x=>x+x).join(''); } const n=parseInt(h,16); return [(n>>16)&255,(n>>8)&255,n&255]; }
      function rgba(c,a){ return `rgba(${c[0]},${c[1]},${c[2]},${a})`; }
      function flash(el){ try{ el.animate([{ filter:'saturate(160%) brightness(1.05)' }, { filter:'saturate(115%) brightness(1)' }], { duration:420, easing:'cubic-bezier(.2,.8,.2,1)' }); }catch(_){ } }

      // Palette
      const palKeys = ['--p1','--p2','--p3','--p4'];
      function readPalette(){ return palKeys.map(k=>hexToRgb(cssVar(k))); }
      let palette = readPalette();

      // Theme switching
      const themeBtns = Array.from(root.querySelectorAll('.theme'));
      function setTheme(btn){
        themeBtns.forEach(b=>b.setAttribute('aria-checked', String(b===btn)));
        root.setAttribute('data-theme', btn.dataset.theme);
        palette = readPalette();
        reset();
        flash(btn);
      }
      themeBtns.forEach(b=>{
        b.addEventListener('click', ()=> setTheme(b));
        b.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); setTheme(b); }});
      });

      // Modes
      const modeBtns = Array.from(root.querySelectorAll('.mode'));
      let mode = 'weave';
      function setMode(btn){
        modeBtns.forEach(b=>b.setAttribute('aria-checked', String(b===btn)));
        mode = btn.dataset.mode;
        reset();
        flash(btn);
      }
      modeBtns.forEach(b=>{
        b.addEventListener('click', ()=> setMode(b));
        b.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); setMode(b); }});
      });

      // Controls
      const tempoEl = root.querySelector('#tempo');
      const glowEl = root.querySelector('#glow');
      const densityEl = root.querySelector('#density');
      const tempoVal = root.querySelector('#tempoVal');
      const glowVal = root.querySelector('#glowVal');
      const densityVal = root.querySelector('#densityVal');

      function syncVals(){
        tempoVal.textContent = parseFloat(tempoEl.value).toFixed(1) + 'x';
        glowVal.textContent = parseFloat(glowEl.value).toFixed(2);
        densityVal.textContent = densityEl.value;
      }
      syncVals();
      ['input','change'].forEach(ev=>{
        tempoEl.addEventListener(ev, syncVals);
        glowEl.addEventListener(ev, syncVals);
        densityEl.addEventListener(ev, ()=>{ syncVals(); reset(); });
      });

      // Random seed
      let seed = Math.floor(Math.random()*1e9);
      function mulberry32(a){ return function(){ let t = a += 0x6D2B79F5; t = Math.imul(t ^ t>>>15, t | 1); t ^= t + Math.imul(t ^ t>>>7, t | 61); return ((t ^ t>>>14) >>> 0) / 4294967296; } }
      let rng = mulberry32(seed);
      function reseed(){
        seed = Math.floor(Math.random()*1e9);
        rng = mulberry32(seed);
      }

      // Seeded hash + value noise
      function hash2(ix, iy){
        let n = ix * 374761393 + iy * 668265263 + seed;
        n = (n ^ (n >> 13)) >>> 0;
        n = Math.imul(n, 1274126177) >>> 0;
        return (n & 0x7fffffff) / 0x7fffffff;
      }
      function smooth(t){ return t*t*(3-2*t); }
      function noise2(x, y){
        const xi = Math.floor(x), yi = Math.floor(y);
        const xf = x - xi, yf = y - yi;
        const v00 = hash2(xi, yi);
        const v10 = hash2(xi+1, yi);
        const v01 = hash2(xi, yi+1);
        const v11 = hash2(xi+1, yi+1);
        const u = smooth(xf), v = smooth(yf);
        const a = lerp(v00, v10, u);
        const b = lerp(v01, v11, u);
        return lerp(a, b, v);
      }

      // Particles
      let threads = [];
      let t = 0;
      const pointer = { x:0.5, y:0.5, active:false };

      function reset(keep=false){
        const w = canvas.width / dpr, h = canvas.height / dpr;
        const count = parseInt(densityEl.value, 10);
        if(!keep || threads.length !== count){
          threads = new Array(count).fill(0).map((_,i)=>{
            const a = rng()*Math.PI*2;
            const r = Math.sqrt(rng()) * Math.min(w,h)*0.48;
            const x = w/2 + Math.cos(a)*r;
            const y = h/2 + Math.sin(a)*r;
            return {
              x, y, px:x, py:y,
              hue: palette[i % palette.length],
              w: 0.9 + (i%7)/12,
            };
          });
          ctx.clearRect(0,0,w,h);
        }else{
          // recolor on theme change
          for(let i=0;i<threads.length;i++){ threads[i].hue = palette[i % palette.length]; }
        }
      }
      reset();

      // Pointer
      function onPoint(e){
        const r = dial.getBoundingClientRect();
        const pt = e.touches ? e.touches[0] : e;
        pointer.x = Math.max(0, Math.min(1, (pt.clientX - r.left) / r.width));
        pointer.y = Math.max(0, Math.min(1, (pt.clientY - r.top) / r.height));
        pointer.active = true;
      }
      function offPoint(){ pointer.active = false; }
      dial.addEventListener('pointermove', onPoint, { passive:true });
      dial.addEventListener('pointerleave', offPoint, { passive:true });
      dial.addEventListener('touchmove', onPoint, { passive:true });
      dial.addEventListener('touchend', offPoint, { passive:true });

      // Buttons
      const shuffleBtn = root.querySelector('#shuffle');
      const toggleBtn = root.querySelector('#toggle');
      const saveBtn = root.querySelector('#save');
      const recordBtn = root.querySelector('#record');

      shuffleBtn.addEventListener('click', ()=>{
        reseed(); palette = readPalette(); reset();
        flash(shuffleBtn);
      });

      let running = true;
      toggleBtn.addEventListener('click', ()=>{
        running = !running;
        toggleBtn.textContent = running ? 'Pause' : 'Play';
        if(running) requestAnimationFrame(loop);
      });

      saveBtn.addEventListener('click', ()=>{
        try{
          const rect = canvas.getBoundingClientRect();
          const scale = 2;
          const off = document.createElement('canvas');
          off.width = Math.floor(rect.width*scale);
          off.height = Math.floor(rect.height*scale);
          const octx = off.getContext('2d');
          // Fill poster background to theme paper
          octx.fillStyle = getComputedStyle(root).getPropertyValue('--paper').trim() || '#ffffff';
          octx.fillRect(0,0,off.width,off.height);
          // draw dial with soft vignette
          octx.drawImage(canvas, 0, 0, off.width, off.height);
          off.toBlob((blob)=>{
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'aurora-1585.png';
            document.body.appendChild(a); a.click(); URL.revokeObjectURL(a.href); a.remove();
          });
          flash(saveBtn);
        }catch(e){}
      });

      // Recording (5s webm)
      let recording = false;
      recordBtn.addEventListener('click', ()=>{
        if(recording) return;
        try{
          const stream = canvas.captureStream(60);
          const rec = new MediaRecorder(stream, { mimeType:'video/webm;codecs=vp9' });
          const chunks = [];
          rec.ondataavailable = e=>{ if(e.data.size) chunks.push(e.data); };
          rec.onstop = ()=>{
            const blob = new Blob(chunks, { type:'video/webm' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'aurora-1585.webm';
            document.body.appendChild(a); a.click(); URL.revokeObjectURL(a.href); a.remove();
            recording = false; recordBtn.textContent = 'Record 5s';
          };
          rec.start();
          recording = true; recordBtn.textContent = 'Recording…';
          setTimeout(()=> rec.stop(), 5000);
          flash(recordBtn);
        }catch(e){}
      });

      // Draw loop
      function step(){
        const w = canvas.width / dpr, h = canvas.height / dpr;
        const cx = w/2, cy = h/2;
        const tempo = parseFloat(tempoEl.value);
        const fade = parseFloat(glowEl.value);
        const light = root.getAttribute('data-theme')!=='obsidian';

        // fade
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = light ? `rgba(255,255,255,${fade})` : `rgba(12,15,20,${fade})`;
        ctx.fillRect(0,0,w,h);

        // field controls
        const baseFreq = 0.0022 * Math.min(w,h);
        const time = t * (0.14 * tempo);

        // pointer space
        const px = w * pointer.x, py = h * pointer.y;

        // draw
        ctx.globalCompositeOperation = light ? 'multiply' : 'screen';

        for(let i=0;i<threads.length;i++){
          const p = threads[i];
          p.px = p.x; p.py = p.y;

          // Vector field in polar space
          const dx = p.x - cx, dy = p.y - cy;
          const r = Math.max(10, Math.hypot(dx, dy));
          const angCenter = Math.atan2(dy, dx);

          const nx = (p.x * baseFreq), ny = (p.y * baseFreq);
          let n = noise2(nx + time, ny - time);
          n = n*2 - 1; // [-1,1]

          // pointer gravity
          let pull = 0;
          if(pointer.active){
            const pdx = px - p.x, pdy = py - p.y;
            const pd = Math.hypot(pdx, pdy) + 1e-5;
            pull = Math.min(1, 140 / pd);
          }

          // angle blend
          let theta;
          if(mode==='orbit'){
            theta = angCenter + n*0.9 + pull*0.4;
          }else if(mode==='bloom'){
            theta = angCenter + n*0.6 + (Math.sin(time*2 + r*0.02)*0.4) + pull*0.2;
          }else{ // weave
            theta = angCenter + n*1.3 + pull*0.3;
          }

          // speed by radius
          const s = (0.8 + (i%7)/9) * (0.6 + (0.3*Math.sin(r*0.01+time))) * tempo;
          p.x += Math.cos(theta) * s;
          p.y += Math.sin(theta) * s;

          // soft wrap inside circle
          const rr = Math.min(w,h)*0.49;
          const ddx = p.x - cx, ddy = p.y - cy;
          const rad = Math.hypot(ddx, ddy);
          if(rad > rr){
            const ang = Math.atan2(ddy, ddx) + Math.PI;
            p.x = cx + Math.cos(ang) * (rr - 2);
            p.y = cy + Math.sin(ang) * (rr - 2);
          }

          // stroke
          const col = p.hue;
          if(mode==='bloom'){
            ctx.fillStyle = rgba(col, light ? 0.28 : 0.75);
            ctx.beginPath();
            ctx.arc(p.x, p.y, 0.8 + (p.w*0.6), 0, Math.PI*2);
            ctx.fill();
          }else if(mode==='orbit'){
            ctx.strokeStyle = rgba(col, light ? 0.25 : 0.7);
            ctx.lineWidth = Math.max(0.7, p.w*0.9);
            ctx.beginPath();
            const vx = p.x - p.px, vy = p.y - p.py;
            ctx.moveTo(p.x, p.y);
            ctx.lineTo(p.x - vx*1.8, p.y - vy*1.8);
            ctx.stroke();
          }else{ // weave
            const grad = ctx.createLinearGradient(p.px, p.py, p.x, p.y);
            grad.addColorStop(0, rgba(col, light ? 0.18 : 0.55));
            grad.addColorStop(1, rgba(col, light ? 0.36 : 0.85));
            ctx.strokeStyle = grad;
            ctx.lineWidth = Math.max(0.8, p.w*1.1);
            ctx.beginPath();
            ctx.moveTo(p.px, p.py);
            ctx.lineTo(p.x, p.y);
            ctx.stroke();
          }
        }

        // subtle iris
        ctx.globalCompositeOperation = light ? 'multiply' : 'screen';
        const iris = hexToRgb(cssVar('--p4'));
        ctx.beginPath();
        ctx.arc(cx, cy, Math.min(w,h)*0.34, 0, Math.PI*2);
        ctx.strokeStyle = rgba(iris, light ? 0.06 : 0.12);
        ctx.lineWidth = 2;
        ctx.stroke();

        t += 0.006;
      }

      function loop(){
        if(!running) return;
        step();
        requestAnimationFrame(loop);
      }
      requestAnimationFrame(loop);
    }());
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


