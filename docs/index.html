<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<style>
  .k819 {
    --bg1: hsl(45 60% 96%);
    --bg2: hsl(190 60% 94%);
    --ink: hsl(222 28% 12%);
    --muted: hsl(222 12% 38%);
    --panel: hsl(0 0% 100% / .65);
    --edge: hsl(220 10% 30% / .16);
    --a: 196 88% 46%;
    --b: 280 82% 52%;
    --c: 16 86% 54%;
    position: relative;
    border-radius: 28px;
    padding: clamp(24px, 5vw, 56px);
    color: var(--ink);
    overflow: hidden;
    isolation: isolate;
    background:
      radial-gradient(1200px 800px at 120% -10%, hsl(var(--a) / .08), transparent 60%),
      radial-gradient(1200px 800px at -20% 110%, hsl(var(--b) / .08), transparent 60%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
    box-shadow:
      0 60px 160px hsl(220 30% 20% / .14),
      inset 0 0 0 1px var(--edge);
  }
  .k819[data-theme="dark"]{
    --bg1: hsl(230 40% 10%);
    --bg2: hsl(258 40% 14%);
    --ink: hsl(0 0% 98%);
    --muted: hsl(0 0% 80%);
    --panel: hsl(0 0% 100% / .06);
    --edge: hsl(0 0% 100% / .14);
    box-shadow:
      0 60px 160px hsl(240 60% 4% / .55),
      inset 0 0 0 1px var(--edge);
  }
  .k819::after{
    content:"";
    position:absolute; inset:-20%;
    background: conic-gradient(from 0deg at 50% 50%, hsl(0 0% 100% / .06), transparent 22%, hsl(0 0% 100% / .08) 40%, transparent 66%, hsl(0 0% 100% / .06) 85%, transparent);
    mix-blend-mode: soft-light;
    filter: blur(14px);
    pointer-events: none;
    z-index: 0;
  }

  .k819-top {
    display:grid; grid-template-columns: 1fr auto; gap: clamp(12px, 3vw, 28px);
    align-items:center; position:relative; z-index:3; margin-bottom: clamp(16px, 4vw, 42px);
  }
  .k819-brand { display:grid; gap: 8px; }
  .k819-brand h1{
    margin:0;
    font: 900 clamp(28px, 7vw, 92px)/.88 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    letter-spacing:-0.02em;
    background:
      linear-gradient(90deg, hsl(0 0% 100% / .8), hsl(0 0% 100% / .8)) padding-box,
      linear-gradient(90deg, hsl(var(--a)), hsl(var(--b)), hsl(var(--c))) text;
    -webkit-background-clip: padding-box, text; background-clip: padding-box, text;
    color: transparent; -webkit-text-fill-color: transparent;
  }
  .k819-brand p{
    margin:0;
    color: var(--muted);
    font: 600 clamp(12px, 1.6vw, 18px)/1.6 ui-sans-serif, system-ui;
  }

  .k819-ctrls { display:grid; grid-auto-flow: column; gap: 10px; justify-content:end; align-items:center; }
  .k819 .chip{
    appearance:none; border:0; cursor:pointer; position:relative; overflow:hidden;
    font: 800 12px/1 ui-sans-serif, system-ui, -apple-system;
    padding: 11px 14px; border-radius: 999px; color: var(--ink);
    background: linear-gradient(180deg, var(--panel), hsl(0 0% 100% / .05));
    border:1px solid var(--edge);
    box-shadow: 0 12px 24px hsl(220 35% 20% / .10), inset 0 1px 0 hsl(0 0% 100% / .18);
    transform: translateZ(0);
    transition: transform 160ms ease, box-shadow 160ms ease, background 160ms ease, opacity .2s ease;
  }
  .k819[data-theme="dark"] .chip{
    box-shadow: 0 12px 24px hsl(240 35% 6% / .50), inset 0 1px 0 hsl(0 0% 100% / .10);
  }
  .k819 .chip:hover { transform: translateY(-2px); }
  .k819 .chip .ink{
    position:absolute; inset:0; border-radius:inherit; pointer-events:none;
    background: radial-gradient(140px 140px at var(--mx,50%) var(--my,50%), hsl(0 0% 100% / .24), transparent 66%);
    opacity:0; transition: opacity .16s ease;
  }
  .k819 .chip:hover .ink{ opacity:1; }

  .k819 .knob{
    display:inline-grid; grid-auto-flow:column; gap:8px; align-items:center;
    padding: 8px 12px; border-radius:999px; color: var(--ink);
    background: linear-gradient(180deg, var(--panel), hsl(0 0% 100% / .05));
    border:1px solid var(--edge);
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .18);
    font: 600 12px ui-sans-serif, system-ui;
  }
  .k819 input[type="range"]{ -webkit-appearance:none; appearance:none; width: 140px; height: 28px; background: transparent; }
  .k819 input[type="range"]::-webkit-slider-runnable-track{
    height:8px; border-radius:999px; background: linear-gradient(90deg, hsl(var(--a)), hsl(var(--b)), hsl(var(--c)));
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .5);
  }
  .k819 input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none; appearance:none; width:18px; height:18px; border-radius:50%;
    background:white; border:1px solid var(--edge); margin-top:-5px;
    box-shadow: 0 4px 10px hsl(240 30% 6% / .35);
  }
  .k819 input[type="range"]::-moz-range-track{
    height:8px; border-radius:999px; background: linear-gradient(90deg, hsl(var(--a)), hsl(var(--b)), hsl(var(--c)));
  }
  .k819 input[type="range"]::-moz-range-thumb{
    width:18px; height:18px; border-radius:50%; background:white; border:1px solid var(--edge);
  }

  .k819-scene{
    position: relative; z-index: 1;
    display:grid; place-items:center;
    min-height: min(78vh, 720px);
    border-radius: 24px;
    overflow:hidden;
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .08), 0 40px 120px hsl(240 60% 4% / .25);
  }
  .k819-canvas{ position:absolute; inset:0; width:100%; height:100%; display:block; }
  .k819-grain{ position:absolute; inset:-10%; background: repeating-radial-gradient(circle at 30% 40%, hsl(0 0% 100% / .02) 0 2px, transparent 2px 6px); mix-blend-mode: soft-light; filter: blur(0.5px); pointer-events:none; }
  .k819-card{
    position: relative; z-index:3;
    display:grid; gap: clamp(8px, 2.2vw, 16px); text-align:center;
    padding: clamp(18px, 3.2vw, 28px) clamp(18px, 3.6vw, 34px);
    border:1px solid var(--edge);
    border-radius: 18px;
    background: linear-gradient(180deg, var(--panel), transparent);
    box-shadow: 0 24px 64px hsl(240 60% 4% / .35), inset 0 1px 0 hsl(0 0% 100% / .18);
  }
  .k819-card h2{
    margin:0;
    font: 800 clamp(22px, 5.8vw, 54px)/1.02 ui-sans-serif, system-ui, -apple-system;
    letter-spacing:-0.01em;
    background: linear-gradient(90deg, hsl(var(--a)), hsl(var(--b)), hsl(var(--c)));
    -webkit-background-clip: text; background-clip: text; color: transparent; -webkit-text-fill-color: transparent;
  }
  .k819-card p{
    margin:0;
    color: var(--muted);
    font: 600 clamp(13px, 1.6vw, 18px)/1.6 ui-sans-serif, system-ui;
  }
  .k819-actions{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }

  .k819-foot{
    position: relative; z-index: 3;
    margin-top: clamp(18px, 3.2vw, 28px);
    display:flex; justify-content:space-between; align-items:center; gap:12px;
    color: var(--muted);
    font: 500 12px/1.4 ui-sans-serif, system-ui;
  }
  .k819 .hint{
    font: 700 11px/1 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    background: hsl(0 0% 100% / .08);
    border: 1px solid var(--edge);
    padding: 6px 8px; border-radius: 8px; color: var(--ink);
  }
  .k819[data-theme="dark"] .hint{ background: hsl(0 0% 0% / .12); color: var(--ink); }

  /* Status badge */
  .k819-badge{
    display:inline-grid; grid-auto-flow:column; gap:6px; align-items:center;
    padding:6px 10px; border-radius:999px; background:hsl(0 0% 100% / .16); border:1px solid var(--edge);
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .25);
    font: 800 11px/1 ui-sans-serif, system-ui;
    color: var(--ink);
  }

  /* Tooltip style for controls */
  .k819 .chip[data-tip]::after{
    content: attr(data-tip);
    position:absolute; bottom: calc(100% + 8px); left: 50%; transform: translateX(-50%) translateY(4px);
    background: hsl(0 0% 0% / .8); color:white; padding:6px 8px; border-radius:6px; font: 700 10px/1 ui-sans-serif;
    opacity:0; pointer-events:none; transition: opacity .2s ease, transform .2s ease;
    white-space: nowrap;
  }
  .k819 .chip:hover::after{ opacity:1; transform: translateX(-50%) translateY(0); }
</style>

<div class="k819" id="k819" data-theme="light" aria-live="polite">
  <div class="k819-top">
    <div class="k819-brand">
      <h1>SOLARIS · 819</h1>
      <p>Constellations you can conduct. Pull gently; the stars will follow.</p>
    </div>
    <div class="k819-ctrls" role="group" aria-label="Controls">
      <span class="k819-badge" aria-hidden="true">
        <svg width="12" height="12" viewBox="0 0 12 12" aria-hidden="true"><circle cx="6" cy="6" r="5" fill="hsl(var(--a))"/></svg>
        LIVE
      </span>
      <button class="chip" id="k819-theme" type="button" data-tip="Toggle theme"><span class="ink" aria-hidden="true"></span>Day / Night</button>
      <button class="chip" id="k819-pal" type="button" data-tip="Cycle palettes"><span class="ink" aria-hidden="true"></span>Palette</button>
      <span class="knob" aria-label="Density">
        <span>Density</span>
        <input id="k819-density" type="range" min="18" max="96" value="54" aria-label="Star density">
      </span>
      <span class="knob" aria-label="Flow">
        <span>Flow</span>
        <input id="k819-flow" type="range" min="0" max="100" value="52" aria-label="Field flow">
      </span>
      <button class="chip" id="k819-pulse" type="button" data-tip="Send a wave"><span class="ink" aria-hidden="true"></span>Pulse</button>
      <button class="chip" id="k819-freeze" type="button" aria-pressed="false" data-tip="Pause / Resume"><span class="ink" aria-hidden="true"></span>Freeze</button>
    </div>
  </div>

  <div class="k819-scene" id="k819-scene">
    <canvas class="k819-canvas" id="k819-canvas" aria-hidden="true"></canvas>
    <div class="k819-grain" aria-hidden="true"></div>

    <div class="k819-card">
      <h2>“Arrange the night by hand.”</h2>
      <p>Drag across the field to bend gravity. Pulse to ripple the web.</p>
      <div class="k819-actions">
        <button class="chip" id="k819-soften"><span class="ink" aria-hidden="true"></span>Soften</button>
        <button class="chip" id="k819-clarify"><span class="ink" aria-hidden="true"></span>Clarify</button>
        <button class="chip" id="k819-random"><span class="ink" aria-hidden="true"></span>Randomize</button>
      </div>
    </div>
  </div>

  <div class="k819-foot">
    <span class="hint" aria-hidden="true">Tip: Day/Night shifts the paper; Palette paints the stars; Freeze to frame a moment.</span>
    <span id="last-updated">Last updated: 2025-11-23 00:17:01 EST</span>
  </div>
</div>

<script>
(function(){
  const root = document.getElementById('k819');
  const scene = document.getElementById('k819-scene');
  const canvas = document.getElementById('k819-canvas');
  const ctx = canvas.getContext('2d', { alpha:true });
  const updated = document.getElementById('last-updated');

  const themeBtn = document.getElementById('k819-theme');
  const palBtn = document.getElementById('k819-pal');
  const freezeBtn = document.getElementById('k819-freeze');
  const pulseBtn = document.getElementById('k819-pulse');
  const density = document.getElementById('k819-density');
  const flow = document.getElementById('k819-flow');
  const soften = document.getElementById('k819-soften');
  const clarify = document.getElementById('k819-clarify');
  const randomize = document.getElementById('k819-random');

  // Timestamp
  try{
    const now = new Date();
    const opts = { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' };
    updated.textContent = 'Last updated: ' + now.toLocaleString(undefined, opts);
  }catch{ updated.textContent = 'Last updated: just now'; }

  // Ink hover
  function ink(e){
    const b = e.currentTarget.getBoundingClientRect();
    e.currentTarget.style.setProperty('--mx', ((e.clientX - b.left)/b.width)*100 + '%');
    e.currentTarget.style.setProperty('--my', ((e.clientY - b.top)/b.height)*100 + '%');
  }
  document.querySelectorAll('.k819 .chip').forEach(b => b.addEventListener('pointermove', ink, { passive:true }));

  // Palettes
  const palettes = [
    { name:'Aegean', a:[196,88,46], b:[225,84,54], c:[175,82,48], bg1:'hsl(200 60% 96%)', bg2:'hsl(175 60% 94%)' },
    { name:'Sundown', a:[16,86,54], b:[320,84,58], c:[45,90,52], bg1:'hsl(23 70% 96%)', bg2:'hsl(332 50% 95%)' },
    { name:'Ultraviolet', a:[280,82,52], b:[315,82,60], c:[200,84,54], bg1:'hsl(265 60% 96%)', bg2:'hsl(250 60% 93%)' },
    { name:'Forest Mist', a:[145,70,42], b:[170,70,46], c:[205,70,52], bg1:'hsl(140 40% 96%)', bg2:'hsl(180 40% 94%)' }
  ];
  let palIndex = 0;
  function setVars(p){
    root.style.setProperty('--a', `${p.a[0]} ${p.a[1]}% ${p.a[2]}%`);
    root.style.setProperty('--b', `${p.b[0]} ${p.b[1]}% ${p.b[2]}%`);
    root.style.setProperty('--c', `${p.c[0]} ${p.c[1]}% ${p.c[2]}%`);
    if(root.getAttribute('data-theme') !== 'dark'){
      root.style.setProperty('--bg1', p.bg1);
      root.style.setProperty('--bg2', p.bg2);
    }
  }
  setVars(palettes[palIndex]);

  // Field — points on a relaxed grid
  let dpr = Math.max(1, window.devicePixelRatio || 1);
  let W=0, H=0, CX=0, CY=0;
  let points = [];
  let pulses = [];
  let time = 0;
  let paused = false;
  let mouse = { x:0.5, y:0.5, active:false };

  function fit(){
    const r = scene.getBoundingClientRect();
    W = Math.max(1, Math.floor(r.width * dpr));
    H = Math.max(1, Math.floor(r.height * dpr));
    canvas.width = W; canvas.height = H;
    canvas.style.width = r.width + 'px';
    canvas.style.height = r.height + 'px';
    CX = W/2; CY = H/2;
    build();
  }
  window.addEventListener('resize', fit);

  function build(){
    points.length = 0;
    const dens = parseInt(density.value,10);
    // spacing maps inversely to density
    const s = Math.max(14, Math.min(70, 120 - dens));
    const jitter = s * 0.28;
    const cols = Math.ceil(W / s);
    const rows = Math.ceil(H / s);
    for(let y=0; y<=rows; y++){
      for(let x=0; x<=cols; x++){
        const px = x*s + (Math.random()*jitter - jitter/2);
        const py = y*s + (Math.random()*jitter - jitter/2);
        points.push({
          x0: px, y0: py,
          x: px, y: py,
          ph: Math.random() * Math.PI*2
        });
      }
    }
  }

  function lerp(a,b,t){ return a + (b-a)*t; }
  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function draw(dt){
    // subtle paper clear depending on theme
    const dark = root.getAttribute('data-theme') === 'dark';
    ctx.globalCompositeOperation = 'source-over';
    ctx.fillStyle = dark ? 'rgba(8,10,18,0.16)' : 'rgba(255,255,255,0.22)';
    ctx.fillRect(0,0,W,H);

    const flowV = parseInt(flow.value,10)/100;
    time += dt * (0.4 + flowV*2.2);

    // Update and draw
    ctx.save();
    ctx.translate(0.5,0.5);

    // Precompute colors
    const a = getComputedStyle(root).getPropertyValue('--a').trim();
    const b = getComputedStyle(root).getPropertyValue('--b').trim();
    const c = getComputedStyle(root).getPropertyValue('--c').trim();

    // Draw lines (mesh to right/down neighbor for efficiency)
    ctx.lineWidth = Math.max(0.6, 1.2 * dpr);
    for(let i=0; i<points.length; i++){
      const p = points[i];
      // flow field offset
      const fx = Math.sin((p.x0*0.0022) + time + p.ph) + Math.cos((p.y0*0.0017) - time*0.8);
      const fy = Math.cos((p.y0*0.0020) + time*0.9 + p.ph) + Math.sin((p.x0*0.0013) - time*0.6);
      const amp = (24 + flowV*56) * dpr;
      // mouse attraction
      let ax = 0, ay = 0;
      if (mouse.active){
        const mx = mouse.x * W, my = mouse.y * H;
        const dx = mx - p.x0, dy = my - p.y0;
        const dist = Math.hypot(dx, dy);
        const f = Math.max(0, 1 - dist/(W*0.6));
        ax = dx * 0.08 * f;
        ay = dy * 0.08 * f;
      }
      p.x = p.x0 + fx * amp * 0.25 + ax;
      p.y = p.y0 + fy * amp * 0.25 + ay;
    }

    // Lines and dots
    const cols = Math.ceil(W / Math.max(14, 120 - parseInt(density.value,10)));
    ctx.globalCompositeOperation = 'lighter';
    for(let y=0; y<points.length; y++){
      // connect to right and down neighbor
      const p = points[y];
      const right = (y+1) % cols !== 0 ? points[y+1] : null;
      const down  = points[y+cols] || null;

      const grad1 = ctx.createLinearGradient(p.x, p.y, right ? right.x : p.x+1, right ? right.y : p.y);
      grad1.addColorStop(0, `hsla(${a} / .20)`);
      grad1.addColorStop(1, `hsla(${b} / .20)`);

      const grad2 = ctx.createLinearGradient(p.x, p.y, down ? down.x : p.x, down ? down.y : p.y+1);
      grad2.addColorStop(0, `hsla(${b} / .16)`);
      grad2.addColorStop(1, `hsla(${c} / .16)`);

      if (right){
        ctx.strokeStyle = grad1;
        ctx.beginPath();
        ctx.moveTo(p.x, p.y);
        ctx.lineTo(right.x, right.y);
        ctx.stroke();
      }
      if (down){
        ctx.strokeStyle = grad2;
        ctx.beginPath();
        ctx.moveTo(p.x, p.y);
        ctx.lineTo(down.x, down.y);
        ctx.stroke();
      }
    }

    // Stars
    ctx.globalCompositeOperation = 'screen';
    for(const p of points){
      const r = 0.6 * dpr + Math.random()*0.6*dpr;
      const g = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, r*6);
      g.addColorStop(0, `hsla(${a} / .24)`);
      g.addColorStop(1, `hsla(${a} / 0)`);
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(p.x, p.y, r*4, 0, Math.PI*2);
      ctx.fill();

      ctx.fillStyle = 'white';
      ctx.beginPath();
      ctx.arc(p.x, p.y, r, 0, Math.PI*2);
      ctx.fill();
    }

    // Pulses
    ctx.globalCompositeOperation = 'overlay';
    for(let i=pulses.length-1; i>=0; i--){
      const P = pulses[i];
      P.t += dt;
      const R = (P.t * 480) * dpr;
      const alpha = clamp(1 - P.t/1.4, 0, 1) * 0.35;
      if (alpha <= 0) { pulses.splice(i,1); continue; }
      ctx.strokeStyle = `hsla(${c} / ${alpha})`;
      ctx.lineWidth = 2.0 * dpr;
      ctx.beginPath();
      ctx.arc(P.x, P.y, R, 0, Math.PI*2);
      ctx.stroke();
    }

    ctx.restore();
  }

  let last = performance.now();
  let raf = null;
  function frame(now){
    const dt = Math.min(0.033, (now - last)/1000);
    last = now;
    if (!paused) draw(dt);
    raf = requestAnimationFrame(frame);
  }

  // Interactions
  scene.addEventListener('pointermove', (e)=>{
    const r = scene.getBoundingClientRect();
    mouse.x = (e.clientX - r.left) / Math.max(1, r.width);
    mouse.y = (e.clientY - r.top) / Math.max(1, r.height);
    mouse.active = true;
  }, { passive:true });
  scene.addEventListener('pointerleave', ()=>{ mouse.active = false; });

  scene.addEventListener('pointerdown', (e)=>{
    const r = scene.getBoundingClientRect();
    const x = (e.clientX - r.left) * dpr;
    const y = (e.clientY - r.top) * dpr;
    pulses.push({ x, y, t: 0 });
  });

  themeBtn.addEventListener('click', ()=>{
    const dark = root.getAttribute('data-theme') === 'dark';
    root.setAttribute('data-theme', dark ? 'light' : 'dark');
    // refresh palette background if leaving dark
    if (dark){ setVars(palettes[palIndex]); }
  });

  palBtn.addEventListener('click', ()=>{
    palIndex = (palIndex + 1) % palettes.length;
    setVars(palettes[palIndex]);
  });

  freezeBtn.addEventListener('click', ()=>{
    paused = !paused;
    freezeBtn.setAttribute('aria-pressed', String(paused));
    freezeBtn.textContent = paused ? 'Resume' : 'Freeze';
    const span = document.createElement('span'); span.className = 'ink'; freezeBtn.prepend(span);
  });

  pulseBtn.addEventListener('click', ()=>{
    pulses.push({ x: CX, y: CY, t: 0 });
  });

  soften.addEventListener('click', ()=>{
    flow.value = Math.max(0, parseInt(flow.value,10) - 20);
    density.value = Math.max(18, parseInt(density.value,10) - 10);
    build();
  });
  clarify.addEventListener('click', ()=>{
    flow.value = Math.min(100, parseInt(flow.value,10) + 20);
    density.value = Math.min(96, parseInt(density.value,10) + 10);
    build();
  });
  randomize.addEventListener('click', ()=>{
    // gentle random tweaks
    flow.value = Math.floor(Math.random()*101);
    density.value = 18 + Math.floor(Math.random()*79);
    palIndex = Math.floor(Math.random()*palettes.length);
    setVars(palettes[palIndex]);
    build();
  });

  density.addEventListener('input', build);
  // Reduced motion
  const media = window.matchMedia('(prefers-reduced-motion: reduce)');
  function setReduced(state){
    paused = !!state;
    freezeBtn.setAttribute('aria-pressed', String(paused));
    freezeBtn.textContent = paused ? 'Resume' : 'Freeze';
  }
  setReduced(media.matches);
  media.addEventListener?.('change', e => setReduced(e.matches));

  // Boot
  fit();
  last = performance.now();
  raf = requestAnimationFrame(frame);

  // Cleanup
  window.addEventListener('beforeunload', ()=> cancelAnimationFrame(raf));
})();
</script>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


