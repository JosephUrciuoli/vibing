<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="vellum-521" aria-label="Paper Garden Atelier">
  <style>
    .vellum-521 {
      --h: 36;            /* sunrise hue */
      --wind: 40;         /* 0–100 */
      --bloom: 60;        /* 0–100 */
      --ink: hsl(225 20% 12%);
      --muted: hsl(225 10% 35%);
      --paper-1: hsl(45 70% 99%);
      --paper-2: hsl(30 70% 97%);
      --edge: hsla(0 0% 0% / .06);
      position: relative;
      border-radius: 28px;
      overflow: hidden;
      color: var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:
        radial-gradient(1200px 800px at 10% -10%, hsla(calc(var(--h) + 20) 80% 80% / .25), transparent 55%),
        radial-gradient(900px 600px at 110% 110%, hsla(calc(var(--h) - 40) 80% 75% / .18), transparent 60%),
        linear-gradient(180deg, var(--paper-1), var(--paper-2));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.6),
        0 24px 80px rgba(0,0,0,.18),
        0 8px 22px rgba(0,0,0,.12);
      isolation: isolate;
    }
    .vellum-521::before {
      content: "";
      position: absolute;
      inset: -2px;
      pointer-events: none;
      background:
        radial-gradient(140% 120% at 50% 10%, transparent 0 58%, rgba(0,0,0,.10) 90%),
        repeating-linear-gradient(0deg, rgba(0,0,0,.018) 0 1px, transparent 1px 3px);
      mix-blend-mode: multiply;
      opacity: .6;
      z-index: 0;
    }

    .field {
      position: absolute;
      inset: 0;
      z-index: 1;
      filter: blur(calc((var(--bloom) - 30) * 0.05px));
      pointer-events: none;
    }

    .atelier {
      position: relative;
      z-index: 2;
      max-width: 1100px;
      margin: 0 auto;
      padding: clamp(24px, 4.6vw, 56px);
      border-radius: 22px;
      background:
        linear-gradient(180deg, hsla(0 0% 100% / .75), hsla(0 0% 100% / .55));
      border: 1px solid hsla(0 0% 0% / .06);
      box-shadow:
        0 24px 60px rgba(0,0,0,.12),
        inset 0 1px 0 rgba(255,255,255,.9);
      backdrop-filter: blur(6px) saturate(125%);
      transform: perspective(1200px) rotateX(var(--rx, 0deg)) rotateY(var(--ry, 0deg));
      transition: transform 420ms cubic-bezier(.2,.8,.2,1), box-shadow 300ms ease;
    }
    .atelier:hover { box-shadow: 0 28px 80px rgba(0,0,0,.16), inset 0 1px 0 rgba(255,255,255,1); }

    .bar {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      font-size: 11px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--muted);
      background: linear-gradient(180deg, hsla(0 0% 100% / .9), hsla(0 0% 100% / .6));
      border: 1px solid hsla(0 0% 0% / .08);
      box-shadow:
        0 6px 14px rgba(0,0,0,.06),
        inset 0 1px 0 rgba(255,255,255,1);
      user-select: none;
      white-space: nowrap;
    }
    .brand {
      justify-self: center;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      color: var(--muted);
      font-weight: 800;
      letter-spacing: .02em;
    }
    .brand svg { width: 22px; height: 22px; filter: drop-shadow(0 8px 20px hsla(var(--h) 90% 55% / .28)); }

    .title {
      margin: 14px 0 8px;
      text-align: center;
      font-weight: 900;
      letter-spacing: -0.02em;
      line-height: .95;
      font-size: clamp(44px, 7.6vw, 92px);
      color: transparent;
      background:
        linear-gradient(92deg,
          hsl(calc(var(--h) - 10) 85% 45%),
          hsl(var(--h) 95% 48%) 45%,
          hsl(calc(var(--h) + 60) 75% 46%)
        );
      -webkit-background-clip: text;
              background-clip: text;
      filter: drop-shadow(0 14px 26px hsla(var(--h) 95% 55% / .18));
    }
    .lede {
      margin: 8px auto 12px;
      max-width: 70ch;
      text-align: center;
      font-size: clamp(16px, 2.2vw, 20px);
      line-height: 1.75;
      color: var(--muted);
    }

    .controls {
      display: grid;
      grid-template-columns: minmax(220px, 280px) 1fr auto;
      gap: clamp(14px, 3.6vw, 36px);
      align-items: center;
      margin-top: clamp(14px, 3.8vw, 34px);
    }
    @media (max-width: 980px) { .controls { grid-template-columns: 1fr; } }

    .dial {
      --angle: 36deg;
      position: relative;
      width: clamp(220px, 32vw, 280px);
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      background:
        radial-gradient(circle at 50% 50%, hsla(0 0% 100% / .9), hsla(0 0% 100% / .7) 60%, transparent 61%),
        conic-gradient(from -90deg,
          hsl(0 85% 60%),
          hsl(60 85% 58%),
          hsl(120 75% 45%),
          hsl(180 80% 48%),
          hsl(240 85% 55%),
          hsl(300 85% 55%),
          hsl(360 85% 60%)
        );
      mask:
        radial-gradient(circle at 50% 50%, transparent 56%, #000 57% 100%);
      border: 1px solid hsla(0 0% 0% / .08);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.9),
        0 18px 42px rgba(0,0,0,.12);
      cursor: grab;
      touch-action: none;
      outline: none;
    }
    .dial:active { cursor: grabbing; }
    .dial .halo {
      position: absolute;
      inset: 6%;
      border-radius: 50%;
      background:
        conic-gradient(from var(--angle),
          hsla(var(--h) 100% 60% / .20) 0 12deg,
          transparent 12deg 360deg);
      filter: blur(10px);
      pointer-events: none;
    }
    .dial .handle {
      position: absolute;
      left: 50%; top: 50%;
      width: 56%;
      height: 56%;
      transform: translate(-50%, -50%) rotate(var(--angle));
      transform-origin: center;
      transition: transform 120ms linear;
    }
    .dial .handle::before {
      content: "";
      position: absolute;
      left: 50%; top: 0%;
      transform: translate(-50%, -50%);
      width: 14px; height: 14px;
      border-radius: 50%;
      background: radial-gradient(circle at 40% 40%, #fff, hsl(var(--h) 100% 62%));
      border: 1px solid hsl(var(--h) 90% 60%);
      box-shadow:
        0 0 0 6px hsla(var(--h) 100% 60% / .10),
        0 14px 28px hsla(var(--h) 90% 60% / .28),
        inset 0 1px 0 rgba(255,255,255,.9);
    }
    .dial-label {
      color: var(--muted);
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
      text-align: center;
      margin-top: 8px;
    }

    .sliders {
      display: grid;
      gap: 14px;
    }
    .group { display: grid; gap: 6px; }
    .group label {
      color: var(--muted);
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
    }
    .slider {
      --pct: 50%;
      position: relative;
      height: 36px;
      border-radius: 12px;
      background: linear-gradient(180deg, hsla(0 0% 100% / .9), hsla(0 0% 100% / .65));
      border: 1px solid hsla(0 0% 0% / .08);
      box-shadow: inset 0 1px 0 rgba(255,255,255,1);
      display: grid;
      align-items: center;
      padding: 0 10px;
    }
    .slider::before {
      content: "";
      position: absolute;
      left: 10px; right: 10px; top: 50%;
      transform: translateY(-50%);
      height: 6px;
      border-radius: 6px;
      background:
        linear-gradient(90deg, hsla(var(--h) 90% 60% / .35), hsla(calc(var(--h) + 60) 90% 60% / .35));
      box-shadow: inset 0 0 0 1px hsla(0 0% 100% / .6);
    }
    .slider .thumb {
      position: absolute;
      left: calc(10px + (var(--pct) * (100% - 20px)));
      top: 50%;
      transform: translate(-50%, -50%);
      width: 18px; height: 18px;
      border-radius: 50%;
      background: radial-gradient(circle at 40% 40%, #fff, hsl(var(--h) 100% 62%));
      border: 1px solid hsl(var(--h) 90% 60%);
      box-shadow:
        0 0 0 6px hsla(var(--h) 100% 60% / .12),
        0 10px 22px hsla(var(--h) 90% 60% / .22),
        inset 0 1px 0 rgba(255,255,255,.9);
      pointer-events: none;
    }
    .slider input[type="range"] {
      appearance: none;
      width: 100%; height: 100%;
      background: transparent; outline: none; margin: 0; padding: 0;
      cursor: pointer;
    }
    .slider input[type="range"]::-webkit-slider-thumb { appearance: none; width: 0; height: 0; }
    .slider input[type="range"]::-moz-range-thumb { width: 0; height: 0; border: 0; }

    .actions {
      display: grid;
      grid-template-columns: repeat(2, minmax(120px, auto));
      gap: 10px;
      justify-content: end;
      align-content: start;
    }
    @media (max-width: 980px) { .actions { grid-template-columns: 1fr 1fr; } }
    .btn {
      appearance: none;
      border: 1px solid hsla(0 0% 0% / .08);
      color: var(--ink);
      background: linear-gradient(180deg, hsla(0 0% 100% / .9), hsla(0 0% 100% / .7));
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 800;
      letter-spacing: .02em;
      cursor: pointer;
      box-shadow:
        0 10px 26px rgba(0,0,0,.12),
        inset 0 1px 0 rgba(255,255,255,1);
      transition: transform 160ms ease, box-shadow 240ms ease, border-color 240ms ease, background 240ms ease;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
      will-change: transform;
    }
    .btn::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(140px 80px at var(--sx, 10%) -20%, hsla(0 0% 100% / .65), transparent 60%);
      mix-blend-mode: screen;
      opacity: .7;
      pointer-events: none;
      transition: opacity 200ms ease;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 18px 36px rgba(0,0,0,.16); }
    .btn:hover::after { opacity: .95; }
    .btn.primary {
      border-color: hsla(var(--h) 90% 60% / .35);
      box-shadow:
        0 18px 46px rgba(0,0,0,.16),
        inset 0 1px 0 rgba(255,255,255,1);
      background: linear-gradient(180deg, hsla(var(--h) 100% 65% / .22), hsla(0 0% 100% / .85));
    }

    .tiles {
      list-style: none;
      margin: 22px 0 0;
      padding: 0;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: clamp(12px, 2.6vw, 20px);
    }
    @media (max-width: 900px) { .tiles { grid-template-columns: 1fr; } }
    .tile {
      position: relative;
      border-radius: 16px;
      padding: clamp(14px, 2.2vw, 18px);
      background: linear-gradient(180deg, hsla(0 0% 100% / .9), hsla(0 0% 100% / .7));
      border: 1px solid hsla(0 0% 0% / .08);
      box-shadow:
        0 12px 30px rgba(0,0,0,.10),
        inset 0 1px 0 rgba(255,255,255,1);
      transition: transform 240ms cubic-bezier(.2,.7,.2,1), box-shadow 240ms ease, border-color 240ms ease;
    }
    .tile::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: linear-gradient(90deg, hsla(var(--h) 90% 60% / .14), transparent 30%, transparent 70%, hsla(calc(var(--h) + 50) 90% 60% / .12));
      opacity: .8;
      pointer-events: none;
    }
    .tile:hover {
      transform: translateY(-6px);
      border-color: hsla(var(--h) 90% 60% / .35);
      box-shadow: 0 22px 44px rgba(0,0,0,.14);
    }
    .tile h3 {
      margin: 8px 0 6px;
      font-size: clamp(16px, 2.2vw, 20px);
      letter-spacing: -0.01em;
      color: var(--ink);
    }
    .tile p {
      margin: 0;
      color: var(--muted);
      line-height: 1.7;
      font-size: 14.5px;
    }
    .ico {
      width: 28px; height: 28px;
      filter: drop-shadow(0 10px 22px hsla(var(--h) 90% 65% / .22));
    }

    .meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      margin-top: 18px;
      color: var(--muted);
      font-size: 12.5px;
      flex-wrap: wrap;
    }
    #last-updated {
      color: var(--ink);
      background: linear-gradient(180deg, hsla(0 0% 100% / .9), hsla(0 0% 100% / .7));
      border: 1px solid hsla(0 0% 0% / .08);
      padding: 6px 10px;
      border-radius: 10px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,1);
      white-space: nowrap;
    }

    @media (prefers-reduced-motion: reduce) {
      .field { display: none !important; }
      .dial .halo { display: none !important; }
      .btn::after { display: none !important; }
      .atelier { transition: none !important; }
    }
  </style>

  <canvas class="field" aria-hidden="true"></canvas>

  <div class="atelier" role="region" aria-label="Paper Garden Console">
    <div class="bar">
      <span class="chip">Iteration 521</span>
      <span class="brand" aria-hidden="true">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <defs>
            <linearGradient id="g521" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="hsl(var(--h) 95% 60%)"/>
              <stop offset="1" stop-color="hsl(calc(var(--h) + 60) 85% 52%)"/>
            </linearGradient>
          </defs>
          <circle cx="12" cy="12" r="5.5" fill="url(#g521)"/>
          <g stroke="url(#g521)" stroke-linecap="round">
            <path d="M12 1.5v3.2M12 19.3v3.2M1.5 12h3.2M19.3 12h3.2M4.3 4.3l2.2 2.2M17.5 17.5l2.2 2.2M4.3 19.7l2.2-2.2M17.5 6.5l2.2-2.2"/>
          </g>
        </svg>
        Dawn Atelier
      </span>
      <span class="chip">Paper mode</span>
    </div>

    <h1 class="title">Paper Garden</h1>
    <p class="lede">Morning margins, letterpress edges, and drifting petals you can guide. Turn the sun; the garden blushes.</p>

    <div class="controls">
      <div class="dial" id="dial" tabindex="0" role="slider" aria-label="Sun hue" aria-valuemin="0" aria-valuemax="360" aria-valuenow="36" aria-valuetext="Hue 36 degrees">
        <div class="halo" aria-hidden="true"></div>
        <div class="handle" aria-hidden="true"></div>
        <div class="dial-label" aria-hidden="true">Turn to color</div>
      </div>

      <div class="sliders">
        <div class="group">
          <label for="wind">Wind</label>
          <div class="slider" style="--pct: .4;">
            <span class="thumb" aria-hidden="true"></span>
            <input id="wind" type="range" min="0" max="100" value="40" aria-label="Wind">
          </div>
        </div>
        <div class="group">
          <label for="bloom">Bloom</label>
          <div class="slider" style="--pct: .6;">
            <span class="thumb" aria-hidden="true"></span>
            <input id="bloom" type="range" min="0" max="100" value="60" aria-label="Bloom">
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" type="button" id="breathe">Breathe</button>
        <button class="btn" type="button" id="shuffle">Palette</button>
      </div>
    </div>

    <ul class="tiles" aria-label="Principles">
      <li class="tile">
        <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M3 12h18" stroke="hsl(var(--h) 80% 50%)" stroke-width="2" stroke-linecap="round"/>
          <rect x="6" y="6" width="12" height="12" rx="3" fill="none" stroke="hsl(calc(var(--h) + 50) 75% 48%)" stroke-width="2"/>
        </svg>
        <h3>1 — Tactility</h3>
        <p>Soft paper, crisp ink. Surfaces feel familiar, like a fresh page at dawn.</p>
      </li>
      <li class="tile">
        <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M4 12c4-6 12-6 16 0" stroke="hsl(var(--h) 80% 50%)" stroke-width="2" fill="none" stroke-linecap="round"/>
          <circle cx="8" cy="10" r="2" fill="hsl(calc(var(--h) + 40) 85% 52%)"/>
        </svg>
        <h3>2 — Calm Motion</h3>
        <p>Gentle drift suggests life without demanding it. Breathing room is a feature.</p>
      </li>
      <li class="tile">
        <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M6 6l12 12M18 6L6 18" stroke="hsl(var(--h) 80% 50%)" stroke-width="2" stroke-linecap="round"/>
          <circle cx="12" cy="12" r="3" fill="hsl(calc(var(--h) + 60) 75% 50%)"/>
        </svg>
        <h3>3 — Kind Contrast</h3>
        <p>Readable by design. Color carries mood; hierarchy carries meaning.</p>
      </li>
    </ul>

    <div class="meta">
      <span class="note">Hue: <strong><span id="hue521">36</span>°</strong> • Wind: <strong><span id="wind521">40</span>%</strong> • Bloom: <strong><span id="bloom521">60</span>%</strong></span>
      <span id="last-updated">Last updated: 2025-11-09 06:13:15 EST</span>
    </div>
  </div>

  <script>
    (function () {
      const root = document.currentScript.closest('.vellum-521');
      if (!root) return;

      // Timestamp
      const last = root.querySelector('#last-updated');
      try {
        const now = new Date();
        const date = now.toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'short' });
        last.textContent = 'Updated: ' + date;
      } catch { last.textContent = 'Updated: just now'; }

      // Parallax + magnetic buttons
      const shell = root.querySelector('.atelier');
      shell.addEventListener('pointermove', (e) => {
        const r = shell.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width - 0.5;
        const y = (e.clientY - r.top) / r.height - 0.5;
        shell.style.setProperty('--rx', (-y * 4).toFixed(2) + 'deg');
        shell.style.setProperty('--ry', (x * 6).toFixed(2) + 'deg');
        root.querySelectorAll('.btn').forEach(btn => {
          const bx = (x * 8).toFixed(2);
          const by = (y * 8).toFixed(2);
          btn.style.transform = `translate(${bx}px, ${by}px)`;
          btn.style.setProperty('--sx', (x * 50 + 50) + '%');
        });
      });
      shell.addEventListener('pointerleave', () => {
        shell.style.setProperty('--rx', '0deg');
        shell.style.setProperty('--ry', '0deg');
        root.querySelectorAll('.btn').forEach(btn => btn.style.transform = '');
      });

      // Sun dial hue control
      const dial = root.querySelector('#dial');
      const hueOut = root.querySelector('#hue521');
      const setHue = (h) => {
        const hue = Math.round(Math.max(0, Math.min(360, h)));
        root.style.setProperty('--h', hue);
        dial.style.setProperty('--angle', hue + 'deg');
        dial.setAttribute('aria-valuenow', String(hue));
        dial.setAttribute('aria-valuetext', 'Hue ' + hue + ' degrees');
        hueOut.textContent = hue;
      };
      const getAngle = (clientX, clientY) => {
        const rect = dial.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top + rect.height / 2;
        const rad = Math.atan2(clientY - cy, clientX - cx);
        let deg = (rad * 180 / Math.PI) + 90; // start at top
        if (deg < 0) deg += 360;
        return deg % 360;
      };
      const initH = parseInt(getComputedStyle(root).getPropertyValue('--h')) || 36;
      setHue(initH);

      let dragging = false;
      const onMove = (e) => { if (!dragging) return; setHue(getAngle(e.clientX, e.clientY)); };
      dial.addEventListener('pointerdown', (e) => {
        dragging = true;
        dial.setPointerCapture(e.pointerId);
        setHue(getAngle(e.clientX, e.clientY));
      });
      dial.addEventListener('pointermove', onMove);
      dial.addEventListener('pointerup', (e) => { dragging = false; try { dial.releasePointerCapture(e.pointerId); } catch {} });
      dial.addEventListener('pointercancel', () => { dragging = false; });
      dial.addEventListener('keydown', (e) => {
        const step = e.shiftKey ? 15 : 5;
        const current = parseInt(dial.getAttribute('aria-valuenow') || '0', 10);
        if (e.key === 'ArrowRight' || e.key === 'ArrowUp') { e.preventDefault(); setHue(current + step); }
        if (e.key === 'ArrowLeft' || e.key === 'ArrowDown') { e.preventDefault(); setHue(current - step); }
        if (e.key === 'Home') { e.preventDefault(); setHue(0); }
        if (e.key === 'End') { e.preventDefault(); setHue(360); }
        if (e.key === '1') { e.preventDefault(); setHue(36); }
        if (e.key === '2') { e.preventDefault(); setHue(312); }
        if (e.key === '3') { e.preventDefault(); setHue(200); }
        if (e.key === '4') { e.preventDefault(); setHue(126); }
        if (e.key === '5') { e.preventDefault(); setHue(8); }
      });

      // Sliders
      const windSlider = root.querySelector('#wind');
      const bloomSlider = root.querySelector('#bloom');
      const windOut = root.querySelector('#wind521');
      const bloomOut = root.querySelector('#bloom521');

      const setSliderPct = (el, v) => el.closest('.slider').style.setProperty('--pct', (v/100).toFixed(3));
      const applyWind = (v) => { root.style.setProperty('--wind', v); windOut.textContent = v; setSliderPct(windSlider, v); };
      const applyBloom = (v) => { root.style.setProperty('--bloom', v); bloomOut.textContent = v; setSliderPct(bloomSlider, v); reseed(); };

      applyWind(parseInt(windSlider.value, 10));
      applyBloom(parseInt(bloomSlider.value, 10));

      windSlider.addEventListener('input', (e) => applyWind(parseInt(e.target.value, 10)));
      bloomSlider.addEventListener('input', (e) => applyBloom(parseInt(e.target.value, 10)));

      // Palette cycle
      const palettes = [36, 312, 200, 126, 8];
      let pi = palettes.indexOf(initH); if (pi < 0) pi = 0;
      root.querySelector('#shuffle')?.addEventListener('click', () => {
        pi = (pi + 1) % palettes.length;
        setHue(palettes[pi]);
        breathe(1.4);
      });

      // Canvas: drifting petals
      const canvas = root.querySelector('.field');
      const ctx = canvas.getContext('2d', { alpha: true });
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      let dpr = Math.max(1, window.devicePixelRatio || 1);
      let petals = [];
      let w = 1, h = 1;

      function sizeCanvas() {
        const r = root.getBoundingClientRect();
        w = Math.max(1, Math.floor(r.width));
        h = Math.max(1, Math.floor(r.height));
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
      }
      window.addEventListener('resize', () => { sizeCanvas(); reseed(); });
      sizeCanvas();

      function reseed() {
        petals.length = 0;
        const bloom = parseInt(getComputedStyle(root).getPropertyValue('--bloom')) || 60;
        const density = 0.00006; // petals per pixel
        const count = Math.min(600, Math.floor((w * h) * density * (0.6 + bloom / 80)));
        for (let i = 0; i < count; i++) {
          petals.push(makePetal(true));
        }
      }

      function makePetal(seedAnywhere = false) {
        const hueBase = parseInt(getComputedStyle(root).getPropertyValue('--h')) || 36;
        return {
          x: seedAnywhere ? Math.random() * (w * dpr) : Math.random() * (w * dpr),
          y: seedAnywhere ? Math.random() * (h * dpr) : (h * dpr + 20),
          s: (Math.random() * 0.9 + 0.6) * dpr * (1 + Math.random()),
          r: Math.random() * Math.PI * 2,
          vr: (Math.random() * 0.002 - 0.001),
          hue: (hueBase + (Math.random() * 40 - 20) + 360) % 360,
          sat: 70 + Math.random() * 20,
          light: 55 + Math.random() * 10,
          wob: Math.random() * 1000
        };
      }

      let gust = 0; // breathing wind boost
      function breathe(mult = 1.25) { gust = Math.max(gust, 0.6 * mult); }
      root.querySelector('#breathe')?.addEventListener('click', () => breathe());

      // Pointer drift influence
      let mouse = { x: 0.5, y: 0.5 };
      root.addEventListener('pointermove', (e) => {
        const r = root.getBoundingClientRect();
        mouse.x = (e.clientX - r.left) / r.width;
        mouse.y = (e.clientY - r.top) / r.height;
      });

      function drawPetal(p) {
        const x = p.x, y = p.y, s = p.s;
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(p.r);
        // Petal shape: rounded teardrop
        ctx.beginPath();
        ctx.moveTo(0, -s * 1.0);
        ctx.quadraticCurveTo(s * 0.9, -s * 0.2, 0, s * 1.1);
        ctx.quadraticCurveTo(-s * 0.9, -s * 0.2, 0, -s * 1.0);
        const grad = ctx.createLinearGradient(0, -s * 1.1, 0, s * 1.1);
        grad.addColorStop(0, `hsla(${p.hue}, ${p.sat}%, ${p.light + 8}%, .85)`);
        grad.addColorStop(1, `hsla(${(p.hue + 20) % 360}, ${p.sat - 10}%, ${p.light - 10}%, .85)`);
        ctx.fillStyle = grad;
        ctx.shadowColor = `hsla(${p.hue}, 80%, 55%, .25)`;
        ctx.shadowBlur = 12 * dpr;
        ctx.fill();
        ctx.restore();
      }

      function loop() {
        const cw = canvas.width, ch = canvas.height;
        ctx.clearRect(0, 0, cw, ch);

        // soft wash behind
        const hue = parseInt(getComputedStyle(root).getPropertyValue('--h')) || 36;
        const wash = ctx.createRadialGradient(cw * 0.2, ch * 0.1, ch * 0.05, cw * 0.2, ch * 0.1, ch * 0.6);
        wash.addColorStop(0, `hsla(${(hue + 30) % 360}, 90%, 85%, .22)`);
        wash.addColorStop(1, 'hsla(0,0%,100%,0)');
        ctx.fillStyle = wash;
        ctx.fillRect(0, 0, cw, ch);

        const wind = parseInt(getComputedStyle(root).getPropertyValue('--wind')) || 40;
        const speed = prefersReduced ? 0 : (0.15 + wind * 0.02);
        const sway = prefersReduced ? 0 : (0.3 + wind * 0.012) * (1 + gust);
        gust *= prefersReduced ? 0 : 0.92;

        // animate petals
        for (let i = 0; i < petals.length; i++) {
          const p = petals[i];
          // velocity
          const vx = (sway * 0.2) * Math.sin((p.wob + i) * 0.012 + mouse.x * 2) + (wind - 50) * 0.02 * dpr;
          const vy = -(speed * (0.3 + (p.s / dpr) * 0.06)) + Math.sin((p.wob + i) * 0.02 + mouse.y * 2) * -0.1;
          p.x += vx;
          p.y += vy * dpr;
          p.r += p.vr + (vx * 0.0006);
          p.wob += 0.6;

          // wrap
          if (p.y < -40) {
            petals[i] = makePetal(false);
            petals[i].y = ch + 20;
            petals[i].x = Math.random() * cw;
          }
          if (p.x > cw + 40) p.x = -20;
          if (p.x < -40) p.x = cw + 20;

          drawPetal(p);
        }

        requestAnimationFrame(loop);
      }

      reseed();

      if (!prefersReduced) {
        loop();
      } else {
        // One still frame
        const cw = canvas.width, ch = canvas.height;
        ctx.clearRect(0, 0, cw, ch);
        for (let i = 0; i < petals.length; i++) drawPetal(petals[i]);
      }

      // DPI observer
      let dprCheck = dpr;
      setInterval(() => {
        const nowDpr = Math.max(1, window.devicePixelRatio || 1);
        if (nowDpr !== dprCheck) {
          dpr = nowDpr;
          sizeCanvas(); reseed();
          dprCheck = nowDpr;
        }
      }, 1000);
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


