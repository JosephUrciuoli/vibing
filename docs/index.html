<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="vibe1576" data-mode="sol" aria-live="polite">
  <style>
    /* Scope */
    #vibe1576 {
      --ink: #0f1526;
      --muted: #5e6a82;
      --paper: #ffffff;
      --c1: #ffb07a; /* primary */
      --c2: #ffd46b; /* mid */
      --c3: #ff7ab2; /* accent */
      --bg-a: #fff5ec;
      --bg-b: #eefcf6;

      color: var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      border-radius: 28px;
      padding: clamp(18px, 3vw, 34px);
      background:
        radial-gradient(900px 700px at var(--gx, 20%) var(--gy, 30%), color-mix(in oklab, var(--bg-a) 80%, transparent) 0 60%, transparent 61%),
        radial-gradient(1100px 720px at calc(100% - var(--gx, 20%)) calc(100% - var(--gy, 30%)), color-mix(in oklab, var(--bg-b) 75%, transparent) 0 62%, transparent 63%),
        linear-gradient(180deg, #ffffff, #f6f8ff);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.85),
        0 28px 70px rgba(16,22,35,0.10),
        0 10px 24px rgba(16,22,35,0.08);
      position: relative;
      overflow: clip;
      isolation: isolate;
    }
    /* Glow field following pointer */
    #vibe1576::before {
      content: "";
      position: absolute; inset: -30%;
      background:
        radial-gradient(900px 700px at var(--mx, 55%) var(--my, 40%), color-mix(in oklab, var(--c1) 16%, transparent) 0 40%, transparent 41%),
        radial-gradient(900px 700px at calc(100% - var(--mx, 55%)) calc(100% - var(--my, 40%)), color-mix(in oklab, var(--c3) 14%, transparent) 0 42%, transparent 43%),
        repeating-linear-gradient(120deg, rgba(0,0,0,0.02) 0 2px, transparent 2px 7px);
      mix-blend-mode: multiply;
      opacity: .55;
      pointer-events: none;
    }

    /* Modes */
    #vibe1576[data-mode="sol"] {
      --ink: #0f1526;
      --muted: #5e6a82;
      --paper: #ffffff;
      --c1: #ffb07a; --c2: #ffd46b; --c3: #ff7ab2;
      --bg-a: #fff2e8; --bg-b: #e9fff7;
    }
    #vibe1576[data-mode="luna"] {
      --ink: #0e1424;
      --muted: #56607a;
      --paper: #fbfdff;
      --c1: #69d4ff; --c2: #6effc7; --c3: #a8b3ff;
      --bg-a: #eaf4ff; --bg-b: #eafff7;
    }
    #vibe1576[data-mode="void"] {
      --ink: #eaf1ff;
      --muted: #b6c4e0;
      --paper: #0e1324;
      --c1: #9b7bff; --c2: #4fc3ff; --c3: #ffd06b;
      --bg-a: #0b1020; --bg-b: #121a33;
      background:
        radial-gradient(900px 700px at var(--gx, 20%) var(--gy, 30%), color-mix(in oklab, var(--bg-a) 92%, transparent) 0 70%, transparent 71%),
        radial-gradient(1100px 720px at calc(100% - var(--gx, 20%)) calc(100% - var(--gy, 30%)), color-mix(in oklab, var(--bg-b) 90%, transparent) 0 72%, transparent 73%),
        linear-gradient(180deg, #0d1224, #0b1020);
    }

    /* Header */
    #vibe1576 .header {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 10px;
      z-index: 2; position: relative;
    }
    #vibe1576 .brand {
      display: inline-flex; align-items: center; gap: 10px;
      background: rgba(255,255,255,0.75);
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 16px;
      padding: 8px 12px;
      font-weight: 900; letter-spacing: 0.12em; text-transform: uppercase; font-size: 11px;
      color: var(--ink);
      backdrop-filter: blur(8px) saturate(120%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.95), 0 10px 22px rgba(0,0,0,0.06);
    }
    #vibe1576 .brand .dot {
      width: 12px; height: 12px; border-radius: 50%;
      background: linear-gradient(180deg, var(--c1), var(--c2));
      box-shadow: 0 0 0 4px color-mix(in oklab, var(--c1) 22%, transparent), 0 10px 22px rgba(0,0,0,0.12);
    }
    #vibe1576 .meta {
      justify-self: end;
      display: inline-flex; align-items: center; gap: 10px;
      font-size: 12px; color: var(--muted);
    }
    #vibe1576 #last-updated {
      font-variant-numeric: tabular-nums;
      color: var(--ink);
      background: rgba(255,255,255,0.75);
      border: 1px solid rgba(0,0,0,0.06);
      padding: 6px 10px; border-radius: 10px; font-weight: 800;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.95);
    }

    /* Hero */
    #vibe1576 .hero {
      margin: clamp(16px, 3vw, 28px) 0 6px;
      font-size: clamp(42px, 8.6vw, 108px);
      line-height: 0.9;
      letter-spacing: -0.02em;
      font-weight: 1000;
      background: conic-gradient(from 180deg at 50% 60%, color-mix(in oklab, var(--ink) 96%, transparent), color-mix(in oklab, var(--c1) 60%, transparent), color-mix(in oklab, var(--c3) 60%, transparent), color-mix(in oklab, var(--ink) 92%, transparent));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-wrap: balance;
      position: relative;
      text-shadow: 0 22px 46px rgba(0,0,0,0.08);
    }
    #vibe1576 .tag {
      margin: 0 0 12px;
      color: var(--muted);
      font-size: clamp(14px, 2.2vw, 18px);
    }

    /* Controls */
    #vibe1576 .controls {
      display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center;
      z-index: 2; position: relative;
    }
    #vibe1576 .modes {
      position: relative;
      display: inline-flex; gap: 2px; padding: 4px;
      border-radius: 999px; background: rgba(255,255,255,0.78);
      border: 1px solid rgba(0,0,0,0.06);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.95), 0 12px 26px rgba(0,0,0,0.08);
    }
    #vibe1576 .modes .thumb {
      position: absolute; top: 4px; left: 4px; height: calc(100% - 8px);
      width: var(--thumb-w, 68px); transform: translateX(var(--thumb-x, 0px));
      border-radius: 999px; z-index: -1;
      background: linear-gradient(180deg, color-mix(in oklab, var(--c3) 65%, white), white);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.95), 0 10px 22px rgba(0,0,0,0.12);
      transition: transform 240ms cubic-bezier(.2,.8,.2,1), width 200ms ease, background 240ms ease;
    }
    #vibe1576 .modes button {
      appearance: none; border: 0; background: transparent; cursor: pointer;
      color: var(--ink);
      padding: 10px 16px; border-radius: 999px;
      font-weight: 900; letter-spacing: 0.12em; text-transform: uppercase; font-size: 11px;
      transition: color 180ms ease, transform 120ms ease;
    }
    #vibe1576 .modes button:active { transform: translateY(1px); }
    #vibe1576 .modes button[aria-checked="true"] { color: #0f141c; }
    #vibe1576[data-mode="void"] .modes button[aria-checked="true"] { color: #0a1020; }

    #vibe1576 .group {
      display: inline-flex; gap: 8px; flex-wrap: wrap; align-items: center; justify-content: flex-end;
    }
    #vibe1576 .pill {
      appearance: none; border: 1px solid rgba(0,0,0,0.08);
      background: linear-gradient(180deg, #fff, #f4f7ff);
      color: var(--ink);
      padding: 10px 14px; border-radius: 12px; font-weight: 800; letter-spacing: 0.02em; cursor: pointer;
      box-shadow: 0 12px 24px rgba(0,0,0,0.10), inset 0 1px 0 rgba(255,255,255,0.95);
      transition: transform 120ms ease, box-shadow 180ms ease, background 240ms ease, color 240ms ease;
    }
    #vibe1576 .pill:hover { transform: translateY(-1px); box-shadow: 0 16px 30px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,1); }
    #vibe1576 .range {
      display: inline-flex; align-items: center; gap: 10px; color: var(--muted); font-size: 12px;
      background: rgba(255,255,255,0.78); border: 1px solid rgba(0,0,0,0.06); border-radius: 12px; padding: 8px 10px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.95);
    }
    #vibe1576 input[type="range"] {
      appearance: none; width: 140px; height: 8px; border-radius: 999px; background: linear-gradient(90deg, var(--c1), var(--c3));
      outline: none; box-shadow: inset 0 1px 0 rgba(255,255,255,0.9);
    }
    #vibe1576 input[type="range"]::-webkit-slider-thumb {
      appearance: none; width: 18px; height: 18px; border-radius: 50%; background: #fff; border: 1px solid rgba(0,0,0,0.12);
      box-shadow: 0 8px 18px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.9);
    }
    #vibe1576 output {
      min-width: 34px; text-align: right; color: var(--ink); font-weight: 800;
    }

    /* Stage */
    #vibe1576 .stage {
      margin-top: clamp(16px, 3.2vw, 28px);
      position: relative;
      height: clamp(300px, 44vw, 520px);
      border-radius: 22px;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,0.1);
      background: radial-gradient(120% 120% at 0% 0%, color-mix(in oklab, var(--c1) 10%, transparent), transparent 60%) ,
                  radial-gradient(120% 140% at 100% 100%, color-mix(in oklab, var(--c3) 10%, transparent), transparent 60%),
                  linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.3));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.85), 0 20px 44px rgba(0,0,0,0.10);
      transform-style: preserve-3d;
      will-change: transform;
    }
    #vibe1576[data-mode="void"] .stage {
      background: radial-gradient(120% 120% at 0% 0%, color-mix(in oklab, var(--c1) 16%, transparent), transparent 60%),
                  radial-gradient(120% 140% at 100% 100%, color-mix(in oklab, var(--c2) 14%, transparent), transparent 60%),
                  linear-gradient(180deg, rgba(15,20,40,0.6), rgba(10,15,30,0.5));
    }
    #vibe1576 canvas#sky {
      position: absolute; inset: 0; width: 100%; height: 100%; display: block; filter: saturate(115%) contrast(102%);
    }
    #vibe1576 .stage::after {
      content: "";
      position: absolute; inset: 0;
      background:
        linear-gradient(transparent, rgba(0,0,0,0.04)),
        repeating-linear-gradient(90deg, rgba(0,0,0,0.03) 0 1px, transparent 1px 24px),
        repeating-linear-gradient(0deg, rgba(0,0,0,0.03) 0 1px, transparent 1px 24px);
      mix-blend-mode: multiply;
      pointer-events: none;
    }

    /* Ticker */
    #vibe1576 .ticker {
      margin-top: 12px;
      display: grid; grid-auto-flow: column; gap: 8px; overflow: hidden;
      mask-image: linear-gradient(90deg, transparent, #000 8%, #000 92%, transparent);
    }
    #vibe1576 .ttrack { display: inline-flex; gap: 8px; min-width: 200%; animation: slide 24s linear infinite; }
    #vibe1576 .chip {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 12px; border-radius: 999px;
      background: rgba(255,255,255,0.78);
      border: 1px solid rgba(0,0,0,0.06);
      color: var(--ink);
      font-size: 12px; font-weight: 800; letter-spacing: 0.02em; white-space: nowrap;
      box-shadow: 0 10px 20px rgba(0,0,0,0.06), inset 0 1px 0 rgba(255,255,255,0.9);
    }
    #vibe1576 .chip::before {
      content: ""; width: 6px; height: 6px; border-radius: 50%;
      background: var(--c1); box-shadow: 0 0 10px color-mix(in oklab, var(--c1) 40%, transparent);
    }

    /* Footer */
    #vibe1576 .foot {
      margin-top: 14px;
      display: flex; align-items: center; justify-content: space-between; gap: 10px;
      color: var(--muted); font-size: 12px;
    }

    /* Motion */
    @keyframes slide { to { transform: translateX(-50%); } }

    /* Responsive */
    @media (max-width: 760px) {
      #vibe1576 .header { grid-template-columns: 1fr; }
      #vibe1576 .controls { grid-template-columns: 1fr; }
      #vibe1576 .ticker { display: none; }
    }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce) {
      #vibe1576 .ttrack { animation: none !important; }
    }
  </style>

  <div class="header">
    <span class="brand" aria-label="Aurora Atelier">
      <span class="dot" aria-hidden="true"></span>
      AURORA ATELIER
    </span>
    <div class="meta">
      <span class="hint">v1576</span>
      <span id="last-updated">Last updated: 2025-12-28 04:18:56 EST</span>
    </div>
  </div>

  <h1 class="hero" role="heading" aria-level="1">Breathing Light</h1>
  <p class="tag">A living aurora — choreographed by math, touch, and time.</p>

  <div class="controls" role="group" aria-label="Aurora controls">
    <div class="modes" role="radiogroup" aria-label="Mode">
      <div class="thumb" aria-hidden="true"></div>
      <button type="button" class="mode" role="radio" data-mode="sol" aria-checked="true">Sol</button>
      <button type="button" class="mode" role="radio" data-mode="luna" aria-checked="false">Luna</button>
      <button type="button" class="mode" role="radio" data-mode="void" aria-checked="false">Void</button>
    </div>

    <div class="group">
      <span class="range">
        Intensity
        <input id="intensity" type="range" min="10" max="100" value="60" aria-label="Intensity">
        <output id="ival">0.60</output>
      </span>
      <button type="button" class="pill" id="play">Pause</button>
      <button type="button" class="pill" id="shuffle">Shuffle</button>
      <button type="button" class="pill" id="save">Export</button>
    </div>
  </div>

  <div class="stage" role="img" aria-label="Generative aurora that responds to your pointer">
    <canvas id="sky"></canvas>
  </div>

  <div class="ticker" aria-hidden="true">
    <div class="ttrack">
      <span class="chip">Additive glow</span>
      <span class="chip">Hi‑DPI aware</span>
      <span class="chip">Pointer drift</span>
      <span class="chip">Palette modes</span>
      <span class="chip">Exportable</span>
      <span class="chip">Reduced‑motion friendly</span>

      <span class="chip">Additive glow</span>
      <span class="chip">Hi‑DPI aware</span>
      <span class="chip">Pointer drift</span>
      <span class="chip">Palette modes</span>
      <span class="chip">Exportable</span>
      <span class="chip">Reduced‑motion friendly</span>
    </div>
  </div>

  <div class="foot">
    <span>“Silence, then color.”</span>
    <span aria-hidden="true">✶</span>
  </div>

  <script>
    (function(){
      const root = document.getElementById('vibe1576');
      const updated = root.querySelector('#last-updated');
      const canvas = root.querySelector('#sky');
      const ctx = canvas.getContext('2d', { alpha: true });
      const stage = root.querySelector('.stage');
      const modes = Array.from(root.querySelectorAll('.mode'));
      const thumb = root.querySelector('.modes .thumb');
      const playBtn = root.querySelector('#play');
      const shuffleBtn = root.querySelector('#shuffle');
      const saveBtn = root.querySelector('#save');
      const range = root.querySelector('#intensity');
      const out = root.querySelector('#ival');

      // Timestamp
      try {
        const now = new Date();
        const opts = { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' };
        updated.textContent = 'Updated ' + now.toLocaleString([], opts);
      } catch(e) {}

      // DPR + size
      let dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      function fit(){
        const r = stage.getBoundingClientRect();
        canvas.width = Math.floor(r.width * dpr);
        canvas.height = Math.floor(r.height * dpr);
        canvas.style.width = r.width + 'px';
        canvas.style.height = r.height + 'px';
        buildStars();
      }
      fit();
      window.addEventListener('resize', ()=>{ dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1)); fit(); });

      // Modes -> palette
      const palettes = {
        sol: [[255,176,122],[255,212,107],[255,122,178]],
        luna: [[105,212,255],[110,255,199],[168,179,255]],
        void: [[155,123,255],[79,195,255],[255,208,107]]
      };
      let palette = palettes.sol;
      function setMode(btn){
        modes.forEach(m => m.setAttribute('aria-checked', String(m === btn)));
        root.setAttribute('data-mode', btn.dataset.mode);
        palette = palettes[btn.dataset.mode] || palettes.sol;
        positionThumb(btn);
        flash();
      }
      function positionThumb(btn){
        const wrap = btn.parentElement.getBoundingClientRect();
        const r = btn.getBoundingClientRect();
        const x = r.left - wrap.left;
        thumb.style.setProperty('--thumb-x', x + 'px');
        thumb.style.setProperty('--thumb-w', r.width + 'px');
      }
      requestAnimationFrame(()=> positionThumb(modes[0]));
      modes.forEach(b=>{
        b.addEventListener('click', ()=> setMode(b));
        b.addEventListener('keydown', (e)=>{
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setMode(b); }
          if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
            e.preventDefault();
            const dir = e.key === 'ArrowRight' ? 1 : -1;
            const i = modes.indexOf(b);
            const next = modes[(i + dir + modes.length) % modes.length];
            next.focus(); setMode(next);
          }
        });
      });

      // Intensity
      function updateIntensity(){
        out.textContent = (range.valueAsNumber/100).toFixed(2);
      }
      updateIntensity();
      range.addEventListener('input', updateIntensity);

      // Pointer drift for background glow
      let targetGX = 20, targetGY = 30, curGX = targetGX, curGY = targetGY;
      function glideGlow(){
        curGX += (targetGX - curGX) * 0.08;
        curGY += (targetGY - curGY) * 0.08;
        root.style.setProperty('--gx', curGX + '%');
        root.style.setProperty('--gy', curGY + '%');
        requestAnimationFrame(glideGlow);
      }
      glideGlow();

      stage.addEventListener('pointermove', (e)=>{
        const r = stage.getBoundingClientRect();
        const x = ((e.clientX - r.left)/r.width)*100;
        const y = ((e.clientY - r.top)/r.height)*100;
        targetGX = clamp(x, 6, 94);
        targetGY = clamp(y, 6, 94);
      }, { passive: true });

      // Pointer warp for aurora
      const pointer = { x: 0.5, y: 0.5, active: false };
      function onPoint(e){
        const rect = canvas.getBoundingClientRect();
        const x = (e.touches ? e.touches[0].clientX : e.clientX);
        const y = (e.touches ? e.touches[0].clientY : e.clientY);
        pointer.x = clamp((x - rect.left) / rect.width, 0, 1);
        pointer.y = clamp((y - rect.top) / rect.height, 0, 1);
        pointer.active = true;

        const tiltX = (pointer.y - 0.5) * -10;
        const tiltY = (pointer.x - 0.5) * 10;
        if (!reduce) stage.style.transform = `rotateX(${tiltX}deg) rotateY(${tiltY}deg)`;
      }
      function onLeave(){ pointer.active = false; if (!reduce) stage.style.transform = 'rotateX(0deg) rotateY(0deg)'; }
      stage.addEventListener('pointermove', onPoint, { passive: true });
      stage.addEventListener('touchmove', onPoint, { passive: true });
      stage.addEventListener('pointerleave', onLeave);
      stage.addEventListener('dblclick', ()=> { randomize(); flash(); });

      // Controls
      let running = true;
      let reduce = false;
      try { reduce = matchMedia('(prefers-reduced-motion: reduce)').matches; } catch(_) {}
      if (reduce) running = false;
      playBtn.textContent = running ? 'Pause' : 'Play';
      playBtn.addEventListener('click', ()=>{
        running = !running;
        playBtn.textContent = running ? 'Pause' : 'Play';
        if (running) requestAnimationFrame(loop);
      });
      shuffleBtn.addEventListener('click', ()=> { randomize(); flash(); });
      saveBtn.addEventListener('click', exportPNG);

      // Utilities
      const lerp = (a,b,t) => a + (b-a)*t;
      const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
      const mix = (A, B, t) => [Math.round(lerp(A[0], B[0], t)), Math.round(lerp(A[1], B[1], t)), Math.round(lerp(A[2], B[2], t))];
      const rgba = ([r,g,b], a=1) => `rgba(${r},${g},${b},${a})`;
      let seed = Math.random() * 1000;

      function rand(n=1){
        const x = Math.sin((seed+=0.0001)*100003.3)*43758.5453;
        return n === 1 ? (x - Math.floor(x)) : Array.from({length:n}, ()=>rand());
      }

      // Stars
      let stars = [];
      function buildStars(){
        const w = canvas.width, h = canvas.height;
        const count = Math.round((w*h)/(170*170));
        stars = Array.from({length: count}, ()=>{
          const [rx, ry, rr, rf] = [Math.random()*w, Math.random()*h, Math.random()*1.4 + 0.4, Math.random()*0.6+0.4];
          return { x: rx, y: ry, r: rr, f: rf, p: Math.random()*Math.PI*2 };
        });
      }
      buildStars();

      // Aurora params
      let ribbons = [];
      function randomize(){
        seed = Math.random() * 10000;
        ribbons = Array.from({length: 4}, (_,i)=>({
          amp: (0.07 + Math.random()*0.1),
          freq: 1.2 + Math.random()*1.4,
          speed: (0.2 + Math.random()*0.5) * (i%2 ? 1 : -1),
          phase: Math.random()*Math.PI*2,
          thick: 0.10 + Math.random()*0.18
        }));
      }
      randomize();

      // Draw
      function draw(t){
        const w = canvas.width, h = canvas.height;
        ctx.clearRect(0,0,w,h);

        // starfield
        ctx.save();
        ctx.globalCompositeOperation = 'screen';
        for (let s of stars){
          const tw = Math.sin(t*0.0015 + s.p) * 0.5 + 0.5;
          const a = 0.25 + 0.55 * tw * s.f;
          ctx.fillStyle = rgba(mix(palette[0], palette[2], tw*0.7), a);
          ctx.beginPath();
          ctx.arc(s.x, s.y, Math.max(0.6, s.r*dpr), 0, Math.PI*2);
          ctx.fill();
        }
        ctx.restore();

        // aurora ribbons
        const baseAmp = range.valueAsNumber/100; // 0.1 .. 1.0
        const centerY = h*0.48;
        const px = pointer.x*w, py = pointer.y*h;

        const samples = Math.max(220, Math.floor(w/6));
        const xStep = w / (samples-1);

        for (let i=0; i<ribbons.length; i++){
          const rb = ribbons[i];
          const hueMix = i / (ribbons.length-1);
          const cA = mix(palette[0], palette[1], hueMix);
          const cB = mix(cA, palette[2], 0.5 + 0.5*Math.sin(t*0.0006 + i));
          const grad = ctx.createLinearGradient(0,0,w,0);
          grad.addColorStop(0, rgba(cA, 0.07));
          grad.addColorStop(0.5, rgba(cB, 0.18));
          grad.addColorStop(1, rgba(cA, 0.07));

          const path = [];
          for (let s=0; s<samples; s++){
            const x = s*xStep;
            const nx = (x/w)*rb.freq + rb.phase;
            const wave = Math.sin(nx + t*0.0015*rb.speed) + 0.5*Math.sin(nx*2.2 - t*0.0011*rb.speed);
            const y = centerY + (h*rb.amp*baseAmp) * wave;

            // pointer warp
            let warp = 0;
            if (pointer.active){
              const dx = (x - px), dy = (y - py);
              const d = Math.hypot(dx, dy);
              warp = Math.exp(-d / (160*dpr));
            }
            const yy = lerp(y, py, warp*0.25);
            path.push([x, yy]);
          }

          // render glow (multi-stroke)
          ctx.save();
          ctx.globalCompositeOperation = 'lighter';
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round';

          const widths = [h*rb.thick*1.6, h*rb.thick, h*rb.thick*0.55];
          const alphas = [0.10, 0.18, 0.30];

          for (let p=0; p<widths.length; p++){
            ctx.beginPath();
            for (let s=0; s<path.length; s++){
              const [x, y] = path[s];
              if (s===0) ctx.moveTo(x, y);
              else ctx.lineTo(x, y);
            }
            ctx.strokeStyle = p === widths.length-1 ? grad : rgba(cB, alphas[p]);
            ctx.lineWidth = widths[p];
            ctx.stroke();
          }

          // shimmer threads
          ctx.beginPath();
          for (let s=0; s<path.length; s+=2){
            const [x, y] = path[s];
            if (s===0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          }
          ctx.strokeStyle = rgba(cB, 0.12);
          ctx.lineWidth = Math.max(1, 2*dpr);
          ctx.stroke();

          ctx.restore();
        }
      }

      // Loop
      let last = 0;
      function loop(now){
        if (!running) return;
        const dt = now - last; last = now;
        draw(now);
        requestAnimationFrame(loop);
      }
      requestAnimationFrame(loop);

      function flash(){
        stage.animate([{ filter: 'saturate(140%) brightness(1.05)' }, { filter: 'saturate(115%) brightness(1.0)' }], { duration: 500, easing: 'cubic-bezier(.2,.8,.2,1)' });
      }

      // Export
      function exportPNG(){
        try {
          const off = document.createElement('canvas');
          const rect = canvas.getBoundingClientRect();
          const scale = 2;
          off.width = Math.floor(rect.width*scale);
          off.height = Math.floor(rect.height*scale);
          const octx = off.getContext('2d');
          // upscale current frame high quality
          octx.imageSmoothingEnabled = true;
          octx.imageSmoothingQuality = 'high';
          octx.drawImage(canvas, 0, 0, off.width, off.height);
          off.toBlob((blob)=>{
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'breathing-light.png';
            document.body.appendChild(a); a.click(); URL.revokeObjectURL(a.href); a.remove();
          }, 'image/png');
          flash();
        } catch(e) {}
      }

      // Reduced motion
      if (reduce) { playBtn.textContent = 'Play'; }

      // Ambient backdrop drift
      let targetX = 55, targetY = 40, curX = targetX, curY = targetY;
      function glideBackdrop(){
        curX += (targetX - curX) * 0.08;
        curY += (targetY - curY) * 0.08;
        root.style.setProperty('--mx', curX + '%');
        root.style.setProperty('--my', curY + '%');
        requestAnimationFrame(glideBackdrop);
      }
      glideBackdrop();
      stage.addEventListener('pointermove', (e)=>{
        const r = stage.getBoundingClientRect();
        const x = ((e.clientX - r.left)/r.width)*100;
        const y = ((e.clientY - r.top)/r.height)*100;
        targetX = clamp(x, 6, 94);
        targetY = clamp(y, 6, 94);
      }, { passive: true });
    }());
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


