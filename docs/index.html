<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="vibe2402" data-theme="dawn" aria-label="Lumen Loom">
  <style>
    /* Scoped to #vibe2402 only */
    #vibe2402 {
      --radius: 26px;
      --ink: hsl(230 22% 12%);
      --muted: hsl(230 10% 40% / 0.85);
      --line: hsl(230 10% 30% / 0.12);

      /* Theme: Dawn (default) */
      --c1: hsl(18 92% 66%);
      --c2: hsl(46 94% 60%);
      --c3: hsl(188 72% 56%);
      --paper: hsl(40 55% 96%);

      position: relative;
      isolation: isolate;
      color: var(--ink);
      background:
        radial-gradient(1200px 800px at -10% -20%, hsl(46 80% 85% / 0.6), transparent 60%),
        radial-gradient(1000px 700px at 115% 120%, hsl(188 70% 80% / 0.5), transparent 60%),
        var(--paper);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: 0 18px 60px hsl(230 50% 10% / 0.12), inset 0 0 0 1px hsl(0 0% 100% / 0.5);
      padding: clamp(18px, 3.5vw, 46px);
      min-height: 70vh;
      font: 400 16px/1.55 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      letter-spacing: 0.01em;
      overflow: hidden;
      container-type: inline-size;
    }

    /* Other palettes */
    #vibe2402[data-theme="dusk"] {
      --c1: hsl(276 80% 70%);
      --c2: hsl(210 90% 62%);
      --c3: hsl(340 82% 66%);
      --paper: hsl(265 60% 9%);
      --ink: hsl(0 0% 96%);
      --muted: hsl(0 0% 78% / 0.85);
      --line: hsl(0 0% 100% / 0.14);
      box-shadow: 0 24px 70px hsl(0 0% 0% / 0.45), inset 0 0 0 1px hsl(0 0% 100% / 0.08);
      background:
        radial-gradient(1100px 760px at -10% -20%, hsl(276 50% 30% / 0.5), transparent 60%),
        radial-gradient(900px 600px at 120% 120%, hsl(210 60% 30% / 0.45), transparent 60%),
        hsl(240 22% 7%);
    }
    #vibe2402[data-theme="tide"] {
      --c1: hsl(187 85% 58%);
      --c2: hsl(160 70% 52%);
      --c3: hsl(222 85% 68%);
      --paper: hsl(195 60% 96%);
    }
    #vibe2402[data-theme="orchid"] {
      --c1: hsl(310 83% 70%);
      --c2: hsl(270 80% 65%);
      --c3: hsl(20 90% 66%);
      --paper: hsl(300 45% 96%);
    }

    /* Soft ribbons behind content */
    #vibe2402::before,
    #vibe2402::after {
      content: "";
      position: absolute;
      inset: -30%;
      pointer-events: none;
      z-index: 0;
      filter: blur(60px) saturate(130%);
      opacity: 0.7;
    }
    #vibe2402::before {
      background:
        conic-gradient(from 30deg at 35% 65%, var(--c1), transparent 60%),
        conic-gradient(from -80deg at 70% 30%, var(--c2), transparent 60%);
      animation: v2402-sweep-a var(--ribbont, 28s) ease-in-out infinite alternate;
      mix-blend-mode: multiply;
    }
    #vibe2402::after {
      background:
        conic-gradient(from 120deg at 50% 50%, var(--c3), transparent 60%);
      animation: v2402-sweep-b var(--ribbont, 36s) ease-in-out infinite alternate-reverse;
      mix-blend-mode: screen;
    }
    #vibe2402[data-theme="dusk"]::before { mix-blend-mode: screen; }
    #vibe2402[data-theme="dusk"]::after { mix-blend-mode: screen; opacity: 0.6; }

    /* Subtle paper grain grid */
    #vibe2402 .grain {
      position: absolute;
      inset: 0;
      background:
        repeating-linear-gradient(90deg, hsl(0 0% 100% / 0.03) 0 1px, transparent 1px 40px),
        repeating-linear-gradient(0deg, hsl(0 0% 0% / 0.03) 0 1px, transparent 1px 40px);
      mask: radial-gradient(120% 95% at 50% 40%, black, transparent);
      pointer-events: none;
      z-index: 1;
    }

    /* Top bar */
    #vibe2402 .bar {
      position: relative; z-index: 3;
      display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 14px;
      margin-bottom: clamp(12px, 3vw, 28px);
    }
    #vibe2402 .logo {
      display: inline-flex; align-items: center; gap: 12px;
      padding: 10px 14px;
      border-radius: 999px;
      background: hsl(0 0% 100% / 0.7);
      border: 1px solid var(--line);
      backdrop-filter: blur(8px) saturate(140%);
      color: var(--ink);
      font-weight: 800; letter-spacing: 0.05em; text-transform: uppercase; font-size: 13px;
    }
    #vibe2402[data-theme="dusk"] .logo { background: hsl(0 0% 10% / 0.45); color: var(--ink); }
    #vibe2402 .logo svg { width: 18px; height: 18px; display: block; }

    #vibe2402 .controls {
      display: inline-flex; align-items: center; gap: 10px; flex-wrap: wrap;
    }
    #vibe2402 .seg {
      display: inline-flex; background: hsl(0 0% 100% / 0.7); border: 1px solid var(--line);
      border-radius: 999px; padding: 4px; backdrop-filter: blur(8px) saturate(140%);
    }
    #vibe2402[data-theme="dusk"] .seg { background: hsl(0 0% 10% / 0.45); }
    #vibe2402 .seg button {
      -webkit-tap-highlight-color: transparent;
      appearance: none; border: 0; background: transparent; color: var(--ink);
      padding: 8px 12px; border-radius: 999px; font-weight: 700; font-size: 12px; cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;
    }
    #vibe2402 .seg button[aria-pressed="true"] {
      background: linear-gradient(90deg, var(--c1), var(--c2));
      color: white; text-shadow: 0 1px 0 hsl(0 0% 0% / 0.2);
    }
    #vibe2402 .ctrl {
      display: inline-grid; grid-template-columns: auto 1fr; align-items: center; gap: 8px;
      padding: 8px 10px; border: 1px solid var(--line); border-radius: 12px;
      background: hsl(0 0% 100% / 0.7); font-size: 12px; color: var(--muted);
      backdrop-filter: blur(8px) saturate(140%);
    }
    #vibe2402[data-theme="dusk"] .ctrl { background: hsl(0 0% 10% / 0.45); }
    #vibe2402 input[type="range"] {
      -webkit-appearance: none; appearance: none;
      width: 140px; height: 10px; border-radius: 999px;
      background: linear-gradient(90deg, var(--c1), var(--c2));
      border: 1px solid hsl(0 0% 100% / 0.3);
      box-shadow: inset 0 1px 0 hsl(0 0% 100% / 0.45), 0 2px 9px hsl(0 0% 0% / 0.2);
      outline: none; cursor: pointer;
    }
    #vibe2402 input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, hsl(0 0% 100%), hsl(0 0% 90%));
      border: 1px solid hsl(0 0% 100% / 0.65);
      box-shadow: 0 2px 8px hsl(0 0% 0% / 0.35), 0 0 0 6px color-mix(in oklab, var(--c3) 30%, transparent);
    }
    #vibe2402 input[type="range"]::-moz-range-thumb {
      width: 18px; height: 18px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, hsl(0 0% 100%), hsl(0 0% 90%));
      border: 1px solid hsl(0 0% 100% / 0.65);
      box-shadow: 0 2px 8px hsl(0 0% 0% / 0.35), 0 0 0 6px color-mix(in oklab, var(--c3) 30%, transparent);
    }

    /* Stage */
    #vibe2402 .stage {
      position: relative; z-index: 2;
      display: grid; justify-items: center; align-items: start;
      gap: clamp(16px, 3.2vw, 34px);
    }

    /* Loom module */
    #vibe2402 .loom {
      --rx: 0deg; --ry: 0deg;
      position: relative;
      width: min(980px, 98cqi);
      aspect-ratio: 16 / 9;
      border-radius: calc(var(--radius) + 8px);
      background: linear-gradient(180deg, hsl(0 0% 100% / 0.85), hsl(0 0% 100% / 0.65)) padding-box;
      border: 1px solid var(--line);
      backdrop-filter: blur(20px) saturate(140%);
      box-shadow: 0 26px 80px hsl(230 50% 10% / 0.18), inset 0 0 0 1px hsl(0 0% 100% / 0.6);
      overflow: hidden;
      transform: perspective(1000px) rotateX(var(--rx)) rotateY(var(--ry));
    }
    #vibe2402[data-theme="dusk"] .loom {
      background: linear-gradient(180deg, hsl(0 0% 12% / 0.7), hsl(0 0% 0% / 0.3));
      box-shadow: 0 24px 70px hsl(0 0% 0% / 0.5), inset 0 0 0 1px hsl(0 0% 100% / 0.12);
    }
    #vibe2402 .fabric {
      position: absolute; inset: 0; width: 100%; height: 100%; display: block;
      z-index: 0; opacity: 0.95; mix-blend-mode: plus-lighter;
    }
    #vibe2402[data-theme="dusk"] .fabric { mix-blend-mode: screen; opacity: 0.9; }

    #vibe2402 .caption {
      position: absolute; inset: 0; z-index: 1;
      display: grid; place-items: center;
      text-align: center; padding: clamp(10px, 5vw, 40px);
    }
    #vibe2402 .title {
      margin: 0;
      font-family: ui-serif, "Georgia", "Times New Roman", serif;
      font-size: clamp(34px, 9cqi, 92px);
      line-height: 0.98; letter-spacing: -0.02em; font-weight: 800;
      background: linear-gradient(90deg, var(--c1), var(--c2), var(--c3));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-shadow: 0 1px 0 hsl(0 0% 100% / 0.2);
    }
    #vibe2402[data-theme="dusk"] .title { text-shadow: 0 1px 0 hsl(0 0% 0% / 0.4); }
    #vibe2402 .sub {
      margin: 12px 0 0; font-size: clamp(14px, 2.5cqi, 22px); color: var(--muted);
      text-wrap: pretty;
    }

    /* Chips */
    #vibe2402 .chips {
      list-style: none; padding: 0; margin: 0;
      display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
    }
    #vibe2402 .chip {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 12px; border-radius: 999px;
      border: 1px solid var(--line);
      background: hsl(0 0% 100% / 0.7); color: var(--ink);
      font-weight: 700; font-size: 13px;
      transition: transform 0.2s ease, background 0.2s ease;
    }
    #vibe2402 .chip::before {
      content: ""; width: 8px; height: 8px; border-radius: 50%;
      background: radial-gradient(circle at 40% 40%, var(--c1), var(--c2));
      box-shadow: 0 0 10px color-mix(in oklab, var(--c2) 70%, transparent);
    }
    #vibe2402 .chip:hover { transform: translateY(-1px) scale(1.02); background: hsl(0 0% 100% / 0.9); }
    #vibe2402[data-theme="dusk"] .chip { background: hsl(0 0% 12% / 0.5); }

    /* Cards */
    #vibe2402 .cards {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: clamp(12px, 2.6vw, 22px);
      width: min(980px, 98cqi);
    }
    @container (max-width: 760px) {
      #vibe2402 .cards { grid-template-columns: 1fr; }
    }
    #vibe2402 .card {
      --card-rx: 0deg; --card-ry: 0deg;
      position: relative; overflow: hidden;
      border-radius: calc(var(--radius) - 6px);
      border: 1px solid var(--line);
      background: linear-gradient(180deg, hsl(0 0% 100% / 0.8), hsl(0 0% 100% / 0.65));
      padding: 16px;
      min-height: 120px;
      display: grid; align-content: space-between;
      box-shadow: 0 12px 30px hsl(0 0% 0% / 0.08), inset 0 0 0 1px hsl(0 0% 100% / 0.55);
      transform: perspective(600px) rotateX(var(--card-rx)) rotateY(var(--card-ry));
      transition: transform 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
    }
    #vibe2402[data-theme="dusk"] .card { background: linear-gradient(180deg, hsl(0 0% 12% / 0.7), hsl(0 0% 0% / 0.3)); }
    #vibe2402 .card:hover { box-shadow: 0 18px 40px color-mix(in oklab, var(--c3) 30%, hsl(0 0% 0% / 0.2)); }
    #vibe2402 .card h3 { margin: 0 0 8px; font-size: 16px; letter-spacing: 0.02em; }
    #vibe2402 .card p { margin: 0; font-size: 13px; color: var(--muted); }
    #vibe2402 .swirl {
      position: absolute; inset: -30% -10% auto auto; height: 140%;
      background: conic-gradient(from 70deg, var(--c1), var(--c2), var(--c3), transparent 70%);
      filter: blur(30px) saturate(130%); opacity: 0.35; mix-blend-mode: plus-lighter;
      pointer-events: none;
      transform: translateZ(0);
    }

    /* Footer */
    #vibe2402 .foot {
      position: relative; z-index: 2; display: grid; place-items: center; text-align: center;
      margin-top: clamp(16px, 4vw, 36px); gap: 8px; color: var(--muted);
    }
    #vibe2402 .foot small {
      font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase;
      border: 1px solid var(--line);
      padding: 8px 12px; border-radius: 10px;
      background: hsl(0 0% 100% / 0.6);
    }
    #vibe2402[data-theme="dusk"] .foot small { background: hsl(0 0% 12% / 0.5); }

    /* Keyframes */
    @keyframes v2402-sweep-a {
      0% { transform: translate3d(-2%, -1%, 0) rotate(0deg) scale(1); }
      50% { transform: translate3d(2%, 1%, 0) rotate(12deg) scale(1.06); }
      100% { transform: translate3d(-1%, 3%, 0) rotate(20deg) scale(1.02); }
    }
    @keyframes v2402-sweep-b {
      0% { transform: translate3d(2%, 1%, 0) rotate(0deg) scale(1.02); }
      50% { transform: translate3d(-2%, -1%, 0) rotate(-10deg) scale(1.08); }
      100% { transform: translate3d(1%, -2%, 0) rotate(-22deg) scale(1.01); }
    }

    /* Reduced motion */
    #vibe2402.reduce-motion::before,
    #vibe2402.reduce-motion::after { animation: none !important; }
    #vibe2402.reduce-motion .fabric { opacity: 0.6; }
  </style>

  <div class="grain" aria-hidden="true"></div>

  <div class="bar">
    <div class="logo" aria-label="Lumen Loom">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <defs>
          <linearGradient id="v2402-g" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0" stop-color="currentColor" stop-opacity="0.7"/>
            <stop offset="1" stop-color="currentColor"/>
          </linearGradient>
        </defs>
        <path d="M4 7c4-5 12-5 16 0M4 17c4 5 12 5 16 0" stroke="url(#v2402-g)" stroke-width="2" fill="none" stroke-linecap="round"/>
        <circle cx="12" cy="12" r="2" fill="currentColor" />
      </svg>
      <span>Lumen Loom</span>
    </div>

    <div class="controls" role="group" aria-label="Appearance and motion controls">
      <div class="seg" role="tablist" aria-label="Themes">
        <button class="theme" data-theme="dawn" aria-pressed="true" role="tab">Dawn</button>
        <button class="theme" data-theme="dusk" aria-pressed="false" role="tab">Dusk</button>
        <button class="theme" data-theme="tide" aria-pressed="false" role="tab">Tide</button>
        <button class="theme" data-theme="orchid" aria-pressed="false" role="tab">Orchid</button>
      </div>

      <label class="ctrl" for="flow">
        Flow
        <input id="flow" type="range" min="0.3" max="2.2" step="0.1" value="1.0" aria-label="Adjust flow speed">
      </label>

      <label class="ctrl" for="density">
        Weave
        <input id="density" type="range" min="40" max="180" step="10" value="100" aria-label="Adjust weave density">
      </label>

      <label class="ctrl" for="glow">
        Glow
        <input id="glow" type="range" min="0.2" max="1.5" step="0.1" value="0.8" aria-label="Adjust glow intensity">
      </label>
    </div>
  </div>

  <div class="stage">
    <div class="loom" tabindex="0" aria-label="Interactive luminous weave">
      <canvas class="fabric" aria-hidden="true"></canvas>
      <div class="caption" aria-hidden="true">
        <h1 class="title">Soft Systems</h1>
        <p class="sub">Interfaces that breathe. Motion that listens.</p>
      </div>
    </div>

    <ul class="chips" aria-label="Principles">
      <li class="chip">Listen</li>
      <li class="chip">Pare</li>
      <li class="chip">Breathe</li>
      <li class="chip">Attend</li>
    </ul>

    <div class="cards" aria-label="Notes">
      <article class="card" tabindex="0" aria-label="Card — Rhythm">
        <div class="swirl" aria-hidden="true"></div>
        <h3>Rhythm</h3>
        <p>Use time as whitespace—leave room for pause and return.</p>
      </article>
      <article class="card" tabindex="0" aria-label="Card — Clarity">
        <div class="swirl" aria-hidden="true"></div>
        <h3>Clarity</h3>
        <p>Reduce until the purpose gleams. Then reduce once more.</p>
      </article>
      <article class="card" tabindex="0" aria-label="Card — Grace">
        <div class="swirl" aria-hidden="true"></div>
        <h3>Grace</h3>
        <p>Let delight be discovered, not demanded.</p>
      </article>
    </div>
  </div>

  <div class="foot">
    <small>Weave quietly. Let color carry the note.</small>
    <span id="last-updated">Last updated: 2026-02-05 02:50:53 EST</span>
  </div>

  <script>
    (function () {
      const root = document.getElementById('vibe2402');
      const fabric = root.querySelector('.fabric');
      const flow = root.querySelector('#flow');
      const density = root.querySelector('#density');
      const glow = root.querySelector('#glow');
      const themes = Array.from(root.querySelectorAll('.theme'));
      const loom = root.querySelector('.loom');
      const cards = Array.from(root.querySelectorAll('.card'));
      const updated = root.querySelector('#last-updated');

      // Last updated stamp
      try {
        const now = new Date();
        const fmt = new Intl.DateTimeFormat(undefined, { dateStyle: 'medium', timeStyle: 'medium' });
        updated.textContent = 'Last updated: ' + fmt.format(now);
      } catch {
        updated.textContent = 'Last updated: just now';
      }

      // Theme switching
      const setTheme = (name) => {
        root.setAttribute('data-theme', name);
        themes.forEach(b => b.setAttribute('aria-pressed', b.dataset.theme === name ? 'true' : 'false'));
        // Refresh canvas palette
        readColors();
      };
      themes.forEach(btn => btn.addEventListener('click', () => setTheme(btn.dataset.theme)));

      // Reduced motion preference
      const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)');
      const applyReduce = (on) => root.classList.toggle('reduce-motion', !!on);
      if (reduce) {
        applyReduce(reduce.matches);
        reduce.addEventListener('change', (e) => applyReduce(e.matches));
      }

      // Loom tilt (pointer + focus)
      const tilt = (x, y, rect) => {
        const mx = (x - rect.left) / rect.width;
        const my = (y - rect.top) / rect.height;
        const rx = (0.5 - my) * 8;
        const ry = (mx - 0.5) * 10;
        loom.style.setProperty('--rx', rx.toFixed(2) + 'deg');
        loom.style.setProperty('--ry', ry.toFixed(2) + 'deg');
      };
      root.addEventListener('pointermove', (e) => {
        const rect = loom.getBoundingClientRect();
        tilt(e.clientX, e.clientY, rect);
      });
      root.addEventListener('pointerleave', () => {
        loom.style.setProperty('--rx', '0deg');
        loom.style.setProperty('--ry', '0deg');
      });
      loom.addEventListener('focus', () => { loom.style.setProperty('--rx', '-2deg'); loom.style.setProperty('--ry', '2deg'); });
      loom.addEventListener('blur', () => { loom.style.setProperty('--rx', '0deg'); loom.style.setProperty('--ry', '0deg'); });

      // Card micro tilt
      const cardTilt = (card, e) => {
        const r = card.getBoundingClientRect();
        const mx = (e.clientX - r.left) / r.width;
        const my = (e.clientY - r.top) / r.height;
        const rx = (0.5 - my) * 6;
        const ry = (mx - 0.5) * 8;
        card.style.setProperty('--card-rx', rx.toFixed(2) + 'deg');
        card.style.setProperty('--card-ry', ry.toFixed(2) + 'deg');
      };
      cards.forEach(c => {
        c.addEventListener('pointermove', (e) => cardTilt(c, e));
        c.addEventListener('pointerleave', () => { c.style.setProperty('--card-rx', '0deg'); c.style.setProperty('--card-ry', '0deg'); });
        c.addEventListener('focus', () => { c.style.setProperty('--card-rx', '-2deg'); c.style.setProperty('--card-ry', '2deg'); });
        c.addEventListener('blur', () => { c.style.setProperty('--card-rx', '0deg'); c.style.setProperty('--card-ry', '0deg'); });
      });

      // Fabric (canvas) — flowing threads
      const ctx = fabric.getContext('2d', { alpha: true });
      let raf;
      const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      const state = { time: 0, flow: parseFloat(flow.value), dens: parseInt(density.value, 10), glow: parseFloat(glow.value) };
      const palette = { c1: '#ff8', c2: '#ff8', c3: '#ff8' };

      const fit = () => {
        const { width, height } = loom.getBoundingClientRect();
        fabric.width = Math.floor(width * DPR);
        fabric.height = Math.floor(height * DPR);
        fabric.style.width = width + 'px';
        fabric.style.height = height + 'px';
        ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      };

      const readColors = () => {
        const s = getComputedStyle(root);
        palette.c1 = s.getPropertyValue('--c1').trim();
        palette.c2 = s.getPropertyValue('--c2').trim();
        palette.c3 = s.getPropertyValue('--c3').trim();
      };

      const grad = () => {
        const g = ctx.createLinearGradient(0, 0, fabric.width / DPR, fabric.height / DPR);
        g.addColorStop(0, palette.c1);
        g.addColorStop(0.5, palette.c2);
        g.addColorStop(1, palette.c3);
        return g;
      };

      const draw = (t) => {
        if (root.classList.contains('reduce-motion')) {
          // Static weave
          ctx.clearRect(0, 0, fabric.width, fabric.height);
          const g = grad();
          ctx.lineWidth = 1.2;
          ctx.strokeStyle = g;
          const W = fabric.width / DPR, H = fabric.height / DPR;
          const rows = Math.max(18, Math.floor(state.dens / 4));
          for (let i = 0; i < rows; i++) {
            const y = (H * i) / (rows - 1);
            ctx.beginPath();
            for (let x = 0; x <= W; x += 6) {
              const k = i * 0.15;
              const ny = Math.sin((x * 0.012) + k) * 8;
              const px = x === 0 ? 0 : x;
              const py = y + ny;
              x === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
            }
            ctx.globalAlpha = 0.5;
            ctx.stroke();
          }
          return;
        }

        state.time = t * 0.001 * state.flow;
        ctx.clearRect(0, 0, fabric.width, fabric.height);
        const W = fabric.width / DPR, H = fabric.height / DPR;

        // Glow layer
        ctx.save();
        ctx.globalCompositeOperation = 'lighter';
        const g = grad();

        const rows = Math.max(18, Math.floor(state.dens));
        for (let i = 0; i < rows; i++) {
          const y = (H * i) / (rows - 1);
          const amp = 18 + 12 * Math.sin((i * 0.3) + state.time * 0.4);
          const freq = 0.008 + 0.004 * Math.cos((i * 0.2) - state.time * 0.3);
          ctx.beginPath();
          for (let x = 0; x <= W; x += 5) {
            const phase = state.time * 1.2 + i * 0.15;
            const ny = Math.sin(x * freq + phase) * amp * Math.sin((i / rows) * Math.PI);
            const px = x;
            const py = y + ny;
            x === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
          }
          ctx.lineWidth = 1.1 + 1.2 * Math.sin(i * 0.25 + state.time);
          ctx.strokeStyle = g;
          ctx.globalAlpha = 0.12 + 0.7 * state.glow * Math.pow(Math.sin((i / rows) * Math.PI), 1.4);
          ctx.stroke();
        }
        ctx.restore();

        raf = requestAnimationFrame(draw);
      };

      const start = () => {
        cancelAnimationFrame(raf);
        draw(performance.now());
      };

      // Handlers
      flow.addEventListener('input', (e) => { state.flow = parseFloat(e.target.value); });
      density.addEventListener('input', (e) => { state.dens = parseInt(e.target.value, 10); });
      glow.addEventListener('input', (e) => { state.glow = parseFloat(e.target.value); });

      const ro = new ResizeObserver(() => { fit(); readColors(); start(); });
      ro.observe(loom);
      fit(); readColors(); start();

      // Cleanup if removed
      root.addEventListener('DOMNodeRemoved', () => { cancelAnimationFrame(raf); ro.disconnect(); });
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


