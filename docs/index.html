<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="observatory" data-theme="dusk" aria-label="Orbital Garden • 692">
  <style>
    /* Scope */
    #observatory {
      --ink: #eaf4ff;
      --muted: #9fb3cc;
      --ring: rgba(255,255,255,0.16);
      --bg-1: #0a0f1a;
      --bg-2: #0e1524;

      /* Accents (will change per theme) */
      --a1: #8da9ff;
      --a2: #b388ff;
      --a3: #ff8bd1;
      --a4: #6ef3ff;
      --star: #dff3ff;
      --orbit: rgba(200,230,255,0.22);

      position: relative;
      isolation: isolate;
      color: var(--ink);
      border-radius: 32px;
      padding: clamp(18px, 4vw, 44px);
      border: 1px solid var(--ring);
      box-shadow:
        0 60px 180px rgba(0,0,0,0.55),
        inset 0 0 0 1px rgba(255,255,255,0.10);
      background:
        radial-gradient(140% 120% at 50% -20%, rgba(255,255,255,0.08), transparent 52%),
        radial-gradient(120% 120% at 100% 100%, rgba(255,255,255,0.05), transparent 62%),
        linear-gradient(180deg, var(--bg-1), var(--bg-2));
      font: 500 15px/1.6 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      min-height: 760px;
      --rx: 0deg;
      --ry: 0deg;
      overflow: clip;
    }

    /* Themes */
    #observatory[data-theme="dawn"] {
      --bg-1:#0d1120; --bg-2:#161d33; --ink:#f4f9ff; --muted:#b9c7dc; --ring:rgba(200,220,255,0.22);
      --a1:#ffd6a5; --a2:#ff8fab; --a3:#9bf6ff; --a4:#b5e48c; --star:#fff6e0; --orbit:rgba(255,240,200,0.24);
    }
    #observatory[data-theme="dusk"] {
      --bg-1:#060b14; --bg-2:#101a2c; --ink:#eaf4ff; --muted:#9fb3cc; --ring:rgba(170,210,255,0.20);
      --a1:#8da9ff; --a2:#b388ff; --a3:#ff8bd1; --a4:#6ef3ff; --star:#dff3ff; --orbit:rgba(180,210,255,0.22);
    }
    #observatory[data-theme="noir"] {
      --bg-1:#0a0a0f; --bg-2:#121219; --ink:#fbfbff; --muted:#bfbfd6; --ring:rgba(255,255,255,0.18);
      --a1:#8fffe0; --a2:#8ecbff; --a3:#ffd483; --a4:#ffffff; --star:#f4faff; --orbit:rgba(220,230,250,0.18);
    }
    #observatory[data-theme="glow"] {
      --bg-1:#050b09; --bg-2:#0c1f1a; --ink:#eafffb; --muted:#a2d6cd; --ring:rgba(160,255,220,0.22);
      --a1:#00ffd0; --a2:#8b6cff; --a3:#ff84e8; --a4:#ffee7a; --star:#dffcf5; --orbit:rgba(160,255,220,0.22);
    }

    /* Ambient layers */
    #observatory .nebula {
      position: absolute; inset: -16%;
      background:
        radial-gradient(60% 40% at 80% 20%, color-mix(in oklab, var(--a2) 28%, transparent) 0, transparent 60%),
        radial-gradient(50% 40% at 20% 80%, color-mix(in oklab, var(--a3) 24%, transparent) 0, transparent 62%),
        conic-gradient(from .2turn at 50% 50%, color-mix(in oklab, var(--a1) 12%, transparent), transparent 60%);
      filter: blur(46px) saturate(120%);
      opacity: .45;
      z-index: 0;
      animation: drift 48s ease-in-out infinite alternate;
    }
    @keyframes drift { 
      0% { transform: translate(-2%, 1%) rotate(0.2deg) scale(1.02); }
      50% { transform: translate(1%, -1%) rotate(-0.2deg) scale(1.04); }
      100% { transform: translate(2%, 2%) rotate(0deg) scale(1.03); }
    }
    #observatory .noise {
      position: absolute; inset: -30%;
      background-image:
        repeating-linear-gradient(90deg, rgba(255,255,255,0.04) 0 2px, transparent 2px 6px),
        repeating-conic-gradient(from 0deg, rgba(0,0,0,0.06) 0 8deg, transparent 8deg 16deg);
      mix-blend-mode: soft-light; opacity:.07; z-index:0;
      animation: grain 8s steps(6) infinite;
    }
    @keyframes grain { 50% { transform: translate(2px, -2px) } }

    /* Top bar */
    #observatory .top {
      position: relative; z-index: 3;
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      margin-bottom: clamp(10px, 2.8vw, 24px);
    }
    #observatory .brand {
      display: inline-flex; align-items: center; gap: 12px; color: var(--muted); font-weight: 900; letter-spacing: .2px;
    }
    #observatory .orb {
      width: 30px; height: 30px; border-radius: 999px; position: relative; overflow: hidden;
      background: radial-gradient(circle at 30% 30%, var(--a4), transparent 60%),
                  conic-gradient(from .2turn, var(--a1), var(--a2), var(--a3), var(--a4), var(--a1));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.75), 0 14px 32px rgba(0,0,0,0.25);
      border: 1px solid var(--ring);
      animation: orbspin 18s linear infinite;
    }
    @keyframes orbspin { to { transform: rotate(1turn) } }

    #observatory .actions { display:flex; align-items:center; gap:8px; }
    #observatory .chip, #observatory .dot {
      appearance: none; -webkit-tap-highlight-color: transparent; user-select: none; cursor: pointer;
      border: 1px solid var(--ring);
      box-shadow: 0 14px 30px rgba(0,0,0,0.25), inset 0 0 0 1px rgba(255,255,255,0.14);
      transition: transform .14s ease, box-shadow .25s ease, background .2s ease, opacity .2s ease;
    }
    #observatory .chip {
      padding: 10px 14px; border-radius: 14px; color: var(--ink); font-weight: 800; letter-spacing: .2px; font-size: 12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.045));
    }
    #observatory .chip:hover { transform: translateY(-1px); box-shadow: 0 22px 44px rgba(0,0,0,0.32), 0 0 0 6px rgba(255,255,255,0.05); }
    #observatory .chip.primary {
      background:
        linear-gradient(180deg, rgba(255,255,255,0.25), rgba(255,255,255,0.09)),
        linear-gradient(90deg, var(--a1), var(--a3));
      background-blend-mode: overlay, normal;
      color: #0f1222; border-color: rgba(0,0,0,0.18);
    }

    #observatory .dot {
      width: 26px; height: 26px; border-radius: 999px; padding: 0; position: relative;
      background: conic-gradient(from .2turn, var(--a1), var(--a2), var(--a3), var(--a4));
    }
    #observatory .dot[data-theme="dawn"] { background: conic-gradient(from .2turn, #ffd6a5, #ff8fab, #9bf6ff, #b5e48c); }
    #observatory .dot[data-theme="dusk"] { background: conic-gradient(from .2turn, #8da9ff, #b388ff, #ff8bd1, #6ef3ff); }
    #observatory .dot[data-theme="noir"] { background: conic-gradient(from .2turn, #8fffe0, #8ecbff, #ffd483, #ffffff); }
    #observatory .dot[data-theme="glow"] { background: conic-gradient(from .2turn, #00ffd0, #8b6cff, #ff84e8, #ffee7a); }
    #observatory .dot.active::after { content:""; position:absolute; inset:4px; border:2px solid rgba(255,255,255,0.95); border-radius:999px; }

    /* Hero */
    #observatory .hero {
      position: relative; z-index: 3; display: grid; gap: clamp(6px, 1.6vw, 12px); margin: clamp(8px, 3.4vw, 28px) 0;
    }
    #observatory .kicker {
      color: var(--muted); text-transform: uppercase; letter-spacing: .28em; font-weight: 900;
      font-size: clamp(11px, 1.4vw, 13px);
    }
    #observatory .title {
      font-weight: 900; letter-spacing: -0.02em; line-height: .92;
      font-size: clamp(44px, 8vw, 116px);
      background: linear-gradient(90deg, var(--ink), var(--a1) 42%, var(--a3) 68%, var(--a4));
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    #observatory .sub { color: var(--muted); max-width: 68ch; font-size: clamp(13px, 1.9vw, 18px); }

    /* Stage */
    #observatory .arena { position: relative; z-index:2; margin: clamp(14px, 4.4vw, 40px) 0; display:grid; place-items:center; }
    #observatory .viewport {
      position: relative; width: min(94vw, 1040px); aspect-ratio: 16/10; border-radius: 24px; overflow: hidden;
      border: 1px solid var(--ring);
      transform-style: preserve-3d; transform: rotateX(var(--rx)) rotateY(var(--ry));
      background:
        radial-gradient(60% 80% at 50% 50%, rgba(255,255,255,0.06), transparent 70%),
        linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.03));
      box-shadow:
        0 40px 140px rgba(0,0,0,0.46),
        inset 0 0 0 1px rgba(255,255,255,0.14);
      backdrop-filter: blur(8px) saturate(120%); -webkit-backdrop-filter: blur(8px) saturate(120%);
    }
    #observatory canvas { position:absolute; inset:0; width:100%; height:100%; display:block; }
    #observatory .crest, #observatory .crest::before {
      content:""; position:absolute; inset:-14px; border-radius:26px; pointer-events:none;
    }
    #observatory .crest {
      background: conic-gradient(from .06turn, transparent 0 14%, rgba(255,255,255,0.10) 14% 16%, transparent 16% 46%, rgba(255,255,255,0.10) 46% 48%, transparent 48% 100%);
      mask: radial-gradient(circle, transparent 68%, #000 70%); opacity:.52; filter: drop-shadow(0 16px 36px rgba(0,0,0,0.26));
    }
    #observatory .crest::before {
      inset:-6px; opacity:.35; filter: blur(1px);
      background: conic-gradient(from .1turn, var(--a1), var(--a2), var(--a3), var(--a4), var(--a1));
      mask: radial-gradient(circle, transparent 74%, #000 77%, transparent 84%); animation: spin 28s linear infinite reverse;
    }
    @keyframes spin { to { transform: rotate(1turn) } }

    /* Hints */
    #observatory .hints { position:relative; z-index:3; display:flex; gap:10px; flex-wrap:wrap; justify-content:center; align-items:center; }
    #observatory .pill {
      font-size: 12px; color: var(--muted); display:inline-flex; align-items:center; gap:8px;
      border: 1px solid var(--ring); border-radius:999px; padding:6px 10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.05));
      box-shadow: 0 8px 20px rgba(0,0,0,0.22);
    }
    #observatory kbd {
      font: 700 11px/1 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      color:#0e1222; background: linear-gradient(90deg, var(--a1), var(--a3));
      padding:6px 8px; border-radius:8px; border:1px solid rgba(0,0,0,0.18);
      box-shadow: 0 2px 10px rgba(0,0,0,0.28); letter-spacing:.15px;
    }

    /* Footer */
    #observatory .foot { position:relative; z-index:3; margin-top:22px; display:flex; flex-direction:column; gap:10px; align-items:center; color:var(--muted); }
    #observatory .rule { height:1px; width:100%; border-radius:1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.7), transparent); opacity:.14; }
    #observatory .meta {
      display:inline-flex; gap:10px; align-items:center; font-size:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.05));
      border: 1px solid var(--ring); padding: 6px 10px; border-radius: 999px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.22);
    }
    #observatory .tag {
      padding: 4px 8px; border-radius: 999px; font-size: 11px; color: #0e1222;
      background: linear-gradient(90deg, var(--a1), var(--a3));
      box-shadow: 0 2px 12px rgba(0,0,0,0.28); font-weight: 800; letter-spacing: .3px;
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      #observatory, #observatory * { animation: none !important; transition: none !important; }
      #observatory .nebula, #observatory .crest { display:none !important; }
    }
  </style>

  <div class="nebula" aria-hidden="true"></div>
  <div class="noise" aria-hidden="true"></div>

  <div class="top">
    <div class="brand">
      <span class="orb" aria-hidden="true"></span>
      <span>Orbital Garden • Iteration 692</span>
    </div>
    <div class="actions" role="group" aria-label="Theme and actions">
      <button class="dot" data-theme="dawn" title="Dawn theme"></button>
      <button class="dot active" data-theme="dusk" title="Dusk theme"></button>
      <button class="dot" data-theme="noir" title="Noir theme"></button>
      <button class="dot" data-theme="glow" title="Glow theme"></button>
      <button class="chip primary" id="pause">Pause</button>
      <button class="chip" id="save">Capture</button>
    </div>
  </div>

  <div class="hero">
    <div class="kicker">Kinetic orrery</div>
    <h1 class="title">Orbital Garden</h1>
    <p class="sub">Tilt the cosmos with your pointer. Click to launch a comet. Wheel to zoom. Time braids paths into light.</p>
  </div>

  <div class="arena">
    <div class="viewport" id="view" aria-label="Interactive orrery">
      <canvas id="sky" aria-hidden="true"></canvas>
      <canvas id="orrery" aria-hidden="true"></canvas>
      <div class="crest" aria-hidden="true"></div>
    </div>
  </div>

  <div class="hints" aria-label="Shortcuts">
    <span class="pill"><kbd>Click</kbd> comet</span>
    <span class="pill"><kbd>Space</kbd> pause</span>
    <span class="pill"><kbd>T</kbd> theme</span>
    <span class="pill"><kbd>+</kbd>/<kbd>-</kbd> speed</span>
    <span class="pill"><kbd>S</kbd> save</span>
    <span class="pill">wheel zoom</span>
  </div>

  <div class="foot">
    <div class="rule" aria-hidden="true"></div>
    <small class="meta">
      <span class="tag">Refreshed</span>
      <span id="last-updated">Last updated: 2025-11-17 03:26:54 EST</span>
    </small>
  </div>

  <script>
    (function () {
      const root = document.getElementById('observatory');
      const view = document.getElementById('view');
      const sky = document.getElementById('sky');
      const orb = document.getElementById('orrery');
      const gSky = sky.getContext('2d', { alpha: true });
      const g = orb.getContext('2d', { alpha: true });

      const dots = [...root.querySelectorAll('.dot')];
      const pauseBtn = document.getElementById('pause');
      const saveBtn = document.getElementById('save');
      const updated = document.getElementById('last-updated');

      // Last updated
      try {
        const fmt = new Intl.DateTimeFormat([], { dateStyle: 'medium', timeStyle: 'medium' });
        updated.textContent = fmt.format(new Date());
      } catch {
        updated.textContent = new Date().toLocaleString();
      }

      // Read palette from CSS
      function readPalette() {
        const cs = getComputedStyle(root);
        return {
          a1: cs.getPropertyValue('--a1').trim(),
          a2: cs.getPropertyValue('--a2').trim(),
          a3: cs.getPropertyValue('--a3').trim(),
          a4: cs.getPropertyValue('--a4').trim(),
          star: cs.getPropertyValue('--star').trim(),
          orbit: cs.getPropertyValue('--orbit').trim()
        };
      }
      let palette = readPalette();

      // Size & DPR
      let W=0, H=0, DPR=Math.min(2, window.devicePixelRatio||1), R=0;
      function fit() {
        const r = view.getBoundingClientRect();
        W = Math.max(400, Math.floor(r.width));
        H = Math.max(300, Math.floor(r.height));
        R = Math.min(W, H) * 0.48;
        [sky, orb].forEach(c => {
          c.width = Math.floor(W * DPR);
          c.height = Math.floor(H * DPR);
          c.style.width = W + 'px';
          c.style.height = H + 'px';
        });
        gSky.setTransform(DPR,0,0,DPR,0,0);
        g.setTransform(DPR,0,0,DPR,0,0);
        paintSky();
      }
      new ResizeObserver(fit).observe(view);
      fit();

      // Sky (draw once per resize/theme)
      function paintSky() {
        gSky.clearRect(0,0,W,H);
        const n = Math.floor((W*H)/2400);
        gSky.save();
        gSky.globalCompositeOperation = 'source-over';
        // Vignette
        const vg = gSky.createRadialGradient(W*0.5, H*0.5, Math.min(W,H)*0.2, W*0.5, H*0.5, Math.max(W,H)*0.8);
        vg.addColorStop(0, 'rgba(0,0,0,0.08)');
        vg.addColorStop(1, 'rgba(0,0,0,0.32)');
        gSky.fillStyle = vg; gSky.fillRect(0,0,W,H);

        // Stars
        for (let i=0;i<n;i++) {
          const x = Math.random()*W, y = Math.random()*H;
          const r = Math.random()*1.2 + 0.2;
          const twinkle = 0.75 + Math.random()*0.25;
          const col = Math.random()<0.18 ? [palette.a1,palette.a3,palette.a4][Math.floor(Math.random()*3)] : palette.star;
          gSky.beginPath();
          gSky.fillStyle = col;
          gSky.globalAlpha = 0.45*twinkle;
          gSky.arc(x,y,r,0,Math.PI*2);
          gSky.fill();
        }
        gSky.restore();
      }

      // System model
      const TAU = Math.PI*2;
      const bodies = [];
      let time = 0, speed = 1.0, paused = false, zoom = 1.0, yaw = 0;

      function resetSystem() {
        bodies.length = 0;
        const cols = [palette.a1, palette.a2, palette.a3, palette.a4];
        const orbits = [0.18, 0.28, 0.38, 0.50, 0.65, 0.82];
        const sizes  = [0.035,0.042,0.050,0.035,0.028,0.055];
        const spins  = [0.9, 0.55, 0.42, 0.30, 0.24, 0.18]; // radians per sec (relative)
        for (let i=0;i<orbits.length;i++) {
          bodies.push({
            color: cols[i%cols.length],
            orbit: orbits[i],
            radius: sizes[i],
            angle: Math.random()*TAU,
            spin: spins[i] * (i%2 ? 1 : -1),
            wobble: (Math.random()*0.04 + 0.02) * (Math.random()<0.5?-1:1)
          });
        }
      }
      resetSystem();

      // Comets
      const comets = [];
      function spawnComet(px, py) {
        const cx = W*0.5, cy = H*0.5;
        const dx = px - cx, dy = py - cy;
        const mag = Math.hypot(dx, dy) || 1;
        const vx = (dy/mag) * (0.9 + Math.random()*0.6) * (Math.random()<0.5?-1:1);
        const vy = (-dx/mag) * (0.9 + Math.random()*0.6) * (Math.random()<0.5?-1:1);
        comets.push({
          x:px, y:py, vx, vy,
          life: 1.0,
          hue: [palette.a1, palette.a2, palette.a3, palette.a4][Math.floor(Math.random()*4)],
          trail: []
        });
      }

      // Interaction
      const aim = { x:0.5, y:0.5 };
      const fine = matchMedia('(pointer:fine)').matches;
      if (fine) {
        let ticking=false;
        view.addEventListener('pointermove', (e)=>{
          const r = view.getBoundingClientRect();
          aim.x = (e.clientX - r.left) / r.width;
          aim.y = (e.clientY - r.top) / r.height;
          yaw = (aim.x - 0.5) * 0.8;
          if (!ticking) {
            requestAnimationFrame(()=>{
              root.style.setProperty('--ry', ((aim.x - 0.5) * 12).toFixed(2) + 'deg');
              root.style.setProperty('--rx', (-(aim.y - 0.5) * 8).toFixed(2) + 'deg');
              ticking=false;
            });
            ticking=true;
          }
        });
        view.addEventListener('pointerleave', ()=>{
          aim.x=0.5; aim.y=0.5; yaw=0;
          root.style.setProperty('--rx', '0deg');
          root.style.setProperty('--ry', '0deg');
        });
      }

      view.addEventListener('click', (e)=>{
        const r = view.getBoundingClientRect();
        spawnComet(e.clientX - r.left, e.clientY - r.top);
      }, { passive:true });

      view.addEventListener('wheel', (e)=>{
        e.preventDefault();
        const d = Math.sign(e.deltaY);
        zoom = Math.min(1.5, Math.max(0.65, zoom + (d>0?-0.05:0.05)));
      }, { passive:false });

      pauseBtn.addEventListener('click', ()=>{
        paused = !paused;
        pauseBtn.textContent = paused ? 'Resume' : 'Pause';
      });

      saveBtn.addEventListener('click', ()=>{
        try {
          const tmp = document.createElement('canvas');
          tmp.width = Math.floor(W*DPR);
          tmp.height = Math.floor(H*DPR);
          const tg = tmp.getContext('2d');
          tg.drawImage(sky, 0, 0, tmp.width, tmp.height);
          tg.drawImage(orb, 0, 0, tmp.width, tmp.height);
          const link = document.createElement('a');
          link.download = 'orbital-garden-' + Date.now() + '.png';
          link.href = tmp.toDataURL('image/png');
          document.body.appendChild(link); link.click(); link.remove();
        } catch {}
      });

      window.addEventListener('keydown', (e)=>{
        if (e.key === ' ') { e.preventDefault(); paused=!paused; pauseBtn.textContent = paused ? 'Resume' : 'Pause'; }
        if (e.key === 's' || e.key === 'S') { saveBtn.click(); }
        if (e.key === 't' || e.key === 'T') { cycleTheme(); }
        if (e.key === '+') { speed = Math.min(3.0, speed + 0.1); }
        if (e.key === '-') { speed = Math.max(0.2, speed - 0.1); }
      }, { passive:false });

      // Theme switching
      function setTheme(name) {
        root.dataset.theme = name;
        dots.forEach(d=>d.classList.toggle('active', d.dataset.theme === name));
        palette = readPalette();
        paintSky();
        resetSystem();
      }
      dots.forEach(d=>d.addEventListener('click', ()=> setTheme(d.dataset.theme)));
      function cycleTheme() {
        const order = ['dawn','dusk','noir','glow'];
        const i = order.indexOf(root.dataset.theme);
        setTheme(order[(i+1)%order.length]);
      }
      // Auto theme by time
      try {
        const h = new Date().getHours();
        if (h >= 6 && h < 11) setTheme('dawn');
        if (h >= 11 && h < 18) setTheme('dusk');
        if (h >= 18 || h < 6) setTheme('glow');
      } catch {}

      // Render
      const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
      let last = performance.now();
      function drawFrame(ts) {
        const dt = Math.min(0.033, (ts - last) / 1000);
        last = ts;
        if (!paused && !reduce) {
          time += dt * speed;

          // Soft fade
          g.save();
          g.globalCompositeOperation = 'source-over';
          g.fillStyle = 'rgba(0,0,0,0.10)';
          g.fillRect(0,0,W,H);
          g.restore();

          const cx = W*0.5, cy = H*0.5;
          const baseR = R * zoom;

          // Orbits
          g.save();
          g.translate(cx, cy);
          g.rotate(yaw);
          g.globalAlpha = 0.9;
          for (let i=0;i<bodies.length;i++) {
            const o = bodies[i];
            const rad = baseR * o.orbit * (1 + 0.03*Math.sin(time*0.6 + i));
            g.beginPath();
            g.lineWidth = 1;
            g.strokeStyle = palette.orbit;
            g.arc(0,0,rad,0,TAU);
            g.stroke();
          }

          // Bodies
          for (let i=0;i<bodies.length;i++) {
            const b = bodies[i];
            b.angle += b.spin * dt;
            const rad = baseR * b.orbit * (1 + 0.03*Math.sin(time*0.6 + i));
            const x = Math.cos(b.angle) * rad;
            const y = Math.sin(b.angle) * rad * (1.0 - 0.06*Math.sin(time*0.7 + i)); // gentle perspective squish
            const rr = Math.max(1, baseR * b.radius);

            // Glow
            g.save();
            g.globalCompositeOperation = 'lighter';
            g.shadowColor = b.color;
            g.shadowBlur = rr*2.2;
            g.globalAlpha = 0.85;
            g.beginPath();
            g.fillStyle = b.color;
            g.arc(x,y, rr, 0, TAU);
            g.fill();
            g.restore();

            // Highlight cap
            g.save();
            const grad = g.createRadialGradient(x - rr*0.4, y - rr*0.4, rr*0.1, x, y, rr);
            grad.addColorStop(0, 'rgba(255,255,255,0.85)');
            grad.addColorStop(1, b.color);
            g.globalAlpha = 0.75;
            g.beginPath();
            g.fillStyle = grad;
            g.arc(x,y, rr*0.96, 0, TAU);
            g.fill();
            g.restore();
          }
          g.restore();

          // Comets
          updateComets(dt);
        }
        raf = requestAnimationFrame(drawFrame);
      }
      function updateComets(dt) {
        for (let i=comets.length-1; i>=0; i--) {
          const c = comets[i];
          c.life -= dt * 0.08;
          if (c.life <= 0) { comets.splice(i,1); continue; }
          // integrate
          c.x += c.vx * 60 * dt;
          c.y += c.vy * 60 * dt;
          // mild gravity toward center
          const dx = W*0.5 - c.x, dy = H*0.5 - c.y;
          c.vx += (dx * 0.0008) * dt * 60;
          c.vy += (dy * 0.0008) * dt * 60;

          // trail
          c.trail.push({x:c.x, y:c.y, a: c.life});
          if (c.trail.length > 120) c.trail.shift();

          // draw
          g.save();
          g.globalCompositeOperation = 'lighter';
          g.lineCap = 'round';
          g.lineJoin = 'round';
          g.shadowColor = c.color || c.hue;
          g.shadowBlur = 12;
          g.lineWidth = 2;
          for (let t=0; t<c.trail.length-1; t++) {
            const p0 = c.trail[t], p1 = c.trail[t+1];
            const a = t / c.trail.length;
            g.strokeStyle = c.hue;
            g.globalAlpha = 0.12 + 0.6 * (1 - a) * c.life;
            g.beginPath();
            g.moveTo(p0.x, p0.y);
            g.lineTo(p1.x, p1.y);
            g.stroke();
          }
          // nucleus
          g.globalAlpha = 0.9;
          g.fillStyle = c.hue;
          g.beginPath();
          g.arc(c.x, c.y, 2.2, 0, TAU);
          g.fill();
          g.restore();
        }
      }

      let raf = requestAnimationFrame(drawFrame);

      // Keep palette fresh on theme change
      dots.forEach(d=>d.addEventListener('click', ()=> {
        palette = readPalette(); paintSky(); resetSystem();
      }));

      // Cleanup
      window.addEventListener('beforeunload', ()=> cancelAnimationFrame(raf));
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


