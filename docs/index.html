<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<style>
/* LUMEN LOOM — Iteration 1741 (woven light poster) */
.loom-1741{
  --ink: #eaf6ff;
  --muted:#a7c2d9;
  --bg1:#04070d;
  --bg2:#0b1226;
  --h0: 212;
  --glass: rgba(255,255,255,.06);
  --ring: color-mix(in srgb, #ffffff 14%, transparent);
  --mx: 50%;
  --my: 50%;
  position:relative; isolation:isolate; overflow:clip;
  min-height: 1000px;
  border-radius: 42px;
  color: var(--ink);
  font: 600 14px/1.6 ui-sans-serif, -apple-system, system-ui, Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  background:
    radial-gradient(1200px 900px at var(--mx) var(--my), hsl(var(--h0) 90% 60% / .10), transparent 60%),
    conic-gradient(from 210deg at 80% -20%, hsl(calc(var(--h0)+100) 80% 18% / .18), transparent 35% 65%, hsl(calc(var(--h0)+240) 80% 18% / .18)),
    radial-gradient(160% 160% at -30% 0%, rgba(255,255,255,.05), transparent 40%),
    linear-gradient(180deg, var(--bg1), var(--bg2));
  box-shadow: 0 160px 360px -160px rgba(0,0,0,.8), inset 0 1px 0 rgba(255,255,255,.05);
  transition: background .6s ease, color .25s ease, filter .4s ease;
}
.loom-1741[data-theme="noon"]{
  --ink:#0d1230;
  --muted:#556b8d;
  --bg1:#f7fbff;
  --bg2:#e8f0ff;
  --glass: rgba(255,255,255,.7);
  --ring: color-mix(in srgb, #0d1230 12%, transparent);
  box-shadow: 0 120px 260px -140px rgba(9,12,30,.16), inset 0 1px 0 rgba(255,255,255,.9);
}
.loom-1741::before{
  content:"";
  position:absolute; inset:-10% -8% 0 -8%; pointer-events:none;
  background:
    radial-gradient(120% 140% at 100% 0%, rgba(255,255,255,.06), transparent 46%),
    conic-gradient(from 120deg at 10% 10%, rgba(255,255,255,.05), transparent 35% 65%, rgba(255,255,255,.05));
  mix-blend-mode: soft-light;
}
.loom-1741::after{
  content:"";
  position:absolute; inset:0; pointer-events:none;
  background:
    linear-gradient(180deg, transparent, rgba(0,0,0,.14) 80%),
    radial-gradient(140% 120% at 0% 0%, rgba(255,255,255,.06), transparent 40%);
  opacity:.5; mix-blend-mode: overlay;
  filter: saturate(1.02);
}

/* layout */
.frame-1741{
  position:relative; z-index:2;
  display:grid; grid-template-columns: minmax(260px, 520px) 1fr; grid-template-rows: auto 1fr auto;
  gap: clamp(22px, 4.8vw, 56px);
  padding: clamp(26px, 6vw, 84px);
}

/* header */
.header-1741{ grid-column:1/-1; display:flex; align-items:flex-end; justify-content:space-between; gap:20px; flex-wrap:wrap; }
.brand-1741{ display:flex; align-items:flex-end; gap:22px; flex-wrap:wrap; }

.badge-1741{
  width:104px; height:104px; border-radius:28px; position:relative; overflow:hidden; flex:0 0 auto;
  border:1px solid var(--ring); background: var(--glass); backdrop-filter: blur(18px);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.16), 0 14px 48px -18px rgba(0,0,0,.5);
}
.badge-1741 .ring, .badge-1741 .core{ position:absolute; inset:0; }
.badge-1741 .ring{
  background:
    conic-gradient(from var(--spin, 0deg),
      transparent 0 8%,
      hsl(var(--h0) 92% 64% / .95) 8% 12%,
      transparent 12% 38%,
      hsl(calc(var(--h0)+120) 92% 64% / .95) 38% 42%,
      transparent 42% 68%,
      hsl(calc(var(--h0)+240) 92% 64% / .95) 68% 72%,
      transparent 72% 100%);
  -webkit-mask: radial-gradient(closest-side, transparent 0 56%, #000 58% 100%);
          mask: radial-gradient(closest-side, transparent 0 56%, #000 58% 100%);
  animation: spinR 22s linear infinite;
}
.badge-1741 .core{
  width:24px; height:24px; border-radius:50%;
  left:calc(50% - 12px); top:calc(50% - 12px);
  background: radial-gradient(circle at 30% 30%, #fff, hsl(var(--h0) 100% 60%));
  box-shadow: 0 0 24px 8px hsl(var(--h0) 100% 60% / .5), inset 0 0 10px rgba(0,0,0,.22);
}
@keyframes spinR { to { transform: rotate(1turn); } }
.loom-1741[data-motion="off"] .badge-1741 .ring{ animation-play-state: paused; }

.kicker-1741{ font-weight:1000; letter-spacing:.28em; font-size:11px; text-transform:uppercase; opacity:.72; }
.title-1741{
  margin:4px 0 10px; line-height:.85; letter-spacing:-.01em; font-weight:1000;
  font-size: clamp(64px, 10vw, 160px);
  background: linear-gradient(100deg,
    hsl(var(--h0) 90% 64%),
    hsl(calc(var(--h0)+120) 90% 60%),
    hsl(calc(var(--h0)+240) 90% 62%));
  -webkit-background-clip:text; background-clip:text; color:transparent;
  text-shadow: 0 16px 60px color-mix(in srgb, hsl(calc(var(--h0)+160) 90% 60%) 22%, transparent);
}
.tag-1741{ color: var(--muted); font-weight:900; max-width: 68ch; }

/* control card */
.panel-1741{
  grid-column:1/2; display:flex; flex-direction:column; gap:18px;
  padding:18px; border-radius:22px; border:1px solid var(--ring); background: var(--glass); backdrop-filter: blur(12px);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.18), 0 10px 40px -20px rgba(0,0,0,.45);
}
.controls-1741{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.btn-1741{
  appearance:none; border:1px solid var(--ring); background: color-mix(in srgb, var(--glass) 100%, transparent); color: currentColor;
  padding:10px 14px; border-radius: 999px; font-weight:1000; letter-spacing:.2px; cursor:pointer;
  backdrop-filter: blur(12px);
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease, color .18s ease, translate .18s ease;
}
.btn-1741:hover{ transform: translateY(-1px); box-shadow: 0 16px 34px -16px rgba(0,0,0,.45); }
.btn-1741.primary{ background: linear-gradient(90deg, hsl(calc(var(--h0)+90) 92% 60%), hsl(var(--h0) 92% 60%)); color:#0b1224; border-color: transparent; }

.sliders-1741{ display:flex; flex-wrap:wrap; gap:10px; }
.chip-1741{
  display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:999px;
  border:1px solid var(--ring); background: var(--glass); backdrop-filter: blur(10px); color: currentColor;
}
.chip-1741 input[type="range"]{
  appearance:none; width:min(54vw, 360px); height:6px; border-radius:999px; outline:none; cursor:pointer;
  background: linear-gradient(90deg, hsl(calc(var(--h0)+210) 90% 60%), hsl(calc(var(--h0)+90) 90% 60%));
}
.chip-1741 input[type="range"]::-webkit-slider-thumb{
  appearance:none; width:18px; height:18px; border-radius:50%;
  background: linear-gradient(90deg, hsl(calc(var(--h0)+100) 90% 60%), hsl(var(--h0) 90% 60%));
  border:2px solid #fff6; box-shadow: 0 2px 10px -2px rgba(0,0,0,.4);
}
.chip-1741 input[type="range"]::-moz-range-thumb{
  width:18px; height:18px; border:none; border-radius:50%;
  background: linear-gradient(90deg, hsl(calc(var(--h0)+100) 90% 60%), hsl(var(--h0) 90% 60%));
}
.meta-1741{ display:flex; align-items:center; justify-content: space-between; gap:8px; flex-wrap:wrap; color: var(--muted); }

/* stage */
.stage-1741{ grid-column:2/3; display:grid; align-items:stretch; justify-items:stretch; min-height: min(72vh, 820px); }
.scene-1741{
  position:relative; border-radius: 32px; overflow:hidden;
  border:1px solid var(--ring); background: linear-gradient(180deg, color-mix(in srgb, var(--bg2) 100%, transparent), color-mix(in srgb, var(--bg2) 86%, transparent));
  box-shadow: inset 0 1px 0 rgba(255,255,255,.24), 0 40px 160px -60px rgba(0,0,0,.32);
  transform-style: preserve-3d; transition: transform .25s ease;
}
.canvas-1741{ position:absolute; inset:0; width:100%; height:100%; display:block; }
.hud-1741{
  position:absolute; inset:auto 0 0 0; padding:16px 18px; display:flex; justify-content:space-between; align-items:flex-end; gap:12px; flex-wrap:wrap;
  background: linear-gradient(180deg, rgba(0,0,0,0), color-mix(in srgb, #000 18%, transparent));
  color: color-mix(in srgb, var(--ink) 90%, transparent); pointer-events:none;
}
.hud-1741 .caption{ font-weight:900; opacity:.85; }
.hud-1741 .hint{ font-weight:900; opacity:.7; }

/* dock */
.dock-1741{
  grid-column:1/-1;
  position:sticky; bottom:16px; z-index:3; display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
  padding:8px; border-radius:16px; border:1px solid var(--ring); background: var(--glass); backdrop-filter: blur(10px);
}
.pill-1741{ display:inline-flex; align-items:center; gap:10px; padding:8px 12px; border-radius:999px; border:1px solid var(--ring); background: color-mix(in srgb, var(--glass) 100%, transparent); color: currentColor; font-weight:900; }
.icon-1741{ width:18px; height:18px; }

.sr{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
</style>

<div class="loom-1741" data-theme="dusk" data-motion="on" aria-label="Lumen Loom — woven light poster">
  <div class="frame-1741">
    <div class="header-1741">
      <div class="brand-1741">
        <div class="badge-1741" aria-hidden="true">
          <div class="ring"></div>
          <div class="core"></div>
        </div>
        <div>
          <div class="kicker-1741">Iteration 1741</div>
          <h1 class="title-1741">Lumen&nbsp;Loom</h1>
          <p class="tag-1741">Threads of color weave and breathe. Drag to tilt the loom. Click to pluck a chord.</p>
        </div>
      </div>
      <div class="controls-1741">
        <button class="btn-1741 t-theme" aria-pressed="true" aria-label="Toggle theme">Theme</button>
        <button class="btn-1741 t-motion" aria-pressed="false" aria-label="Toggle motion">Motion</button>
        <button class="btn-1741 primary t-palette" aria-label="Shift palette">Palette</button>
      </div>
    </div>

    <div class="panel-1741" aria-label="Weave control panel">
      <div class="sliders-1741">
        <div class="chip-1741" title="Density">
          <span>Density</span>
          <input class="s-density" type="range" min="24" max="160" step="2" value="80" aria-label="Thread density">
        </div>
        <div class="chip-1741" title="Width">
          <span>Width</span>
          <input class="s-width" type="range" min="0.5" max="4.0" step="0.1" value="1.8" aria-label="Thread width">
        </div>
        <div class="chip-1741" title="Tempo">
          <span>Tempo</span>
          <input class="s-tempo" type="range" min="0.3" max="2.2" step="0.05" value="1.0" aria-label="Flow tempo">
        </div>
        <div class="chip-1741" title="Persistence">
          <span>Trails</span>
          <input class="s-trail" type="range" min="0.75" max="0.995" step="0.003" value="0.92" aria-label="Trail persistence">
        </div>
      </div>
      <div class="meta-1741">
        <span class="palette-name" aria-live="polite">Palette: Meridian</span>
        <span class="sr">Status:</span>
        <span>Weave • pluck • drift</span>
      </div>
    </div>

    <section class="stage-1741" aria-label="Woven light viewport">
      <div class="scene-1741">
        <canvas class="canvas-1741" role="img" aria-label="Woven ribbons of light forming a living tapestry"></canvas>
        <div class="hud-1741" aria-hidden="true">
          <span class="caption">Drag to tilt • Click to pluck • Scroll to speed</span>
          <span class="hint">Kinetic poster • woven ribbons</span>
        </div>
      </div>
    </section>

    <div class="dock-1741" aria-label="Footer">
      <div class="pill-1741">
        <svg class="icon-1741" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 3v18M3 12h18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
        <span id="last-updated">Last updated: 2026-01-04 15:20:52 EST</span>
      </div>
      <div class="pill-1741" aria-hidden="true">Loom engine • woven threads</div>
    </div>
  </div>
</div>

<script>
(function(){
  const root = document.currentScript.previousElementSibling?.classList?.contains('loom-1741')
    ? document.currentScript.previousElementSibling
    : document.querySelector('.loom-1741');

  const canvas = root.querySelector('.canvas-1741');
  const ctx = canvas.getContext('2d', { alpha: true });
  const view = root.querySelector('.scene-1741');

  // Last updated
  const last = root.querySelector('#last-updated');
  try {
    const now = new Date();
    last.textContent = 'Last updated: ' + now.toLocaleString(undefined, {
      year:'numeric', month:'2-digit', day:'2-digit',
      hour:'2-digit', minute:'2-digit', second:'2-digit',
      hour12:false, timeZoneName:'short'
    });
  } catch(e){ last.textContent = 'Last updated: just now'; }

  // Controls
  const themeBtn = root.querySelector('.t-theme');
  const motionBtn = root.querySelector('.t-motion');
  const paletteBtn = root.querySelector('.t-palette');
  const densityIn = root.querySelector('.s-density');
  const widthIn = root.querySelector('.s-width');
  const tempoIn = root.querySelector('.s-tempo');
  const trailIn = root.querySelector('.s-trail');
  const paletteNameEl = root.querySelector('.palette-name');

  const KEY_THEME = 'v1741-theme';
  const KEY_MOTION = 'v1741-motion';
  const KEY_PALETTE = 'v1741-palette';

  // Palettes
  const palettes = [
    { name:'Meridian',     h: 212, bg1:'#04070d', bg2:'#0b1226', day1:'#f7fbff', day2:'#eaf2ff' },
    { name:'Citrine Dawn', h: 38,  bg1:'#140c04', bg2:'#231507', day1:'#fff7ea', day2:'#ffeeda' },
    { name:'Verdant Vale', h: 148, bg1:'#04120b', bg2:'#0a2518', day1:'#f3fff8', day2:'#e8fff2' },
    { name:'Amethyst Air', h: 266, bg1:'#0a0a16', bg2:'#101737', day1:'#f7f4ff', day2:'#edf1ff' },
    { name:'Glacier Veil', h: 194, bg1:'#041017', bg2:'#0b2035', day1:'#f2fbff', day2:'#e6f3ff' }
  ];
  let paletteIndex = +localStorage.getItem(KEY_PALETTE) || 0;

  function applyPalette(p, mode){
    root.style.setProperty('--h0', p.h);
    if ((mode||root.getAttribute('data-theme')) === 'noon'){
      root.style.setProperty('--bg1', p.day1);
      root.style.setProperty('--bg2', p.day2);
    } else {
      root.style.setProperty('--bg1', p.bg1);
      root.style.setProperty('--bg2', p.bg2);
    }
    paletteNameEl.textContent = 'Palette: ' + p.name;
    root.style.filter = 'saturate(1.2) brightness(1.06)';
    setTimeout(()=> root.style.filter='', 420);
  }

  // Theme
  const savedTheme = localStorage.getItem(KEY_THEME);
  if (savedTheme) root.setAttribute('data-theme', savedTheme);
  themeBtn.setAttribute('aria-pressed', String(root.getAttribute('data-theme') !== 'noon'));
  applyPalette(palettes[paletteIndex], root.getAttribute('data-theme'));
  themeBtn.addEventListener('click', ()=>{
    const next = root.getAttribute('data-theme') === 'noon' ? 'dusk' : 'noon';
    root.setAttribute('data-theme', next);
    localStorage.setItem(KEY_THEME, next);
    themeBtn.setAttribute('aria-pressed', String(next !== 'noon'));
    applyPalette(palettes[paletteIndex], next);
  });

  // Motion
  const mediaReduce = matchMedia('(prefers-reduced-motion: reduce)');
  function setMotion(on){
    root.setAttribute('data-motion', on ? 'on' : 'off');
    motionBtn.setAttribute('aria-pressed', String(!on));
    if(on && !running){ running = true; lastTick = performance.now(); requestAnimationFrame(loop); }
  }
  const savedMotion = localStorage.getItem(KEY_MOTION);
  if (savedMotion) setMotion(savedMotion === 'on');
  else if (mediaReduce.matches) setMotion(false);
  else setMotion(true);

  motionBtn.addEventListener('click', ()=>{
    const on = root.getAttribute('data-motion') === 'off';
    setMotion(on);
    localStorage.setItem(KEY_MOTION, on ? 'on' : 'off');
  });
  mediaReduce.addEventListener && mediaReduce.addEventListener('change', e => setMotion(!e.matches));

  // Palette cycling
  function cyclePalette(){
    paletteIndex = (paletteIndex + 1) % palettes.length;
    localStorage.setItem(KEY_PALETTE, paletteIndex);
    applyPalette(palettes[paletteIndex]);
  }
  paletteBtn.addEventListener('click', cyclePalette);

  // Params
  const params = {
    density: +densityIn.value || 80,
    width: +widthIn.value || 1.8,
    tempo: +tempoIn.value || 1.0,
    trail: +trailIn.value || 0.92,
    amp: 1.0
  };
  densityIn.addEventListener('input', ()=> params.density = Math.max(12, Math.min(200, Math.floor(+densityIn.value||80))));
  widthIn.addEventListener('input', ()=> params.width = +widthIn.value || 1.8);
  tempoIn.addEventListener('input', ()=> params.tempo = +tempoIn.value || 1.0);
  trailIn.addEventListener('input', ()=> params.trail = +trailIn.value || 0.92);

  // Pointer + tilt + wheel
  const pointer = { x:0, y:0, down:false, lastX:0, lastY:0, vx:0, vy:0 };
  function updateTilt(e){
    const rect = view.getBoundingClientRect();
    const x = ('touches' in e) ? e.touches[0].clientX : e.clientX;
    const y = ('touches' in e) ? e.touches[0].clientY : e.clientY;
    pointer.lastX = pointer.x; pointer.lastY = pointer.y;
    pointer.x = x - rect.left; pointer.y = y - rect.top;
    pointer.vx = pointer.x - pointer.lastX;
    pointer.vy = pointer.y - pointer.lastY;
    const nx = (pointer.x / rect.width) * 2 - 1;
    const ny = (pointer.y / rect.height) * 2 - 1;
    root.style.setProperty('--mx', (pointer.x / rect.width * 100).toFixed(2) + '%');
    root.style.setProperty('--my', (pointer.y / rect.height * 100).toFixed(2) + '%');
    view.style.transform = `perspective(1000px) rotateX(${(-ny*5.5).toFixed(2)}deg) rotateY(${(nx*5.5).toFixed(2)}deg)`;
  }
  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
  view.addEventListener('pointermove', updateTilt, { passive:true });
  view.addEventListener('touchstart', updateTilt, { passive:true });
  view.addEventListener('pointerdown', (e)=>{ pointer.down = true; updateTilt(e); pluck(pointer.x, pointer.y); }, { passive:true });
  window.addEventListener('pointerup', ()=> pointer.down = false, { passive:true });
  view.addEventListener('wheel', (e)=>{ params.tempo = clamp(params.tempo + (e.deltaY>0?-0.08:0.08), 0.3, 2.2); tempoIn.value = params.tempo.toFixed(2); e.preventDefault(); }, { passive:false });

  // Canvas sizing
  const DPR = () => Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  let dpr=1, cw=0, ch=0;
  const ro = new ResizeObserver(()=> resize());
  ro.observe(view);

  function resize(){
    const rect = view.getBoundingClientRect();
    dpr = DPR();
    cw = Math.max(1, Math.floor(rect.width * dpr));
    ch = Math.max(1, Math.floor(rect.height * dpr));
    canvas.width = cw; canvas.height = ch;
    canvas.style.width = rect.width + 'px';
    canvas.style.height = rect.height + 'px';
    ctx.setTransform(1,0,0,1,0,0);
    ctx.scale(dpr, dpr);
    clearHard();
  }

  function clearHard(){
    const rect = view.getBoundingClientRect();
    const g = ctx.createLinearGradient(0,0,rect.width, rect.height);
    const A = getComputedStyle(root).getPropertyValue('--bg1').trim();
    const B = getComputedStyle(root).getPropertyValue('--bg2').trim();
    g.addColorStop(0, A);
    g.addColorStop(1, B);
    ctx.globalCompositeOperation = 'source-over';
    ctx.globalAlpha = 1;
    ctx.fillStyle = g;
    ctx.fillRect(0,0,rect.width,rect.height);
  }

  // Utilities
  function hash(x){ return Math.sin(x*127.1)*43758.5453 % 1; }
  function noise2(x, y){
    // cheap smooth noise
    const xi = Math.floor(x), yi = Math.floor(y);
    const xf = x - xi, yf = y - yi;
    function rnd(ix, iy){ return (Math.sin(ix*12.9898 + iy*78.233) * 43758.5453) % 1; }
    const a = rnd(xi, yi), b = rnd(xi+1, yi), c = rnd(xi, yi+1), d = rnd(xi+1, yi+1);
    const u = xf*xf*(3-2*xf), v = yf*yf*(3-2*yf);
    return a*(1-u)*(1-v) + b*u*(1-v) + c*(1-u)*v + d*u*v;
  }
  function fbm(x, y){
    let v=0, a=0.5, f=1;
    for(let i=0;i<4;i++){
      v += a*noise2(x*f, y*f);
      a*=0.5; f*=2.03;
    }
    return v;
  }

  // Plucks (pulse fields)
  const plucks = [];
  function pluck(x, y){
    plucks.push({ x, y, r: 0, life: 1, hue: parseFloat(getComputedStyle(root).getPropertyValue('--h0'))||212 });
    if (plucks.length>10) plucks.shift();
  }

  // Animation state
  let lastTick = performance.now();
  let running = root.getAttribute('data-motion') !== 'off';
  let T = 0;

  // Sync badge halo
  function tickHalo(){
    const ring = root.querySelector('.badge-1741 .ring');
    if (!ring) return;
    const spin = (performance.now()*0.00022)%1;
    ring.style.setProperty('--spin', (spin*360)+'deg');
    requestAnimationFrame(tickHalo);
  }
  requestAnimationFrame(tickHalo);

  // Draw
  function loop(now){
    if (root.getAttribute('data-motion') === 'off'){ running = false; return; }
    const dt = Math.min(32, now - lastTick) / 1000;
    lastTick = now;
    T += dt * params.tempo;

    const rect = view.getBoundingClientRect();

    // trail fade
    ctx.globalCompositeOperation = 'source-over';
    ctx.globalAlpha = 1 - (1 - params.trail);
    ctx.fillStyle = getComputedStyle(root).getPropertyValue('--bg2').trim();
    ctx.fillRect(0,0,rect.width,rect.height);
    ctx.globalAlpha = 1;

    // subtle vignette glow near pointer
    const baseHue = parseFloat(getComputedStyle(root).getPropertyValue('--h0')) || 212;
    const vg = ctx.createRadialGradient(pointer.x, pointer.y, 0, pointer.x, pointer.y, 160);
    vg.addColorStop(0, `hsla(${(baseHue+140)%360},100%,70%,0.10)`);
    vg.addColorStop(1, 'rgba(255,255,255,0)');
    ctx.globalCompositeOperation = 'lighter';
    ctx.fillStyle = vg;
    ctx.beginPath(); ctx.arc(pointer.x, pointer.y, 160, 0, Math.PI*2); ctx.fill();

    // pluck rings
    for(let i=plucks.length-1;i>=0;i--){
      const p = plucks[i];
      p.r += dt * 600;
      p.life -= dt*0.6;
      if (p.life<=0){ plucks.splice(i,1); continue; }
      const g = ctx.createRadialGradient(p.x, p.y, Math.max(0,p.r-30), p.x, p.y, p.r+30);
      g.addColorStop(0, `hsla(${(p.hue+80)%360}, 100%, 65%, ${0.14*p.life})`);
      g.addColorStop(0.7, `hsla(${(p.hue+160)%360}, 100%, 60%, ${0.08*p.life})`);
      g.addColorStop(1, `hsla(${(p.hue+160)%360}, 100%, 60%, 0)`);
      ctx.globalCompositeOperation = 'lighter';
      ctx.fillStyle = g;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r+30,0,Math.PI*2); ctx.fill();
    }

    // woven threads
    const N = params.density|0;
    const L = 80; // segments per thread
    const cx = rect.width * 0.5, cy = rect.height * 0.5;
    const scale = Math.min(rect.width, rect.height) * 0.42;
    ctx.globalCompositeOperation = 'lighter';

    for(let i=0;i<N;i++){
      const tOff = i / N;
      const hue = (baseHue + (i/N)*180 + 30*Math.sin(T*0.7 + i*0.13))%360;
      ctx.lineWidth = Math.max(0.5, params.width * (1.0 + 0.4*Math.sin(i*0.21 + T)));
      ctx.strokeStyle = `hsla(${hue}, 100%, ${60 + 12*Math.sin(T + i*0.3)}%, ${0.15 + 0.08*Math.sin(i*0.5)} )`;
      ctx.beginPath();

      for(let s=0;s<=L;s++){
        const u = s/L;
        // parametric weave curve influenced by fbm field, pointer, and plucks
        const ang = 2*Math.PI * (u + tOff*0.2 + 0.03*Math.sin(T*0.9 + i));
        const r = 0.6 + 0.35*Math.sin(ang*3 + T*0.8 + i*0.5);
        const nx = Math.cos(ang)*r;
        const ny = Math.sin(ang)*r;

        // flow field warp
        const f = fbm((nx+1.2)*1.8 + T*0.3, (ny+1.2)*1.8 - T*0.25) - 0.5;
        const wx = nx + f*0.35 + 0.15*Math.sin(T*1.1 + i*0.3 + u*6.0);
        const wy = ny + f*0.35 + 0.15*Math.cos(T*1.0 + i*0.4 + u*6.0);

        // pointer pull
        const dx = (pointer.x - cx)/scale;
        const dy = (pointer.y - cy)/scale;
        const pull = Math.exp(-((wx-dx)**2 + (wy-dy)**2) * 0.8) * (pointer.down?0.26:0.12);
        const px = wx + (dx - wx) * pull;
        const py = wy + (dy - wy) * pull;

        // pluck push
        let ox=0, oy=0;
        for(let k=0;k<plucks.length;k++){
          const p = plucks[k];
          const gx = cx + px*scale, gy = cy + py*scale;
          const pd = Math.hypot(gx - p.x, gy - p.y);
          const ring = Math.max(1, Math.abs(pd - p.r));
          const push = Math.exp(-Math.pow(ring/100,2)) * 0.8;
          const ux = (gx - p.x) / (pd || 1);
          const uy = (gy - p.y) / (pd || 1);
          ox += ux * push / scale;
          oy += uy * push / scale;
        }

        const X = cx + (px + ox) * scale;
        const Y = cy + (py + oy) * scale;

        if (s===0) ctx.moveTo(X, Y); else ctx.lineTo(X, Y);
      }
      ctx.stroke();

      // occasional sparkle
      if ((i & 7) === 0){
        const spx = cx + Math.cos(T + i)*scale*0.2;
        const spy = cy + Math.sin(T*1.1 + i*0.6)*scale*0.2;
        ctx.fillStyle = `hsla(${(hue+80)%360}, 100%, 65%, 0.14)`;
        ctx.beginPath(); ctx.arc(spx, spy, 2.0, 0, Math.PI*2); ctx.fill();
      }
    }

    requestAnimationFrame(loop);
  }

  // Init
  function init(){
    resize();
    lastTick = performance.now();
    if (running) requestAnimationFrame(loop);
  }
  init();

  // Re-seed on resize
  let rezTO;
  window.addEventListener('resize', ()=>{
    clearTimeout(rezTO);
    rezTO = setTimeout(()=>{ resize(); }, 80);
  });
})();
</script>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


