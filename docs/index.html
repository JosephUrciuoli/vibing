<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="vibe1592" data-theme="pearl" aria-live="polite">
  <style>
    /* SILK ENGINE — v1592 (aggressive shift: luminous ribbons, day-forward aesthetics) */
    #vibe1592{
      --ink:#0d1220;
      --muted:#4b5a72;
      --edge:rgba(13,18,32,.16);

      --bg1:#f7fbff;
      --bg2:#eef6ff;
      --bgCanvas:#f7fbff;

      --c1:#5b8eff;
      --c2:#9aa7ff;
      --c3:#2fd3cf;
      --c4:#86efac;
      --c5:#ffd86a;
      --c6:#ff9eb3;

      --radius:28px;

      position:relative;
      padding:clamp(22px,4.8vw,56px);
      border-radius:var(--radius);
      color:var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro", "Segoe UI", Inter, Roboto, Helvetica, Arial;
      background:
        radial-gradient(180% 120% at 0% 0%, var(--bg2), transparent 60%),
        radial-gradient(160% 120% at 100% 100%, var(--bg2), transparent 58%),
        linear-gradient(180deg, var(--bg1), var(--bg2) 60%, #e8f2ff);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.65),
        0 40px 120px rgba(10,30,100,.12),
        0 12px 40px rgba(10,30,100,.10);
      overflow:hidden;
      isolation:isolate;
    }
    /* moving mesh light */
    #vibe1592::before{
      content:""; position:absolute; inset:-20%; z-index:0; pointer-events:none;
      background:
        conic-gradient(from 0deg at 70% 20%, rgba(91,142,255,.18), transparent 36%, rgba(255,216,106,.18), transparent 72%),
        radial-gradient(85% 60% at 30% 70%, rgba(47,211,207,.14), transparent 60%);
      filter: blur(28px) saturate(120%);
      opacity:.9; mix-blend-mode: screen;
      animation:v1592_mesh 38s ease-in-out infinite alternate;
    }
    @keyframes v1592_mesh{
      from{ transform: translate3d(-2%,2%,0) rotate(.4deg) scale(1.02); }
      to{ transform: translate3d(2%,-2%,0) rotate(-.5deg) scale(1.00); }
    }
    /* micrograin */
    #vibe1592::after{
      content:""; position:absolute; inset:0; pointer-events:none; z-index:0;
      background:
        radial-gradient(60% 40% at 50% 8%, rgba(0,0,0,.03), transparent 50%),
        repeating-linear-gradient(180deg, rgba(0,0,0,.025) 0 1px, transparent 1px 3px);
      mix-blend-mode:soft-light; opacity:.35;
    }

    /* Top bar */
    #vibe1592 .bar{
      display:grid; grid-template-columns:auto 1fr; align-items:center; gap:14px; z-index:2; position:relative;
    }
    #vibe1592 .brand{
      display:inline-flex; gap:12px; align-items:center; padding:10px 14px;
      border-radius:14px;
      background:linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.55));
      border:1px solid var(--edge);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9), 0 10px 28px rgba(10,30,100,.12);
      font-weight:900; letter-spacing:.14em; font-size:11px; text-transform:uppercase;
      color:var(--ink); user-select:none;
    }
    #vibe1592 .gem{
      width:18px; height:18px; border-radius:10px; position:relative; overflow:hidden;
      background: conic-gradient(from 90deg, var(--c1), var(--c2), var(--c3), var(--c4), var(--c5), var(--c6), var(--c1));
      box-shadow: 0 0 0 6px rgba(255,255,255,.5), 0 6px 18px rgba(10,30,100,.15);
    }
    #vibe1592 .themes{ justify-self:end; display:flex; gap:8px; flex-wrap:wrap; }
    #vibe1592 .chip{
      appearance:none; border:1px solid var(--edge);
      background:linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.5));
      color:var(--ink); padding:8px 12px; border-radius:999px;
      font-weight:900; font-size:11px; letter-spacing:.08em; text-transform:uppercase; cursor:pointer;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9), 0 10px 24px rgba(10,30,100,.10);
      transition: transform .12s ease, box-shadow .2s ease, background .3s ease, color .2s ease;
    }
    #vibe1592 .chip:hover{ transform: translateY(-1px); box-shadow: inset 0 1px 0 rgba(255,255,255,1), 0 16px 36px rgba(10,30,100,.18); }
    #vibe1592 .chip[aria-checked="true"]{
      background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.75));
      border-color: color-mix(in oklab, var(--c1) 40%, var(--edge));
      text-shadow: 0 1px 0 rgba(255,255,255,.65);
    }

    /* Hero */
    #vibe1592 .hero{ margin: clamp(10px,3.5vw,28px) 0 0; position:relative; z-index:2; }
    #vibe1592 .title{
      margin:0; line-height:.86; letter-spacing:-0.02em; font-weight:1000;
      font-size: clamp(50px, 9.5vw, 136px);
      background: linear-gradient(92deg, #111, #355dff 35%, #00cdbb 68%, #ffb800);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter: drop-shadow(0 10px 24px rgba(10,30,100,.12));
      text-wrap:balance;
    }
    #vibe1592 .sub{ margin:.7rem 0 0; color:var(--muted); font-size: clamp(14px,2.2vw,18px); text-wrap:balance; }

    /* Loom (canvas stage) */
    #vibe1592 .loom{
      margin-top: clamp(18px,4vw,38px);
      position:relative; z-index:1; border-radius:30px; overflow:hidden;
      border:1px solid var(--edge);
      background: linear-gradient(180deg, rgba(255,255,255,.7), rgba(255,255,255,.45));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.9),
        0 26px 70px rgba(10,30,100,.16),
        0 0 0 1px rgba(255,255,255,.5);
      min-height:min(92vw, 720px);
      perspective:1000px;
      transform-style:preserve-3d;
    }
    #vibe1592 canvas#weave{ width:100%; height:min(92vw,720px); display:block; }
    #vibe1592 .hud{
      position:absolute; left:12px; right:12px; bottom:12px; z-index:3;
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:center;
      background:linear-gradient(180deg, rgba(255,255,255,.8), rgba(255,255,255,.55));
      backdrop-filter: blur(10px);
      border:1px solid var(--edge); border-radius:14px; padding:10px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,1);
    }
    #vibe1592 .group{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    #vibe1592 .btn{
      appearance:none; border:1px solid var(--edge);
      background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.65));
      color:var(--ink);
      padding:8px 12px; border-radius:10px; font-weight:900; cursor:pointer; font-size:12px;
      box-shadow: 0 10px 24px rgba(10,30,100,.18), inset 0 1px 0 rgba(255,255,255,1);
      transition: transform .12s ease, box-shadow .18s ease, background .22s ease, color .2s ease;
    }
    #vibe1592 .btn:hover{ transform: translateY(-1px); box-shadow: 0 16px 36px rgba(10,30,100,.24), inset 0 1px 0 rgba(255,255,255,1); }

    #vibe1592 .range, #vibe1592 .toggle{
      display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:10px; border:1px solid var(--edge);
      background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.6));
      box-shadow: inset 0 1px 0 rgba(255,255,255,1);
      font-weight:800; font-size:12px; color:var(--muted);
    }
    #vibe1592 input[type="range"]{
      appearance:none; height:6px; width:130px; background:
        linear-gradient(90deg, var(--c1), var(--c3), var(--c5));
      border-radius:999px; outline:none;
    }
    #vibe1592 input[type="range"]::-webkit-slider-thumb{
      appearance:none; width:16px; height:16px; border-radius:50%; background: rgba(255,255,255,1);
      border:1px solid var(--edge); box-shadow:0 2px 6px rgba(10,30,100,.25);
    }
    #vibe1592 .val{ font-variant-numeric: tabular-nums; color:var(--ink); }
    #vibe1592 .toggle input{ accent-color: color-mix(in oklab, var(--c1) 60%, white); width:18px; height:18px; }

    /* Footer */
    #vibe1592 .footer{ margin-top:18px; display:flex; align-items:center; justify-content:space-between; gap:10px; color:var(--muted); font-size:12px; z-index:2; position:relative; }
    #vibe1592 #last-updated{
      font-variant-numeric: tabular-nums; font-weight:900; color:var(--ink);
      background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.65));
      border:1px solid var(--edge);
      padding:6px 10px; border-radius:10px; box-shadow: inset 0 1px 0 rgba(255,255,255,1);
    }

    /* Themes */
    #vibe1592[data-theme="pearl"]{
      --ink:#0d1220; --muted:#4b5a72; --edge:rgba(13,18,32,.16);
      --bg1:#f7fbff; --bg2:#eef6ff; --bgCanvas:#f7fbff;
      --c1:#5b8eff; --c2:#9aa7ff; --c3:#2fd3cf; --c4:#86efac; --c5:#ffd86a; --c6:#ff9eb3;
    }
    #vibe1592[data-theme="noir"]{
      --ink:#eef3ff; --muted:#a7b2c7; --edge:rgba(255,255,255,.18);
      --bg1:#0b0f1a; --bg2:#121a2c; --bgCanvas:#0b0f1a;
      --c1:#67e8f9; --c2:#a78bfa; --c3:#f472b6; --c4:#facc15; --c5:#34d399; --c6:#60a5fa;
    }
    #vibe1592[data-theme="copper"]{
      --ink:#2b140a; --muted:#6b5244; --edge:rgba(43,20,10,.18);
      --bg1:#fff7f2; --bg2:#ffefe1; --bgCanvas:#fff7f2;
      --c1:#ff8a4c; --c2:#ffb86b; --c3:#ffd86a; --c4:#b8e986; --c5:#9aa7ff; --c6:#ff9eb3;
    }
    #vibe1592[data-theme="lagoon"]{
      --ink:#061a18; --muted:#3b6d64; --edge:rgba(6,26,24,.18);
      --bg1:#e9fffb; --bg2:#dbfbf3; --bgCanvas:#e9fffb;
      --c1:#22d3ee; --c2:#67e8f9; --c3:#34d399; --c4:#86efac; --c5:#60a5fa; --c6:#a78bfa;
    }

    /* Responsive */
    @media (max-width:760px){
      #vibe1592 .bar{ grid-template-columns:1fr; }
      #vibe1592 .themes{ justify-content:flex-start; }
      #vibe1592 input[type="range"]{ width:96px; }
      #vibe1592 canvas#weave{ height:60vh; min-height:360px; }
    }

    /* A11y */
    #vibe1592 .chip:focus-visible, #vibe1592 .btn:focus-visible, #vibe1592 input[type="range"]:focus-visible, #vibe1592 .toggle input:focus-visible{
      outline: 2px solid color-mix(in oklab, var(--c1) 70%, black);
      outline-offset: 2px;
    }
    @media (prefers-reduced-motion: reduce){
      #vibe1592, #vibe1592 *{ animation:none !important; transition:none !important; }
    }
  </style>

  <div class="bar">
    <span class="brand"><span class="gem" aria-hidden="true"></span>SILK ENGINE 1592</span>
    <div class="themes" role="radiogroup" aria-label="Theme">
      <button type="button" class="chip theme" data-theme="pearl" aria-checked="true">Pearl</button>
      <button type="button" class="chip theme" data-theme="noir" aria-checked="false">Noir</button>
      <button type="button" class="chip theme" data-theme="copper" aria-checked="false">Copper</button>
      <button type="button" class="chip theme" data-theme="lagoon" aria-checked="false">Lagoon</button>
    </div>
  </div>

  <div class="hero">
    <h1 class="title" role="heading" aria-level="1">Weave Light</h1>
    <p class="sub">Generative silk ribbons that follow a living wind. Touch, tilt, and let color write.</p>
  </div>

  <div class="loom" role="img" aria-label="Generative silk ribbons flowing across a luminous field">
    <canvas id="weave"></canvas>

    <div class="hud glass" role="group" aria-label="Controls">
      <div class="group">
        <button class="btn" id="pause" type="button">Pause</button>
        <button class="btn" id="shuffle" type="button">Shuffle</button>
        <button class="btn" id="snapshot" type="button">Snapshot</button>
      </div>
      <label class="range" for="threads">Threads <span class="val" id="threadsVal">28</span>
        <input id="threads" type="range" min="8" max="64" step="1" value="28" aria-label="Ribbon count">
      </label>
      <label class="range" for="flow">Flow <span class="val" id="flowVal">1.00x</span>
        <input id="flow" type="range" min="0.60" max="2.00" step="0.01" value="1.00" aria-label="Field speed">
      </label>
      <label class="range" for="trail">Trails <span class="val" id="trailVal">0.92</span>
        <input id="trail" type="range" min="0.80" max="0.98" step="0.01" value="0.92" aria-label="Trail persistence">
      </label>
      <label class="toggle" for="glow">
        <input id="glow" type="checkbox" checked aria-label="Glow effect"> Glow
      </label>
      <label class="toggle" for="weaveMode">
        <input id="weaveMode" type="checkbox" checked aria-label="Weave blend"> Weave
      </label>
    </div>
  </div>

  <div class="footer">
    <span class="quote">“Let the wind do the drawing.”</span>
    <span id="last-updated">Last updated: 2025-12-28 22:47:45 EST</span>
  </div>

  <script>
    (function(){
      const root = document.getElementById('vibe1592');
      const canvas = root.querySelector('#weave');
      const ctx = canvas.getContext('2d', { alpha:true });
      const stage = root.querySelector('.loom');

      // Last updated
      try{
        const lu = root.querySelector('#last-updated');
        const now = new Date();
        const opts = { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' };
        lu.textContent = 'Updated ' + now.toLocaleString([], opts);
      }catch(e){}

      // Utilities
      const css = (v)=> getComputedStyle(root).getPropertyValue(v).trim();
      const themes = Array.from(root.querySelectorAll('.theme'));
      function recolor(){
        palette = [css('--c1'), css('--c2'), css('--c3'), css('--c4'), css('--c5'), css('--c6')].filter(Boolean);
      }
      function setTheme(btn){
        themes.forEach(b=>b.setAttribute('aria-checked', String(b===btn)));
        root.setAttribute('data-theme', btn.dataset.theme);
        recolor(); flash(btn);
      }
      themes.forEach(b=>{
        b.addEventListener('click', ()=> setTheme(b));
        b.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); setTheme(b);} });
      });

      // Controls
      const threadsEl = root.querySelector('#threads');
      const flowEl = root.querySelector('#flow');
      const trailEl = root.querySelector('#trail');
      const glowEl = root.querySelector('#glow');
      const blendEl = root.querySelector('#weaveMode');
      const pauseBtn = root.querySelector('#pause');
      const shuffleBtn = root.querySelector('#shuffle');
      const shotBtn = root.querySelector('#snapshot');

      const threadsVal = root.querySelector('#threadsVal');
      const flowVal = root.querySelector('#flowVal');
      const trailVal = root.querySelector('#trailVal');

      function syncLabels(){
        threadsVal.textContent = threadsEl.value;
        flowVal.textContent = parseFloat(flowEl.value).toFixed(2)+'x';
        trailVal.textContent = parseFloat(trailEl.value).toFixed(2);
      }
      threadsEl.addEventListener('input', ()=>{ rebuild(+threadsEl.value); syncLabels(); flash(threadsEl.parentElement); });
      flowEl.addEventListener('input', syncLabels);
      trailEl.addEventListener('input', syncLabels);
      glowEl.addEventListener('change', ()=> flash(glowEl.parentElement));
      blendEl.addEventListener('change', ()=> flash(blendEl.parentElement));
      syncLabels();

      // Pointer parallax + tilt
      const pointer = { x:0.5, y:0.45, active:false };
      function onPoint(e){
        const r = stage.getBoundingClientRect();
        const pt = e.touches ? e.touches[0] : e;
        const nx = Math.max(0, Math.min(1, (pt.clientX - r.left) / r.width));
        const ny = Math.max(0, Math.min(1, (pt.clientY - r.top) / r.height));
        pointer.x = nx; pointer.y = ny; pointer.active = true;
        const tx = (nx - .5) * 6;
        const ty = (ny - .5) * -6;
        stage.style.transform = `rotateX(${ty.toFixed(2)}deg) rotateY(${tx.toFixed(2)}deg)`;
      }
      function offPoint(){ pointer.active = false; stage.style.transform = 'rotateX(0deg) rotateY(0deg)'; }
      stage.addEventListener('pointermove', onPoint, { passive:true });
      stage.addEventListener('pointerleave', offPoint, { passive:true });
      stage.addEventListener('touchmove', onPoint, { passive:true });
      stage.addEventListener('touchend', offPoint, { passive:true });

      // Sizing
      const state = { w: 800, h: 600, dpr: 1, cx: 400, cy: 300 };
      function fit(){
        const rect = stage.getBoundingClientRect();
        const w = Math.max(320, Math.floor(rect.width));
        const h = Math.max(240, Math.floor(Math.min(rect.height, rect.width*0.9)));
        const dpr = Math.min(2, window.devicePixelRatio || 1);
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        canvas.style.width = w+'px';
        canvas.style.height = h+'px';
        ctx.setTransform(dpr,0,0,dpr,0,0);
        state.w = w; state.h = h; state.dpr = dpr; state.cx = w/2; state.cy = h/2;
        fadeHard(); // clear nicely on resize
        rebuild(+threadsEl.value);
      }
      const ro = new ResizeObserver(()=> fit());
      ro.observe(stage);

      // Engine
      let palette = [];
      recolor();

      let ribbons = [];
      let t = 0;
      const RLEN = 80;

      function rand(min,max){ return min + Math.random()*(max-min); }

      function makeRibbon(i){
        const col = palette[i % palette.length] || '#000';
        const ang = Math.random()*Math.PI*2;
        const r = Math.min(state.w,state.h)*0.35*rand(0.2,1.0);
        const start = { x: state.cx + Math.cos(ang)*r, y: state.cy + Math.sin(ang)*r };
        const pts = new Array(RLEN).fill(0).map((_,k)=> ({ x: start.x + Math.cos(ang)*(k*0.6), y: start.y + Math.sin(ang)*(k*0.6) }));
        return {
          color: col,
          width: rand(1.2, 3.6),
          pts,
          seed: Math.random()*1000,
          jitter: rand(0.2, 0.8),
          bias: rand(-Math.PI, Math.PI)
        };
      }

      function rebuild(n){
        ribbons = [];
        for(let i=0;i<n;i++) ribbons.push(makeRibbon(i));
        flash(threadsEl.parentElement);
      }

      function flowAngle(x,y,tt){
        // Soft pseudo-noise via sines; field scale reacts to Flow slider
        const f = parseFloat(flowEl.value);
        const kx = 0.0016 * f;
        const ky = 0.0012 * (1.2/f);
        const a = Math.sin(x*kx + tt*0.0012) + Math.cos(y*ky - tt*0.0008);
        const b = Math.sin((x+y)*(kx*0.6) + tt*0.0006) - Math.cos((x-y)*(ky*0.85) - tt*0.0010);
        return (a + b) * 1.2;
      }

      function fadeStep(){
        const fade = 1 - parseFloat(trailEl.value);
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = hexWithAlpha(css('--bgCanvas') || '#ffffff', fade*2.2);
        ctx.fillRect(0,0,state.w,state.h);
      }
      function fadeHard(){
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = css('--bgCanvas') || '#ffffff';
        ctx.fillRect(0,0,state.w,state.h);
      }

      function draw(){
        fadeStep();

        const glow = glowEl.checked;
        const weaveBlend = blendEl.checked;

        ctx.save();
        ctx.globalCompositeOperation = weaveBlend ? 'lighter' : 'source-over';

        for(let i=0;i<ribbons.length;i++){
          const rb = ribbons[i];
          const head = rb.pts[rb.pts.length-1];
          const ang = flowAngle(head.x, head.y, t) + rb.bias*0.05;
          const towards = pointer.active ? attract(head.x, head.y, state.cx + (pointer.x-0.5)*state.w*0.3, state.cy + (pointer.y-0.5)*state.h*0.3) : {x:0,y:0};
          const speed = 1.2 + Math.sin((t+rb.seed)*0.001)*0.4;
          const nx = head.x + Math.cos(ang)*speed + (Math.random()-0.5)*rb.jitter + towards.x*0.06;
          const ny = head.y + Math.sin(ang)*speed + (Math.random()-0.5)*rb.jitter + towards.y*0.06;

          rb.pts.push({x:nx,y:ny});
          if(rb.pts.length>RLEN) rb.pts.shift();

          // Draw ribbon
          ctx.lineCap='round'; ctx.lineJoin='round';
          if(glow){
            ctx.shadowColor = rb.color;
            ctx.shadowBlur = 20 + i*0.1;
          }else{
            ctx.shadowBlur = 0;
          }
          // soft under-stroke
          ctx.strokeStyle = rb.color;
          ctx.globalAlpha = weaveBlend ? 0.65 : 0.85;
          ctx.lineWidth = rb.width*2.4;
          strokePath(rb.pts);

          // crisp core
          ctx.globalAlpha = 1;
          ctx.lineWidth = rb.width;
          strokePath(rb.pts);
        }
        ctx.restore();
      }

      function strokePath(pts){
        if(pts.length<2) return;
        ctx.beginPath();
        ctx.moveTo(pts[0].x, pts[0].y);
        for(let j=1;j<pts.length;j++){
          const p = pts[j];
          ctx.lineTo(p.x, p.y);
        }
        ctx.stroke();
      }

      function attract(x,y, tx,ty){
        const dx = tx - x, dy = ty - y;
        const d = Math.hypot(dx,dy) || 1;
        const s = Math.min(2.0, 80/d);
        return { x: dx*s*0.02, y: dy*s*0.02 };
      }

      // Loop
      let running = true;
      function loop(){
        if(!running) return;
        draw();
        t += 16;
        requestAnimationFrame(loop);
      }

      // Buttons
      pauseBtn.addEventListener('click', ()=>{
        running = !running;
        pauseBtn.textContent = running ? 'Pause' : 'Play';
        if(running) requestAnimationFrame(loop);
        flash(pauseBtn);
      });

      shuffleBtn.addEventListener('click', ()=>{
        ribbons.forEach((rb,i)=>{ rb.bias = rand(-Math.PI, Math.PI); rb.seed = Math.random()*1000; rb.jitter = rand(0.2,0.8); });
        flash(shuffleBtn);
      });

      // Snapshot
      shotBtn.addEventListener('click', ()=>{
        try{
          const w = state.w, h = state.h;
          const bg = css('--bgCanvas') || '#ffffff';
          const temp = document.createElement('canvas');
          temp.width = Math.floor(w * state.dpr);
          temp.height = Math.floor(h * state.dpr);
          const tctx = temp.getContext('2d');
          tctx.fillStyle = bg; tctx.fillRect(0,0,temp.width,temp.height);
          tctx.drawImage(canvas,0,0,temp.width,temp.height);
          const link = document.createElement('a');
          link.href = temp.toDataURL('image/png');
          link.download = 'silk-engine-'+Date.now()+'.png';
          link.click();
          flash(shotBtn);
        }catch(e){}
      });

      // Keyboard
      root.addEventListener('keydown', (e)=>{
        if(e.key===' '){ e.preventDefault(); pauseBtn.click(); }
        if(e.key==='s'||e.key==='S'){ shotBtn.click(); }
        if(e.key==='r'||e.key==='R'){ shuffleBtn.click(); }
      });

      function flash(el){ try{ el.animate([{ filter:'saturate(150%) brightness(1.08)' }, { filter:'saturate(110%) brightness(1)' }], { duration:380, easing:'cubic-bezier(.2,.8,.2,1)' }); }catch(_){ } }
      function hexWithAlpha(hex, a){
        if(!hex) return `rgba(255,255,255,${a})`;
        if(hex.startsWith('rgb')) return hex.replace(')', `, ${a})`).replace('rgb(', 'rgba(');
        const h = hex.replace('#','').trim();
        const n = parseInt(h.length===3? h.split('').map(ch=>ch+ch).join('') : h, 16);
        const r = (n>>16)&255, g=(n>>8)&255, b=n&255;
        return `rgba(${r},${g},${b},${a})`;
      }

      // Init
      fit();
      const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if(!reduce){ requestAnimationFrame(loop); }

    }());
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


