<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="orrery" data-theme="dawn" aria-label="Orbital Garden — A Luminous Orrery">
  <style>
    .orrery {
      --r: 28px;
      --ink: #10131f;
      --muted: #5b657c;
      --line: rgba(16,19,31,0.14);
      --bg1: #f9fbff;
      --bg2: #fff9f5;
      --a1: #7aa8ff;
      --a2: #ffb86b;
      --a3: #88ffd8;
      position: relative;
      padding: clamp(18px, 3.6vw, 48px);
      border-radius: var(--r);
      border: 1px solid var(--line);
      color: var(--ink);
      background:
        radial-gradient(120% 100% at 10% -10%, rgba(122,168,255,0.18), transparent 55%),
        radial-gradient(120% 100% at 110% 110%, rgba(255,184,107,0.18), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.7),
        0 40px 100px rgba(20,25,40,0.22),
        0 10px 26px rgba(20,25,40,0.14);
      overflow: hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      isolation: isolate;
    }
    .orrery::before {
      content: "";
      position: absolute; inset: -50% -40%;
      background:
        conic-gradient(from 0deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02) 25% 40%, rgba(255,255,255,0.10) 60% 80%, rgba(255,255,255,0.02) 100%),
        radial-gradient(70% 60% at 50% 50%, rgba(255,255,255,0.45), transparent 70%);
      filter: blur(26px);
      mix-blend-mode: overlay;
      animation: drift 140s linear infinite;
      pointer-events: none;
    }
    @keyframes drift { to { transform: rotate(360deg); } }

    /* THEMES */
    .orrery[data-theme="dawn"] {
      --ink:#10131f; --muted:#5b657c; --bg1:#f9fbff; --bg2:#fff9f5; --line:rgba(16,19,31,0.14);
      --a1:#7aa8ff; --a2:#ffb86b; --a3:#88ffd8;
    }
    .orrery[data-theme="dusk"] {
      --ink:#0f1527; --muted:#465477; --bg1:#f7f7ff; --bg2:#eef4ff; --line:rgba(15,21,39,0.14);
      --a1:#b39cff; --a2:#ff79c6; --a3:#9affd1;
    }
    .orrery[data-theme="midnight"] {
      --ink:#eaf2ff; --muted:#a7b6d6; --bg1:#070b16; --bg2:#0a1120; --line:rgba(255,255,255,0.16);
      --a1:#89a2ff; --a2:#ffd37a; --a3:#66ffd4;
      border-color: rgba(255,255,255,0.12);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.12),
        0 40px 100px rgba(0,0,0,0.45),
        0 10px 26px rgba(0,0,0,0.30);
    }

    .topbar {
      display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 8px;
    }
    .sig {
      display: inline-grid; grid-auto-flow: column; align-items: center; gap: 12px;
      letter-spacing: .22em; text-transform: uppercase; font-weight: 800; font-size: 11px; color: var(--muted);
    }
    .mark {
      --s: 30px;
      width: var(--s); height: var(--s);
      border-radius: 10px; position: relative; display: grid; place-items: center; overflow: hidden;
      background: linear-gradient(135deg, rgba(255,255,255,0.85), rgba(255,255,255,0.35));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.8), 0 8px 20px rgba(20,25,40,0.18);
    }
    .mark::before, .mark::after {
      content: ""; position: absolute; border-radius: 50%;
      inset: 6px; border: 2px solid rgba(16,19,31,0.12);
    }
    .chip {
      font-size: 10px; letter-spacing: .18em; text-transform: uppercase;
      padding: 6px 10px; border-radius: 999px; border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.5));
      color: var(--ink);
      box-shadow: 0 12px 24px rgba(20,25,40,0.16);
    }

    .hero {
      margin: 10px 0 14px;
    }
    .hero-title {
      margin: 0;
      font-size: clamp(38px, 8.2vw, 100px);
      line-height: .9; font-weight: 900; letter-spacing: -0.02em;
      background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      filter: drop-shadow(0 10px 24px rgba(20,25,40,0.20));
    }
    .hero-sub {
      margin: 8px 0 0; max-width: 72ch;
      font-size: clamp(14px, 2.2vw, 18px); color: var(--muted);
    }

    .viewport {
      position: relative;
      min-height: clamp(440px, 62vh, 880px);
      border-radius: 24px;
      border: 1px solid var(--line);
      background:
        radial-gradient(140% 100% at 50% -10%, rgba(255,255,255,0.55), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.45), rgba(255,255,255,0.25));
      overflow: hidden;
      transform-style: preserve-3d;
      transition: transform 220ms ease, box-shadow 220ms ease;
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.75),
        0 26px 70px rgba(20,25,40,0.18);
    }
    .viewport:hover { box-shadow: inset 0 0 0 1px rgba(255,255,255,0.9), 0 36px 90px rgba(20,25,40,0.22); }
    canvas.sky { position: absolute; inset: 0; width: 100%; height: 100%; display: block; }

    .halo { position: absolute; inset: -30% -10% auto -10%; height: 50%;
      background: radial-gradient(50% 65% at 20% 30%, var(--a1) 0%, transparent 50%),
                  radial-gradient(60% 70% at 80% 20%, var(--a2) 0%, transparent 55%),
                  radial-gradient(80% 80% at 50% 80%, var(--a3) 0%, transparent 60%);
      opacity: .16; filter: blur(20px); pointer-events: none;
      mix-blend-mode: screen; animation: floaty 22s ease-in-out infinite alternate;
    }
    @keyframes floaty { to { transform: translate3d(0, 10px, 0) scale(1.04); } }

    .controls {
      margin-top: 16px;
      display: flex; flex-wrap: wrap; align-items: center; gap: 10px;
      padding: 10px; border-radius: 16px; border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.6));
      backdrop-filter: blur(10px) saturate(1.05);
      box-shadow: 0 16px 40px rgba(20,25,40,0.16);
    }
    .btn, .pill {
      appearance: none; cursor: pointer; user-select: none;
      border: 1px solid var(--line); border-radius: 999px; color: var(--ink);
      background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.55));
      padding: 8px 12px; font-size: 13px; white-space: nowrap;
      transition: transform 140ms ease, background 140ms ease, box-shadow 140ms ease, color 140ms ease;
      box-shadow: 0 10px 22px rgba(20,25,40,0.14);
    }
    .btn:hover, .pill:hover { transform: translateY(-2px); background: linear-gradient(180deg, #fff, rgba(255,255,255,0.65)); }
    .btn:focus-visible, .pill:focus-visible { outline: 2px solid var(--a1); outline-offset: 2px; }

    .slider {
      appearance: none; width: clamp(140px, 26vw, 260px); height: 28px; border-radius: 999px;
      border: 1px solid var(--line);
      background: linear-gradient(90deg, rgba(10,18,40,0.08), rgba(10,18,40,0.02));
      box-shadow: inset 0 0 0 2px rgba(255,255,255,0.65);
    }
    .slider::-webkit-slider-thumb {
      appearance: none; width: 20px; height: 20px; border-radius: 50%;
      background: linear-gradient(180deg, #fff, #e9eef3); border: 2px solid rgba(10,18,40,0.18); box-shadow: 0 2px 12px rgba(20,25,40,0.18); cursor: pointer;
    }
    .slider::-moz-range-thumb {
      width: 20px; height: 20px; border-radius: 50%;
      background: linear-gradient(180deg, #fff, #e9eef3); border: 2px solid rgba(10,18,40,0.18); box-shadow: 0 2px 12px rgba(20,25,40,0.18); cursor: pointer;
    }

    .themes { display: inline-flex; gap: 8px; margin-left: auto; }
    .swatch {
      width: 28px; height: 28px; border-radius: 50%; border: 1px solid var(--line);
      box-shadow: 0 10px 22px rgba(20,25,40,0.18); cursor: pointer; transition: transform 140ms ease;
    }
    .swatch:hover { transform: translateY(-2px) rotate(-4deg); }
    .swatch[data-theme="dawn"] { background: conic-gradient(#7aa8ff, #ffb86b, #88ffd8, #ffd6a8, #7aa8ff); }
    .swatch[data-theme="dusk"] { background: conic-gradient(#b39cff, #ff79c6, #9affd1, #ffe58a, #b39cff); }
    .swatch[data-theme="midnight"] { background: conic-gradient(#89a2ff, #ffd37a, #66ffd4, #bcd4ff, #89a2ff); }

    .meta {
      display: flex; align-items: center; gap: 12px; margin-top: 10px; font-size: 12px; color: var(--muted);
    }
    .meta .sep { opacity: .5; }

    [data-ui="hidden"] .controls, [data-ui="hidden"] .topbar { opacity: 0; pointer-events: none; transform: translateY(-6px); transition: 200ms ease; }
  </style>

  <div class="topbar">
    <div class="sig">
      <div class="mark" aria-hidden="true"></div>
      Aether Instruments
    </div>
    <div class="chip" aria-hidden="true">Orbital Garden</div>
  </div>

  <div class="hero">
    <h1 class="hero-title">A Clock of Orbits</h1>
    <p class="hero-sub">Time, rendered as a quiet cosmos. Planets sweep, threads connect, and the hours breathe in soft color.</p>
  </div>

  <div class="viewport" aria-label="Luminous Orrery">
    <div class="halo" aria-hidden="true"></div>
    <canvas class="sky" aria-hidden="true"></canvas>
  </div>

  <div class="controls" role="group" aria-label="Controls">
    <button type="button" class="btn play" aria-pressed="false" title="Pause/Resume">Pause</button>

    <label class="pill" style="padding:0 10px; display:inline-flex; align-items:center; gap:8px;">
      <span style="opacity:.8; font-size:12px;">Tempo</span>
      <input class="slider tempo" type="range" min="0.2" max="3" step="0.05" value="1" aria-label="Orbit speed">
    </label>

    <label class="pill" style="padding:0 10px; display:inline-flex; align-items:center; gap:8px;">
      <span style="opacity:.8; font-size:12px;">Trail</span>
      <input class="slider trail" type="range" min="0.02" max="0.24" step="0.01" value="0.09" aria-label="Trail persistence">
    </label>

    <button type="button" class="btn pulse" title="Align to a pleasing ratio">Pulse</button>
    <button type="button" class="btn snap" title="Save image">Capture</button>

    <div class="themes" role="group" aria-label="Theme">
      <button class="swatch" type="button" data-theme="dawn" title="Dawn"></button>
      <button class="swatch" type="button" data-theme="dusk" title="Dusk"></button>
      <button class="swatch" type="button" data-theme="midnight" title="Midnight"></button>
    </div>
  </div>

  <div class="meta" aria-label="Meta">
    <span id="last-updated">Last updated: 2025-11-03 07:38:03 EST</span>
    <span class="sep">•</span>
    <span class="hint">Drag to tilt • Space: pause • P: pulse • S: capture • 1/2/3: theme</span>
  </div>

  <script>
    (function(){
      const root = document.currentScript.closest('.orrery');
      const canvas = root.querySelector('canvas.sky');
      const ctx = canvas.getContext('2d', { alpha: true });
      const view = root.querySelector('.viewport');

      const playBtn = root.querySelector('.play');
      const tempoInput = root.querySelector('.tempo');
      const trailInput = root.querySelector('.trail');
      const pulseBtn = root.querySelector('.pulse');
      const snapBtn = root.querySelector('.snap');
      const themeBtns = root.querySelectorAll('.swatch');
      const last = root.querySelector('#last-updated');

      // Timestamp
      try {
        const now = new Date();
        const fmt = new Intl.DateTimeFormat([], {
          year: 'numeric', month: 'short', day: '2-digit',
          hour: '2-digit', minute: '2-digit', second:'2-digit',
          hour12: true, timeZoneName: 'short'
        });
        last.textContent = 'Updated ' + fmt.format(now);
      } catch { last.textContent = 'Updated ' + new Date().toLocaleString(); }

      // Themes
      const savedTheme = localStorage.getItem('orrery-theme');
      if (savedTheme) root.setAttribute('data-theme', savedTheme);
      themeBtns.forEach(b => b.addEventListener('click', ()=>{
        const t = b.getAttribute('data-theme');
        root.setAttribute('data-theme', t);
        localStorage.setItem('orrery-theme', t);
        hardClear();
      }));

      // Palette per theme
      function palette(){
        const t = root.getAttribute('data-theme') || 'dawn';
        if (t === 'midnight') return ['#89a2ff','#ffd37a','#66ffd4','#bcd4ff','#9aaeff'];
        if (t === 'dusk') return ['#b39cff','#ff79c6','#9affd1','#ffe58a','#c7b7ff'];
        return ['#7aa8ff','#ffb86b','#88ffd8','#ffd6a8','#a3c6ff'];
      }

      // DPI + sizing
      const DPR = Math.min(2, window.devicePixelRatio || 1);
      let W=0, H=0, CX=0, CY=0, RAD=0;
      function resize(){
        const r = view.getBoundingClientRect();
        W = Math.max(1, Math.floor(r.width));
        H = Math.max(1, Math.floor(r.height));
        CX = W/2; CY = H/2; RAD = Math.min(CX, CY)*0.9;
        canvas.width = Math.floor(W * DPR);
        canvas.height = Math.floor(H * DPR);
        canvas.style.width = W + 'px';
        canvas.style.height = H + 'px';
        ctx.setTransform(DPR,0,0,DPR,0,0);
        hardClear();
        drawBackdrop();
      }
      const ro = new ResizeObserver(resize);
      ro.observe(view);
      window.addEventListener('orientationchange', ()=> setTimeout(resize, 120));

      // Backdrop stars
      let stars = [];
      function seedStars(){
        stars = [];
        const n = Math.floor(120 + (W*H)/24000);
        for (let i=0;i<n;i++){
          stars.push({
            x: Math.random()*W,
            y: Math.random()*H,
            r: Math.random()*1.2 + 0.2,
            a: Math.random()*Math.PI*2,
            tw: 0.3 + Math.random()*0.7
          });
        }
      }
      function drawBackdrop(){
        const t = root.getAttribute('data-theme') || 'dawn';
        const grad = ctx.createRadialGradient(CX, CY, 0, CX, CY, Math.max(W,H)*0.8);
        grad.addColorStop(0, (t==='midnight'?'#0d1428':'#ffffff') + '00');
        grad.addColorStop(1, (t==='midnight'?'#070b16':'#ffffff') + '00');
        ctx.fillStyle = grad;
        ctx.fillRect(0,0,W,H);

        // stars
        ctx.save();
        stars.forEach(s => {
          const tw = 0.6 + 0.4*Math.sin(s.a);
          s.a += 0.02*s.tw;
          const c = palette()[Math.floor((s.x/W)*palette().length)%palette().length];
          ctx.globalAlpha = 0.35 + 0.65*tw;
          ctx.fillStyle = c;
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.r*(0.7+0.6*tw), 0, Math.PI*2);
          ctx.fill();
        });
        ctx.restore();
        ctx.globalAlpha = 1;
      }

      // Orrery bodies
      function makeSystem(){
        const P = palette();
        return [
          { name:'inner', r: RAD*0.18, size: 3.5, period: 7, color: P[0], wobble: 0.04 },
          { name:'mid',   r: RAD*0.34, size: 5.0, period: 16, color: P[1], wobble: 0.06 },
          { name:'outer', r: RAD*0.52, size: 6.5, period: 32, color: P[2], wobble: 0.08 },
          { name:'veil',  r: RAD*0.72, size: 4.5, period: 48, color: P[3], wobble: 0.05 }
        ];
      }
      let bodies = [];
      function refreshSystem(){ bodies = makeSystem(); }
      
      // Controls
      let paused = matchMedia('(prefers-reduced-motion: reduce)').matches;
      function setPaused(p){
        paused = p;
        playBtn.setAttribute('aria-pressed', String(p));
        playBtn.textContent = p ? 'Resume' : 'Pause';
      }
      playBtn.addEventListener('click', ()=> setPaused(!paused));
      setPaused(paused);

      let tempo = parseFloat(localStorage.getItem('orrery-tempo') ?? '1');
      tempoInput.value = String(tempo);
      tempoInput.addEventListener('input', e => {
        tempo = parseFloat(e.target.value || '1');
        localStorage.setItem('orrery-tempo', String(tempo));
      });

      let trail = parseFloat(localStorage.getItem('orrery-trail') ?? '0.09');
      trailInput.value = String(trail);
      trailInput.addEventListener('input', e => {
        trail = parseFloat(e.target.value || '0.09');
        localStorage.setItem('orrery-trail', String(trail));
      });

      pulseBtn.addEventListener('click', ()=>{
        // Snap periods into a simple harmonic set (musical-ish ratios)
        const ratios = [1, 3/2, 5/3, 2, 8/3];
        bodies.forEach((b, i)=> b.period = 12 * ratios[(i % ratios.length)]);
        ping();
      });

      function ping(){
        // brief center flash
        flash = 1;
      }

      function snapshot(){
        try {
          const link = document.createElement('a');
          link.download = 'orbital-garden.png';
          link.href = canvas.toDataURL('image/png');
          link.click();
        } catch {}
      }
      snapBtn.addEventListener('click', snapshot);

      // Pointer tilt
      const pointer = { x:0, y:0, inside:false };
      function setPointer(eX, eY){
        const r = view.getBoundingClientRect();
        pointer.x = (eX - r.left) / r.width;
        pointer.y = (eY - r.top) / r.height;
        pointer.inside = true;
      }
      view.addEventListener('mousemove', e => setPointer(e.clientX, e.clientY));
      view.addEventListener('mouseenter', e => setPointer(e.clientX, e.clientY));
      view.addEventListener('mouseleave', ()=> { pointer.inside = false; });

      // Keyboard
      root.tabIndex = 0;
      root.addEventListener('keydown', (e)=>{
        const k = e.key.toLowerCase();
        if (e.code === 'Space'){ e.preventDefault(); setPaused(!paused); }
        if (k === 'p'){ pulseBtn.click(); }
        if (k === 's'){ snapshot(); }
        if (k === '1'){ themeBtns[0].click(); }
        if (k === '2'){ themeBtns[1].click(); }
        if (k === '3'){ themeBtns[2].click(); }
      });

      // Trails
      function fade(){
        const t = root.getAttribute('data-theme') || 'dawn';
        ctx.globalCompositeOperation = 'source-over';
        if (t === 'midnight'){
          ctx.fillStyle = 'rgba(7,11,22,' + trail + ')';
        } else {
          ctx.fillStyle = 'rgba(255,255,255,' + trail + ')';
        }
        ctx.fillRect(0,0,W,H);
      }

      // Drawing helpers
      function ring(r, color, alpha){
        ctx.save();
        ctx.globalAlpha = alpha;
        ctx.strokeStyle = color;
        ctx.lineWidth = 1.1;
        ctx.setLineDash([4, 8]);
        ctx.beginPath();
        ctx.arc(CX, CY, r, 0, Math.PI*2);
        ctx.stroke();
        ctx.restore();
      }

      function glowDot(x, y, size, color){
        const g = ctx.createRadialGradient(x, y, 0.1, x, y, size*3);
        g.addColorStop(0, color);
        g.addColorStop(1, color + '00');
        ctx.fillStyle = g;
        ctx.beginPath();
        ctx.arc(x, y, size*3, 0, Math.PI*2);
        ctx.fill();

        ctx.shadowColor = color;
        ctx.shadowBlur = size*3;
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(x, y, size, 0, Math.PI*2);
        ctx.fill();
        ctx.shadowBlur = 0;
      }

      // Comet particles on pulses or clicks
      let comets = [];
      function spawnComet(x, y, hue){
        for (let i=0;i<12;i++){
          const ang = Math.random()*Math.PI*2;
          const sp = 1.5 + Math.random()*3;
          comets.push({
            x, y,
            vx: Math.cos(ang)*sp,
            vy: Math.sin(ang)*sp,
            life: 1,
            color: hue
          });
        }
      }

      view.addEventListener('click', ()=>{
        const hue = palette()[Math.floor(Math.random()*palette().length)];
        spawnComet(CX, CY, hue);
        ping();
      });

      // Animation
      let t0 = performance.now();
      let flash = 0;
      function tick(now){
        const dt = Math.min(0.05, (now - t0)/1000);
        t0 = now;

        // Tilt
        const nx = (pointer.inside ? (pointer.x - 0.5) : 0) * 2;
        const ny = (pointer.inside ? (pointer.y - 0.5) : 0) * 2;
        view.style.transform = `perspective(1000px) rotateX(${ny * -4}deg) rotateY(${nx * 6}deg) translateZ(0)`;

        if (!paused){
          fade();

          // orbits
          const P = palette();
          bodies.forEach((b, i)=>{
            ring(b.r, (P[i%P.length]+'44'), 0.7);
          });

          // center pulse
          if (flash > 0){
            const c = palette()[0];
            glowDot(CX, CY, 3 + 8*flash, c);
            flash -= dt*1.5;
          } else {
            const c = palette()[0];
            glowDot(CX, CY, 3, c + 'cc');
          }

          // planets + constellation lines
          const t = now * 0.001 * tempo;
          const pts = [];
          bodies.forEach((b, i)=>{
            const wob = 1 + b.wobble*Math.sin(t*0.8 + i);
            const ang = (t / b.period + i*0.17) * Math.PI*2;
            const rx = b.r*wob, ry = b.r*(1 - b.wobble*0.8);
            const x = CX + Math.cos(ang)*rx;
            const y = CY + Math.sin(ang)*ry;
            pts.push({x,y,color:b.color,size:b.size});
            glowDot(x, y, b.size, b.color + 'cc');
          });

          // connect softly
          ctx.globalCompositeOperation = 'lighter';
          for (let i=0; i<pts.length; i++){
            const a = pts[i], b = pts[(i+1)%pts.length];
            const grad = ctx.createLinearGradient(a.x, a.y, b.x, b.y);
            grad.addColorStop(0, a.color + 'aa');
            grad.addColorStop(1, b.color + 'aa');
            ctx.strokeStyle = grad;
            ctx.lineWidth = 1.6;
            ctx.beginPath();
            ctx.moveTo(a.x, a.y);
            ctx.lineTo(b.x, b.y);
            ctx.stroke();
          }
          ctx.globalCompositeOperation = 'source-over';

          // comets
          for (let i=comets.length-1; i>=0; i--){
            const c = comets[i];
            c.x += c.vx;
            c.y += c.vy;
            c.life -= dt*0.9;
            ctx.globalAlpha = Math.max(0, c.life);
            ctx.strokeStyle = c.color + 'aa';
            ctx.lineWidth = 1.2;
            ctx.beginPath();
            ctx.moveTo(c.x, c.y);
            ctx.lineTo(c.x - c.vx*4, c.y - c.vy*4);
            ctx.stroke();
            if (c.life <= 0) comets.splice(i,1);
          }
          ctx.globalAlpha = 1;

          // ambient backdrop stars over time
          drawBackdrop();
        }

        requestAnimationFrame(tick);
      }

      function hardClear(){
        ctx.clearRect(0,0,W,H);
      }

      // Init
      resize();
      seedStars();
      refreshSystem();
      hardClear();
      drawBackdrop();
      requestAnimationFrame(tick);

      // Reduced motion: show static layout
      if (matchMedia('(prefers-reduced-motion: reduce)').matches){
        setPaused(true);
        const P = palette();
        bodies.forEach((b, i)=>{
          ring(b.r, (P[i%P.length]+'55'), 1);
          const ang = i*1.2;
          const x = CX + Math.cos(ang)*b.r;
          const y = CY + Math.sin(ang)*b.r;
          glowDot(x, y, b.size, b.color + 'cc');
        });
        glowDot(CX, CY, 3, palette()[0] + 'cc');
      }
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


