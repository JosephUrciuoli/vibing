<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="vibe1167" class="nocturne" role="region" aria-label="Kaleidoscope Poster · Build 1167">
  <style>
    /* Kinetic Kaleidoscope — Build 1167 */
    #vibe1167 {
      --bg1: hsl(230 25% 9%);
      --bg2: hsl(230 22% 13%);
      --ink: hsl(0 0% 98%);
      --muted: hsl(220 12% 75% / .9);
      --edge: hsl(220 24% 36% / .45);
      --accentA: hsl(185 95% 58%);
      --accentB: hsl(318 92% 62%);
      --accentC: hsl(48 94% 56%);
      --ring: hsl(0 0% 100% / .08);
      --radius: 30px;
      --spd: 1;
      position: relative;
      padding: clamp(22px, 5vw, 56px);
      color: var(--ink);
      border-radius: var(--radius);
      border: 1px solid var(--edge);
      background:
        radial-gradient(1200px 600px at calc(var(--mx,50) * 1%) calc(var(--my,38) * 1%),
          color-mix(in oklab, var(--accentA) 12%, transparent) 0%,
          transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      box-shadow: 0 40px 100px hsl(230 60% 4% / .55), inset 0 1px 0 hsl(0 0% 100% / .06);
      font: 500 16px/1.6 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, ui-rounded, "SF Pro Rounded";
      overflow: clip;
      isolation: isolate;
    }
    #vibe1167 * { box-sizing: border-box; }

    /* Ambient grain + chroma veil */
    #vibe1167::before {
      content: "";
      position: absolute; inset: -20% -10%;
      background:
        conic-gradient(from 120deg at 10% 10%,
          color-mix(in oklab, var(--accentA) 16%, transparent) 0 18%,
          transparent 0 42%,
          color-mix(in oklab, var(--accentB) 20%, transparent) 0 62%,
          transparent 0 84%,
          color-mix(in oklab, var(--accentC) 18%, transparent) 0 100%);
      filter: blur(70px) saturate(120%);
      opacity: .7;
      animation: v1167-veil calc(60s / var(--spd)) linear infinite;
      mix-blend-mode: screen;
      pointer-events: none;
      z-index: 0;
    }
    #vibe1167::after {
      content: "";
      position: absolute; inset: 0;
      background:
        repeating-linear-gradient(0deg, #0000 0 2px, #fff1 2px 3px),
        repeating-linear-gradient(90deg, #0000 0 2px, #fff1 2px 3px);
      opacity: .04;
      pointer-events: none;
      z-index: 1;
    }

    /* Palettes */
    #vibe1167.dawn {
      --bg1: hsl(28 90% 98%);
      --bg2: hsl(18 70% 96%);
      --ink: hsl(18 32% 16%);
      --muted: hsl(18 20% 40%);
      --edge: hsl(22 30% 82% / .7);
      --accentA: hsl(12 90% 58%);
      --accentB: hsl(42 94% 54%);
      --accentC: hsl(328 86% 60%);
      --ring: hsl(18 20% 30% / .12);
      box-shadow: 0 42px 90px hsl(24 40% 15% / .12), inset 0 1px 0 hsl(0 0% 100% / .8);
    }
    #vibe1167.prism {
      --bg1: hsl(205 70% 99%);
      --bg2: hsl(195 64% 97%);
      --ink: hsl(222 28% 10%);
      --muted: hsl(220 14% 42%);
      --edge: hsl(205 24% 84% / .65);
      --accentA: hsl(192 92% 52%);
      --accentB: hsl(268 84% 62%);
      --accentC: hsl(156 76% 46%);
      --ring: hsl(220 20% 30% / .12);
      box-shadow: 0 42px 90px hsl(220 40% 15% / .12), inset 0 1px 0 hsl(0 0% 100% / .8);
    }
    #vibe1167.tundra {
      --bg1: hsl(220 10% 98%);
      --bg2: hsl(220 12% 94%);
      --ink: hsl(230 30% 14%);
      --muted: hsl(230 12% 42%);
      --edge: hsl(220 18% 84% / .65);
      --accentA: hsl(195 78% 52%);
      --accentB: hsl(215 84% 64%);
      --accentC: hsl(265 78% 62%);
      --ring: hsl(220 12% 30% / .12);
      box-shadow: 0 42px 90px hsl(220 40% 15% / .12), inset 0 1px 0 hsl(0 0% 100% / .8);
    }
    #vibe1167.nocturne {
      --bg1: hsl(230 25% 9%);
      --bg2: hsl(230 22% 13%);
      --ink: hsl(0 0% 98%);
      --muted: hsl(220 12% 75% / .9);
      --edge: hsl(220 24% 36% / .45);
      --accentA: hsl(185 95% 58%);
      --accentB: hsl(318 92% 62%);
      --accentC: hsl(48 94% 56%);
      --ring: hsl(0 0% 100% / .08);
    }

    /* Header */
    #vibe1167 .head {
      position: relative; z-index: 2;
      display: grid; gap: 12px;
      grid-template-columns: 1fr auto;
      align-items: end;
    }
    #vibe1167 .brand {
      display: inline-flex; align-items: center; gap: 10px;
      font-weight: 800; letter-spacing: .18em; text-transform: uppercase;
      color: var(--muted); font-size: 12px; user-select: none;
    }
    #vibe1167 .stamp {
      width: 22px; height: 22px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, white, color-mix(in oklab, var(--accentA) 60%, var(--accentB) 40%));
      box-shadow: 0 0 0 5px hsl(0 0% 100% / .15), 0 0 28px color-mix(in oklab, var(--accentA) 55%, transparent);
      position: relative;
    }
    #vibe1167 .stamp::after {
      content: "";
      position: absolute; inset: -6px; border-radius: 50%;
      border: 1px dashed color-mix(in oklab, var(--accentA) 40%, var(--edge));
      opacity: .6;
      animation: v1167-spin calc(20s / var(--spd)) linear infinite;
    }
    #vibe1167 .chips { display: flex; gap: 8px; flex-wrap: wrap; justify-content: end; }
    #vibe1167 .chip {
      appearance: none; cursor: pointer;
      border-radius: 999px; padding: 8px 12px;
      border: 1px solid hsl(0 0% 100% / .15);
      background: linear-gradient(180deg, hsl(0 0% 100% / .14), hsl(0 0% 100% / .08));
      color: var(--ink); font-weight: 800; font-size: 12px; letter-spacing: .03em;
      box-shadow: 0 12px 28px hsl(230 40% 5% / .42), inset 0 1px 0 hsl(0 0% 100% / .08);
      transition: transform .12s ease, box-shadow .2s ease, filter .2s ease, border-color .2s ease;
    }
    #vibe1167.dawn .chip, #vibe1167.prism .chip, #vibe1167.tundra .chip {
      border-color: hsl(0 0% 100% / .7);
      background: linear-gradient(180deg, hsl(0 0% 100% / .85), hsl(0 0% 100% / .6));
      box-shadow: 0 12px 28px hsl(220 24% 16% / .14), inset 0 1px 0 hsl(0 0% 100%);
      color: color-mix(in oklab, var(--ink) 86%, black);
    }
    #vibe1167 .chip:hover { transform: translateY(-1px); filter: saturate(1.05); }
    #vibe1167 .chip[data-active] {
      background: linear-gradient(120deg, var(--accentA), var(--accentB));
      color: white; border-color: transparent;
      box-shadow: 0 16px 34px color-mix(in oklab, var(--accentA) 35%, transparent);
    }

    /* Hero */
    #vibe1167 .hero {
      position: relative; z-index: 2;
      margin-top: clamp(6px, 3vh, 18px);
      display: grid; gap: 8px;
    }
    #vibe1167 .title {
      margin: 0;
      font-weight: 900; letter-spacing: -0.02em;
      font-size: clamp(44px, 9.6vw, 110px); line-height: .86;
      background: linear-gradient(90deg,
        color-mix(in oklab, var(--ink) 85%, white 15%),
        color-mix(in oklab, var(--accentA) 70%, white 30%),
        color-mix(in oklab, var(--accentB) 70%, white 30%),
        color-mix(in oklab, var(--accentC) 70%, white 30%),
        color-mix(in oklab, var(--ink) 85%, white 15%));
      background-size: 260% 100%;
      -webkit-background-clip: text; background-clip: text; color: transparent;
      animation: v1167-shimmer calc(11s / var(--spd)) ease-in-out infinite;
      filter: drop-shadow(0 16px 36px hsl(0 0% 0% / .45));
    }
    #vibe1167 .subtitle {
      margin: 2px 0 0; color: var(--muted);
      font-size: clamp(14px, 2.2vw, 18px);
      max-width: 72ch;
    }

    /* Stage (canvas + HUD) */
    #vibe1167 .stage {
      position: relative; z-index: 2;
      margin-top: clamp(18px, 6vh, 36px);
      border-radius: 22px;
      border: 1px solid var(--edge);
      background: linear-gradient(180deg, hsl(0 0% 100% / .06), hsl(0 0% 100% / .03));
      box-shadow: 0 26px 70px hsl(230 60% 6% / .45), inset 0 1px 0 hsl(0 0% 100% / .06);
      height: clamp(340px, 54vh, 720px);
      overflow: hidden;
    }
    #vibe1167.dawn .stage, #vibe1167.prism .stage, #vibe1167.tundra .stage {
      background: linear-gradient(180deg, hsl(0 0% 100% / .86), hsl(0 0% 100% / .6));
      box-shadow: 0 24px 60px hsl(220 30% 16% / .14), inset 0 1px 0 hsl(0 0% 100% / .85);
    }
    #vibe1167 .scope { position: absolute; inset: 0; width: 100%; height: 100%; display: block; }
    #vibe1167 .halo {
      position: absolute; inset: 0; pointer-events: none;
      background:
        radial-gradient(50% 50% at 50% 50%, #0000 58%, var(--ring) 59% 60%, #0000 61%),
        radial-gradient(50% 50% at 50% 50%, #0000 70%, var(--ring) 71% 72%, #0000 73%),
        conic-gradient(from 0deg, color-mix(in oklab, var(--accentA) 12%, transparent), transparent 30%, color-mix(in oklab, var(--accentB) 12%, transparent), transparent 60%, color-mix(in oklab, var(--accentC) 12%, transparent), transparent);
      mix-blend-mode: screen;
      opacity: .5;
      animation: v1167-rotate calc(50s / var(--spd)) linear infinite;
    }

    /* Glass card */
    #vibe1167 .card {
      position: absolute; right: clamp(14px, 6%, 24px); bottom: clamp(14px, 6%, 24px);
      backdrop-filter: blur(10px) saturate(140%);
      background: linear-gradient(180deg, hsl(0 0% 100% / .12), hsl(0 0% 100% / .06));
      color: var(--ink);
      border: 1px solid var(--edge);
      border-radius: 16px;
      padding: 14px 16px;
      box-shadow: 0 18px 46px hsl(230 60% 6% / .42), inset 0 1px 0 hsl(0 0% 100% / .06);
      max-width: min(520px, 80%);
    }
    #vibe1167.dawn .card, #vibe1167.prism .card, #vibe1167.tundra .card {
      background: linear-gradient(180deg, hsl(0 0% 100% / .9), hsl(0 0% 100% / .66));
      border-color: hsl(0 0% 100% / .8);
      box-shadow: 0 18px 46px hsl(220 30% 16% / .18), inset 0 1px 0 hsl(0 0% 100% / .85);
    }
    #vibe1167 .card h2 {
      margin: 0 0 4px; font-size: clamp(16px, 2vw, 20px); letter-spacing: -.01em;
      background: linear-gradient(90deg, var(--ink), color-mix(in oklab, var(--accentA) 55%, var(--ink)));
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    #vibe1167 .card p { margin: 0 0 10px; color: var(--muted); font-size: 13px; }
    #vibe1167 .cta {
      display: inline-block; text-decoration: none;
      font-weight: 900; letter-spacing: .02em;
      color: white;
      background: linear-gradient(120deg, var(--accentA), var(--accentB));
      border: 0; border-radius: 999px;
      padding: 10px 14px;
      box-shadow: 0 16px 34px color-mix(in oklab, var(--accentA) 35%, transparent);
      transform: translateZ(0);
      transition: transform .1s ease, box-shadow .2s ease, filter .2s ease;
      will-change: transform;
      cursor: pointer;
      margin-right: 8px;
    }
    #vibe1167 .cta:hover { transform: translateY(-1px) scale(1.02); filter: saturate(1.1); }
    #vibe1167 .ghost {
      appearance: none; cursor: pointer;
      border-radius: 999px; padding: 9px 12px;
      border: 1px solid hsl(0 0% 100% / .18);
      background: linear-gradient(180deg, hsl(0 0% 100% / .1), hsl(0 0% 100% / .06));
      color: var(--ink); font-weight: 800; font-size: 12px; letter-spacing: .02em;
      box-shadow: 0 14px 30px hsl(230 50% 6% / .34), inset 0 1px 0 hsl(0 0% 100% / .06);
      transition: transform .12s ease, border-color .2s ease, box-shadow .2s ease;
    }
    #vibe1167.dawn .ghost, #vibe1167.prism .ghost, #vibe1167.tundra .ghost {
      border-color: hsl(0 0% 100% / .7);
      background: linear-gradient(180deg, hsl(0 0% 100% / .85), hsl(0 0% 100% / .6));
      box-shadow: 0 12px 28px hsl(220 24% 16% / .14), inset 0 1px 0 hsl(0 0% 100%);
      color: color-mix(in oklab, var(--ink) 86%, black);
    }
    #vibe1167 .ghost:hover { transform: translateY(-1px); }

    /* Dock / controls */
    #vibe1167 .dock {
      position: relative; z-index: 2;
      margin-top: clamp(18px, 6vh, 34px);
      display: grid; gap: 12px;
      grid-template-columns: 1fr auto;
      align-items: center;
      color: var(--muted); font-size: 12px;
    }
    #vibe1167 .controls { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; justify-content: end; }
    #vibe1167 .btn, #vibe1167 .range {
      appearance: none; border-radius: 12px;
      border: 1px solid hsl(0 0% 100% / .18);
      background: linear-gradient(180deg, hsl(0 0% 100% / .1), hsl(0 0% 100% / .06));
      color: var(--ink); padding: 9px 12px; font-weight: 800; letter-spacing: .02em;
      box-shadow: 0 16px 38px hsl(230 50% 6% / .34), inset 0 1px 0 hsl(0 0% 100% / .06);
      transition: transform .12s ease, border-color .2s ease, box-shadow .2s ease, background .2s ease, color .2s ease;
    }
    #vibe1167.dawn .btn, #vibe1167.dawn .range,
    #vibe1167.prism .btn, #vibe1167.prism .range,
    #vibe1167.tundra .btn, #vibe1167.tundra .range {
      border-color: hsl(0 0% 100% / .7);
      background: linear-gradient(180deg, hsl(0 0% 100% / .85), hsl(0 0% 100% / .6));
      box-shadow: 0 12px 28px hsl(220 24% 16% / .14), inset 0 1px 0 hsl(0 0% 100%);
      color: color-mix(in oklab, var(--ink) 86%, black);
    }
    #vibe1167 .btn { cursor: pointer; }
    #vibe1167 .btn:hover { transform: translateY(-1px); }
    #vibe1167 .btn:focus-visible, #vibe1167 .chip:focus-visible, #vibe1167 input[type="range"]:focus-visible { outline: 2px solid var(--accentA); outline-offset: 3px; }
    #vibe1167 .range { display: inline-flex; align-items: center; gap: 10px; padding: 8px 12px; }
    #vibe1167 .range label { font-weight: 800; font-size: 12px; color: var(--muted); letter-spacing: .02em; }
    #vibe1167 input[type="range"] {
      -webkit-appearance: none; appearance: none; width: 160px; height: 6px; border-radius: 999px;
      background: linear-gradient(90deg, var(--accentA), var(--accentB));
      outline: none; border: none;
    }
    #vibe1167 input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none; width: 16px; height: 16px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, white, var(--accentA));
      border: 1px solid hsl(0 0% 100% / .8);
      box-shadow: 0 8px 16px hsl(230 30% 16% / .18);
      cursor: grab;
    }
    #vibe1167 input[type="range"]::-moz-range-thumb {
      width: 16px; height: 16px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, white, var(--accentA));
      border: 1px solid hsl(0 0% 100% / .8);
      box-shadow: 0 8px 16px hsl(230 30% 16% / .18);
      cursor: grab;
    }

    /* Pause all motion when requested */
    #vibe1167.paused * { animation-play-state: paused !important; }

    /* Motion preferences */
    @media (prefers-reduced-motion: reduce) {
      #vibe1167, #vibe1167 * { animation: none !important; transition: none !important; }
    }

    @keyframes v1167-spin { to { transform: rotate(1turn); } }
    @keyframes v1167-veil { to { transform: rotate(380deg); } }
    @keyframes v1167-shimmer {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes v1167-rotate { to { transform: rotate(360deg); } }
  </style>

  <!-- Header -->
  <div class="head">
    <div class="brand">
      <span class="stamp" aria-hidden="true"></span>
      Lumen Forge · Build 1167
    </div>
    <div class="chips" role="group" aria-label="Palette">
      <button class="chip" type="button" data-mode="dawn" aria-label="Dawn">Dawn</button>
      <button class="chip" type="button" data-mode="prism" aria-label="Prism">Prism</button>
      <button class="chip" type="button" data-mode="tundra" aria-label="Tundra">Tundra</button>
      <button class="chip" type="button" data-mode="nocturne" aria-label="Nocturne">Nocturne</button>
    </div>
  </div>

  <!-- Hero -->
  <section class="hero" aria-label="Intro">
    <h1 class="title">Quiet thunder.</h1>
    <p class="subtitle">A kinetic poster that listens to your cursor. Geometry breathes; color hums.</p>
  </section>

  <!-- Stage -->
  <section class="stage" aria-label="Kaleidoscope">
    <canvas class="scope" aria-hidden="true"></canvas>
    <div class="halo" aria-hidden="true"></div>

    <div class="card" role="note" aria-label="Caption">
      <h2>Orbiting calm</h2>
      <p>Symmetry, softened. Pull the center with your pointer; the field responds without shouting.</p>
      <button class="cta" type="button" id="pulse">Pulse</button>
      <button class="ghost" type="button" id="save">Save PNG</button>
    </div>
  </section>

  <!-- Dock -->
  <div class="dock">
    <span id="last-updated">Last updated: 2025-12-09 02:20:53 EST</span>
    <div class="controls">
      <div class="range" role="group" aria-label="Speed">
        <label for="speed">Speed</label>
        <input id="speed" type="range" min="0.4" max="2" step="0.1" value="1" aria-valuemin="0.4" aria-valuemax="2" aria-valuenow="1" aria-label="Animation speed">
      </div>
      <div class="range" role="group" aria-label="Detail">
        <label for="detail">Detail</label>
        <input id="detail" type="range" min="24" max="160" step="2" value="96" aria-valuemin="24" aria-valuemax="160" aria-valuenow="96" aria-label="Visual detail">
      </div>
      <button class="btn" type="button" id="toggle" aria-pressed="false" aria-label="Toggle Motion">Pause</button>
      <button class="btn" type="button" id="randomize" aria-label="Randomize Accents">Randomize</button>
    </div>
  </div>

  <script>
    (function(){
      const root = document.getElementById('vibe1167');
      const updated = root.querySelector('#last-updated');
      const chips = root.querySelectorAll('.chip');
      const speed = root.querySelector('#speed');
      const detail = root.querySelector('#detail');
      const toggle = root.querySelector('#toggle');
      const randomize = root.querySelector('#randomize');
      const pulse = root.querySelector('#pulse');
      const saveBtn = root.querySelector('#save');
      const canvas = root.querySelector('.scope');
      const ctx = canvas.getContext('2d', { alpha: true });

      // Timestamp
      try {
        const d = new Date();
        const fmt = { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' };
        updated.textContent = 'Last updated: ' + d.toLocaleString(undefined, fmt);
      } catch(e) { updated.textContent = 'Last updated: just now'; }

      // Palette switching
      function setMode(m) {
        root.classList.remove('dawn','prism','tundra','nocturne');
        root.classList.add(m);
        chips.forEach(c => c.removeAttribute('data-active'));
        const btn = Array.from(chips).find(c => c.dataset.mode === m);
        if (btn) btn.setAttribute('data-active','');
        // Nudge redraw to pick new CSS vars
        sampleAccents();
      }
      setMode('nocturne');
      chips.forEach(btn => btn.addEventListener('click', () => setMode(btn.dataset.mode)));

      // Read current accents from CSS
      let ACCENTS = ['#66E', '#E66', '#6E6'];
      function css(varName) { return getComputedStyle(root).getPropertyValue(varName).trim(); }
      function sampleAccents() {
        ACCENTS = [css('--accentA'), css('--accentB'), css('--accentC')].map(c => c || '#fff');
      }
      sampleAccents();

      // Randomize triad around a base hue
      function randomizeAccents() {
        const h = Math.floor(Math.random() * 360);
        const b = (h + 140 + Math.floor(Math.random()*40-20)) % 360;
        const c = (h + 260 + Math.floor(Math.random()*40-20)) % 360;
        root.style.setProperty('--accentA', `hsl(${h} 92% 58%)`);
        root.style.setProperty('--accentB', `hsl(${b} 88% 60%)`);
        root.style.setProperty('--accentC', `hsl(${c} 78% 56%)`);
        sampleAccents();
      }
      randomize.addEventListener('click', () => { randomizeAccents(); randomize.blur(); });

      // Canvas sizing
      function resize() {
        const r = canvas.getBoundingClientRect();
        const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
        canvas.width = Math.floor(r.width * dpr);
        canvas.height = Math.floor(r.height * dpr);
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      }
      resize();
      window.addEventListener('resize', resize);

      // Pointer tracking for parallax center
      const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      let pointer = { x: 0.5, y: 0.5 };
      function updateXY(e, el){
        const r = el.getBoundingClientRect();
        pointer.x = (e.clientX - r.left) / r.width;
        pointer.y = (e.clientY - r.top) / r.height;
        root.style.setProperty('--mx', (pointer.x*100).toFixed(2));
        root.style.setProperty('--my', (pointer.y*100).toFixed(2));
      }
      if (!reduce) {
        canvas.addEventListener('pointermove', (e) => updateXY(e, canvas), { passive: true });
        canvas.addEventListener('pointerleave', () => {
          pointer.x = 0.5; pointer.y = 0.5;
          root.style.removeProperty('--mx');
          root.style.removeProperty('--my');
        }, { passive: true });
      }

      // Controls
      let SPD = parseFloat(speed.value);
      speed.addEventListener('input', () => {
        SPD = parseFloat(speed.value);
        speed.setAttribute('aria-valuenow', String(SPD));
        root.style.setProperty('--spd', SPD);
      });
      let DETAIL = parseInt(detail.value, 10);
      detail.addEventListener('input', () => {
        DETAIL = parseInt(detail.value, 10);
        detail.setAttribute('aria-valuenow', String(DETAIL));
      });

      // Pause toggle
      let running = true;
      toggle.addEventListener('click', () => {
        running = !running;
        toggle.setAttribute('aria-pressed', String(!running ? true : false));
        toggle.textContent = running ? 'Pause' : 'Resume';
        root.classList.toggle('paused', !running);
        if (running) raf();
      });

      // Pulse
      let pulsePower = 0;
      pulse.addEventListener('click', () => {
        pulsePower = 1.0;
        pulse.animate([{ transform: 'scale(1)' }, { transform: 'scale(1.06)' }, { transform: 'scale(1)' }], { duration: 260, easing: 'ease-out' });
        running = true;
        toggle.textContent = 'Pause';
        toggle.setAttribute('aria-pressed','false');
        root.classList.remove('paused');
        raf();
      });

      // Save PNG
      saveBtn.addEventListener('click', () => {
        try {
          const link = document.createElement('a');
          link.download = 'lumen-forge-1167.png';
          link.href = canvas.toDataURL('image/png');
          link.click();
        } catch(e) { /* no-op */ }
      });

      // Draw utilities
      function lerp(a,b,t){ return a + (b-a)*t; }
      function mix(a,b,t){ return `rgba(${Math.round(lerp(a[0],b[0],t))},${Math.round(lerp(a[1],b[1],t))},${Math.round(lerp(a[2],b[2],t))},${lerp(a[3],b[3],t)})`; }
      function parseRGB(str){
        // expects hsl or rgb; canvas supports both strings; we can leave as-is for fillStyle
        return str;
      }

      // Animation
      let t = 0;
      function draw() {
        const { width: Wcss, height: Hcss } = canvas.getBoundingClientRect();
        const W = canvas.width; const H = canvas.height;
        const w = Wcss; const h = Hcss;

        ctx.clearRect(0,0,w,h);

        // Translate to center with slight pointer offset
        const cx = lerp(w*0.5, w * pointer.x, 0.18);
        const cy = lerp(h*0.5, h * pointer.y, 0.18);

        // Base parameters
        const rings = 6;
        const points = Math.max(24, Math.min(240, DETAIL));
        const baseR = Math.min(w, h) * 0.12;
        const maxR = Math.min(w, h) * 0.48;
        const spin = t * 0.2 * SPD + (pointer.x - 0.5) * 2.5;
        const sway = Math.sin(t * 0.8 * SPD) * 0.5 + (pointer.y - 0.5) * 1.2;

        // Glow blend
        ctx.globalCompositeOperation = 'lighter';

        // Draw concentric rosettes
        for (let r = 0; r < rings; r++) {
          const frac = r / (rings - 1 || 1);
          const R = lerp(baseR, maxR, frac);
          const amp = lerp(12, 40, frac) * (1 + pulsePower * 0.8);
          const col = ACCENTS[r % ACCENTS.length];

          for (let i = 0; i < points; i++) {
            const a = (i / points) * Math.PI * 2 + spin * (0.2 + frac * 0.6);
            const wob = Math.sin(a * (3 + r) + t * (1.4 + frac)) * amp + Math.cos(a * (2 + r) - t * (1.2 - frac)) * amp * 0.4;
            const rad = Math.max(6, 8 + Math.sin(a * 2 + t) * 2 + frac * 6);
            const x = cx + Math.cos(a + sway * 0.1) * (R + wob);
            const y = cy + Math.sin(a + sway * 0.1) * (R + wob);

            const g = ctx.createRadialGradient(x, y, 0, x, y, rad * 2.2);
            g.addColorStop(0, 'rgba(255,255,255,0.85)');
            g.addColorStop(0.25, col.replace('hsl','hsla').replace(')',',0.95)'));
            g.addColorStop(1, 'rgba(0,0,0,0)');
            ctx.fillStyle = g;
            ctx.beginPath();
            ctx.arc(x, y, rad, 0, Math.PI * 2);
            ctx.fill();
          }
        }

        // Soft center fade
        ctx.globalCompositeOperation = 'destination-out';
        const centerFade = ctx.createRadialGradient(cx, cy, 0, cx, cy, Math.min(w,h)*0.12);
        centerFade.addColorStop(0, 'rgba(0,0,0,0.08)');
        centerFade.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = centerFade;
        ctx.beginPath(); ctx.arc(cx, cy, Math.min(w,h)*0.18, 0, Math.PI*2); ctx.fill();

        ctx.globalCompositeOperation = 'source-over';

        // Decay pulse
        if (pulsePower > 0) pulsePower = Math.max(0, pulsePower - 0.04 * SPD);
      }

      let rafId = null;
      function loop() {
        t += 0.016 * SPD;
        draw();
      }
      function raf(){
        if (!running || reduce) return;
        cancelAnimationFrame(rafId);
        const step = () => { loop(); rafId = requestAnimationFrame(step); };
        rafId = requestAnimationFrame(step);
      }

      // Start
      if (!reduce) {
        raf();
      } else {
        draw();
      }
    })();
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


