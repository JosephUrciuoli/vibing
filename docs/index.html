<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="v146" aria-label="Neon Observatory">
  <style>
    .v146 {
      --space-0: hsl(230 35% 6%);
      --space-1: hsl(260 32% 10%);
      --space-2: hsl(260 30% 12% / 0.8);
      --ink: hsl(210 30% 98%);
      --muted: hsl(220 10% 72%);
      --ring: hsl(220 20% 80% / 0.18);
      --glass: hsl(0 0% 100% / 0.06);
      --accent-a: hsl(190 95% 55%);
      --accent-b: hsl(318 90% 66%);
      --tempo: 1;
      color: var(--ink);
      background:
        radial-gradient(120% 140% at 110% -10%, hsl(190 95% 55% / 0.12), transparent 60%),
        radial-gradient(120% 140% at -10% 120%, hsl(318 90% 66% / 0.12), transparent 60%),
        linear-gradient(180deg, var(--space-0), var(--space-1));
      border-radius: 32px;
      box-shadow:
        inset 0 1px 0 hsl(0 0% 100% / 0.06),
        0 40px 120px hsl(240 50% 5% / 0.65);
      font-family: ui-sans-serif, -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial;
      position: relative;
      overflow: hidden;
      min-height: 860px;
      isolation: isolate;
    }
    .v146 .grain,
    .v146 .vignette { position: absolute; inset: 0; pointer-events: none; }
    .v146 .grain {
      background-image:
        radial-gradient(1px 1px at 12% 32%, hsl(0 0% 100% / 0.06) 0, transparent 50%),
        radial-gradient(1px 1px at 62% 66%, hsl(0 0% 100% / 0.06) 0, transparent 50%),
        radial-gradient(1px 1px at 22% 86%, hsl(0 0% 100% / 0.04) 0, transparent 50%),
        radial-gradient(1px 1px at 82% 24%, hsl(0 0% 100% / 0.04) 0, transparent 50%),
        radial-gradient(1px 1px at 44% 44%, hsl(0 0% 100% / 0.05) 0, transparent 50%);
      background-size: 280px 280px, 280px 280px, 280px 280px, 280px 280px, 280px 280px;
      mix-blend-mode: overlay;
      opacity: 0.35;
      animation: v146-noise 40s linear infinite;
    }
    .v146 .vignette { box-shadow: inset 0 0 280px hsl(0 0% 0% / 0.5), inset 0 -120px 240px hsl(260 40% 6% / 0.6); }
    @keyframes v146-noise { to { transform: translate(18px, -16px); } }

    .v146 .wrap { width: min(1200px, 100%); margin-inline: auto; padding: clamp(22px, 6vw, 64px); position: relative; z-index: 2; }

    .v146 .top { display: grid; grid-template-columns: 1fr auto; align-items: end; gap: 16px; }
    .v146 .mark {
      display: inline-flex; align-items: center; gap: 10px;
      letter-spacing: 0.18em; text-transform: uppercase;
      color: var(--muted); font-weight: 800; font-size: 11px;
    }
    .v146 .chip {
      width: 26px; height: 26px; border-radius: 9px;
      background: linear-gradient(135deg, var(--accent-a), var(--accent-b));
      box-shadow: 0 0 0 2px hsl(0 0% 100% / 0.25) inset, 0 12px 28px hsl(260 80% 50% / 0.4);
    }
    .v146 .pill {
      padding: 8px 12px; border-radius: 999px;
      border: 1px solid var(--ring);
      background: hsl(0 0% 100% / 0.06);
      backdrop-filter: blur(10px) saturate(140%);
      color: var(--muted); font-weight: 700; font-size: 11px;
    }

    .v146 .title {
      margin: 14px 0 10px 0;
      font-weight: 900; letter-spacing: -0.02em; line-height: 0.96;
      font-size: clamp(48px, 9.4vw, 120px);
      background: linear-gradient(95deg, hsl(210 40% 98%), var(--accent-a) 45%, var(--accent-b) 75%, hsl(210 40% 98%));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      filter: drop-shadow(0 14px 34px hsl(260 80% 60% / 0.28));
      text-wrap: balance;
    }
    .v146 .sub {
      color: var(--muted); font-size: clamp(14px, 2vw, 18px);
      max-width: 72ch; text-wrap: balance;
    }

    .v146 .stage {
      position: relative; margin-top: clamp(18px, 4vw, 28px);
      border-radius: 26px; overflow: hidden; min-height: 600px;
      border: 1px solid var(--ring);
      background:
        radial-gradient(120% 140% at 50% 40%, hsl(0 0% 100% / 0.04), transparent 60%),
        linear-gradient(180deg, var(--space-2), hsl(230 32% 8%));
      box-shadow:
        inset 0 1px 0 hsl(0 0% 100% / 0.08),
        0 30px 90px hsl(240 40% 10% / 0.6);
      perspective: 1000px; transform-style: preserve-3d;
    }
    .v146 canvas { position: absolute; inset: 0; width: 100%; height: 100%; display: block; }

    .v146 .ring {
      position: absolute; inset: 0; pointer-events: none;
      border-radius: 26px;
      box-shadow:
        0 0 0 1px var(--ring) inset,
        0 0 0 2px hsl(0 0% 100% / 0.03) inset,
        0 40px 120px hsl(260 80% 60% / 0.25);
      mask: radial-gradient(140% 120% at 50% 50%, black 68%, transparent 100%);
    }

    .v146 .controls {
      position: absolute; z-index: 2;
      left: 50%; bottom: clamp(12px, 4vw, 22px); transform: translateX(-50%);
      display: grid; grid-auto-flow: column; gap: 10px; align-items: center;
      background: var(--glass); border: 1px solid var(--ring); border-radius: 999px; padding: 10px 12px;
      box-shadow: 0 14px 44px hsl(240 50% 5% / 0.6), 0 1px 0 hsl(0 0% 100% / 0.08) inset;
      backdrop-filter: blur(16px) saturate(160%);
    }
    .v146 .btn, .v146 .toggle {
      appearance: none; cursor: pointer; user-select: none;
      border-radius: 999px; padding: 10px 14px;
      font-weight: 800; letter-spacing: 0.01em; font-size: 12px;
      color: var(--ink); border: 1px solid var(--ring);
      background: linear-gradient(180deg, hsl(0 0% 100% / 0.12), hsl(0 0% 100% / 0.06));
      box-shadow: 0 1px 0 hsl(0 0% 100% / 0.18) inset, 0 8px 16px hsl(240 40% 10% / 0.3);
      transition: transform 120ms ease, background 220ms ease, border-color 220ms ease, box-shadow 220ms ease, color 220ms ease;
    }
    .v146 .btn:hover, .v146 .toggle:hover { transform: translateY(-1px); }
    .v146 .btn:active, .v146 .toggle:active { transform: translateY(0); box-shadow: 0 2px 8px hsl(240 40% 10% / 0.4) inset; }
    .v146 .primary {
      color: white;
      background: linear-gradient(92deg, var(--accent-a), var(--accent-b));
      border-color: transparent;
      box-shadow: 0 12px 26px color-mix(in oklab, var(--accent-b), black 40%);
    }
    .v146 .toggle[aria-pressed="true"] { outline: 2px solid var(--accent-a); outline-offset: 2px; }

    .v146 .slider {
      display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 10px;
      color: var(--muted); font-size: 12px;
      border: 1px solid var(--ring);
      background: linear-gradient(180deg, hsl(0 0% 100% / 0.12), hsl(0 0% 100% / 0.06));
      padding: 8px 10px; border-radius: 999px;
      box-shadow: 0 1px 0 hsl(0 0% 100% / 0.2) inset;
      backdrop-filter: blur(10px) saturate(140%);
    }
    .v146 input[type="range"] {
      accent-color: hsl(200 95% 55%);
      width: 190px; height: 6px; cursor: pointer; appearance: none; outline: none; border-radius: 999px;
      background: linear-gradient(90deg, var(--accent-a), var(--accent-b));
    }
    .v146 input[type="range"]::-webkit-slider-thumb {
      appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background: white; border: 2px solid hsl(0 0% 100% / 0.7);
      box-shadow: 0 8px 18px hsl(240 40% 10% / 0.4);
      margin-top: -6px;
    }
    .v146 input[type="range"]::-moz-range-thumb {
      width: 18px; height: 18px; border-radius: 50%;
      background: white; border: 2px solid hsl(0 0% 100% / 0.7);
    }
    .v146 .val { font-variant-numeric: tabular-nums; color: var(--ink); font-weight: 800; padding: 6px 10px; }

    .v146 .foot {
      display: flex; justify-content: space-between; align-items: center;
      padding: 20px clamp(22px, 6vw, 64px) 34px; color: var(--muted);
      font-size: 12px; flex-wrap: wrap; gap: 10px; position: relative; z-index: 2;
    }
    .v146 .tags { display: flex; gap: 8px; flex-wrap: wrap; }
    .v146 .tag {
      padding: 6px 10px; border-radius: 999px;
      border: 1px solid var(--ring);
      background: hsl(0 0% 100% / 0.08);
      color: var(--ink);
      backdrop-filter: blur(6px);
    }

    /* Reduced motion */
    .v146.rm .grain { animation: none; }
  </style>

  <div class="grain" aria-hidden="true"></div>
  <div class="vignette" aria-hidden="true"></div>

  <div class="wrap">
    <div class="top">
      <div class="mark">
        <span class="chip" aria-hidden="true"></span>
        Edition 146 — Neon Observatory
      </div>
      <div class="pill">Night · Neon · Orbits</div>
    </div>

    <h2 class="title">Kinetic Orrery</h2>
    <p class="sub">Time made circular. Drag the sky; sculpt gravity. Save a slice when it feels right.</p>

    <div class="stage" id="v146-stage">
      <canvas id="v146-canvas" role="img" aria-label="Generative neon planetarium"></canvas>
      <div class="ring" aria-hidden="true"></div>

      <div class="controls" aria-label="Controls">
        <button class="btn primary" id="v146-palette" type="button" aria-label="Cycle palette">Palette: Ion</button>
        <button class="toggle" id="v146-trails" type="button" aria-pressed="true" aria-label="Toggle trails">Trails</button>
        <button class="toggle" id="v146-const" type="button" aria-pressed="false" aria-label="Toggle constellations">Constellations</button>
        <button class="toggle" id="v146-glow" type="button" aria-pressed="true" aria-label="Toggle glow">Glow</button>
        <button class="btn" id="v146-play" type="button" aria-label="Pause animation">Pause</button>
        <button class="btn" id="v146-save" type="button" aria-label="Save image">Save</button>

        <label class="slider" for="v146-speed">
          <span>Speed</span>
          <input id="v146-speed" type="range" min="10" max="300" value="120" />
          <span class="val" id="v146-speed-val">1.0×</span>
        </label>
      </div>
    </div>
  </div>

  <div class="foot">
    <div class="tags" role="list" aria-label="design notes">
      <span class="tag" role="listitem">Dark mode</span>
      <span class="tag" role="listitem">Orrery physics</span>
      <span class="tag" role="listitem">Save as PNG</span>
    </div>
    <small><span id="last-updated">Last updated: 2025-10-23 08:38:07 EST</span></small>
  </div>

  <script>
    (function () {
      const root = document.currentScript.closest('.v146');
      const stage = root.querySelector('#v146-stage');
      const canvas = root.querySelector('#v146-canvas');
      const ctx = canvas.getContext('2d');
      const updated = root.querySelector('#last-updated');

      // Last updated timestamp
      try {
        const fmt = new Intl.DateTimeFormat([], { dateStyle: 'medium', timeStyle: 'short' });
        updated.textContent = 'Updated ' + fmt.format(new Date());
      } catch { updated.textContent = 'Updated ' + new Date().toLocaleString(); }

      const reducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (reducedMotion) root.classList.add('rm');

      // Controls
      const paletteBtn = root.querySelector('#v146-palette');
      const trailsBtn = root.querySelector('#v146-trails');
      const constBtn = root.querySelector('#v146-const');
      const glowBtn = root.querySelector('#v146-glow');
      const playBtn = root.querySelector('#v146-play');
      const saveBtn = root.querySelector('#v146-save');
      const speedEl = root.querySelector('#v146-speed');
      const speedVal = root.querySelector('#v146-speed-val');

      // Size and DPR
      let dpr = 1;
      function size() {
        dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
        const rect = stage.getBoundingClientRect();
        canvas.width = Math.floor(rect.width * dpr);
        canvas.height = Math.floor(rect.height * dpr);
        canvas.style.width = rect.width + 'px';
        canvas.style.height = rect.height + 'px';
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        // base clear
        ctx.fillStyle = 'black';
        ctx.fillRect(0, 0, rect.width, rect.height);
      }
      size();
      addEventListener('resize', size);

      // Palettes
      const palettes = [
        { name: 'Ion', ui: ['hsl(189 95% 55%)','hsl(318 90% 66%)'], bodies: ['hsl(189 95% 60%)','hsl(264 90% 65%)','hsl(318 90% 66%)','hsl(42 100% 60%)','hsl(200 95% 55%)'] },
        { name: 'Pulse', ui: ['hsl(165 95% 52%)','hsl(45 95% 58%)'], bodies: ['hsl(165 95% 52%)','hsl(210 90% 55%)','hsl(45 95% 58%)','hsl(300 80% 62%)','hsl(12 90% 60%)'] },
        { name: 'Orbit', ui: ['hsl(205 90% 50%)','hsl(230 80% 60%)'], bodies: ['hsl(210 90% 40%)','hsl(225 80% 55%)','hsl(190 80% 45%)','hsl(230 70% 60%)','hsl(20 85% 58%)'] },
        { name: 'Lumen', ui: ['hsl(345 80% 64%)','hsl(28 90% 60%)'], bodies: ['hsl(345 80% 64%)','hsl(12 90% 60%)','hsl(334 80% 58%)','hsl(28 90% 60%)','hsl(200 95% 62%)'] }
      ];
      let paletteIndex = 0;

      // System
      let planets = [];
      const planetCount = 7;
      const maxTrail = 130;
      let trails = true;
      let showConst = false;
      let glow = true;
      let running = !reducedMotion;
      let speedMult = 1.0;

      // Pointer + tilt
      const pointer = { x: 0.5, y: 0.5, down: false };
      function setPointer(e) {
        const rect = stage.getBoundingClientRect();
        const t = e.touches ? e.touches[0] : e;
        pointer.x = (t.clientX - rect.left) / rect.width;
        pointer.y = (t.clientY - rect.top) / rect.height;
        tilt();
      }
      function tilt() {
        if (reducedMotion) return;
        const dx = (pointer.x - 0.5);
        const dy = (pointer.y - 0.5);
        const rx = dy * -5;
        const ry = dx * 5;
        stage.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
      }
      stage.addEventListener('mousemove', setPointer, { passive: true });
      stage.addEventListener('touchmove', setPointer, { passive: true });
      stage.addEventListener('pointerleave', () => { pointer.x = 0.5; pointer.y = 0.5; tilt(); }, { passive: true });
      stage.addEventListener('pointerdown', () => pointer.down = true);
      stage.addEventListener('pointerup', () => pointer.down = false);

      function flash(el) {
        el.classList.add('primary');
        setTimeout(() => el.classList.remove('primary'), 220);
      }

      function applyPalette(i) {
        const p = palettes[i];
        root.style.setProperty('--accent-a', p.ui[0]);
        root.style.setProperty('--accent-b', p.ui[1]);
        paletteBtn.textContent = 'Palette: ' + p.name;
        // recolor planets
        planets.forEach((pl, idx) => pl.color = p.bodies[idx % p.bodies.length]);
        flash(paletteBtn);
      }

      function makeSystem() {
        const rect = stage.getBoundingClientRect();
        const minDim = Math.min(rect.width, rect.height);
        planets = [];
        for (let i = 0; i < planetCount; i++) {
          const radius = (minDim * 0.08) + i * (minDim * 0.06);
          const size = 2 + (i * 1.1);
          const speed = 0.0005 + i * 0.00022;
          planets.push({
            r: radius,
            size: size,
            ang: Math.random() * Math.PI * 2,
            speed: speed,
            ecc: Math.min(0.5, Math.random() * 0.3),
            trail: [],
            color: palettes[paletteIndex].bodies[i % palettes[paletteIndex].bodies.length]
          });
        }
      }
      makeSystem();

      // Stars
      let stars = [];
      function makeStars() {
        const rect = stage.getBoundingClientRect();
        const count = Math.round(rect.width * rect.height / 8000);
        stars = Array.from({ length: count }, () => ({
          x: Math.random() * rect.width,
          y: Math.random() * rect.height,
          s: Math.random() * 1.5 + 0.5,
          tw: Math.random() * 0.8 + 0.2
        }));
      }
      makeStars();

      // Drawing helpers
      function fadeCanvas() {
        const w = stage.clientWidth, h = stage.clientHeight;
        if (trails) {
          ctx.globalCompositeOperation = 'source-over';
          ctx.fillStyle = 'rgba(8,10,16,0.08)';
          ctx.fillRect(0, 0, w, h);
        } else {
          ctx.clearRect(0, 0, w, h);
          // base gradient background for export
          const cx = w * 0.5, cy = h * 0.45;
          const g = ctx.createRadialGradient(cx, cy, 0, cx, cy, Math.hypot(w, h) * 0.7);
          g.addColorStop(0, 'rgba(40,50,70,0.6)');
          g.addColorStop(1, 'rgba(10,12,18,1)');
          ctx.fillStyle = g;
          ctx.fillRect(0, 0, w, h);
        }
      }

      function drawStars(t) {
        const w = stage.clientWidth, h = stage.clientHeight;
        ctx.save();
        ctx.globalCompositeOperation = 'screen';
        for (let i = 0; i < stars.length; i++) {
          const st = stars[i];
          const tw = 0.4 + 0.6 * Math.sin(t * st.tw + i);
          ctx.fillStyle = `rgba(255,255,255,${0.05 + tw * 0.25})`;
          ctx.fillRect(st.x, st.y, st.s, st.s);
        }
        ctx.restore();
      }

      function drawSystem(now) {
        const w = stage.clientWidth, h = stage.clientHeight;
        const cx = w * 0.5 + (pointer.x - 0.5) * w * 0.12;
        const cy = h * 0.5 + (pointer.y - 0.5) * h * 0.10;

        // Background halo
        const halo = ctx.createRadialGradient(cx, cy, 0, cx, cy, Math.hypot(w, h) * 0.5);
        halo.addColorStop(0, 'rgba(255,255,255,0.06)');
        halo.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.globalCompositeOperation = 'screen';
        ctx.fillStyle = halo;
        ctx.fillRect(0, 0, w, h);

        // Orbits
        ctx.save();
        ctx.globalCompositeOperation = 'lighten';
        ctx.strokeStyle = 'rgba(200,220,255,0.08)';
        for (const p of planets) {
          ctx.beginPath();
          ctx.ellipse(cx, cy, p.r, p.r * (1 - p.ecc), 0, 0, Math.PI * 2);
          ctx.lineWidth = 1;
          ctx.stroke();
        }
        ctx.restore();

        // Motion + trails
        const t = now * 0.001 * speedMult;
        const mx = pointer.x * w, my = pointer.y * h;

        for (let i = 0; i < planets.length; i++) {
          const p = planets[i];
          // gravitational nudge toward pointer when held
          if (pointer.down) {
            const target = Math.atan2(my - cy, mx - cx);
            p.ang += (target - p.ang) * 0.0008 * (i + 1);
          }

          p.ang += p.speed * (0.6 + i * 0.15) * (1 + speedMult * 0.6);
          const rx = p.r, ry = p.r * (1 - p.ecc);
          const px = cx + Math.cos(p.ang + i * 0.03) * rx;
          const py = cy + Math.sin(p.ang + i * 0.03) * ry;

          // trail
          p.trail.push({ x: px, y: py });
          if (p.trail.length > maxTrail) p.trail.shift();

          // draw trail
          ctx.save();
          ctx.globalCompositeOperation = 'screen';
          ctx.strokeStyle = p.color;
          ctx.lineWidth = Math.max(0.6, 0.9 + Math.sin(t + i) * 0.2);
          if (glow) { ctx.shadowColor = p.color; ctx.shadowBlur = 14; }
          ctx.beginPath();
          for (let j = 0; j < p.trail.length; j += 2) {
            const pt = p.trail[j];
            if (j === 0) ctx.moveTo(pt.x, pt.y);
            else ctx.lineTo(pt.x, pt.y);
          }
          ctx.stroke();
          ctx.restore();

          // draw planet
          ctx.save();
          ctx.globalCompositeOperation = 'screen';
          if (glow) { ctx.shadowColor = p.color; ctx.shadowBlur = 22 + i * 2; }
          const g = ctx.createRadialGradient(px, py, 0, px, py, p.size * 2.2);
          g.addColorStop(0, p.color);
          g.addColorStop(1, 'rgba(255,255,255,0)');
          ctx.fillStyle = g;
          ctx.beginPath();
          ctx.arc(px, py, p.size, 0, Math.PI * 2);
          ctx.fill();
          ctx.restore();
        }

        // Constellations between moving bodies
        if (showConst) {
          ctx.save();
          ctx.globalCompositeOperation = 'screen';
          ctx.lineWidth = 0.8;
          ctx.strokeStyle = 'rgba(200,220,255,0.15)';
          for (let i = 0; i < planets.length - 1; i++) {
            const a = planets[i].trail[planets[i].trail.length - 1];
            const b = planets[i + 1].trail[planets[i + 1].trail.length - 1];
            if (!a || !b) continue;
            ctx.beginPath();
            ctx.moveTo(a.x, a.y);
            ctx.lineTo(b.x, b.y);
            ctx.stroke();
          }
          // trigonal loop
          const a = planets[0].trail[planets[0].trail.length - 1];
          const z = planets[planets.length - 1].trail[planets[planets.length - 1].trail.length - 1];
          if (a && z) {
            ctx.beginPath(); ctx.moveTo(a.x, a.y); ctx.lineTo(z.x, z.y); ctx.stroke();
          }
          ctx.restore();
        }
      }

      // Shooting stars
      const meteors = [];
      function spawnMeteor() {
        const w = stage.clientWidth, h = stage.clientHeight;
        const fromTop = Math.random() < 0.5;
        const x = Math.random() * w;
        const y = fromTop ? -20 : h + 20;
        const dx = (Math.random() - 0.5) * 0.6;
        const dy = fromTop ? 1 : -1;
        meteors.push({ x, y, vx: (2 + Math.random() * 2) * dx, vy: (2 + Math.random() * 2) * dy, life: 1 });
        if (meteors.length > 12) meteors.shift();
      }
      setInterval(spawnMeteor, 3000);

      function drawMeteors() {
        ctx.save();
        ctx.globalCompositeOperation = 'screen';
        for (let i = meteors.length - 1; i >= 0; i--) {
          const m = meteors[i];
          m.x += m.vx * 4;
          m.y += m.vy * 4;
          m.life *= 0.985;
          if (m.life < 0.02) { meteors.splice(i, 1); continue; }
          ctx.strokeStyle = `rgba(255,255,255,${0.3 * m.life})`;
          ctx.lineWidth = 1.2;
          ctx.beginPath();
          ctx.moveTo(m.x, m.y);
          ctx.lineTo(m.x - m.vx * 24, m.y - m.vy * 24);
          ctx.stroke();
        }
        ctx.restore();
      }

      // Animation loop
      let last = performance.now();
      function tick(now) {
        if (!running) return;
        const dt = Math.min(50, now - last) / 1000;
        last = now;
        fadeCanvas();
        drawStars(now * 0.001);
        drawSystem(now);
        drawMeteors();
        if (!reducedMotion) requestAnimationFrame(tick);
      }

      // UI behavior
      function setSpeed(v) {
        const mult = Math.max(0.3, Math.min(2.4, Math.round((v / 100) * 10) / 10));
        speedMult = mult;
        root.style.setProperty('--tempo', String(mult));
        speedVal.textContent = mult.toFixed(1) + '×';
      }
      setSpeed(Number(speedEl.value));
      speedEl.addEventListener('input', (e) => setSpeed(Number(e.target.value)));

      trailsBtn.addEventListener('click', () => {
        trails = !trails;
        trailsBtn.setAttribute('aria-pressed', trails ? 'true' : 'false');
        flash(trailsBtn);
      });

      constBtn.addEventListener('click', () => {
        showConst = !showConst;
        constBtn.setAttribute('aria-pressed', showConst ? 'true' : 'false');
        flash(constBtn);
      });

      glowBtn.addEventListener('click', () => {
        glow = !glow;
        glowBtn.setAttribute('aria-pressed', glow ? 'true' : 'false');
        flash(glowBtn);
      });

      playBtn.addEventListener('click', () => {
        running = !running;
        playBtn.textContent = running ? 'Pause' : 'Play';
        flash(playBtn);
        if (running && !reducedMotion) requestAnimationFrame((t) => { last = t; tick(t); });
      });

      saveBtn.addEventListener('click', () => {
        try {
          const link = document.createElement('a');
          link.download = 'neon-observatory.png';
          link.href = canvas.toDataURL('image/png');
          link.click();
          flash(saveBtn);
        } catch {}
      });

      paletteBtn.addEventListener('click', () => {
        paletteIndex = (paletteIndex + 1) % palettes.length;
        applyPalette(paletteIndex);
      });

      // Rebuild on resize for consistent scale
      addEventListener('resize', () => { makeSystem(); makeStars(); });

      // Keyboard shortcuts
      root.addEventListener('keydown', (e) => {
        const k = e.key.toLowerCase();
        if (k === ' ') { e.preventDefault(); playBtn.click(); }
        if (k === 't') trailsBtn.click();
        if (k === 'c') constBtn.click();
        if (k === 'g') glowBtn.click();
        if (k === 'p') paletteBtn.click();
        if (k === 's') saveBtn.click();
      });

      // Start
      applyPalette(paletteIndex);
      if (!reducedMotion) requestAnimationFrame((t) => { last = t; tick(t); });
      else {
        // Static snapshot
        fadeCanvas();
        drawStars(0.8);
        drawSystem(performance.now());
      }
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


