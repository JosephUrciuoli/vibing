<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="vibe2326" role="region" aria-label="Aeolian Studio — living ribbons" data-scheme="light">
  <style>
    /* Design tokens */
    #vibe2326{
      --h: 280;
      --ink: #0f1524;
      --muted: #5a647a;
      --line: color-mix(in oklab, var(--ink) 12%, transparent);
      --bg0: #f7faff;
      --bg1: #edf3ff;
      --panel: rgba(255,255,255,.65);
      --ring: color-mix(in oklab, hsl(var(--h) 80% 55%) 40%, transparent);
      color-scheme: light;
      color: var(--ink);
      font: 600 14px/1.55 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      border-radius: 28px;
      padding: clamp(20px, 4vw, 36px);
      background:
        radial-gradient(120% 120% at 0% 0%, hsl(calc(var(--h) + 40) 85% 92% / .8), transparent 60%),
        radial-gradient(120% 120% at 100% 100%, hsl(calc(var(--h) - 40) 85% 92% / .8), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9), 0 40px 120px rgba(14,24,45,.12);
      position: relative;
      overflow: hidden;
      isolation: isolate;
    }
    #vibe2326[data-scheme="dark"]{
      --ink: #ebf1ff;
      --muted: #97a2b8;
      --bg0: #0a0f18;
      --bg1: #0f1726;
      --panel: rgba(10,14,24,.55);
      --line: color-mix(in oklab, var(--ink) 16%, transparent);
      color-scheme: dark;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 60px 180px rgba(0,0,0,.6);
    }

    /* Ambient veils + grain */
    #vibe2326::before, #vibe2326::after{
      content:""; position:absolute; inset:-35%;
      pointer-events: none; mix-blend-mode: soft-light;
    }
    #vibe2326::before{
      background:
        conic-gradient(from 120deg at 60% 40%, color-mix(in oklab, hsl(var(--h) 80% 60%) 18%, transparent), transparent 25% 75%, color-mix(in oklab, hsl(calc(var(--h)+120) 80% 60%) 18%, transparent)),
        radial-gradient(60% 50% at 70% 70%, color-mix(in oklab, hsl(var(--h) 80% 60%) 22%, transparent), transparent 60%);
      filter: blur(18px) saturate(1.05);
      opacity: .55;
      animation: a26-sway1 60s ease-in-out infinite;
    }
    #vibe2326::after{
      background: repeating-conic-gradient(from 0deg, rgba(255,255,255,.018) 0 6deg, transparent 6deg 12deg);
      mix-blend-mode: overlay;
      opacity:.8;
      animation: a26-sway2 90s ease-in-out infinite;
    }
    @keyframes a26-sway1{ 50%{ transform: translate3d(1.2%,-1.4%,0) rotate(.8deg) scale(1.02); } }
    @keyframes a26-sway2{ 50%{ transform: translate3d(-1.0%,1.0%,0) rotate(-.6deg) scale(1.01); } }

    /* Header */
    #vibe2326 .top{
      display:grid; grid-template-columns: 1fr auto; gap: 14px; align-items:center;
      margin-bottom: clamp(14px, 3vw, 26px);
    }
    #vibe2326 .brand{ display:grid; grid-template-columns:auto 1fr; gap:12px; align-items:center; }
    #vibe2326 .logo{
      width:42px; height:42px; border-radius:14px; position:relative; overflow:hidden;
      background:
        radial-gradient(120% 120% at 30% 30%, #fff, rgba(255,255,255,0.3) 40%, transparent 60%),
        conic-gradient(from 0deg, hsl(var(--h) 80% 60%), hsl(calc(var(--h)+80) 80% 60%), hsl(calc(var(--h)+160) 80% 60%), hsl(calc(var(--h)+240) 80% 60%), hsl(var(--h) 80% 60%));
      box-shadow: inset 0 1px 10px rgba(255,255,255,.6), 0 10px 24px rgba(0,0,0,.12);
      animation: a26-spin 10s linear infinite;
    }
    @keyframes a26-spin{ to{ transform: rotate(360deg); } }
    #vibe2326 h1{ margin:0; font-size: clamp(18px, 2.4vw, 24px); letter-spacing:.28em; text-transform:uppercase; color:var(--muted); }
    #vibe2326 .tag{ margin:0; grid-column: 1 / -1; font-weight:900; letter-spacing:-.02em; color: color-mix(in oklab, var(--ink) 74%, transparent); font-size: clamp(28px, 6vw, 60px); }

    /* Buttons */
    #vibe2326 .actions{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-self:end; }
    #vibe2326 .btn{
      appearance:none; border:1px solid var(--line); border-radius:999px; padding:9px 14px; cursor:pointer;
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.55));
      color:var(--ink); font-weight:800; letter-spacing:.02em;
      box-shadow: 0 10px 18px rgba(0,0,0,0.08);
      transition: transform .14s ease, filter .18s ease, box-shadow .18s ease, background .18s ease;
    }
    #vibe2326[data-scheme="dark"] .btn{
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      box-shadow: 0 10px 18px rgba(0,0,0,0.25);
    }
    #vibe2326 .btn:hover{ transform: translateY(-1px); filter: brightness(1.06); }
    #vibe2326 .btn:active{ transform: translateY(0); filter: brightness(.98); }
    #vibe2326 .btn.primary{
      border:none; color:#fff; text-shadow:0 1px 0 rgba(0,0,0,0.25);
      background: linear-gradient(90deg, hsl(var(--h) 85% 55%), hsl(calc(var(--h) + 90) 85% 60%));
      box-shadow: 0 16px 30px rgba(47,108,255,.22);
    }

    /* Stage */
    #vibe2326 .stage{
      position:relative; display:grid; grid-template-rows: 1fr auto; gap: clamp(14px, 3vw, 22px);
      border-radius: clamp(22px, 3vw, 30px);
      min-height: clamp(560px, 66vh, 900px);
      border: 1px solid var(--line);
      background:
        radial-gradient(60% 40% at 50% 0%, color-mix(in oklab, var(--bg1) 65%, transparent), transparent 65%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), 0 24px 70px rgba(0,0,0,.12);
      overflow:hidden;
    }
    #vibe2326 .viewport{
      position:relative; width:100%; aspect-ratio: 16/9; margin:auto; display:grid; place-items:center;
      border-radius: clamp(20px,3vw,26px);
      background: radial-gradient(120% 120% at 50% 20%, rgba(255,255,255,0.7), transparent 55%);
      box-shadow: 0 30px 60px rgba(0,0,0,.15);
      border: 1px solid var(--line);
      overflow:hidden; cursor: crosshair;
    }
    #vibe2326[data-scheme="dark"] .viewport{
      background: radial-gradient(120% 120% at 50% 20%, rgba(255,255,255,0.08), transparent 55%);
      box-shadow: 0 30px 60px rgba(0,0,0,.25);
    }
    #vibe2326 canvas.flow{ position:absolute; inset:0; width:100%; height:100%; display:block; }
    #vibe2326 .ring{
      position:absolute; inset:3%; pointer-events:none; border-radius: clamp(18px,2.6vw,24px);
      border: 1px solid color-mix(in oklab, var(--ink) 16%, transparent);
      box-shadow: 0 0 0 1px rgba(255,255,255,.35) inset, 0 14px 40px rgba(0,0,0,.08) inset, 0 0 50px var(--ring);
    }
    #vibe2326 .readout{
      position:absolute; inset:0; display:grid; place-items:center; pointer-events:none; text-align:center;
    }
    #vibe2326 .readout h2{
      margin:0; font-weight:900; letter-spacing:-.02em; text-transform: lowercase;
      font-size: clamp(46px, 9vw, 120px);
      background: linear-gradient(120deg, hsl(var(--h) 85% 55%), hsl(calc(var(--h) + 90) 85% 60%));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter: drop-shadow(0 1px 0 rgba(255,255,255,.25));
    }
    #vibe2326 .readout p{ margin:.5em 0 0; font-size:13px; color:var(--muted); }

    /* Controls */
    #vibe2326 .panel{
      position:relative; z-index:3; display:grid; gap:14px; width: min(1000px, 100%); justify-self:center;
      padding: clamp(12px,2vw,16px);
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 18px;
      box-shadow: 0 18px 50px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.2);
      backdrop-filter: blur(14px) saturate(1.08);
    }
    #vibe2326 .grid{ display:grid; grid-template-columns: repeat(5, minmax(0,1fr)); gap:10px; }
    @media (max-width:960px){ #vibe2326 .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); } }
    @media (max-width:560px){ #vibe2326 .grid{ grid-template-columns: 1fr 1fr; } }
    @media (max-width:420px){ #vibe2326 .grid{ grid-template-columns: 1fr; } }
    #vibe2326 label{ display:grid; gap:6px; font-size:11px; color:var(--muted); letter-spacing:.08em; text-transform:uppercase; }
    #vibe2326 input[type="range"]{
      -webkit-appearance:none; appearance:none; width:100%; height:12px;
      border-radius:999px; border:1px solid var(--line);
      background:
        linear-gradient(90deg, hsl(var(--h) 85% 55%), hsl(calc(var(--h)+90) 85% 60%)) left/var(--pct,50%) 100% no-repeat,
        rgba(0,0,0,.06);
      box-shadow: inset 0 2px 6px rgba(0,0,0,.08);
      outline:none;
    }
    #vibe2326[data-scheme="dark"] input[type="range"]{
      background:
        linear-gradient(90deg, hsl(var(--h) 85% 55%), hsl(calc(var(--h)+90) 85% 60%)) left/var(--pct,50%) 100% no-repeat,
        rgba(255,255,255,.08);
      box-shadow: inset 0 2px 6px rgba(0,0,0,.18);
    }
    #vibe2326 input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none; appearance:none; width:18px; height:18px; border-radius:50%;
      background: radial-gradient(circle at 35% 35%, #fff, #e6edf7);
      border:1px solid var(--line); box-shadow:0 6px 12px rgba(0,0,0,.18); cursor:pointer;
    }
    #vibe2326 input[type="range"]::-moz-range-thumb{
      width:18px; height:18px; border-radius:50%;
      background: radial-gradient(circle at 35% 35%, #fff, #e6edf7);
      border:1px solid var(--line); box-shadow:0 6px 12px rgba(0,0,0,.18); cursor:pointer;
    }

    #vibe2326 .row{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    #vibe2326 .chip{
      appearance:none; border:1px solid var(--line); border-radius:999px; padding:8px 12px; cursor:pointer;
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.6));
      color:var(--ink); font-weight:800; letter-spacing:.02em;
      box-shadow: 0 8px 16px rgba(0,0,0,0.12);
      transition: transform .14s ease, background .18s ease, box-shadow .18s ease;
    }
    #vibe2326[data-scheme="dark"] .chip{
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      box-shadow: 0 8px 16px rgba(0,0,0,0.25);
    }
    #vibe2326 .chip[aria-pressed="true"]{
      border-color: transparent;
      background: linear-gradient(90deg, hsl(var(--h) 85% 55%), hsl(calc(var(--h)+90) 85% 60%));
      color:#fff; text-shadow:0 1px 0 rgba(0,0,0,0.25);
      box-shadow: 0 14px 24px rgba(47,108,255,.22);
    }
    #vibe2326 .meta{ display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap; font-size:12px; color:var(--muted); }

    /* Focus & motion */
    #vibe2326 .btn:focus, #vibe2326 .chip:focus, #vibe2326 input:focus{ outline: 2px solid hsl(var(--h) 85% 60%); outline-offset: 2px; }
    @media (prefers-reduced-motion: reduce){
      #vibe2326 *, #vibe2326::before, #vibe2326::after{ animation:none !important; transition:none !important; }
    }
  </style>

  <div class="top" aria-label="Header">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <h1>Aeolian Studio</h1>
      <p class="tag" id="tag26">draw wind. weave color.</p>
    </div>
    <div class="actions">
      <button class="btn" id="theme26" type="button" aria-pressed="false" title="Toggle theme">Dark</button>
      <button class="btn primary" id="snap26" type="button" title="Save artwork">Capture</button>
      <button class="btn" id="reset26" type="button" title="Reset">Reset</button>
    </div>
  </div>

  <section class="stage" aria-label="Ribbon canvas. Drag to blow wind. Space to pause. T for theme.">
    <div class="viewport" id="view26">
      <canvas class="flow" id="flow26"></canvas>
      <div class="ring" aria-hidden="true"></div>
      <div class="readout" aria-live="polite">
        <h2 id="title26">zephyr</h2>
        <p id="sub26">drag to blow | S to save</p>
      </div>
    </div>

    <aside class="panel" aria-label="Controls">
      <div class="grid">
        <label for="ribbons26">Ribbons
          <input id="ribbons26" type="range" min="3" max="90" step="1" value="26" aria-valuemin="3" aria-valuemax="90" aria-valuenow="26">
        </label>
        <label for="wind26">Wind
          <input id="wind26" type="range" min="0" max="300" step="1" value="120" aria-valuemin="0" aria-valuemax="300" aria-valuenow="120">
        </label>
        <label for="curl26">Curl
          <input id="curl26" type="range" min="0" max="200" step="1" value="70" aria-valuemin="0" aria-valuemax="200" aria-valuenow="70">
        </label>
        <label for="fade26">Trail
          <input id="fade26" type="range" min="0" max="100" step="1" value="72" aria-valuemin="0" aria-valuemax="100" aria-valuenow="72">
        </label>
        <label for="hue26">Hue
          <input id="hue26" type="range" min="0" max="360" step="1" value="280" aria-valuemin="0" aria-valuemax="360" aria-valuenow="280">
        </label>
      </div>
      <div class="row">
        <button class="chip" id="auto26" type="button" aria-pressed="true" title="Auto wind">Auto</button>
        <button class="chip" id="glow26" type="button" aria-pressed="true" title="Bloom glow">Glow</button>
        <button class="chip" id="blend26" type="button" aria-pressed="true" title="Luminous blend">Lume</button>
        <button class="chip" id="pause26" type="button" aria-pressed="false" title="Pause animation">Pause</button>
      </div>
      <div class="meta" role="contentinfo">
        <span class="hint">Tip: Letters Z/X adjust wind. Press T for theme.</span>
        <span id="last-updated">Last updated: 2026-02-01 02:35:39 EST</span>
      </div>
    </aside>
  </section>

  <script>
  (function(){
    const root = document.getElementById('vibe2326');
    const canvas = document.getElementById('flow26');
    const ctx = canvas.getContext('2d', { alpha: true, desynchronized: true });
    const view = document.getElementById('view26');

    const themeBtn = document.getElementById('theme26');
    const snapBtn = document.getElementById('snap26');
    const resetBtn = document.getElementById('reset26');

    const ribbonsEl = document.getElementById('ribbons26');
    const windEl = document.getElementById('wind26');
    const curlEl = document.getElementById('curl26');
    const fadeEl = document.getElementById('fade26');
    const hueEl = document.getElementById('hue26');

    const autoBtn = document.getElementById('auto26');
    const glowBtn = document.getElementById('glow26');
    const blendBtn = document.getElementById('blend26');
    const pauseBtn = document.getElementById('pause26');

    const title = document.getElementById('title26');
    const tag = document.getElementById('tag26');
    const updated = document.getElementById('last-updated');

    function fmt(d){
      try{
        return new Intl.DateTimeFormat(undefined,{
          year:'numeric', month:'short', day:'2-digit',
          hour:'2-digit', minute:'2-digit', second:'2-digit'
        }).format(d);
      }catch{ return d.toLocaleString(); }
    }
    updated.textContent = 'Last updated: ' + fmt(new Date());

    /* Hue token */
    function setHue(h){ root.style.setProperty('--h', String(h)); }

    /* Range fill */
    function fillRange(el){
      const min = +el.min, max = +el.max, val = +el.value;
      const pct = ((val - min) / (max - min)) * 100;
      el.style.setProperty('--pct', pct + '%');
      el.setAttribute('aria-valuenow', String(val));
    }
    [ribbonsEl, windEl, curlEl, fadeEl, hueEl].forEach(r => { fillRange(r); r.addEventListener('input', ()=>fillRange(r)); });

    /* Theme toggle */
    function toggleTheme(){
      const light = root.getAttribute('data-scheme') === 'light';
      root.setAttribute('data-scheme', light ? 'dark' : 'light');
      themeBtn.textContent = light ? 'Light' : 'Dark';
      themeBtn.setAttribute('aria-pressed', (!light).toString());
      hardClear();
    }
    themeBtn.addEventListener('click', toggleTheme);

    /* Mood words */
    const moods = ['zephyr','silk','lilt','ripple','tress','swirl','purl','gauze','wave','drift'];
    function setMood(){
      const h = (+hueEl.value)%360;
      const ix = Math.round((h/360) * (moods.length-1));
      title.textContent = moods[ix] || 'zephyr';
      tag.textContent = 'aeolian studio — ' + (moods[ix] || 'weave color');
    }
    setHue(hueEl.value); setMood();
    hueEl.addEventListener('input', ()=>{ setHue(hueEl.value); setMood(); });

    /* Size & DPR */
    let dpr = Math.min(3, window.devicePixelRatio || 1);
    function size(){
      const r = canvas.getBoundingClientRect();
      canvas.width = Math.max(1, Math.floor(r.width * dpr));
      canvas.height = Math.max(1, Math.floor(r.height * dpr));
      ctx.setTransform(1,0,0,1,0,0);
      ctx.scale(dpr, dpr);
      hardClear();
      seed();
    }
    const ro = new ResizeObserver(size);
    ro.observe(view);
    addEventListener('resize', ()=>{ clearTimeout(resizeT); resizeT=setTimeout(size, 80); });
    let resizeT=0;

    /* Canvas helpers */
    function bgColor(alpha=1){
      return root.getAttribute('data-scheme')==='dark'
        ? `rgba(10,15,24,${alpha})`
        : `rgba(247,250,255,${alpha})`;
    }
    function hardClear(){
      const r = canvas.getBoundingClientRect();
      ctx.globalCompositeOperation='source-over';
      ctx.fillStyle = bgColor(1);
      ctx.fillRect(0,0,r.width,r.height);
    }
    function fade(){
      const r = canvas.getBoundingClientRect();
      const a = 1 - (+fadeEl.value/100);
      ctx.globalCompositeOperation='source-over';
      ctx.fillStyle = bgColor(a*0.18);
      ctx.fillRect(0,0,r.width,r.height);
    }

    /* Field + ribbons */
    const focus = { x:0.5, y:0.5, active:false };
    let dragging=false;
    view.addEventListener('pointerdown', (e)=>{ dragging=true; view.setPointerCapture(e.pointerId); setFocus(e); });
    view.addEventListener('pointermove', (e)=>{ if(dragging){ setFocus(e); }});
    view.addEventListener('pointerup', (e)=>{ dragging=false; view.releasePointerCapture(e.pointerId); focus.active=false; });
    function setFocus(e){
      const r = view.getBoundingClientRect();
      focus.x = (e.clientX - r.left) / r.width;
      focus.y = (e.clientY - r.top) / r.height;
      focus.active = true;
      auto = false; autoBtn.setAttribute('aria-pressed','false');
    }

    let auto = true, glow = true, blend = true, paused = false;
    autoBtn.addEventListener('click', ()=>{ auto=!auto; autoBtn.setAttribute('aria-pressed', String(auto)); });
    glowBtn.addEventListener('click', ()=>{ glow=!glow; glowBtn.setAttribute('aria-pressed', String(glow)); });
    blendBtn.addEventListener('click', ()=>{ blend=!blend; blendBtn.setAttribute('aria-pressed', String(blend)); });

    pauseBtn.addEventListener('click', ()=>{
      paused=!paused; pauseBtn.setAttribute('aria-pressed', String(paused));
      pauseBtn.textContent = paused ? 'Resume' : 'Pause';
      if(!paused){ prev = performance.now(); rafId = requestAnimationFrame(frame); }
    });

    resetBtn.addEventListener('click', ()=>{
      ribbonsEl.value='26'; windEl.value='120'; curlEl.value='70'; fadeEl.value='72'; hueEl.value='280';
      [ribbonsEl, windEl, curlEl, fadeEl, hueEl].forEach(fillRange);
      setHue(hueEl.value); setMood();
      auto=true; glow=true; blend=true; paused=false;
      autoBtn.setAttribute('aria-pressed','true');
      glowBtn.setAttribute('aria-pressed','true');
      blendBtn.setAttribute('aria-pressed','true');
      pauseBtn.textContent='Pause'; pauseBtn.setAttribute('aria-pressed','false');
      seed();
      hardClear();
    });

    /* Keys */
    root.addEventListener('keydown', (e)=>{
      if(e.code==='Space'){ e.preventDefault(); pauseBtn.click(); }
      if(e.key?.toLowerCase()==='t'){ e.preventDefault(); themeBtn.click(); }
      if(e.key?.toLowerCase()==='s'){ e.preventDefault(); snapBtn.click(); }
      if(e.key?.toLowerCase()==='z'){ e.preventDefault(); windEl.value = Math.max(+windEl.min, +windEl.value - 10); fillRange(windEl); }
      if(e.key?.toLowerCase()==='x'){ e.preventDefault(); windEl.value = Math.min(+windEl.max, +windEl.value + 10); fillRange(windEl); }
    });

    /* Capture */
    snapBtn.addEventListener('click', ()=>{
      try{
        const a = document.createElement('a');
        a.download = `ribbons-${new Date().toISOString().replace(/[:.]/g,'-')}.png`;
        a.href = canvas.toDataURL('image/png');
        a.click();
      }catch(e){}
    });

    /* Ribbon system */
    let ribbons = [];
    function seed(){
      const N = +ribbonsEl.value;
      ribbons.length = 0;
      const r = canvas.getBoundingClientRect();
      for(let i=0;i<N;i++){
        const len = 50 + Math.floor(Math.random()*40);
        const pts = [];
        const x0 = Math.random()*r.width;
        const y0 = Math.random()*r.height;
        for(let j=0;j<len;j++){ pts.push({x:x0, y:y0}); }
        ribbons.push({
          pts, hue: ((+hueEl.value) + (i/N)*180 + Math.random()*30)%360,
          w: 0.8 + Math.random()*2.6
        });
      }
    }

    function fieldVec(x,y,t){
      const curl = +curlEl.value / 200; // 0..1
      const sc = 0.0025 + curl*0.004;
      const nx = x*sc, ny = y*sc;
      let a = Math.sin(nx*1.7 + t*0.00055) + Math.cos(ny*1.3 - t*0.0007) + Math.sin((nx+ny)*0.6 + t*0.0003);
      // swirl around focus/auto locus
      const r = canvas.getBoundingClientRect();
      const fx = r.width * (auto ? 0.5 + Math.sin(t*0.00012)*0.08 : focus.x);
      const fy = r.height * (auto ? 0.5 + Math.cos(t*0.0001)*0.06 : focus.y);
      const dx = x - fx, dy = y - fy;
      const swirl = Math.atan2(dy, dx) + Math.PI/2;
      const dist = Math.hypot(dx,dy);
      const w = Math.min(1, (auto?0.6:1) * (1/(1+dist*0.002))) * (0.4 + curl*0.6);
      a = a*(1-w) + swirl*w;
      return {x: Math.cos(a), y: Math.sin(a)};
    }

    function draw(t, dt){
      const r = canvas.getBoundingClientRect();
      // fade trails
      fade();

      if(blend){
        ctx.globalCompositeOperation = 'lighter';
      }else{
        ctx.globalCompositeOperation = 'source-over';
      }

      const speed = (+windEl.value)/60; // scale
      for(let i=0;i<ribbons.length;i++){
        const rb = ribbons[i];
        const pts = rb.pts;
        // update head
        const h = pts[0];
        const v = fieldVec(h.x, h.y, t);
        h.x += v.x * speed * (dt*0.06);
        h.y += v.y * speed * (dt*0.06);

        // wrap
        if(h.x < -20) h.x = r.width+20;
        if(h.x > r.width+20) h.x = -20;
        if(h.y < -20) h.y = r.height+20;
        if(h.y > r.height+20) h.y = -20;

        // follow
        for(let k=pts.length-1;k>0;k--){
          const p = pts[k], q = pts[k-1];
          p.x += (q.x - p.x)*0.35;
          p.y += (q.y - p.y)*0.35;
        }

        // draw
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        const baseHue = rb.hue;
        const L = pts.length;
        if(glow){
          ctx.shadowColor = `hsla(${baseHue}, 90%, 60%, .6)`;
          ctx.shadowBlur = 18;
        }else{
          ctx.shadowBlur = 0;
        }

        // segmented color flow
        for(let s=2; s<L; s+=3){
          const p0 = pts[s-2], p1 = pts[s-1], p2 = pts[s];
          if(!p0 || !p1 || !p2) continue;
          const prog = s / L;
          const hue = (baseHue + prog*60) % 360;
          const alpha = 0.14 + prog*0.6;
          ctx.strokeStyle = `hsla(${hue}, 90%, 55%, ${alpha})`;
          ctx.lineWidth = rb.w + prog*3.2;
          ctx.beginPath();
          ctx.moveTo(p0.x, p0.y);
          ctx.lineTo(p1.x, p1.y);
          ctx.lineTo(p2.x, p2.y);
          ctx.stroke();
        }
      }
      ctx.shadowBlur = 0;
    }

    /* Loop */
    let prev = performance.now();
    let rafId = 0;
    function frame(now){
      const dt = Math.min(50, now - prev);
      prev = now;

      // gentle hue drift
      const h = (parseFloat(getComputedStyle(root).getPropertyValue('--h')) || 280) + dt*0.0025*(auto?1:0.5);
      setHue((h+360)%360);

      draw(now, dt);
      if(!paused) rafId = requestAnimationFrame(frame);
    }

    /* Reduced motion & visibility */
    const media = matchMedia('(prefers-reduced-motion: reduce)');
    media.addEventListener?.('change', ()=>{
      if(media.matches){ cancelAnimationFrame(rafId); }
      else if(!paused){ prev = performance.now(); rafId = requestAnimationFrame(frame); }
    });
    document.addEventListener('visibilitychange', ()=>{
      if(document.hidden) cancelAnimationFrame(rafId);
      else if(!paused) rafId = requestAnimationFrame(frame);
    });

    /* Init */
    function init(){
      size();
      seed();
      hardClear();
      paused = false;
      pauseBtn.textContent = 'Pause';
      prev = performance.now();
      rafId = requestAnimationFrame(frame);
    }
    init();
  })();
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


