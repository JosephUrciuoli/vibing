<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="vibe1254" role="region" aria-label="NEBULA FUGUE 1254 — Kinetic Gradient Tapestry">
  <style>
    .vibe1254{
      --ink:#0e1424;
      --muted:#6a7798;
      --edge:#dce6ff;
      --bg0:#f6f9ff;
      --bg1:#eef3ff;
      --glass: rgba(255,255,255,.55);
      --a:#7af0dd; --b:#8ea4ff; --c:#ff9ac5; --d:#ffd094; --e:#75d2ff;
      --glow: 0 80px 160px rgba(10, 20, 50, .18);
      color-scheme: light;
      position: relative; isolation:isolate; overflow:hidden;
      border:1px solid var(--edge); border-radius:28px;
      padding: clamp(18px, 4.6vw, 56px);
      background:
        radial-gradient(120% 100% at 110% -10%, #e4efff7a 0 40%, transparent 60%),
        radial-gradient(120% 100% at -10% 110%, #efe5ff66 0 40%, transparent 65%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      box-shadow: var(--glow), inset 0 1px 0 rgba(255,255,255,.85);
    }
    .vibe1254[data-theme="night"]{
      --ink:#eaf1ff; --muted:#9bb0d9; --edge:#1c2a4a;
      --bg0:#070b1a; --bg1:#0b1328;
      --glass: rgba(15,20,40,.55);
      --glow: 0 100px 220px rgba(0,0,0,.55);
      color-scheme: dark;
      box-shadow: var(--glow), inset 0 1px 0 rgba(255,255,255,.08);
    }
    .vibe1254::before{
      content:"";
      position:absolute; inset:-30%;
      background: conic-gradient(from 120deg,
        color-mix(in oklab, var(--a), transparent 82%) 0 20%,
        color-mix(in oklab, var(--b), transparent 82%) 20% 40%,
        color-mix(in oklab, var(--d), transparent 82%) 40% 60%,
        color-mix(in oklab, var(--e), transparent 82%) 60% 80%,
        color-mix(in oklab, var(--c), transparent 82%) 80% 100%);
      filter: blur(120px) saturate(1.06);
      opacity:.28; pointer-events:none;
    }
    .vibe1254::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(900px 600px at var(--mx,60%) var(--my,30%), rgba(140,180,255,.22), transparent 60%),
        radial-gradient(1200px 800px at 10% 120%, rgba(255,255,255,.18), transparent 60%);
      mix-blend-mode:soft-light; opacity:.24; pointer-events:none;
      mask: radial-gradient(100% 80% at 50% 8%, #000 42%, transparent 100%);
    }

    /* Top bar */
    .vibe1254 .bar{
      display:grid; grid-template-columns:auto minmax(0,1fr) auto; gap:16px; align-items:center;
      padding:12px 14px; border-radius:18px; border:1px solid var(--edge);
      background: linear-gradient(180deg, var(--glass), transparent);
      backdrop-filter: blur(16px) saturate(1.06);
      box-shadow: 0 24px 60px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.55);
      position:relative; z-index:4;
    }
    .vibe1254 .glyph{
      --s:58px; width:var(--s); height:var(--s); border-radius:14px; display:grid; place-items:center;
      border:1px solid var(--edge);
      background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.45));
      box-shadow: inset 0 10px 22px rgba(255,255,255,.6), 0 10px 26px rgba(0,0,0,.12);
    }
    .vibe1254[data-theme="night"] .glyph{
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      box-shadow: inset 0 10px 22px rgba(255,255,255,.12), 0 10px 26px rgba(0,0,0,.3);
    }
    .vibe1254 .glyph svg{ width:70%; height:70%; display:block; }

    .vibe1254 .title{
      font-family: ui-serif, "SF Pro Display", Georgia, serif;
      font-weight:900; letter-spacing:.003em; line-height:.94; margin:0;
      font-size: clamp(22px, 5vw, 54px);
      background: linear-gradient(95deg, var(--ink), color-mix(in oklab, var(--b), var(--ink) 46%) 60%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter: drop-shadow(0 16px 42px rgba(180,205,255,.18));
      background-size:200% 100%; animation: titleShift1254 12s linear infinite;
    }
    .vibe1254 .sub{
      color:var(--muted); font-weight:800; font-size:11px; letter-spacing:.18em; text-transform:uppercase;
      margin-top:4px;
    }
    @keyframes titleShift1254{ 0%{background-position:0 0} 100%{background-position:200% 0} }
    .vibe1254 .controls{ display:flex; gap:8px; align-items:center; justify-content:flex-end; flex-wrap:wrap; }
    .vibe1254 .btn{
      appearance:none; cursor:pointer; user-select:none;
      padding:10px 12px; font-size:12px; font-weight:800; letter-spacing:.04em;
      color: var(--ink); border-radius:999px; border:1px solid var(--edge);
      background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.40));
      box-shadow: 0 12px 28px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.58);
      transition: transform .14s ease, box-shadow .22s ease, background .22s ease, opacity .2s ease, outline-color .2s ease;
    }
    .vibe1254[data-theme="night"] .btn{
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      color: var(--ink);
      box-shadow: 0 12px 28px rgba(0,0,0,.28), inset 0 1px 0 rgba(255,255,255,.12);
    }
    .vibe1254 .btn:hover{ transform: translateY(-1px); box-shadow: 0 22px 44px rgba(0,0,0,.22), inset 0 1px 0 rgba(255,255,255,.28); }
    .vibe1254 .btn[aria-pressed="true"]{ outline:2px solid var(--e); outline-offset:0; }

    /* Hero canvas */
    .vibe1254 .hero{
      position:relative; z-index:1; margin-top:18px;
      border-radius:24px; border:1px solid var(--edge);
      background: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.35));
      box-shadow: 0 50px 160px rgba(0,0,0,.16), inset 0 1px 0 rgba(255,255,255,.70);
      overflow:hidden; display:grid; place-items:center;
      backdrop-filter: blur(10px) saturate(1.04);
      min-height: clamp(560px, 58vw, 980px);
    }
    .vibe1254[data-theme="night"] .hero{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      box-shadow: 0 50px 160px rgba(0,0,0,.32), inset 0 1px 0 rgba(255,255,255,.10);
    }
    .vibe1254 canvas#flow{
      position:absolute; inset:0; width:100%; height:100%;
      filter: blur(.1px) saturate(1.05);
    }

    /* Copy overlay */
    .vibe1254 .copy{
      position:relative; z-index:3; text-align:center; pointer-events:none;
      padding: clamp(10px, 3vw, 24px);
      mix-blend-mode:luminosity;
    }
    .vibe1254 .headline{
      font-family: ui-sans-serif, system-ui, Inter, "SF Pro", Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      font-weight:900; letter-spacing:-.01em; line-height:.9; margin:0;
      font-size: clamp(34px, 6vw, 92px);
      color:var(--ink);
      text-shadow: 0 1px 0 rgba(255,255,255,.18), 0 24px 64px color-mix(in oklab, var(--e), transparent 68%);
    }
    .vibe1254 .headline em{
      font-style:normal;
      background: linear-gradient(90deg, var(--e), var(--d), var(--b), var(--c));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      background-size: 200% 100%; animation: glideText1254 14s linear infinite;
    }
    @keyframes glideText1254{ 0%{background-position:0 0} 100%{background-position:200% 0} }
    .vibe1254 .tag{
      margin-top:10px; color:var(--muted); font-weight:800; font-size:12px; letter-spacing:.16em; text-transform:uppercase;
    }

    /* Glassy panel */
    .vibe1254 .panel{
      position:relative; z-index:5; margin-top:16px;
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:center;
      padding:10px; border-radius:14px; border:1px solid var(--edge);
      background: var(--glass);
      backdrop-filter: blur(14px) saturate(1.06);
      box-shadow: 0 16px 42px rgba(0,0,0,.16), inset 0 1px 0 rgba(255,255,255,.50);
    }
    .vibe1254[data-theme="night"] .panel{
      background: rgba(255,255,255,.08);
      box-shadow: 0 16px 42px rgba(0,0,0,.20), inset 0 1px 0 rgba(255,255,255,.10);
    }
    .vibe1254 .cluster{ display:flex; align-items:center; gap:10px; }
    .vibe1254 .lab{ color:var(--muted); font-size:12px; font-weight:800; letter-spacing:.12em; text-transform:uppercase; white-space:nowrap; }
    .vibe1254 .knob{ -webkit-appearance:none; appearance:none; width:220px; max-width:35vw; height:30px; background:transparent; cursor:pointer; }
    .vibe1254 .knob::-webkit-slider-thumb{
      -webkit-appearance:none; width:18px; height:18px; border-radius:50%;
      background: linear-gradient(180deg, #f8fbff, #dfe8f7); border:1px solid var(--edge);
      box-shadow: 0 6px 16px rgba(12,20,50,.16);
    }
    .vibe1254[data-theme="night"] .knob::-webkit-slider-thumb{ background: linear-gradient(180deg, #fff, #e9f3ff); }
    .vibe1254 .knob::-webkit-slider-runnable-track{
      height:10px; border-radius:999px; border:1px solid var(--edge);
      background: linear-gradient(90deg, var(--e), var(--d), var(--b), var(--a), var(--c));
      opacity:.9;
    }

    /* Meta chips */
    .vibe1254 .meta{
      position:relative; z-index:5; margin:14px 2px 0; padding:0; list-style:none;
      display:flex; flex-wrap:wrap; gap:12px; align-items:center; color:var(--muted); font-size:12.5px;
    }
    .vibe1254 .chip{
      display:inline-flex; align-items:center; gap:8px; font-weight:800; text-transform:uppercase; letter-spacing:.12em;
      padding:6px 10px; border-radius:999px; border:1px solid var(--edge);
      background: linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.30));
      backdrop-filter: blur(6px);
    }
    .vibe1254[data-theme="night"] .chip{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
    }
    .vibe1254 .grow{ flex:1 1 auto; min-width:180px; text-align:right; }

    @media (prefers-reduced-motion: reduce){
      .vibe1254 *{ animation: none !important; transition: none !important; }
    }
  </style>

  <div class="bar">
    <div class="glyph" aria-hidden="true">
      <svg viewBox="0 0 100 100" aria-hidden="true">
        <defs>
          <linearGradient id="g1254" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="var(--e)"/>
            <stop offset="1" stop-color="var(--b)"/>
          </linearGradient>
        </defs>
        <g fill="none" stroke="url(#g1254)" stroke-width="7" stroke-linecap="round">
          <path d="M12 50 Q50 12 88 50" />
          <path d="M12 50 Q50 88 88 50" />
          <circle cx="50" cy="50" r="28"/>
        </g>
      </svg>
    </div>
    <div class="brand">
      <div class="title">NEBULA FUGUE 1254 — Kinetic Gradient Tapestry</div>
      <div class="sub">flow • breath • light</div>
    </div>
    <div class="controls" role="group" aria-label="Controls">
      <button class="btn" data-act="theme" title="Toggle theme (T)">Night</button>
      <button class="btn" data-act="run" aria-pressed="true" title="Pause/Play (Space)">Pause</button>
      <button class="btn" data-act="palette" title="Palette (P)">Hues</button>
    </div>
  </div>

  <div class="hero" aria-label="A living canvas of luminous threads that follow an invisible wind">
    <canvas id="flow" aria-hidden="true"></canvas>
    <div class="copy">
      <h2 class="headline">Let color <em>breathe</em>; let motion <em>listen</em>.</h2>
      <div class="tag">drag to steer • hover to glow</div>
    </div>
  </div>

  <div class="panel" role="group" aria-label="Canvas controls">
    <div class="cluster">
      <span class="lab">Speed</span>
      <input class="knob" type="range" data-ctrl="speed" min="0.2" max="3.0" step="0.01" value="1.2" aria-label="Particle speed (0.2–3.0)" title="Speed">
    </div>
    <div class="cluster">
      <span class="lab">Density</span>
      <input class="knob" type="range" data-ctrl="density" min="0.2" max="1.6" step="0.01" value="0.9" aria-label="Particle density (0.2–1.6)" title="Density">
    </div>
    <div class="cluster">
      <span class="lab">Flow</span>
      <input class="knob" type="range" data-ctrl="flow" min="0.5" max="3.0" step="0.01" value="1.4" aria-label="Field complexity (0.5–3.0)" title="Flow">
    </div>
    <div class="cluster">
      <span class="lab">Trails</span>
      <input class="knob" type="range" data-ctrl="trail" min="0" max="1" step="0.01" value="0.35" aria-label="Trail persistence (0–1)" title="Trails">
    </div>
  </div>

  <ul class="meta" aria-label="status">
    <li class="chip">live</li>
    <li class="chip">mode <strong id="mode1254">Night</strong></li>
    <li class="chip">palette <strong id="pal1254">Celestial</strong></li>
    <li class="chip">fps <strong id="fps1254">—</strong></li>
    <li class="grow"><span id="last-updated">Last updated: 2025-12-13 02:18:39 EST</span></li>
  </ul>

  <script>
  (function(){
    const root = document.currentScript.closest('.vibe1254');
    const canvas = root.querySelector('#flow');
    const ctx = canvas.getContext('2d');
    const ui = {
      theme: root.querySelector('[data-act="theme"]'),
      run: root.querySelector('[data-act="run"]'),
      palette: root.querySelector('[data-act="palette"]'),
      speed: root.querySelector('[data-ctrl="speed"]'),
      density: root.querySelector('[data-ctrl="density"]'),
      flow: root.querySelector('[data-ctrl="flow"]'),
      trail: root.querySelector('[data-ctrl="trail"]'),
      mode: root.querySelector('#mode1254'),
      fps: root.querySelector('#fps1254'),
      palname: root.querySelector('#pal1254'),
      ts: root.querySelector('#last-updated'),
      hero: root.querySelector('.hero')
    };

    // Timestamp
    try{
      const fmt = new Intl.DateTimeFormat(undefined, { dateStyle:'medium', timeStyle:'short' });
      ui.ts.textContent = 'Updated ' + fmt.format(new Date());
    }catch{
      ui.ts.textContent = 'Updated ' + new Date().toLocaleString();
    }

    // Theme
    root.setAttribute('data-theme', 'night');

    // Palettes
    const palettes = [
      { name:'Celestial', colors:['#7AF0DD','#8EA4FF','#FF9AC5','#FFD094','#75D2FF'] },
      { name:'Auric Dusk', colors:['#FFE18B','#9C8BFF','#FF9BB3','#7FEFD4','#88B6FF'] },
      { name:'Verdant Bloom', colors:['#7CF0B8','#76A5FF','#FFB39D','#89F1FF','#D7A2FF'] },
      { name:'Polar Night', colors:['#9CE6FF','#94A5FF','#FFDFA1','#74EBCB','#FFB7DA'] }
    ];
    let palIndex = 0;
    function applyPalette(i){
      const p = palettes[i].colors;
      root.style.setProperty('--a', p[0]);
      root.style.setProperty('--b', p[1]);
      root.style.setProperty('--c', p[2]);
      root.style.setProperty('--d', p[3]);
      root.style.setProperty('--e', p[4]);
      ui.palname.textContent = palettes[i].name;
    }
    applyPalette(palIndex);

    // Canvas sizing
    let dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    function fit(){
      const r = canvas.getBoundingClientRect();
      const w = Math.max(1, Math.floor(r.width * dpr));
      const h = Math.max(1, Math.floor(r.height * dpr));
      if(canvas.width !== w || canvas.height !== h){
        canvas.width = w; canvas.height = h;
        ctx.setTransform(1,0,0,1,0,0);
        ctx.scale(dpr, dpr);
        clearCanvas(true);
        setParticleTarget();
      }
    }
    const ro = new ResizeObserver(fit); ro.observe(canvas);

    // Particles
    let particles = [];
    let targetCount = 0;
    function setParticleTarget(){
      const r = canvas.getBoundingClientRect();
      const area = Math.max(1, r.width * r.height);
      const base = area / 2200; // base density per pixel
      targetCount = Math.max(80, Math.floor(base * parseFloat(ui.density.value)));
      if(!running) return;
      if(particles.length < targetCount){
        for(let i=particles.length; i<targetCount; i++) particles.push(makeParticle());
      }else if(particles.length > targetCount){
        particles.length = targetCount;
      }
    }
    function makeParticle(){
      const r = canvas.getBoundingClientRect();
      const x = Math.random() * r.width;
      const y = Math.random() * r.height;
      return {
        x, y, px:x, py:y,
        hue: Math.random(),
        life: 0,
        maxLife: 200 + Math.random()*400
      };
    }
    function wrap(p){
      const r = canvas.getBoundingClientRect();
      let wrapd = false;
      if(p.x < -2){ p.x = r.width + 2; wrapd = true; }
      if(p.x > r.width + 2){ p.x = -2; wrapd = true; }
      if(p.y < -2){ p.y = r.height + 2; wrapd = true; }
      if(p.y > r.height + 2){ p.y = -2; wrapd = true; }
      if(wrapd){ p.px = p.x; p.py = p.y; p.life = 0; }
    }

    // Field function
    function fieldAngle(x, y, t){
      const r = canvas.getBoundingClientRect();
      const nx = x / Math.max(1, r.width);
      const ny = y / Math.max(1, r.height);
      const k = 1.2 * parseFloat(ui.flow.value);
      const u = (nx * 8.0 * k), v = (ny * 8.0 * k);
      const a = Math.sin(u + t*0.6) + Math.cos(v - t*0.7) + Math.sin((u+v)*0.5 - t*0.3);
      return a;
    }

    // Fade/trails
    function clearCanvas(force){
      const a = parseFloat(ui.trail.value);
      // lower value => longer trails; compute gentle fade
      const fade = force ? 1 : (0.05 + a*0.22);
      ctx.save();
      ctx.globalCompositeOperation = 'destination-out';
      ctx.globalAlpha = fade;
      const r = canvas.getBoundingClientRect();
      ctx.fillRect(0,0,r.width,r.height);
      ctx.restore();
    }

    // Pointer interaction
    const pointer = { x: -9999, y: -9999, down: false };
    function updatePointerVars(e){
      const r = canvas.getBoundingClientRect();
      const x = e.clientX - r.left;
      const y = e.clientY - r.top;
      root.style.setProperty('--mx', x + 'px');
      root.style.setProperty('--my', y + 'px');
      pointer.x = x; pointer.y = y;
    }
    ui.hero.addEventListener('pointermove', updatePointerVars, {passive:true});
    ui.hero.addEventListener('pointerdown', (e)=>{ pointer.down = true; updatePointerVars(e); });
    window.addEventListener('pointerup', ()=> pointer.down = false);

    // Animation loop
    let running = true;
    let last = performance.now(), frames = 0, lastFpsT = last, t = 0;
    function tick(now){
      if(!running){ requestAnimationFrame(tick); return; }
      const dt = Math.max(0.016, Math.min(0.05, (now - last)/1000)); last = now;
      frames++; if(now - lastFpsT > 500){ ui.fps.textContent = String(Math.round(frames/((now-lastFpsT)/1000))); frames=0; lastFpsT=now; }
      t += dt;

      clearCanvas(false);

      // Draw
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      ctx.globalCompositeOperation = 'lighter';

      const speed = parseFloat(ui.speed.value);
      const r = canvas.getBoundingClientRect();

      // Ensure count matches target
      if(particles.length !== targetCount) setParticleTarget();

      for(let i=0;i<particles.length;i++){
        const p = particles[i];
        p.life++; if(p.life > p.maxLife){ particles[i] = makeParticle(); continue; }

        // move
        const a = fieldAngle(p.x, p.y, t);
        const vx = Math.cos(a) * speed;
        const vy = Math.sin(a) * speed;

        // subtle pointer force
        const dx = p.x - pointer.x;
        const dy = p.y - pointer.y;
        const dist2 = dx*dx + dy*dy;
        const rad = pointer.down ? 20000 : 14000;
        if(dist2 < rad){
          const f = (pointer.down ? 1.8 : 0.8) * (1 - dist2 / rad);
          p.x += (dx) * f * 0.02;
          p.y += (dy) * f * 0.02;
        }

        p.x += vx; p.y += vy;

        // color from palette sweep
        const cidx = Math.floor((p.hue * 5) % 5);
        const cols = getCols();
        const colA = cols[cidx];
        const colB = cols[(cidx+1)%cols.length];
        const w = (Math.sin((p.life/60) + p.hue*6) + 1)/2;
        const col = lerpColor(colA, colB, w);

        ctx.strokeStyle = col;
        ctx.globalAlpha = 0.35 + Math.sin((p.life%60)/60*Math.PI)*0.15;
        ctx.lineWidth = 1.1 + Math.sin(p.hue*10 + t)*0.6;

        ctx.beginPath();
        ctx.moveTo(p.px, p.py);
        ctx.lineTo(p.x, p.y);
        ctx.stroke();

        p.px = p.x; p.py = p.y;
        wrap(p);
      }

      requestAnimationFrame(tick);
    }
    requestAnimationFrame(()=>{ fit(); setParticleTarget(); requestAnimationFrame(tick); });

    function getCols(){
      // read active CSS vars for palette to keep JS <-> CSS in sync
      const s = getComputedStyle(root);
      return [s.getPropertyValue('--a'), s.getPropertyValue('--b'), s.getPropertyValue('--c'), s.getPropertyValue('--d'), s.getPropertyValue('--e')].map(v=>v.trim());
    }
    function hexToRgb(h){
      const c = h.replace('#','');
      const n = c.length===3 ? c.split('').map(x=>x+x).join('') : c;
      const num = parseInt(n,16);
      const r = (num>>16)&255, g=(num>>8)&255, b=num&255;
      return {r,g,b};
    }
    function lerpColor(ha, hb, t){
      const a = hexToRgb(ha), b = hexToRgb(hb);
      const r = Math.round(a.r + (b.r - a.r)*t);
      const g = Math.round(a.g + (b.g - a.g)*t);
      const b2 = Math.round(a.b + (b.b - a.b)*t);
      return 'rgb('+r+','+g+','+b2+')';
    }

    // UI
    ui.theme.addEventListener('click', ()=>{
      const next = root.getAttribute('data-theme')==='night' ? 'day' : 'night';
      root.setAttribute('data-theme', next);
      ui.theme.textContent = next==='day' ? 'Day' : 'Night';
      ui.mode.textContent = next==='day' ? 'Day' : 'Night';
    });
    ui.run.addEventListener('click', ()=>{
      running = !running;
      ui.run.setAttribute('aria-pressed', running? 'true':'false');
      ui.run.textContent = running? 'Pause':'Play';
      if(running){ last = performance.now(); requestAnimationFrame(tick); }
    });
    ui.palette.addEventListener('click', ()=>{
      palIndex = (palIndex + 1) % palettes.length;
      applyPalette(palIndex);
    });
    ui.density.addEventListener('input', ()=> setParticleTarget());
    ui.speed.addEventListener('input', ()=>{/* live */});
    ui.flow.addEventListener('input', ()=>{/* live */});
    ui.trail.addEventListener('input', ()=>{/* live */});

    // Keyboard shortcuts
    root.tabIndex = 0;
    root.addEventListener('keydown', (e)=>{
      const k = e.key.toLowerCase();
      if(k==='t') ui.theme.click();
      else if (k===' ') { e.preventDefault(); ui.run.click(); }
      else if (k==='p') ui.palette.click();
      else if (k==='['){ ui.speed.value = String(Math.max(0.2, parseFloat(ui.speed.value)-0.06)); }
      else if (k===']'){ ui.speed.value = String(Math.min(3.0, parseFloat(ui.speed.value)+0.06)); }
      else if (k==='-'){ ui.trail.value = String(Math.max(0, parseFloat(ui.trail.value)-0.05)); }
      else if (k==='='){ ui.trail.value = String(Math.min(1, parseFloat(ui.trail.value)+0.05)); }
    });

    // Respect reduced motion
    try{
      if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches){
        ui.speed.value = '0.6';
        ui.density.value = '0.5';
        ui.trail.value = '0.2';
        setParticleTarget();
      }
    }catch{}

  })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


