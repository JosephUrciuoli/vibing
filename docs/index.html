<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="atelier809" aria-label="Orbital Atelier 809 — Kinetic Orrery">
  <style>
    /* Orbital Atelier — Iteration 809 (radical shift: woven ribbons -> glass orrery) */
    #atelier809 {
      --ink: #0e1320;
      --muted: #5c6a80;
      --line: rgba(0,0,0,0.12);
      --glass: rgba(255,255,255,0.6);
      --bg1: #f8fbff;
      --bg2: #eef5ff;
      --ha: 208; /* ring A hue */
      --hb: 322; /* ring B hue */
      --hc: 46;  /* ring C hue */
      position: relative;
      border-radius: 42px;
      padding: clamp(18px, 3.8vw, 48px);
      min-height: 920px;
      color: var(--ink);
      font-family: ui-rounded, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Inter, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      background:
        radial-gradient(1400px 900px at 18% 8%, hsla(var(--ha), 70%, 60%, 0.18), transparent 62%),
        radial-gradient(1200px 900px at 86% 94%, hsla(var(--hb), 70%, 60%, 0.18), transparent 58%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      box-shadow: 0 60px 160px rgba(12,20,40,0.14), inset 0 0 0 1px rgba(0,0,0,0.04);
      overflow: hidden;
      isolation: isolate;
    }

    /* Header */
    #atelier809 .top {
      display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 16px;
      margin-bottom: 12px; position: relative; z-index: 3;
    }
    #atelier809 .brand {
      display: inline-flex; align-items: center; gap: 12px;
      padding: 10px 16px; border-radius: 999px; user-select: none;
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.55));
      -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.95);
      font-weight: 900; letter-spacing: 0.2px;
    }
    #atelier809 .glyph {
      --s: 34px; width: var(--s); height: var(--s); border-radius: 50%;
      background:
        radial-gradient(70% 70% at 30% 30%, rgba(255,255,255,0.96), transparent 60%),
        conic-gradient(from 0deg, hsl(var(--ha),90%,62%), hsl(var(--hb),90%,62%), hsl(var(--hc),90%,58%), hsl(var(--ha),90%,62%));
      box-shadow: 0 10px 24px rgba(0,0,0,0.16), 0 0 0 8px rgba(0,0,0,0.03);
    }
    #atelier809 .actions { justify-self: end; display: inline-flex; gap: 10px; flex-wrap: wrap; }
    #atelier809 .btn {
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.55));
      color: var(--ink);
      padding: 9px 12px;
      border-radius: 14px;
      font-weight: 800; letter-spacing: 0.2px;
      display: inline-flex; align-items: center; gap: 8px;
      cursor: pointer;
      transition: transform 160ms ease, box-shadow 160ms ease, opacity 160ms ease, background 160ms ease;
      -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.92);
      will-change: transform;
    }
    #atelier809 .btn:hover { transform: translateY(-2px); box-shadow: 0 16px 32px rgba(0,0,0,0.18); }
    #atelier809 .btn.on { box-shadow: 0 18px 36px rgba(0,0,0,0.2), inset 0 0 0 1px rgba(255,255,255,1); transform: translateY(-2px); }
    #atelier809 .badge { width: 10px; height: 10px; border-radius: 50%; background: hsl(calc(var(--hb) + 12), 85%, 58%); box-shadow: 0 0 10px hsl(calc(var(--hb) + 12), 80%, 58%); }

    /* Hero */
    #atelier809 .hero { position: relative; z-index: 3; display: grid; gap: 8px; margin: 6px 0 14px; }
    #atelier809 h1 {
      margin: 0; line-height: 0.88; letter-spacing: -0.02em;
      font-size: clamp(48px, 9.8vw, 120px);
      background: linear-gradient(90deg, rgba(0,0,0,0.8), rgba(0,0,0,0.86));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-wrap: balance;
    }
    #atelier809 .sub { margin: 0; color: var(--muted); font-size: 14px; max-width: 76ch; }

    /* Stage */
    #atelier809 .stage { position: relative; z-index: 2; display: grid; place-items: center; margin: 12px 0 18px; perspective: 1100px; }
    #atelier809 .disc {
      width: min(92vw, 1160px);
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      position: relative; overflow: hidden;
      border: 1px solid var(--line);
      background:
        linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.0)),
        radial-gradient(70% 70% at 50% 50%, rgba(255,255,255,0.7), rgba(255,255,255,0.35));
      box-shadow: 0 46px 140px rgba(0,0,0,0.22), inset 0 0 0 1px rgba(255,255,255,0.46);
      transform-style: preserve-3d;
    }
    #atelier809 canvas#orrery { position: absolute; inset: 0; width: 100%; height: 100%; display: block; }
    #atelier809 .halo {
      pointer-events: none; position: absolute; inset: -20%;
      background:
        radial-gradient(560px 520px at 26% 30%, hsla(var(--ha), 95%, 72%, 0.18), transparent 65%),
        radial-gradient(600px 560px at 74% 70%, hsla(var(--hb), 95%, 70%, 0.18), transparent 65%),
        radial-gradient(520px 520px at 52% 10%, hsla(var(--hc), 95%, 60%, 0.16), transparent 65%);
      filter: blur(60px);
      z-index: 0;
      animation: a809-halo 30s ease-in-out infinite alternate;
      border-radius: 50%;
    }
    @keyframes a809-halo {
      0% { transform: scale(1) translateY(-2%); opacity: 0.9; }
      100% { transform: scale(1.08) translateY(2%); opacity: 1; }
    }
    #atelier809 .center-mark {
      position: absolute; inset: 0; display: grid; place-items: center; pointer-events: none;
      z-index: 2;
    }
    #atelier809 .center-mark .crest {
      width: clamp(56px, 10vw, 120px); height: clamp(56px, 10vw, 120px);
      border-radius: 50%;
      background: radial-gradient(60% 60% at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0.1));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.8), 0 20px 60px rgba(0,0,0,0.18);
      border: 1px solid var(--line);
    }
    #atelier809 .center-mark .crest::after {
      content: "809";
      font-weight: 900; letter-spacing: -0.02em;
      display: grid; place-items: center; color: rgba(0,0,0,0.55);
      width: 100%; height: 100%;
      font-size: clamp(14px, 2.3vw, 28px);
      mix-blend-mode: multiply;
    }

    /* Console */
    #atelier809 .console {
      display: grid; grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px; padding: 10px; border-radius: 16px; border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.68), rgba(255,255,255,0.44));
      -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.92);
      color: var(--muted); font-size: 12px; position: relative; z-index: 3;
    }
    #atelier809 .chip {
      border: 1px solid var(--line);
      border-radius: 14px; padding: 10px 12px;
      display: grid; gap: 6px; align-content: start;
      background: linear-gradient(180deg, rgba(255,255,255,0.82), rgba(255,255,255,0.5));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.92);
      min-width: 140px;
    }
    #atelier809 .k { font-weight: 900; letter-spacing: -0.02em; color: var(--ink); font-size: 18px; display: inline-flex; align-items: center; gap: 8px; }
    #atelier809 .swatch { width: 16px; height: 8px; border-radius: 999px; background: linear-gradient(90deg, hsl(var(--ha),85%,58%), hsl(var(--hb),85%,58%), hsl(var(--hc),85%,58%)); box-shadow: 0 0 0 1px rgba(0,0,0,0.08) inset; }
    #atelier809 .range { appearance: none; width: 100%; height: 6px; border-radius: 999px; background: rgba(0,0,0,0.08); outline: none; }
    #atelier809 .range::-webkit-slider-thumb { appearance: none; width: 16px; height: 16px; border-radius: 50%; background: hsl(var(--ha), 90%, 55%); box-shadow: 0 0 0 3px rgba(0,0,0,0.08); border: 1px solid var(--line); }
    #atelier809 .range::-moz-range-thumb { width: 16px; height: 16px; border-radius: 50%; background: hsl(var(--ha), 90%, 55%); border: 1px solid var(--line); }

    /* Footer */
    #atelier809 .foot {
      position: relative; z-index: 3; margin-top: 16px;
      display: grid; grid-template-columns: auto 1fr auto; gap: 12px; align-items: center;
      border: 1px solid var(--line); border-radius: 16px; padding: 10px 12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.68), rgba(255,255,255,0.44));
      color: var(--muted); font-size: 12px;
      -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.92);
    }
    #atelier809 .dial {
      --p: 0deg;
      width: 38px; height: 38px; border-radius: 50%; border: 1px solid var(--line);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.92);
      background: conic-gradient(from 0deg, hsl(var(--ha),90%,60%) var(--p,0deg), rgba(0,0,0,0.12) var(--p,0deg));
    }

    /* Dark mode tone */
    #atelier809[data-tone="dark"] {
      --ink: #eef3ff;
      --muted: #9eb0c6;
      --glass: rgba(255,255,255,0.16);
      --line: rgba(255,255,255,0.18);
      --bg1: #0b0f18; --bg2: #101a2c;
      box-shadow: 0 38px 120px rgba(12,20,40,0.34), inset 0 0 0 1px rgba(255,255,255,0.06);
    }
    #atelier809[data-tone="dark"] h1 {
      background: linear-gradient(90deg, rgba(255,255,255,0.98), rgba(255,255,255,0.78));
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    #atelier809[data-bloom="on"] .disc { box-shadow: 0 68px 180px rgba(0,0,0,0.26), inset 0 0 0 1px rgba(255,255,255,0.76), 0 0 0 10px rgba(255,255,255,0.06); }

    /* Hint */
    #atelier809 .hint {
      position: absolute; bottom: 10px; left: 10px; z-index: 2;
      padding: 6px 10px; border-radius: 999px; font-size: 12px; color: var(--muted);
      border: 1px solid var(--line); background: rgba(255,255,255,0.7); -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.9);
    }

    /* Responsive console columns */
    @media (max-width: 1080px) { #atelier809 .console { grid-template-columns: 1fr 1fr 1fr; } }
    @media (max-width: 740px)  { #atelier809 .console { grid-template-columns: 1fr 1fr; } }
    @media (max-width: 520px)  { #atelier809 .console { grid-template-columns: 1fr; } }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      #atelier809 .halo { animation: none; }
      #atelier809 .btn:hover { transform: none; box-shadow: none; }
    }
  </style>

  <div class="top">
    <div class="brand" aria-label="Orbital Atelier 809">
      <span class="glyph" aria-hidden="true"></span>
      <span>Orrery 809</span>
    </div>
    <div></div>
    <div class="actions">
      <button type="button" class="btn mode" aria-label="Switch palette">
        <span class="badge" aria-hidden="true"></span> Mode
      </button>
      <button type="button" class="btn bloom" aria-label="Toggle glow">
        <span class="badge" aria-hidden="true" style="background:hsl(calc(var(--ha) + 20), 90%, 60%); box-shadow:0 0 10px hsl(calc(var(--ha) + 20), 80%, 60%)"></span> Glow
      </button>
      <button type="button" class="btn pause" aria-label="Pause motion">
        <span class="badge" aria-hidden="true" style="background:#9aa3b2; box-shadow:0 0 10px rgba(0,0,0,0.2)"></span> Pause
      </button>
      <button type="button" class="btn save" aria-label="Download snapshot">
        <span class="badge" aria-hidden="true" style="background:#4ad6a7; box-shadow:0 0 10px rgba(74,214,167,0.8)"></span> Save
      </button>
    </div>
  </div>

  <div class="hero">
    <h1>Time draws in circles.</h1>
    <p class="sub">A glass orrery of light and motion. Drag to spin. Dial harmonics. Save a constellation.</p>
  </div>

  <div class="stage" role="region" aria-label="Interactive orbital disc of moving rings and satellites">
    <div class="disc">
      <div class="halo" aria-hidden="true"></div>
      <canvas id="orrery" role="img" aria-label="Animated orbits and satellites on a glowing disc"></canvas>
      <div class="center-mark"><div class="crest" aria-hidden="true"></div></div>
      <div class="hint">Drag to spin • Space to pause</div>
    </div>
  </div>

  <div class="console" aria-live="polite" aria-atomic="true">
    <div class="chip">
      <span>Rings</span>
      <span class="k"><span id="ring-count">—</span></span>
    </div>
    <div class="chip">
      <span>Palette</span>
      <span class="k"><i class="swatch" aria-hidden="true"></i><span id="theme-name" style="margin-left:6px">—</span></span>
    </div>
    <div class="chip">
      <span>Harmonics</span>
      <input class="range" id="harm" type="range" min="1" max="12" value="7" aria-label="Harmonic complexity">
    </div>
    <div class="chip">
      <span>Glow</span>
      <input class="range" id="glow" type="range" min="0" max="40" value="18" aria-label="Glow amount">
    </div>
  </div>

  <div class="foot">
    <div style="display:inline-flex; align-items:center; gap:10px;">
      <span class="dial" id="dial" aria-hidden="true"></span>
      <span>Cycle</span>
    </div>
    <div></div>
    <span id="last-updated" aria-live="polite"></span>
  </div>

  <script>
    (function () {
      const root = document.getElementById('atelier809');
      const canvas = root.querySelector('#orrery');
      const ctx = canvas.getContext('2d', { alpha: true });
      const disc = canvas.parentElement;

      const btnMode = root.querySelector('.btn.mode');
      const btnBloom = root.querySelector('.btn.bloom');
      const btnPause = root.querySelector('.btn.pause');
      const btnSave = root.querySelector('.btn.save');

      const harmInput = root.querySelector('#harm');
      const glowInput = root.querySelector('#glow');

      const ringCountEl = root.querySelector('#ring-count');
      const statTheme = root.querySelector('#theme-name');
      const dial = root.querySelector('#dial');
      const lastEl = root.querySelector('#last-updated');

      let running = true;
      let bloom = false;
      let glow = Number(glowInput.value);
      let harmonics = Number(harmInput.value);
      let reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      // Palettes
      const palettes = [
        { name: 'Solstice',  tone: 'light', bg1: '#f8fbff', bg2: '#eef5ff', ha:208, hb:322, hc:46  },
        { name: 'Nocturne',  tone: 'dark',  bg1: '#0b0f18', bg2: '#101a2c', ha:206, hb:276, hc:338 },
        { name: 'Citrus',    tone: 'light', bg1: '#fffaf4', bg2: '#f4fbff', ha:36,  hb:318, hc:182 },
        { name: 'Glacier',   tone: 'dark',  bg1: '#0b1319', bg2: '#10202b', ha:196, hb:166, hc:48  },
        { name: 'Aurora',    tone: 'light', bg1: '#f4fffb', bg2: '#eef3ff', ha:162, hb:206, hc:296 }
      ];
      let palIndex = 0;

      function applyPalette(p) {
        root.style.setProperty('--bg1', p.bg1);
        root.style.setProperty('--bg2', p.bg2);
        root.style.setProperty('--ha', p.ha);
        root.style.setProperty('--hb', p.hb);
        root.style.setProperty('--hc', p.hc);
        root.setAttribute('data-tone', p.tone);
        statTheme.textContent = p.name;
      }
      applyPalette(palettes[palIndex]);

      btnMode.addEventListener('click', () => {
        palIndex = (palIndex + 1) % palettes.length;
        applyPalette(palettes[palIndex]);
      });

      btnBloom.addEventListener('click', () => {
        bloom = !bloom;
        btnBloom.classList.toggle('on', bloom);
        root.setAttribute('data-bloom', bloom ? 'on' : 'off');
      });

      btnPause.addEventListener('click', () => {
        running = !running;
        btnPause.classList.toggle('on', running);
        if (running && !reduceMotion) requestAnimationFrame(tick);
      });

      btnSave.addEventListener('click', () => {
        try {
          const url = canvas.toDataURL('image/png');
          const link = document.createElement('a');
          link.download = 'orrery-809.png';
          link.href = url;
          link.click();
        } catch (e) {}
      });

      document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') { e.preventDefault(); btnPause.click(); }
      });

      // Inputs
      harmInput.addEventListener('input', () => { harmonics = Number(harmInput.value); computeRings(); });
      glowInput.addEventListener('input', () => { glow = Number(glowInput.value); });

      // Tilt + spin via pointer
      let mx = 0.5, my = 0.5, px = 0.5, py = 0.5;
      let spinning = false;
      let prevAngle = 0;
      let spinVel = 0; // radians/sec
      let spin = 0;    // accumulated

      function angleAt(e) {
        const rect = disc.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top + rect.height / 2;
        return Math.atan2(e.clientY - cy, e.clientX - cx);
      }

      root.addEventListener('pointermove', (e) => {
        const rect = root.getBoundingClientRect();
        mx = (e.clientX - rect.left) / rect.width;
        my = (e.clientY - rect.top) / rect.height;
        if (spinning) {
          const a = angleAt(e);
          let da = a - prevAngle;
          // Wrap
          if (da > Math.PI) da -= Math.PI*2;
          if (da < -Math.PI) da += Math.PI*2;
          spinVel = da * 14; // gesture intensity
          prevAngle = a;
        }
      }, { passive: true });

      disc.addEventListener('pointerdown', (e) => {
        spinning = true;
        disc.setPointerCapture(e.pointerId);
        prevAngle = angleAt(e);
      });
      disc.addEventListener('pointerup', (e) => {
        spinning = false;
        try { disc.releasePointerCapture(e.pointerId); } catch(_){}
      });
      disc.addEventListener('pointerleave', () => { spinning = false; });

      function tiltStage() {
        px += (mx - px) * 0.08;
        py += (my - py) * 0.08;
        const tx = (px - 0.5) * 14;
        const ty = (py - 0.5) * -14;
        disc.style.transform = `rotateX(${ty}deg) rotateY(${tx}deg)`;
      }

      // Canvas sizing
      function fit() {
        const r = Math.min(window.devicePixelRatio || 1, 2);
        const rect = disc.getBoundingClientRect();
        canvas.width = Math.floor(rect.width * r);
        canvas.height = Math.floor(rect.height * r);
        ctx.setTransform(r, 0, 0, r, 0, 0);
      }
      new ResizeObserver(fit).observe(disc);

      // Ring engine
      let rings = [];
      function computeRings() {
        const rect = disc.getBoundingClientRect();
        const size = Math.min(rect.width, rect.height);
        const baseR = size * 0.18;
        const maxR = size * 0.46;
        const count = Math.max(4, Math.min(18, Math.round(4 + harmonics * 1.2)));
        rings = [];
        for (let i = 0; i < count; i++) {
          const t = i / (count - 1 || 1);
          const r = baseR + (maxR - baseR) * t;
          const w = 1.2 + 2.4 * Math.pow(1 - t, 0.6);
          const speed = (0.2 + t * 1.2) * (Math.sin(i * 1.17) > 0 ? 1 : -1);
          const hue = i % 3 === 0 ? cssHue('--ha') : (i % 3 === 1 ? cssHue('--hb') : cssHue('--hc'));
          rings.push({ r, w, speed, hue, dash: 34 + (i*7)%18, offset: 0 });
        }
        ringCountEl.textContent = String(rings.length);
      }

      function cssHue(varName) {
        const s = getComputedStyle(root);
        const v = Number(s.getPropertyValue(varName));
        return Number.isFinite(v) ? v : 200;
      }

      // Starlets
      const sparks = Array.from({length: 72}, (_, i) => ({
        a: Math.random()*Math.PI*2,
        r: 0.2 + Math.random()*0.44,
        s: 0.2 + Math.random()*1.2,
        j: i * 13.7
      }));

      // Draw
      let t0 = performance.now();

      function draw(now) {
        const w = canvas.clientWidth, h = canvas.clientHeight;
        if (w === 0 || h === 0) return;
        const cx = w * 0.5, cy = h * 0.5;

        // Time + spin
        const dt = Math.min(0.06, (now - t0) / 1000);
        t0 = now;
        spin += spinVel * dt;
        spinVel *= 0.94;

        // Clear
        ctx.clearRect(0, 0, w, h);

        // Background sheen
        if (bloom) {
          const g = ctx.createRadialGradient(cx, cy, 0, cx, cy, Math.max(w, h)*0.5);
          g.addColorStop(0.0, `hsla(${cssHue('--hb')}, 90%, 70%, 0.16)`);
          g.addColorStop(0.6, `hsla(${cssHue('--ha')}, 90%, 60%, 0.08)`);
          g.addColorStop(1.0, `rgba(255,255,255,0)`);
          ctx.fillStyle = g;
          ctx.fillRect(0, 0, w, h);
        }

        // Composite + glow
        ctx.globalCompositeOperation = 'screen';
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.shadowColor = 'rgba(255,255,255,0.7)';
        ctx.shadowBlur = bloom ? glow * 1.8 : glow * 1.0;

        // Orbits
        for (let i = 0; i < rings.length; i++) {
          const R = rings[i].r;
          const lw = rings[i].w;
          const hue = rings[i].hue;
          const s = rings[i].speed;
          rings[i].offset = (rings[i].offset + (30 + i*3) * dt) % 200;

          // Dashed arc
          ctx.setLineDash([rings[i].dash, rings[i].dash * 0.8]);
          ctx.lineDashOffset = -rings[i].offset;
          ctx.lineWidth = lw;
          ctx.strokeStyle = `hsla(${hue}, 90%, ${62 - i*0.8}%, ${0.8 - i*0.015})`;

          ctx.beginPath();
          ctx.arc(cx, cy, R, 0, Math.PI * 2);
          ctx.stroke();

          // Satellites
          const satellites = 1 + (i % 3);
          for (let k = 0; k < satellites; k++) {
            const a = spin + now*0.0009 * s + (k / satellites) * Math.PI * 2 + Math.sin(i*1.3)*0.2;
            const x = cx + Math.cos(a) * R;
            const y = cy + Math.sin(a) * R;
            const dotR = Math.max(1.2, lw * 0.8);
            const grad = ctx.createRadialGradient(x, y, 0, x, y, dotR*6);
            grad.addColorStop(0, `hsla(${hue}, 90%, 70%, 0.9)`);
            grad.addColorStop(1, `hsla(${hue}, 90%, 60%, 0.0)`);
            ctx.fillStyle = grad;
            ctx.beginPath();
            ctx.arc(x, y, dotR*3, 0, Math.PI*2);
            ctx.fill();
          }
        }

        // Starlets overprint
        ctx.shadowBlur = 0;
        ctx.globalCompositeOperation = 'lighter';
        for (let i = 0; i < sparks.length; i++) {
          const s = sparks[i];
          const a = s.a + now*0.0002 * s.s + Math.sin((now*0.0001) + s.j) * 0.1;
          const r = Math.min(w, h) * (0.18 + s.r * 0.28);
          const x = cx + Math.cos(a + spin*0.3) * r;
          const y = cy + Math.sin(a + spin*0.3) * r;
          ctx.fillStyle = `hsla(${(cssHue('--ha') + cssHue('--hb'))/2}, 90%, 75%, ${0.10 + (harmonics/12)*0.06})`;
          ctx.fillRect(x, y, 1, 1);
        }

        // Center iris
        ctx.globalCompositeOperation = 'screen';
        const iris = ctx.createRadialGradient(cx, cy, 0, cx, cy, Math.min(w, h)*0.2);
        iris.addColorStop(0, `hsla(${cssHue('--hc')}, 90%, 70%, 0.20)`);
        iris.addColorStop(1, `rgba(255,255,255,0)`);
        ctx.fillStyle = iris;
        ctx.beginPath();
        ctx.arc(cx, cy, Math.min(w, h)*0.24, 0, Math.PI*2);
        ctx.fill();
      }

      function tick(now) {
        if (!running) return;
        tiltStage();
        const pace = 8.0;
        const pct = ((now / 1000) % pace) / pace;
        dial.style.setProperty('--p', (pct * 360).toFixed(2) + 'deg');
        const d = new Date();
        lastEl.textContent = 'Last updated: ' + d.toLocaleString([], { year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit', second:'2-digit' });

        draw(now || performance.now());
        if (!reduceMotion) requestAnimationFrame(tick);
      }

      // Init
      fit();
      computeRings();
      running = true;
      if (reduceMotion) {
        draw(performance.now());
        setInterval(() => {
          const d = new Date();
          lastEl.textContent = 'Last updated: ' + d.toLocaleString([], { year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit', second:'2-digit' });
        }, 1000);
      } else {
        requestAnimationFrame(tick);
      }

      // Recompute rings on resize
      new ResizeObserver(() => computeRings()).observe(disc);

      // Gentle breathing of harmonics
      setInterval(() => {
        if (!running || reduceMotion) return;
        const base = Number(harmInput.value);
        const osc = Math.round(Math.sin(performance.now()*0.0006) * 1);
        const val = Math.min(Number(harmInput.max), Math.max(Number(harmInput.min), base + osc));
        if (val !== harmonics) {
          harmonics = val;
          computeRings();
        }
      }, 350);

      // Clean up on detach
      const obs = new MutationObserver(() => {
        if (!document.body.contains(root)) { running = false; obs.disconnect(); }
      });
      obs.observe(document.body, { childList: true, subtree: true });
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


