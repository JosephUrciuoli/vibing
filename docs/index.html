<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<style>
  /* v1144 — Wind Meadow */
  #v1144 {
    --ink: #e9eef6;
    --muted: #a6b2c5;
    --edge: rgba(148,163,184,.22);
    --bg-a: 8, 12, 24;
    --bg-b: 7, 17, 36;
    --accentA: 125, 211, 252;  /* will be updated by palette */
    --accentB: 167, 139, 250;
    position: relative;
    border-radius: 28px;
    padding: clamp(22px, 5.5vw, 46px);
    color: var(--ink);
    background:
      radial-gradient(1200px 900px at 120% -20%, rgba(var(--accentA),.12), transparent 60%),
      radial-gradient(1200px 900px at -20% 120%, rgba(var(--accentB),.10), transparent 60%),
      linear-gradient(180deg, rgba(var(--bg-a),1), rgba(var(--bg-b),1));
    box-shadow:
      inset 0 1px 0 rgba(255,255,255,.06),
      0 30px 80px rgba(0,0,0,.45),
      0 12px 34px rgba(0,0,0,.35);
    font: 500 15px/1.6 ui-sans-serif, system-ui, -apple-system, "SF Pro Text", Segoe UI, Roboto, "Helvetica Neue", Arial;
    overflow: hidden;
    isolation: isolate;
  }
  #v1144::after {
    /* soft grain + sheen */
    content: "";
    position: absolute; inset: -10% -10%;
    pointer-events: none; border-radius: inherit;
    background:
      linear-gradient(115deg, rgba(255,255,255,.06), transparent 30%, transparent 70%, rgba(255,255,255,.04)) no-repeat;
    background-size: 200% 200%;
    mix-blend-mode: overlay; opacity: .24;
    animation: sheen1144 18s ease-in-out infinite;
  }
  @keyframes sheen1144 {
    0%,100% { transform: translateX(0) translateY(0) rotate(0.001deg); }
    50% { transform: translateX(-4%) translateY(2%) rotate(0.001deg); }
  }

  /* Hero */
  #v1144 .hero {
    position: relative; z-index: 3;
    max-width: 1100px; margin: 0 auto 18px;
    display: grid; gap: 12px; justify-items: center; text-align: center;
  }
  #v1144 .badge {
    display: inline-grid; place-items: center; width: fit-content;
    padding: 7px 12px; letter-spacing: .18em; text-transform: uppercase;
    font-size: 11px; color: var(--muted);
    background: rgba(255,255,255,.04);
    border: 1px solid var(--edge); border-radius: 999px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 8px 18px rgba(0,0,0,.35);
    backdrop-filter: blur(10px);
  }
  #v1144 h1 {
    margin: 2px 0 0;
    font-weight: 900; letter-spacing: -.02em; line-height: 1.02;
    font-size: clamp(44px, 8.6vw, 102px);
    background: linear-gradient(120deg, rgb(var(--accentA)) 0%, rgb(var(--accentB)) 55%, #34d399 100%);
    -webkit-background-clip: text; background-clip: text; color: transparent;
    filter: drop-shadow(0 18px 60px rgba(125,211,252,.24));
  }
  #v1144 .lede {
    margin: 0; max-width: 70ch; color: var(--muted);
    font-weight: 450; letter-spacing: .01em;
  }

  /* Stage */
  #v1144 .stage {
    position: relative; z-index: 2;
    margin: clamp(18px, 5.6vw, 32px) auto 14px; max-width: 1100px;
    height: min(64vh, 640px);
    border-radius: 22px; overflow: hidden;
    border: 1px solid var(--edge);
    background:
      radial-gradient(70% 80% at 50% 95%, rgba(52, 211, 153,.08), transparent 60%),
      linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.35));
    box-shadow:
      0 24px 60px rgba(0,0,0,.45),
      inset 0 1px 0 rgba(255,255,255,.06);
  }
  #v1144 canvas {
    position: absolute; inset: 0; width: 100%; height: 100%; display: block;
  }
  #v1144 .sweep {
    position: absolute; inset: -10% -40% 30% -40%; pointer-events: none; border-radius: 50%;
    background:
      radial-gradient(60% 80% at 50% 100%, rgba(var(--accentA), .12), transparent 60%),
      radial-gradient(80% 90% at 70% 110%, rgba(var(--accentB), .10), transparent 70%);
    mix-blend-mode: screen; filter: blur(12px) saturate(1.1);
    animation: driftLight1144 22s ease-in-out infinite;
  }
  @keyframes driftLight1144 {
    0%,100% { transform: translate(-2%, 1%) rotate(2deg) scale(1.02); opacity: .9; }
    50% { transform: translate(3%, -1%) rotate(-1deg) scale(1.06); opacity: 1; }
  }
  #v1144 .note {
    position: absolute; inset: auto 14px 14px auto; z-index: 5;
    padding: 8px 12px; font-size: 12px; color: var(--muted);
    background: rgba(15,23,42,.55); border: 1px solid var(--edge); border-radius: 10px;
    box-shadow: 0 12px 30px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);
    backdrop-filter: blur(10px);
  }

  /* Controls */
  #v1144 .controls {
    position: relative; z-index: 3; margin: 18px auto 0;
    display: grid; grid-template-columns: 1fr; gap: 12px 14px; justify-items: center;
  }
  #v1144 .row { display: flex; flex-wrap: wrap; gap: 12px 14px; justify-content: center; }
  #v1144 .btn, #v1144 .ctrl, #v1144 .switch, #v1144 .swatch {
    display: inline-flex; align-items: center; gap: 10px;
    padding: 10px 14px; border-radius: 14px;
    background: rgba(255,255,255,.04);
    border: 1px solid var(--edge);
    color: var(--ink);
    box-shadow: 0 14px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
    backdrop-filter: blur(8px);
  }
  #v1144 .btn { cursor: pointer; transition: transform .18s ease, filter .2s ease, background .2s ease; }
  #v1144 .btn:hover { transform: translateY(-2px); filter: saturate(1.08); background: rgba(255,255,255,.06); }
  #v1144 .btn.primary {
    background: linear-gradient(135deg, rgba(var(--accentA),.18), rgba(var(--accentB),.18));
    font-weight: 700;
  }
  #v1144 .ctrl span, #v1144 .switch span { font-size: 13px; color: var(--muted); }
  #v1144 input[type="range"] { appearance: none; width: 220px; height: 24px; background: transparent; cursor: pointer; }
  #v1144 input[type="range"]::-webkit-slider-runnable-track {
    height: 8px; border-radius: 999px;
    background: linear-gradient(90deg, rgba(52,211,153,.9), rgba(var(--accentA),.9), rgba(var(--accentB),.9));
    box-shadow: inset 0 0 0 1px rgba(15,23,42,.2), 0 6px 16px rgba(0,0,0,.35);
  }
  #v1144 input[type="range"]::-webkit-slider-thumb {
    appearance: none; width: 18px; height: 18px; margin-top: -5px; border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #ffffff, #dbeafe);
    border: 1px solid rgba(255,255,255,.1);
    box-shadow: 0 2px 8px rgba(0,0,0,.5), 0 0 0 4px rgba(125,211,252,.22);
  }
  #v1144 input[type="checkbox"] {
    appearance: none; width: 46px; height: 28px; border-radius: 999px;
    background: #0f172a; border: 1px solid var(--edge); position: relative; cursor: pointer;
    transition: background .25s ease, border-color .25s ease, box-shadow .25s ease;
  }
  #v1144 input[type="checkbox"]::after {
    content: ""; position: absolute; top: 3px; left: 3px; width: 22px; height: 22px; border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #ffffff, #e2e8f0);
    border: 1px solid rgba(255,255,255,.12);
    box-shadow: 0 2px 8px rgba(0,0,0,.6);
    transition: transform .25s ease, background .25s ease;
  }
  #v1144 input[type="checkbox"]:checked {
    background: linear-gradient(90deg, rgba(var(--accentA),.5), rgba(var(--accentB),.5));
    border-color: transparent;
  }
  #v1144 input[type="checkbox"]:checked::after { transform: translateX(18px); background: #fff; }

  /* Palette swatches */
  #v1144 .palette {
    display: inline-flex; gap: 8px; align-items: center; padding: 8px 10px; border-radius: 16px;
    background: rgba(255,255,255,.04); border: 1px solid var(--edge); box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
  }
  #v1144 .swatch {
    width: 34px; height: 26px; border-radius: 8px; padding: 0; border: 1px solid var(--edge);
    cursor: pointer; box-shadow: inset 0 1px 0 rgba(255,255,255,.08), 0 8px 16px rgba(0,0,0,.35);
  }
  #v1144 .swatch[aria-checked="true"] { outline: 2px solid rgba(var(--accentA),.75); outline-offset: 2px; }
  #v1144 .swatch > span { display: block; width: 100%; height: 100%; border-radius: inherit; }

  /* Footer Meta */
  #v1144 .meta {
    position: relative; z-index: 2; margin-top: 22px; padding-top: 14px;
    border-top: 1px solid var(--edge); display: flex; justify-content: space-between; align-items: center;
    gap: 12px; color: var(--muted); font-size: 13px;
  }
  #v1144 .hints { display: flex; gap: 10px; flex-wrap: wrap; }
  #v1144 .hint {
    padding: 6px 10px; border-radius: 999px;
    background: rgba(255,255,255,.04);
    border: 1px solid var(--edge);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
  }

  /* Responsive */
  @media (max-width: 560px) {
    #v1144 .controls input[type="range"] { width: 150px; }
    #v1144 .meta { flex-direction: column; align-items: flex-start; }
  }
</style>

<div id="v1144" aria-label="Wind Meadow — Kinetic Grass Studio">
  <section class="hero">
    <span class="badge">Iteration 1144 · Wind Meadow</span>
    <h1>Glass Meadow</h1>
    <p class="lede">Sketch wind with your pointer. Grow a field of light and let it sway. Calm, gust, or paint its colors.</p>
  </section>

  <div class="stage" role="region" aria-label="Interactive wind field">
    <canvas id="meadow1144" aria-label="Meadow canvas"></canvas>
    <div class="sweep" aria-hidden="true"></div>
    <div class="note">Tip: move to bend the grass; click to send a gust; double‑click to regrow the field.</div>
  </div>

  <div class="controls" role="group" aria-label="Controls">
    <div class="row">
      <button class="btn primary" id="gust1144" type="button" aria-label="Gust of wind">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 10h10m-8 4h12m2-4a3 3 0 10-3-3M9 18a3 3 0 103-3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        </svg>
        Gust
      </button>
      <button class="btn" id="reset1144" type="button" aria-label="Regrow field">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 12a8 8 0 1114.9 4M4 12l-2-2m2 2l2-2" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Regrow
      </button>
      <button class="btn" id="save1144" type="button" aria-label="Save image">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 3v12m0 0l-4-4m4 4l4-4M5 19h14" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Save PNG
      </button>
    </div>
    <div class="row">
      <label class="ctrl" for="wind1144">
        <span>Wind</span>
        <input id="wind1144" type="range" min="0.2" max="3.0" step="0.01" value="1.00" aria-label="Wind speed">
      </label>
      <label class="ctrl" for="sway1144">
        <span>Sway</span>
        <input id="sway1144" type="range" min="0.2" max="2.5" step="0.01" value="1.20" aria-label="Sway amplitude">
      </label>
      <label class="ctrl" for="height1144">
        <span>Height</span>
        <input id="height1144" type="range" min="0.6" max="1.4" step="0.01" value="1.00" aria-label="Blade height">
      </label>
      <label class="ctrl" for="density1144">
        <span>Density</span>
        <input id="density1144" type="range" min="120" max="900" step="10" value="480" aria-label="Blade count">
      </label>
      <label class="switch" for="glow1144" title="Toggle glow">
        <input id="glow1144" type="checkbox" checked>
        <span>Glow</span>
      </label>
      <label class="switch" for="pause1144" title="Pause motion">
        <input id="pause1144" type="checkbox">
        <span>Pause</span>
      </label>
    </div>
    <div class="row">
      <div class="palette" role="radiogroup" aria-label="Palette">
        <button class="swatch" data-p="0" role="radio" aria-checked="true" aria-label="Daybreak">
          <span style="background: linear-gradient(90deg,#7dd3fc,#a78bfa,#34d399);"></span>
        </button>
        <button class="swatch" data-p="1" role="radio" aria-checked="false" aria-label="Canyon">
          <span style="background: linear-gradient(90deg,#f59e0b,#f97316,#10b981);"></span>
        </button>
        <button class="swatch" data-p="2" role="radio" aria-checked="false" aria-label="Nocturne">
          <span style="background: linear-gradient(90deg,#0ea5e9,#6366f1,#22d3ee);"></span>
        </button>
        <button class="swatch" data-p="3" role="radio" aria-checked="false" aria-label="Bloom">
          <span style="background: linear-gradient(90deg,#fb7185,#a78bfa,#06b6d4);"></span>
        </button>
      </div>
    </div>
  </div>

  <div class="meta">
    <div class="hints" aria-hidden="true">
      <span class="hint">Move to bend the grass</span>
      <span class="hint">Click to send a gust</span>
      <span class="hint">Double‑click to regrow</span>
    </div>
    <span id="last-updated">Last updated: 2025-12-08 01:32:03 EST</span>
  </div>
</div>

<script>
(() => {
  const root = document.getElementById('v1144');
  if (!root) return;

  // Last updated
  const lu = root.querySelector('#last-updated');
  const now = new Date();
  try {
    const opts = { year: 'numeric', month: 'short', day: '2-digit', hour: '2-digit', minute: '2-digit' };
    lu.textContent = 'Last updated: ' + now.toLocaleString(undefined, opts);
  } catch { lu.textContent = 'Last updated: ' + now.toISOString(); }

  // Elements
  const stage = root.querySelector('.stage');
  const canvas = root.querySelector('#meadow1144');
  const k = canvas.getContext('2d');

  // Controls
  const gustBtn = root.querySelector('#gust1144');
  const resetBtn = root.querySelector('#reset1144');
  const saveBtn = root.querySelector('#save1144');
  const windEl = root.querySelector('#wind1144');
  const swayEl = root.querySelector('#sway1144');
  const heightEl = root.querySelector('#height1144');
  const densityEl = root.querySelector('#density1144');
  const glowEl = root.querySelector('#glow1144');
  const pauseEl = root.querySelector('#pause1144');
  const swatches = Array.from(root.querySelectorAll('.swatch'));

  // Motion prefs
  const reduced = matchMedia && matchMedia('(prefers-reduced-motion: reduce)').matches;

  // Palettes
  const PALETTES = [
    ['#7dd3fc', '#a78bfa', '#34d399'], // daybreak
    ['#f59e0b', '#f97316', '#10b981'], // canyon
    ['#0ea5e9', '#6366f1', '#22d3ee'], // nocturne
    ['#fb7185', '#a78bfa', '#06b6d4']  // bloom
  ];
  let paletteIndex = 0;
  let palette = PALETTES[paletteIndex];

  function hexToRgb(h){
    const s = h.replace('#','');
    const b = s.length===3 ? s.split('').map(c=>c+c).join('') : s;
    const n = parseInt(b,16);
    return { r:(n>>16)&255, g:(n>>8)&255, b:n&255 };
  }
  function lerp(a,b,t){ return a + (b-a)*t; }
  function mixColor(c1,c2,t){
    const a = hexToRgb(c1), b = hexToRgb(c2);
    const r = Math.round(lerp(a.r,b.r,t));
    const g = Math.round(lerp(a.g,b.g,t));
    const b2 = Math.round(lerp(a.b,b.b,t));
    return `rgb(${r},${g},${b2})`;
  }
  function gradColor(v){
    const stops = palette;
    const seg = Math.max(1, stops.length-1);
    const x = Math.max(0, Math.min(0.9999, v));
    const i = Math.floor(x*seg);
    const t = (x*seg) - i;
    return mixColor(stops[i], stops[i+1] || stops[i], t);
  }
  function setAccentFromPalette() {
    const a = hexToRgb(palette[0]), b = hexToRgb(palette[1]||palette[0]);
    root.style.setProperty('--accentA', `${a.r},${a.g},${a.b}`);
    root.style.setProperty('--accentB', `${b.r},${b.g},${b.b}`);
    root.animate([{ opacity: 1 }, { opacity: .96 }, { opacity: 1 }], { duration: 220 });
  }

  // Canvas state
  let W = 800, H = 500, DPR = Math.min(2, devicePixelRatio || 1);
  const pointer = { x: 0.5, y: 0.5, active: false };
  let blades = [];
  let RAF = null;

  // Tunables
  let WIND = parseFloat(windEl.value);
  let SWAY = parseFloat(swayEl.value);
  let HEIGHT = parseFloat(heightEl.value);
  let DENSITY = parseInt(densityEl.value, 10);

  // Gust state
  let gust = 0; // decays to 0

  // Seeded RNG for stable field
  function mulberry32(a){ return function(){ let t=a+=0x6D2B79F5; t=Math.imul(t^t>>>15,t|1); t^=t+Math.imul(t^t>>>7,t|61); return ((t^t>>>14)>>>0)/4294967296; } }
  let seed = Math.floor(Math.random()*1e9);
  let rand = mulberry32(seed);

  function resize(){
    const r = stage.getBoundingClientRect();
    W = Math.max(640, Math.floor(r.width));
    H = Math.max(360, Math.floor(r.height));
    DPR = Math.min(2, devicePixelRatio || 1);
    canvas.width = Math.floor(W*DPR);
    canvas.height = Math.floor(H*DPR);
    canvas.style.width = W + 'px';
    canvas.style.height = H + 'px';
    k.setTransform(DPR,0,0,DPR,0,0);
    rebuild();
  }

  function rebuild(){
    rand = mulberry32(seed);
    blades = [];
    const n = DENSITY;
    for (let i=0;i<n;i++){
      const x = rand()*W;
      const y = H*(0.70 + rand()*0.26);
      const len = (H*0.18 + rand()*H*0.28) * HEIGHT;
      const w = 0.7 + rand()*1.6;
      const hueJit = rand();
      const noiseOff = rand()*1000;
      blades.push({ x, y, len, w, hueJit, noiseOff });
    }
  }

  function fieldAngle(x, y, t){
    // layered sine field + gentle curl around pointer
    const f1 = 0.0022, f2 = 0.0013, f3 = 0.0009;
    let a = Math.sin(y*f1 + t*WIND*1.5 + x*0.0004) * 0.9
          + Math.cos(x*f2 - t*WIND*1.2 + y*0.0006) * 0.7
          + Math.sin((x+y)*f3 + t*0.8) * 0.4;

    // gust push
    if (gust > 0) {
      a += Math.sin((x*0.004 + y*0.002) + t*2.8) * gust * 0.8;
    }

    // pointer curl
    if (pointer.active){
      const dx = x - pointer.x, dy = y - pointer.y;
      const dist = Math.hypot(dx, dy) + 1e-6;
      const pull = 1 / (1 + dist*0.01);
      const curl = Math.atan2(dy, dx) + Math.PI/2; // perpendicular = swirl
      a += (curl - (-1.3)) * pull * 0.9; // bend towards swirl from default up-left
    }

    return a * SWAY * 0.6; // amplitude
  }

  function draw(now){
    const t = now*0.001;

    // Clear
    k.clearRect(0,0,W,H);

    // Subtle ground glow
    const grd = k.createRadialGradient(W*0.5, H*0.96, Math.min(W,H)*0.1, W*0.5, H*0.96, Math.max(W,H)*0.9);
    grd.addColorStop(0, 'rgba(255,255,255,0.04)');
    grd.addColorStop(1, 'rgba(0,0,0,0.2)');
    k.fillStyle = grd;
    k.fillRect(0,0,W,H);

    // Draw blades
    k.lineCap = 'round';
    k.globalCompositeOperation = 'lighter';
    const glow = glowEl.checked;

    if (gust > 0) gust = Math.max(0, gust - 0.02);

    for (let i=0;i<blades.length;i++){
      const b = blades[i];
      const baseAng = -1.32; // upward leaning
      const field = fieldAngle(b.x + Math.sin(t + b.noiseOff)*6, b.y, t);
      const a0 = baseAng + field*0.6;
      const a1 = a0 + field*0.55 + Math.sin(t*1.2 + b.noiseOff)*0.08;
      const a2 = a1 + field*0.45 + Math.cos(t*1.1 + b.noiseOff*1.7)*0.05;

      const p0 = { x: b.x, y: b.y };
      const p1 = { x: p0.x + Math.cos(a0)*b.len*0.42, y: p0.y + Math.sin(a0)*b.len*0.42 };
      const p2 = { x: p1.x + Math.cos(a1)*b.len*0.36, y: p1.y + Math.sin(a1)*b.len*0.36 };
      const p3 = { x: p2.x + Math.cos(a2)*b.len*0.26, y: p2.y + Math.sin(a2)*b.len*0.26 };

      const cMix = ((b.x / W) * 0.7 + b.hueJit*0.3) % 1;
      const col = gradColor(cMix);

      if (glow) {
        k.shadowColor = col;
        k.shadowBlur = 12 + (b.w*5);
      } else {
        k.shadowBlur = 0;
      }

      k.strokeStyle = col;
      k.globalAlpha = 0.75;
      k.lineWidth = Math.max(0.8, b.w);

      k.beginPath();
      k.moveTo(p0.x, p0.y);
      k.bezierCurveTo(p1.x, p1.y, p2.x, p2.y, p3.x, p3.y);
      k.stroke();

      // tip sparkle
      k.globalAlpha = glow ? 0.8 : 0.35;
      k.fillStyle = col;
      k.beginPath();
      k.arc(p3.x, p3.y, Math.max(0.3, b.w*0.35), 0, Math.PI*2);
      k.fill();
    }

    RAF = requestAnimationFrame(draw);
  }

  // Events
  function posFromEvent(e){
    const rect = canvas.getBoundingClientRect();
    const x = Math.max(0, Math.min(W, e.clientX - rect.left));
    const y = Math.max(0, Math.min(H, e.clientY - rect.top));
    return { x, y };
  }
  stage.addEventListener('pointermove', e => {
    const p = posFromEvent(e);
    pointer.x = p.x; pointer.y = p.y; pointer.active = true;
  });
  stage.addEventListener('pointerleave', () => { pointer.active = false; });
  stage.addEventListener('pointerdown', e => {
    pointer.active = true;
    gust = Math.min(1.2, gust + 0.9);
    root.animate([{ transform:'scale(1)' }, { transform:'scale(.996)' }, { transform:'scale(1)' }], { duration: 260, easing: 'cubic-bezier(.2,.9,.2,1)' });
  });
  stage.addEventListener('dblclick', e => {
    seed = Math.floor(Math.random()*1e9);
    rebuild();
    root.animate([{ opacity: 1 }, { opacity: .94 }, { opacity: 1 }], { duration: 240 });
  });

  // Buttons
  gustBtn.addEventListener('click', () => {
    gust = Math.min(1.2, gust + 0.9);
    gustBtn.animate([{ transform:'translateY(0)' }, { transform:'translateY(-2px)' }, { transform:'translateY(0)' }], { duration: 220, easing: 'cubic-bezier(.2,.9,.2,1)' });
  });
  resetBtn.addEventListener('click', () => {
    seed = Math.floor(Math.random()*1e9);
    rebuild();
  });
  saveBtn.addEventListener('click', () => {
    const c = document.createElement('canvas');
    const dpr = DPR;
    c.width = Math.floor(W*dpr);
    c.height = Math.floor(H*dpr);
    const cx = c.getContext('2d');
    // background fill to match container
    cx.fillStyle = 'rgb(8,12,24)';
    cx.fillRect(0,0,c.width,c.height);
    cx.drawImage(canvas, 0, 0);
    const a = document.createElement('a');
    a.download = 'wind-meadow-' + Date.now() + '.png';
    a.href = c.toDataURL('image/png');
    a.click();
  });

  // Sliders
  windEl.addEventListener('input', e => { WIND = parseFloat(e.target.value)||1; });
  swayEl.addEventListener('input', e => { SWAY = parseFloat(e.target.value)||1; });
  heightEl.addEventListener('input', e => { HEIGHT = parseFloat(e.target.value)||1; rebuild(); });
  densityEl.addEventListener('input', e => {
    DENSITY = parseInt(e.target.value,10)||480;
    rebuild();
  });

  glowEl.addEventListener('change', () => {
    root.animate([{ opacity: 1 }, { opacity: .97 }, { opacity: 1 }], { duration: 180 });
  });
  pauseEl.addEventListener('change', () => { if (pauseEl.checked || reduced) stop(); else start(); });

  // Palette switching
  swatches.forEach(btn => {
    btn.addEventListener('click', () => {
      swatches.forEach(b=>b.setAttribute('aria-checked','false'));
      btn.setAttribute('aria-checked','true');
      paletteIndex = parseInt(btn.dataset.p,10) || 0;
      palette = PALETTES[paletteIndex];
      setAccentFromPalette();
    });
  });

  function start(){ if (!RAF) RAF = requestAnimationFrame(draw); }
  function stop(){ if (RAF) cancelAnimationFrame(RAF); RAF = null; }

  // Init
  function init(){
    setAccentFromPalette();
    resize();
    if (!reduced && !pauseEl.checked) start();
    else { pauseEl.checked = true; }
    addEventListener('resize', resize);
  }
  init();
})();
</script>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


