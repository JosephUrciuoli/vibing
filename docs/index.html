<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="vibe-1527" data-theme="bloom" aria-label="Aurora Flowfield Studio">
  <style>
    /* Scope to #vibe-1527 */
    #vibe-1527{
      --bg1:#fff7fb;
      --bg2:#eefaff;
      --ink:#0c1320;
      --muted:#536074;
      --chip-bg: rgba(255,255,255,0.55);
      --chip-br: rgba(10,16,28,0.12);
      --mx: 50%;
      --my: 50%;

      /* accents per theme (updated via [data-theme]) */
      --a1: 330;
      --a2: 180;
      --a3: 45;

      position: relative;
      font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--ink);
      border-radius: 28px;
      border: 1px solid rgba(12,18,34,0.08);
      padding: 26px;
      isolation: isolate;
      overflow: hidden;

      background:
        radial-gradient(1200px 700px at var(--mx) var(--my), rgba(255,255,255,0.85), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      box-shadow:
        0 24px 70px rgba(12,18,34,0.14),
        inset 0 1px 0 rgba(255,255,255,0.75);
      transition: background .6s ease, color .3s ease, box-shadow .3s ease;
    }
    #vibe-1527::before{
      content:"";
      position:absolute; inset:-40% -30%;
      background:
        radial-gradient(40% 60% at 80% 20%, rgba(255,255,255,0.6), transparent 60%),
        radial-gradient(60% 40% at 20% 80%, rgba(255,255,255,0.45), transparent 60%);
      filter: blur(36px);
      pointer-events:none;
      z-index:0;
      mix-blend-mode: soft-light;
      opacity:.8;
    }
    #vibe-1527::after{
      content:"";
      position:absolute; inset:0; z-index:0; pointer-events:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 60'%3E%3Cg fill='none' stroke='rgba(12,18,34,.06)' stroke-width='1'%3E%3Cpath d='M0 30h60M30 0v60'/%3E%3C/g%3E%3C/svg%3E");
      mix-blend-mode: soft-light;
      opacity:.6;
    }

    /* Themes */
    #vibe-1527[data-theme="bloom"]{ --bg1:#fff5fb; --bg2:#f0fbff; --ink:#0b1320; --muted:#5a6880; --a1: 325; --a2: 195; --a3: 38; }
    #vibe-1527[data-theme="glacier"]{ --bg1:#e9fbff; --bg2:#fafdff; --ink:#0a1622; --muted:#4b6176; --a1: 190; --a2: 210; --a3: 230; }
    #vibe-1527[data-theme="ember"]{ --bg1:#fff3e9; --bg2:#fff7fb; --ink:#21120b; --muted:#745a53; --a1: 18; --a2: 330; --a3: 48; }
    #vibe-1527[data-theme="noir"]{ --bg1:#08131f; --bg2:#0c1928; --ink:#e9f2ff; --muted:#a7bfd9; --chip-bg: rgba(255,255,255,0.08); --chip-br: rgba(233,241,255,0.18); --a1: 200; --a2: 260; --a3: 160; }

    /* Masthead */
    #vibe-1527 .mast{ position:relative; z-index:2; display:grid; gap:10px; justify-items:center; text-align:center; margin-bottom:18px; }
    #vibe-1527 .tag{
      font-size:11px; letter-spacing:.3em; text-transform:uppercase; color:var(--muted);
      display:inline-flex; align-items:center; gap:10px;
      padding:6px 12px; border-radius:999px;
      background: var(--chip-bg);
      border: 1px solid var(--chip-br);
      box-shadow: 0 1px 0 rgba(255,255,255,0.65) inset, 0 8px 18px rgba(12,18,34,.06);
      -webkit-backdrop-filter: blur(8px);
      backdrop-filter: blur(8px);
    }
    #vibe-1527 .tag .dot{ width:8px; height:8px; border-radius:50%; background:
      radial-gradient(circle at 35% 35%, #fff, hsl(var(--a1) 100% 62%));
      box-shadow: 0 0 10px hsl(var(--a1) 100% 60% / .6);
    }
    #vibe-1527 h1{
      margin:0;
      font-size: clamp(34px, 9vw, 80px);
      line-height:1.02; font-weight:900; letter-spacing:-.02em;
      background: conic-gradient(from 120deg, hsl(var(--a1) 100% 55%), hsl(var(--a2) 100% 55%), hsl(var(--a3) 100% 55%), hsl(var(--a1) 100% 55%));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter: drop-shadow(0 4px 18px hsl(var(--a2) 100% 50% / .25));
      animation: hue-shift 16s linear infinite;
    }
    @keyframes hue-shift { to { filter: drop-shadow(0 4px 18px hsl(var(--a2) 100% 50% / .25)) hue-rotate(360deg); } }
    #vibe-1527 .lead{ margin:0; color:var(--muted); font-size: clamp(14px, 2.2vw, 17px); }

    /* Stage */
    #vibe-1527 .stage{
      position:relative; z-index:1;
      width:min(96vw, 1100px); aspect-ratio: 21/10;
      margin: 22px auto 12px; border-radius:26px;
      border: 1px solid rgba(12,18,34,0.12);
      overflow:hidden; transform-style: preserve-3d;
      background:
        radial-gradient(900px 500px at var(--mx) var(--my), rgba(255,255,255,0.75), rgba(255,255,255,0.25) 55%, transparent 80%),
        linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.35));
      box-shadow: 0 20px 40px rgba(12,18,34,0.16), inset 0 1px 0 rgba(255,255,255,0.7);
    }
    #vibe-1527[data-theme="noir"] .stage{
      background:
        radial-gradient(1000px 600px at var(--mx) var(--my), rgba(255,255,255,0.10), rgba(255,255,255,0.02) 60%, transparent 80%),
        linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      box-shadow: 0 22px 48px rgba(4,10,20,0.7), inset 0 1px 0 rgba(255,255,255,0.05);
    }

    /* Subtle dot grid overlay */
    #vibe-1527 .stage::after{
      content:""; position:absolute; inset:0; pointer-events:none; z-index:2;
      background-image:
        radial-gradient(circle at 1px 1px, rgba(12,18,34,0.08) 1px, transparent 1.2px);
      background-size: 18px 18px; opacity:.4; mix-blend-mode: soft-light;
    }
    #vibe-1527[data-theme="noir"] .stage::after{
      background-image:
        radial-gradient(circle at 1px 1px, rgba(233,241,255,0.10) 1px, transparent 1.2px);
      opacity:.28;
    }

    #vibe-1527 canvas.field{
      position:absolute; inset:0; width:100%; height:100%; z-index:1; display:block;
    }

    /* Floating glass orbs */
    #vibe-1527 .orb{ position:absolute; z-index:3; pointer-events:none; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.8), rgba(255,255,255,.15) 60%, rgba(255,255,255,0) 70%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
      filter: blur(0.2px) saturate(110%);
      animation: float 14s ease-in-out infinite;
      mix-blend-mode: screen; opacity:.6;
    }
    #vibe-1527 .orb.o1{ width:110px; height:110px; left: 6%; top:12%; animation-duration: 18s; }
    #vibe-1527 .orb.o2{ width:80px; height:80px; right: 10%; bottom: 16%; animation-duration: 16s; animation-delay: -3s; }
    #vibe-1527 .orb.o3{ width:140px; height:140px; right: 22%; top: 10%; animation-duration: 20s; animation-delay: -6s; }
    @keyframes float {
      0%,100%{ transform: translateY(0) translateX(0); }
      50%{ transform: translateY(-10px) translateX(6px); }
    }

    /* Controls */
    #vibe-1527 .controls{
      position:relative; z-index:4; display:flex; flex-wrap:wrap; gap:10px 12px;
      justify-content:center; align-items:center; margin: 14px 0 6px;
    }
    #vibe-1527 .chip{
      -webkit-tap-highlight-color: transparent;
      appearance:none; border:1px solid var(--chip-br);
      background: var(--chip-bg);
      color: var(--ink); padding:10px 14px; border-radius:999px;
      font-size:13px; font-weight:800; letter-spacing:.02em;
      cursor:pointer; transition: transform .15s ease, border-color .2s ease, background .3s ease, color .3s ease, box-shadow .3s ease;
      box-shadow: 0 1px 0 rgba(255,255,255,0.7) inset, 0 8px 18px rgba(12,18,34,0.08);
      -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px);
    }
    #vibe-1527 .chip:hover{ transform: translateY(-2px); border-color: rgba(12,18,34,0.26); }
    #vibe-1527 .chip[aria-pressed="true"]{
      background: linear-gradient(90deg, hsl(var(--a1) 100% 65%), hsl(var(--a2) 100% 65%), hsl(var(--a3) 100% 60%));
      color:#071824; border-color:transparent;
      box-shadow: 0 14px 28px hsl(var(--a2) 100% 55% / .22), 0 1px 0 rgba(255,255,255,0.7) inset;
    }

    #vibe-1527 .knob{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:999px; border:1px solid var(--chip-br);
      background: var(--chip-bg);
      color:var(--muted); font-size:12px; box-shadow: 0 1px 0 rgba(255,255,255,0.65) inset;
      -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px);
    }
    #vibe-1527 input[type="range"]{ width:150px; height:24px; background:transparent; cursor:pointer; }
    #vibe-1527 input[type="range"]::-webkit-slider-runnable-track{
      height:6px; border-radius:6px;
      background: linear-gradient(90deg, hsl(var(--a1) 100% 60%), hsl(var(--a2) 100% 60%), hsl(var(--a3) 100% 60%));
      box-shadow: 0 0 0 1px rgba(0,0,0,0.06) inset;
    }
    #vibe-1527 input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none; appearance:none; width:16px; height:16px; border-radius:50%;
      background:#fff; border:1px solid rgba(0,0,0,0.12); margin-top:-5px; box-shadow:0 4px 10px rgba(12,18,34,0.18);
    }
    #vibe-1527 input[type="range"]::-moz-range-track{ height:6px; border-radius:6px; background: linear-gradient(90deg, hsl(var(--a1) 100% 60%), hsl(var(--a2) 100% 60%), hsl(var(--a3) 100% 60%)); }
    #vibe-1527 input[type="range"]::-moz-range-thumb{ width:16px; height:16px; border-radius:50%; background:#fff; border:1px solid rgba(0,0,0,0.12); box-shadow:0 4px 10px rgba(12,18,34,0.18); }

    /* Meta */
    #vibe-1527 .meta{ display:flex; align-items:center; justify-content:space-between; gap:12px; color:var(--muted); font-size:12px; margin-top:8px; }
    #vibe-1527 .legend{ display:inline-flex; gap:8px; align-items:center; opacity:.92; }
    #vibe-1527 .legend .swatch{
      width:12px; height:12px; border-radius:50%;
      background: radial-gradient(circle at 35% 35%, #fff, hsl(var(--a2) 100% 55%));
      box-shadow: 0 0 12px hsl(var(--a2) 100% 60% / .35);
    }

    /* Pause visuals */
    #vibe-1527[data-paused="true"] .stage{ box-shadow: 0 12px 26px rgba(12,18,34,0.1); }
    #vibe-1527[data-paused="true"] .stage::after{ opacity:.15; }

    @media (prefers-reduced-motion: reduce){
      #vibe-1527 h1{ animation: none !important; }
      #vibe-1527 .orb{ display:none; }
    }
  </style>

  <div class="mast">
    <span class="tag"><span class="dot" aria-hidden="true"></span> Iteration 1527</span>
    <h1>Aurora Flowfield Studio</h1>
    <p class="lead">Painted by vectors. Guided by your touch. A living gradient of motion.</p>
  </div>

  <div class="stage" id="stage" role="application" aria-label="Flowfield canvas. Move pointer to stir the aurora; use controls to change theme, density, flow and trails.">
    <canvas class="field" id="field" aria-hidden="true"></canvas>
    <div class="orb o1" aria-hidden="true"></div>
    <div class="orb o2" aria-hidden="true"></div>
    <div class="orb o3" aria-hidden="true"></div>
  </div>

  <div class="controls" role="group" aria-label="Theme, density and motion controls">
    <button class="chip theme" data-theme="bloom" aria-pressed="true" type="button">Bloom</button>
    <button class="chip theme" data-theme="glacier" aria-pressed="false" type="button">Glacier</button>
    <button class="chip theme" data-theme="ember" aria-pressed="false" type="button">Ember</button>
    <button class="chip theme" data-theme="noir" aria-pressed="false" type="button">Noir</button>

    <span class="knob">Density <input id="density" type="range" min="400" max="3000" value="1200" step="100" aria-label="Particle density"></span>
    <span class="knob">Flow <input id="flow" type="range" min="20" max="200" value="110" aria-label="Flow speed percent"></span>
    <span class="knob">Trail <input id="trail" type="range" min="1" max="20" value="7" aria-label="Trail persistence"></span>

    <button class="chip" id="clear" type="button">Clear</button>
    <button class="chip" id="pause" type="button" aria-pressed="false">Pause</button>
    <button class="chip" id="save" type="button">Save snapshot</button>
  </div>

  <div class="meta">
    <span id="last-updated">Last updated: 2025-12-25 18:17:53 EST</span>
    <span class="legend"><span class="swatch" aria-hidden="true"></span> tip: press and swirl to carve light</span>
  </div>

  <script>
    (function(){
      const root = document.getElementById('vibe-1527');
      const stage = document.getElementById('stage');
      const canvas = document.getElementById('field');
      const ctx = canvas.getContext('2d');
      const updated = document.getElementById('last-updated');

      const themeBtns = root.querySelectorAll('.theme');
      const densityInput = document.getElementById('density');
      const flowInput = document.getElementById('flow');
      const trailInput = document.getElementById('trail');
      const pauseBtn = document.getElementById('pause');
      const clearBtn = document.getElementById('clear');
      const saveBtn = document.getElementById('save');

      // Timestamp
      const now = new Date();
      try {
        updated.textContent = 'Last updated: ' + now.toLocaleString(undefined, {
          year:'numeric', month:'short', day:'2-digit',
          hour:'2-digit', minute:'2-digit', second:'2-digit'
        });
      } catch (e) {
        updated.textContent = 'Last updated: ' + now.toString();
      }

      // DPR + sizing
      const DPR = Math.min(2, window.devicePixelRatio || 1);
      function size(){
        const r = stage.getBoundingClientRect();
        canvas.width = Math.max(1, Math.floor(r.width * DPR));
        canvas.height = Math.max(1, Math.floor(r.height * DPR));
        ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
        center.x = r.width/2; center.y = r.height/2;
      }
      window.addEventListener('resize', size);

      // State
      let particles = [];
      const center = { x: 0, y: 0 };
      let pointer = null;
      let paused = false;
      let lastT = performance.now();
      let flowScale = Number(flowInput.value) / 100;
      let fadeStrength = Number(trailInput.value); // higher = faster fade
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      // Theme hue banks
      const palettes = {
        bloom: [325, 195, 38],
        glacier: [190, 210, 230],
        ember: [18, 330, 48],
        noir: [200, 260, 160]
      };

      // Theme switching
      function setTheme(t){
        root.setAttribute('data-theme', t);
        themeBtns.forEach(b => b.setAttribute('aria-pressed', String(b.getAttribute('data-theme')===t)));
      }

      // Particles
      function resetParticles(n){
        particles.length = 0;
        const r = stage.getBoundingClientRect();
        for (let i=0; i<n; i++){
          particles.push({
            x: Math.random()*r.width,
            y: Math.random()*r.height,
            vx: 0, vy: 0,
            life: Math.random()*200 + 50,
            age: 0,
            hueBias: Math.random()
          });
        }
        clearCanvas();
      }

      // Simple flowing pseudo-noise field (sum of sines) -> angle
      function fieldAngle(x, y, t){
        const s = 0.0028; // spatial scale
        const a = Math.sin(x*s + t*0.25);
        const b = Math.sin(y*s*1.2 + t*0.18);
        const c = Math.sin((x+y)*s*0.6 + t*0.12);
        const d = Math.sin((x - y)*s*0.8 - t*0.21);
        return (a + b*0.8 + c*0.6 + d*0.5) * Math.PI; // -PI..PI
      }

      // Pointer forces
      function pointerForce(px, py, x, y){
        const dx = px - x, dy = py - y;
        const dist = Math.hypot(dx, dy) + 0.0001;
        const f = Math.min(1, 160 / dist); // taper
        // Swirl: perpendicular to vector to create a vortex
        return { fx: -dy / dist * f, fy: dx / dist * f };
      }

      function clearCanvas(){
        ctx.save();
        ctx.setTransform(DPR,0,0,DPR,0,0); // ensure proper scale
        ctx.globalCompositeOperation = 'source-over';
        const theme = root.getAttribute('data-theme');
        if (theme === 'noir'){
          ctx.fillStyle = 'rgba(8,19,31,0.85)';
        } else {
          ctx.fillStyle = 'rgba(255,255,255,0.85)';
        }
        const r = stage.getBoundingClientRect();
        ctx.fillRect(0,0,r.width,r.height);
        ctx.restore();
      }

      // Draw loop
      function step(t){
        const dt = Math.min(0.05, (t - lastT)/1000);
        lastT = t;

        if (!paused && !prefersReduced){
          // Fade trails slightly
          ctx.save();
          ctx.globalCompositeOperation = 'destination-out';
          ctx.fillStyle = 'rgba(0,0,0,' + (fadeStrength * 0.01).toFixed(3) + ')';
          const r = stage.getBoundingClientRect();
          ctx.fillRect(0,0,r.width,r.height);
          ctx.restore();

          // Draw particles
          ctx.save();
          ctx.globalCompositeOperation = 'lighter';
          ctx.lineCap = 'round';

          const theme = root.getAttribute('data-theme') || 'bloom';
          const hues = palettes[theme] || palettes.bloom;

          const r2 = stage.getBoundingClientRect();
          const time = t * 0.001;

          for (let i=0; i<particles.length; i++){
            const p = particles[i];
            const ox = p.x, oy = p.y;

            // Flowfield velocity
            const ang = fieldAngle(p.x, p.y, time);
            p.vx += Math.cos(ang) * (0.6 * flowScale);
            p.vy += Math.sin(ang) * (0.6 * flowScale);

            // Pointer swirl
            if (pointer){
              const F = pointerForce(pointer.x, pointer.y, p.x, p.y);
              p.vx += F.fx * 1.3;
              p.vy += F.fy * 1.3;
            }

            // Damp
            p.vx *= 0.96; p.vy *= 0.96;

            // Integrate
            p.x += p.vx * dt * 60;
            p.y += p.vy * dt * 60;

            // Wrap edges
            if (p.x < -2) p.x = r2.width + 2;
            if (p.x > r2.width + 2) p.x = -2;
            if (p.y < -2) p.y = r2.height + 2;
            if (p.y > r2.height + 2) p.y = -2;

            // Color
            const mix = (Math.sin((p.x + p.y) * 0.002 + time*0.8) * 0.5 + 0.5) * 0.6 + 0.2;
            const hue = hues[0] * (1 - mix) + hues[1] * mix;
            const hue2 = hues[2];
            const blend = 0.5 + 0.5*Math.sin(p.hueBias*6.28 + time*0.7);
            const h = hue * (1 - blend) + hue2 * blend;

            // Opacity scales with velocity
            const sp = Math.hypot(p.vx, p.vy);
            const alpha = Math.min(0.9, 0.08 + sp * 0.06);

            ctx.strokeStyle = 'hsla(' + ((h%360+360)%360).toFixed(1) + ',100%,' + (theme==='noir' ? '55%' : '50%') + ',' + alpha.toFixed(3) + ')';
            ctx.lineWidth = Math.min(2.2, 0.6 + sp * 0.35);

            ctx.beginPath();
            ctx.moveTo(ox, oy);
            ctx.lineTo(p.x, p.y);
            ctx.stroke();

            // Life cycle
            p.age += dt * 60;
            if (p.age > p.life){
              // Rebirth at a random spot to keep the garden lush
              p.x = Math.random()*r2.width;
              p.y = Math.random()*r2.height;
              p.vx = p.vy = 0;
              p.age = 0;
              p.life = 80 + Math.random()*240;
              p.hueBias = Math.random();
            }
          }
          ctx.restore();
        }

        requestAnimationFrame(step);
      }

      // Pointer tracking for background focus too
      function updatePointer(clientX, clientY){
        const r = stage.getBoundingClientRect();
        const x = Math.max(0, Math.min(r.width, clientX - r.left));
        const y = Math.max(0, Math.min(r.height, clientY - r.top));
        pointer = { x, y };
        root.style.setProperty('--mx', (x / r.width) * 100 + '%');
        root.style.setProperty('--my', (y / r.height) * 100 + '%');
      }
      stage.addEventListener('mousemove', e => updatePointer(e.clientX, e.clientY));
      stage.addEventListener('mouseleave', () => { pointer = null; root.style.setProperty('--mx','50%'); root.style.setProperty('--my','50%'); });
      stage.addEventListener('touchmove', e => { const t = e.touches[0]; if(!t) return; updatePointer(t.clientX, t.clientY); }, { passive:true });
      stage.addEventListener('touchend', () => { pointer = null; });

      // Wire controls
      themeBtns.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          setTheme(btn.getAttribute('data-theme'));
        });
      });
      densityInput.addEventListener('input', ()=> resetParticles(Number(densityInput.value)));
      flowInput.addEventListener('input', ()=> { flowScale = Number(flowInput.value)/100; });
      trailInput.addEventListener('input', ()=> { fadeStrength = Number(trailInput.value); });

      clearBtn.addEventListener('click', clearCanvas);
      pauseBtn.addEventListener('click', ()=>{
        paused = !paused;
        root.setAttribute('data-paused', String(paused));
        pauseBtn.setAttribute('aria-pressed', String(paused));
        pauseBtn.textContent = paused ? 'Resume' : 'Pause';
      });
      saveBtn.addEventListener('click', ()=>{
        try{
          const link = document.createElement('a');
          link.download = 'aurora-' + Date.now() + '.png';
          link.href = canvas.toDataURL('image/png');
          document.body.appendChild(link);
          link.click();
          link.remove();
        }catch(e){}
      });

      // Initialize
      size();
      setTheme(root.getAttribute('data-theme') || 'bloom');
      resetParticles(Number(densityInput.value));
      clearCanvas();

      // Accessibility: start paused if reduced motion
      if (prefersReduced){
        paused = true;
        root.setAttribute('data-paused','true');
        pauseBtn.setAttribute('aria-pressed','true');
        pauseBtn.textContent = 'Resume';
      }

      requestAnimationFrame(step);

      // Cleanup observer
      const observer = new MutationObserver(()=>{
        if (!document.body.contains(root)){
          // Let RAF naturally stop when detached
        }
      });
      observer.observe(document.body, { childList:true, subtree:true });
    })();
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


