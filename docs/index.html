<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<style>
  .loom822 {
    --ink: hsl(220 20% 96%);
    --muted: hsl(220 10% 78%);
    --bg1: hsl(240 65% 8%);
    --bg2: hsl(260 55% 12%);
    --edge: hsl(0 0% 100% / .16);
    --a1: 208 100% 62%;
    --a2: 312 88% 64%;
    --a3: 38 95% 58%;
    --glow: 0 60px 180px hsl(240 80% 4% / .55);
    position: relative;
    border-radius: 32px;
    color: var(--ink);
    padding: clamp(20px, 4vw, 44px);
    background:
      radial-gradient(1200px 800px at calc(20% + var(--px, 0%)) calc(0% + var(--py, 0%)), hsl(var(--a1) / .14), transparent 60%),
      radial-gradient(1000px 900px at calc(90% + var(--px, 0%)) calc(100% + var(--py, 0%)), hsl(var(--a2) / .14), transparent 60%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
    box-shadow: var(--glow), inset 0 0 0 1px var(--edge);
    overflow: hidden;
    isolation: isolate;
  }
  .loom822[data-theme="light"] {
    --ink: hsl(220 18% 12%);
    --muted: hsl(220 10% 42%);
    --bg1: hsl(220 60% 98%);
    --bg2: hsl(210 55% 94%);
    --edge: hsl(220 10% 30% / .16);
    --glow: 0 40px 140px hsl(220 30% 30% / .16);
    box-shadow: var(--glow), inset 0 0 0 1px var(--edge);
  }
  .loom822::after {
    content: "";
    position: absolute; inset: -40% -20%;
    background:
      conic-gradient(from 0deg at 50% 50%,
        hsl(0 0% 100% / .06) 0 5%,
        transparent 30%,
        hsl(0 0% 100% / .08) 55%,
        transparent 80%,
        hsl(0 0% 100% / .06) 95%);
    mix-blend-mode: soft-light;
    filter: blur(18px);
    animation: spin822 28s linear infinite;
    pointer-events: none;
  }
  @keyframes spin822 { to { transform: rotate(360deg); } }

  /* Top */
  .loom-top {
    display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: center; position: relative; z-index: 3;
  }
  .loom-title { display: grid; gap: 8px; }
  .loom-title h1 {
    margin: 0;
    font: 900 clamp(28px, 8vw, 88px)/.9 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    letter-spacing: -.02em;
    background:
      linear-gradient(90deg, hsl(0 0% 100% / .96), hsl(0 0% 100% / .7)) padding-box,
      linear-gradient(120deg, hsl(var(--a1)), hsl(var(--a2)), hsl(var(--a3))) text;
    -webkit-background-clip: padding-box, text; background-clip: padding-box, text;
    color: transparent; -webkit-text-fill-color: transparent;
  }
  .loom-title h1 em {
    font-style: normal; opacity: .75;
    background: linear-gradient(120deg, hsl(var(--a2)), hsl(var(--a3))); -webkit-background-clip: text; background-clip: text;
  }
  .loom-title p {
    margin: 0; color: var(--muted);
    font: 600 clamp(12px, 1.6vw, 18px)/1.6 ui-sans-serif, system-ui;
  }

  /* Controls */
  .loom-controls { display: grid; grid-auto-flow: column; gap: 10px; align-items: center; justify-content: end; }
  .pill822 {
    appearance: none; border: 0; cursor: pointer; position: relative;
    display: inline-grid; grid-auto-flow: column; gap: 8px; align-items: center;
    padding: 11px 14px; border-radius: 999px;
    color: var(--ink);
    background: linear-gradient(180deg, hsl(0 0% 100% / .12), hsl(0 0% 100% / .06));
    border: 1px solid var(--edge);
    box-shadow: 0 16px 34px hsl(240 80% 4% / .45), inset 0 1px 0 hsl(0 0% 100% / .18);
    font: 800 12px/1 ui-sans-serif, system-ui;
    transition: transform .18s ease, background .18s ease, box-shadow .18s ease;
  }
  .loom822[data-theme="light"] .pill822 {
    background: linear-gradient(180deg, hsl(0 0% 100% / .7), hsl(0 0% 100% / .38));
    box-shadow: 0 16px 28px hsl(220 40% 20% / .12), inset 0 1px 0 hsl(0 0% 100% / .55);
  }
  .pill822:hover { transform: translateY(-2px); }
  .pill822 .ink { position: absolute; inset: 0; border-radius: inherit; pointer-events: none; opacity: 0; transition: opacity .16s ease;
    background: radial-gradient(200px 200px at var(--mx, 50%) var(--my, 50%), hsl(0 0% 100% / .22), transparent 60%); }
  .pill822:hover .ink { opacity: 1; }

  .knob822 {
    display: inline-grid; grid-template-columns: auto 1fr; gap: 10px; align-items: center;
    padding: 8px 12px; border-radius: 14px;
    background: linear-gradient(180deg, hsl(0 0% 100% / .10), hsl(0 0% 100% / .05));
    border: 1px solid var(--edge);
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .25);
    color: var(--ink);
    font: 700 12px/1 ui-sans-serif, system-ui;
  }
  .loom822 input[type="range"] { -webkit-appearance: none; appearance: none; width: 140px; height: 28px; background: transparent; }
  .loom822 input[type="range"]::-webkit-slider-runnable-track {
    height: 8px; border-radius: 999px;
    background: linear-gradient(90deg, hsl(var(--a1)), hsl(var(--a2)), hsl(var(--a3)));
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .4);
  }
  .loom822 input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none; appearance: none; width: 18px; height: 18px; border-radius: 50%;
    background: white; border: 1px solid var(--edge); margin-top: -5px;
    box-shadow: 0 6px 14px hsl(240 30% 6% / .35);
  }
  .loom822 input[type="range"]::-moz-range-track {
    height: 8px; border-radius: 999px;
    background: linear-gradient(90deg, hsl(var(--a1)), hsl(var(--a2)), hsl(var(--a3)));
  }
  .loom822 input[type="range"]::-moz-range-thumb {
    width: 18px; height: 18px; border-radius: 50%; background: white; border: 1px solid var(--edge);
  }

  /* Stage */
  .loom-stage {
    position: relative; margin-top: clamp(10px, 2vw, 20px);
    min-height: min(78vh, 740px);
    border-radius: 24px; overflow: hidden;
    border: 1px solid var(--edge);
    background: linear-gradient(180deg, hsl(0 0% 100% / .06), hsl(0 0% 0% / .12));
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .14), 0 40px 140px hsl(240 60% 4% / .25);
  }
  .loom822[data-theme="light"] .loom-stage {
    background: linear-gradient(180deg, hsl(0 0% 100% / .68), hsl(0 0% 100% / .45));
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .55), 0 34px 120px hsl(220 30% 30% / .14);
  }

  /* Canvas & overlays */
  #loom-canvas { position: absolute; inset: 0; z-index: 1; }
  .mesh-glow {
    position: absolute; inset: -20% -10% -30% -10%; z-index: 0; pointer-events: none;
    background:
      radial-gradient(closest-side at 15% 10%, hsl(var(--a1) / .35), transparent 55%),
      radial-gradient(closest-side at 85% 25%, hsl(var(--a2) / .28), transparent 60%),
      radial-gradient(closest-side at 50% 100%, hsl(var(--a3) / .24), transparent 60%);
    filter: blur(24px) saturate(120%);
    transform: translate3d(calc(var(--px, 0%) * .2), calc(var(--py, 0%) * .2), 0);
    transition: transform .1s linear;
  }

  /* Caption */
  .loom-caption {
    position: absolute; z-index: 3; left: 50%; bottom: clamp(18px, 4vw, 40px); transform: translateX(-50%);
    display: grid; gap: clamp(8px, 2vw, 16px); text-align: center;
    padding: clamp(16px, 3vw, 24px) clamp(18px, 3vw, 30px);
    border-radius: 16px; border: 1px solid var(--edge);
    background: linear-gradient(180deg, hsl(0 0% 100% / .08), hsl(0 0% 0% / .10));
    box-shadow: 0 24px 60px hsl(240 60% 4% / .30), inset 0 1px 0 hsl(0 0% 100% / .18);
    backdrop-filter: blur(6px) saturate(120%);
    max-width: min(90%, 800px);
  }
  .loom822[data-theme="light"] .loom-caption {
    background: linear-gradient(180deg, hsl(0 0% 100% / .7), hsl(0 0% 100% / .5));
    box-shadow: 0 24px 60px hsl(220 40% 30% / .12), inset 0 1px 0 hsl(0 0% 100% / .55);
  }
  .loom-caption h2 {
    margin: 0;
    font: 900 clamp(22px, 6vw, 56px)/1.02 ui-sans-serif, system-ui;
    letter-spacing: -0.01em;
    background: linear-gradient(90deg, hsl(var(--a1)), hsl(var(--a2)), hsl(var(--a3)));
    -webkit-background-clip: text; background-clip: text; color: transparent; -webkit-text-fill-color: transparent;
  }
  .loom-caption p { margin: 0; color: var(--muted); font: 600 clamp(13px, 1.6vw, 18px)/1.6 ui-sans-serif, system-ui; }
  .actions822 { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }

  /* Pulses / Blooms */
  .burst822 {
    position: absolute; border: 2px solid hsl(var(--h, var(--a2)) / .45);
    border-radius: 50%; pointer-events: none; mix-blend-mode: overlay; z-index: 2;
    left: var(--rx); top: var(--ry); width: 2px; height: 2px; transform: translate(-50%, -50%);
    animation: bloom822 1400ms ease-out forwards;
  }
  @keyframes bloom822 {
    0% { opacity: .5; transform: translate(-50%, -50%) scale(1); filter: blur(0px); }
    70% { opacity: .18; transform: translate(-50%, -50%) scale(140); filter: blur(1px); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(240); filter: blur(1.5px); }
  }

  /* Footer */
  .loom-foot {
    position: relative; z-index: 3; margin-top: clamp(16px, 3vw, 24px);
    display: flex; justify-content: space-between; align-items: center; gap: 12px;
    color: var(--muted); font: 500 12px/1.4 ui-sans-serif, system-ui;
  }
  .hint822 {
    font: 700 11px/1 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    background: hsl(0 0% 100% / .10);
    border: 1px solid var(--edge);
    padding: 6px 8px; border-radius: 8px; color: var(--ink);
  }
  .loom822[data-theme="light"] .hint822 { background: hsl(0 0% 0% / .06); }

  /* Tooltips */
  .loom822 .pill822[data-tip]::after {
    content: attr(data-tip);
    position: absolute; bottom: calc(100% + 8px); left: 50%; transform: translate(-50%, 4px);
    background: hsl(0 0% 0% / .8); color: white; padding: 6px 8px; border-radius: 6px;
    font: 700 10px/1 ui-sans-serif; opacity: 0; pointer-events: none; white-space: nowrap;
    transition: opacity .18s ease, transform .18s ease;
  }
  .loom822 .pill822:hover::after { opacity: 1; transform: translate(-50%, 0); }
</style>

<div class="loom822" id="loom822" data-theme="dark" aria-live="polite">
  <div class="loom-top">
    <div class="loom-title">
      <h1>AURORA <em>LOOM</em> 822</h1>
      <p>Weave light with your cursor. Ribbons listen. The room breathes.</p>
    </div>
    <div class="loom-controls" role="group" aria-label="Controls">
      <button class="pill822" id="loom-theme" type="button" data-tip="Toggle theme"><span class="ink" aria-hidden="true"></span>Day / Night</button>
      <button class="pill822" id="loom-pal" type="button" data-tip="Cycle palettes"><span class="ink" aria-hidden="true"></span>Palette</button>
      <span class="knob822" aria-label="Flow">
        <span>Flow</span>
        <input id="loom-flow" type="range" min="0" max="100" value="58" aria-label="Flow speed">
      </span>
      <button class="pill822" id="loom-pause" type="button" aria-pressed="false" data-tip="Pause / Resume"><span class="ink" aria-hidden="true"></span>Pause</button>
    </div>
  </div>

  <div class="loom-stage" id="loom-stage" aria-label="Aurora stage">
    <div class="mesh-glow" aria-hidden="true"></div>
    <canvas id="loom-canvas" aria-hidden="true"></canvas>

    <div class="loom-caption" aria-live="polite">
      <h2>Silk made of color.</h2>
      <p>Drag to bend the fabric. Click to bloom a ripple. Adjust Flow to change the tide.</p>
      <div class="actions822">
        <button class="pill822" id="loom-bloom" type="button"><span class="ink" aria-hidden="true"></span>Bloom</button>
        <button class="pill822" id="loom-riff" type="button"><span class="ink" aria-hidden="true"></span>Riff</button>
      </div>
    </div>
  </div>

  <div class="loom-foot">
    <span class="hint822" aria-hidden="true">Tip: Slow flow reveals delicate interference. Try blooms near corners.</span>
    <span id="last-updated">Last updated: 2025-11-23 03:21:45 EST</span>
  </div>
</div>

<script>
(function(){
  const root = document.getElementById('loom822');
  const stage = document.getElementById('loom-stage');
  const canvas = document.getElementById('loom-canvas');
  const ctx = canvas.getContext('2d');
  const flow = document.getElementById('loom-flow');
  const updated = document.getElementById('last-updated');

  const btnTheme = document.getElementById('loom-theme');
  const btnPal = document.getElementById('loom-pal');
  const btnPause = document.getElementById('loom-pause');
  const btnBloom = document.getElementById('loom-bloom');
  const btnRiff = document.getElementById('loom-riff');

  // Timestamp
  try {
    const now = new Date();
    const opts = { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' };
    updated.textContent = 'Last updated: ' + now.toLocaleString(undefined, opts);
  } catch { updated.textContent = 'Last updated: just now'; }

  // Palettes
  const palettes = [
    { name:'Ion', a1:[208,100,62], a2:[312,88,64], a3:[38,95,58], bg1:'hsl(240 65% 8%)', bg2:'hsl(260 55% 12%)' },
    { name:'Quartz', a1:[280,90,66], a2:[180,85,56], a3:[340,85,62], bg1:'hsl(252 60% 96%)', bg2:'hsl(210 55% 94%)' },
    { name:'Verdigris', a1:[170,85,50], a2:[200,90,58], a3:[45,95,56], bg1:'hsl(165 50% 95%)', bg2:'hsl(190 55% 92%)' },
    { name:'Magma', a1:[18,95,56], a2:[12,90,60], a3:[320,90,64], bg1:'hsl(22 65% 96%)', bg2:'hsl(10 60% 94%)' },
    { name:'Ultraviolet', a1:[260,95,62], a2:[300,88,60], a3:[190,88,56], bg1:'hsl(258 50% 95%)', bg2:'hsl(240 55% 92%)' }
  ];
  let palIndex = 0;
  function setPalette(p){
    root.style.setProperty('--a1', `${p.a1[0]} ${p.a1[1]}% ${p.a1[2]}%`);
    root.style.setProperty('--a2', `${p.a2[0]} ${p.a2[1]}% ${p.a2[2]}%`);
    root.style.setProperty('--a3', `${p.a3[0]} ${p.a3[1]}% ${p.a3[2]}%`);
    if (root.getAttribute('data-theme') === 'light'){
      root.style.setProperty('--bg1', p.bg1);
      root.style.setProperty('--bg2', p.bg2);
    }
  }
  setPalette(palettes[palIndex]);

  // Button ink hover
  function ink(e){
    const b = e.currentTarget.getBoundingClientRect();
    e.currentTarget.style.setProperty('--mx', ((e.clientX - b.left)/b.width)*100 + '%');
    e.currentTarget.style.setProperty('--my', ((e.clientY - b.top)/b.height)*100 + '%');
  }
  root.querySelectorAll('.pill822').forEach(b => b.addEventListener('pointermove', ink, { passive:true }));

  // Canvas sizing
  let DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  let W = 0, H = 0;

  function resize(){
    const r = stage.getBoundingClientRect();
    W = Math.max(300, Math.floor(r.width));
    H = Math.max(300, Math.floor(r.height));
    DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    canvas.width = W * DPR; canvas.height = H * DPR;
    canvas.style.width = W + 'px'; canvas.style.height = H + 'px';
    ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
    buildRibbons();
  }
  window.addEventListener('resize', resize);
  resize();

  // Ribbon field
  let ribbons = [];
  const RIBBON_COUNT_BASE = 6;
  const POINTS = 160;

  function buildRibbons(){
    ribbons = [];
    const count = Math.max(4, Math.floor(RIBBON_COUNT_BASE + (parseInt(flow.value,10)/100)*3));
    for (let i=0; i<count; i++){
      const y = H * (0.15 + (i/(count-1))*0.7);
      const amp = 14 + i*3;
      const freq = 0.002 + i*0.0006;
      const phase = Math.random()*Math.PI*2;
      const hueBias = i/(count-1);
      ribbons.push({ y, amp, baseAmp: amp, freq, phase, colorBias: hueBias });
    }
  }
  buildRibbons();

  // Pointer interaction
  let px = W*0.5, py = H*0.5, hover = false;
  stage.addEventListener('pointerenter', ()=> hover = true, { passive:true });
  stage.addEventListener('pointerleave', ()=> { hover = false; root.style.removeProperty('--px'); root.style.removeProperty('--py'); }, { passive:true });
  stage.addEventListener('pointermove', (e)=>{
    const r = stage.getBoundingClientRect();
    px = e.clientX - r.left; py = e.clientY - r.top;
    const nx = (px/r.width - 0.5)*100;
    const ny = (py/r.height - 0.5)*100;
    root.style.setProperty('--px', nx + '%');
    root.style.setProperty('--py', ny + '%');
  }, { passive:true });

  // Blooms
  function bloomAt(x, y){
    const ring = document.createElement('span');
    ring.className = 'burst822';
    ring.style.setProperty('--rx', x + 'px');
    ring.style.setProperty('--ry', y + 'px');
    const pick = ['var(--a1)','var(--a2)','var(--a3)'][Math.floor(Math.random()*3)];
    ring.style.setProperty('--h', pick);
    stage.appendChild(ring);
    ring.addEventListener('animationend', ()=> ring.remove());
    // inject a transient impulse to ribbons
    for (const rb of ribbons){
      const d = Math.hypot(x - W*0.5, y - rb.y);
      const kick = Math.max(0, 1 - d/Math.max(W,H));
      rb.amp = rb.baseAmp + 90 * kick;
    }
  }
  btnBloom.addEventListener('click', ()=>{
    const r = stage.getBoundingClientRect();
    bloomAt(r.width*0.5, r.height*0.6);
  });
  stage.addEventListener('pointerdown', (e)=>{
    const r = stage.getBoundingClientRect();
    bloomAt(e.clientX - r.left, e.clientY - r.top);
  });

  // Controls
  btnTheme.addEventListener('click', ()=>{
    const isLight = root.getAttribute('data-theme') === 'light';
    root.setAttribute('data-theme', isLight ? 'dark' : 'light');
    setPalette(palettes[palIndex]);
  });
  btnPal.addEventListener('click', ()=>{
    palIndex = (palIndex + 1) % palettes.length;
    setPalette(palettes[palIndex]);
  });
  btnPause.addEventListener('click', ()=>{
    paused = !paused;
    btnPause.setAttribute('aria-pressed', String(paused));
    btnPause.textContent = paused ? 'Resume' : 'Pause';
    const ink = document.createElement('span'); ink.className = 'ink'; btnPause.prepend(ink);
  });
  btnRiff.addEventListener('click', ()=>{
    flow.value = Math.floor(Math.random()*101);
    palIndex = Math.floor(Math.random()*palettes.length);
    setPalette(palettes[palIndex]);
    buildRibbons();
  });
  flow.addEventListener('input', buildRibbons);

  // Render
  let t0 = performance.now();
  let paused = false;
  function render(now){
    const dt = Math.min(0.033, (now - t0) / 1000);
    t0 = now;

    if (!paused){
      const flowV = parseInt(flow.value,10)/100;
      const speed = 0.4 + flowV*2.2;
      const ampScale = 1 + flowV*1.2;

      ctx.clearRect(0,0,W,H);

      // composite mode changes by theme
      const dark = root.getAttribute('data-theme') !== 'light';
      ctx.globalCompositeOperation = dark ? 'screen' : 'multiply';

      for (let i=0; i<ribbons.length; i++){
        const rb = ribbons[i];
        rb.phase += speed * (0.6 + i*0.08) * dt;
        rb.amp += (rb.baseAmp*ampScale - rb.amp) * 0.06; // ease back after blooms

        // Warp toward pointer
        const warp = hover ? Math.max(0, 1 - Math.abs(py - rb.y)/(H*0.6)) : 0;
        const localAmp = rb.amp * (1 + warp*0.8);

        ctx.beginPath();
        const grad = ctx.createLinearGradient(0, rb.y, W, rb.y);
        grad.addColorStop(0, `hsla(${cssHue('--a1')} / ${dark?'.75':'.55'})`);
        grad.addColorStop(0.5, `hsla(${cssHue('--a2')} / ${dark?'.75':'.55'})`);
        grad.addColorStop(1, `hsla(${cssHue('--a3')} / ${dark?'.75':'.55'})`);
        ctx.strokeStyle = grad;
        ctx.lineWidth = 10 + i*1.2;
        ctx.lineCap = 'round';

        for (let x=0; x<=W; x+= W/POINTS){
          const p = x;
          const base = rb.y + Math.sin(p*rb.freq + rb.phase) * localAmp;
          const attract = hover ? (Math.exp(-Math.pow((p - px)/(W*0.12), 2)) * (py - rb.y) * 0.8) : 0;
          const y = base + attract;
          if (x===0) ctx.moveTo(p, y);
          else ctx.lineTo(p, y);
        }
        ctx.stroke();
      }

      // soft veil
      ctx.globalCompositeOperation = dark ? 'soft-light' : 'overlay';
      const veil = ctx.createLinearGradient(0, 0, 0, H);
      veil.addColorStop(0, dark ? 'hsla(0,0%,100%,.06)' : 'hsla(0,0%,0%,.04)');
      veil.addColorStop(1, 'transparent');
      ctx.fillStyle = veil;
      ctx.fillRect(0,0,W,H);
    }

    requestAnimationFrame(render);
  }
  requestAnimationFrame(render);

  function cssHue(varName){
    // read CSS variable "h s l" and return "h s% l%"
    const v = getComputedStyle(root).getPropertyValue(varName).trim();
    return v || '200 100% 60%';
  }

  // Reduced motion
  const media = window.matchMedia('(prefers-reduced-motion: reduce)');
  function setReduced(state){
    paused = !!state;
    btnPause.setAttribute('aria-pressed', String(paused));
    btnPause.textContent = paused ? 'Resume' : 'Pause';
  }
  setReduced(media.matches);
  media.addEventListener?.('change', e => setReduced(e.matches));
})();
</script>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


