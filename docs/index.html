<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="aerolume" data-theme="nocturne" aria-label="Aerolume • Iteration 698">
  <style>
    /* ---- Design tokens ---- */
    #aerolume{
      --ink:#e8eeff;
      --muted:#b6c2dd;
      --ring:rgba(232,238,255,0.18);
      --bg1:#0b0f1c; --bg2:#0e1224;
      --c1:#7aa6ff; --c2:#76ffe8; --c3:#ffce70; --c4:#ff76d1;
      --rx:0deg; --ry:0deg;
      position:relative; isolation:isolate; overflow:clip;
      border-radius:36px; padding:clamp(16px,4vw,44px);
      border:1px solid var(--ring);
      background: radial-gradient(140% 120% at -10% -10%, rgba(255,255,255,0.07), transparent 50%),
                  radial-gradient(120% 160% at 120% 120%, rgba(255,255,255,0.05), transparent 60%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
      color:var(--ink);
      min-height:760px;
      font:500 15px/1.6 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
      box-shadow: 0 90px 180px rgba(0,0,0,0.24), inset 0 0 0 1px rgba(255,255,255,0.05);
    }

    /* Themes */
    #aerolume[data-theme="nocturne"]{
      --ink:#e8eeff; --muted:#b6c2dd; --ring:rgba(232,238,255,0.18);
      --bg1:#070a16; --bg2:#0f1531;
      --c1:#7aa6ff; --c2:#76ffe8; --c3:#ffd27a; --c4:#ff76d1;
    }
    #aerolume[data-theme="dawn"]{
      --ink:#0f1322; --muted:#4f5a78; --ring:rgba(16,19,34,0.18);
      --bg1:#fdf6ff; --bg2:#eef6ff;
      --c1:#ff8fb2; --c2:#ffd66e; --c3:#7ad8ff; --c4:#7affc4;
    }
    #aerolume[data-theme="mint"]{
      --ink:#0f1322; --muted:#465469; --ring:rgba(16,19,34,0.16);
      --bg1:#eafff5; --bg2:#e9f8ff;
      --c1:#46e2a8; --c2:#63d8ff; --c3:#ffd27a; --c4:#a07aff;
    }
    #aerolume[data-theme="solar"]{
      --ink:#111318; --muted:#6a7184; --ring:rgba(16,19,27,0.16);
      --bg1:#fff6e6; --bg2:#fff1fb;
      --c1:#ffb36e; --c2:#ffe36e; --c3:#7cffc1; --c4:#7aa6ff;
    }

    /* Ambient halo + grain */
    #aerolume .halo{
      position:absolute; inset:-30%;
      background:
        conic-gradient(from 0.1turn, color-mix(in lab, var(--c1), transparent 74%),
                                     color-mix(in lab, var(--c4), transparent 76%),
                                     color-mix(in lab, var(--c2), transparent 76%),
                                     color-mix(in lab, var(--c3), transparent 76%));
      filter: blur(100px) saturate(130%);
      mix-blend-mode: screen; opacity:.55;
      animation: sweep 28s linear infinite;
      z-index:0;
    }
    @keyframes sweep { to{ transform: rotate(360deg)} }
    #aerolume .grain{
      position:absolute; inset:-6%;
      background:
        repeating-linear-gradient(0deg, rgba(255,255,255,0.03) 0 2px, transparent 2px 6px),
        repeating-conic-gradient(from 0deg, rgba(0,0,0,0.06) 0 12deg, transparent 12deg 24deg);
      mix-blend-mode: soft-light; opacity:.06; pointer-events:none; z-index:0;
      animation: gra 8s steps(6) infinite;
    }
    @keyframes gra { 50% { transform: translate(2px,-2px)} }

    /* Header */
    #aerolume .top{
      position:relative; z-index:2;
      display:flex; justify-content:space-between; align-items:center; gap:16px;
      margin-bottom: clamp(8px,2.6vw,22px);
    }
    #aerolume .brand{ display:flex; align-items:center; gap:12px; color:var(--muted); font-weight:900; letter-spacing:.2px; }
    #aerolume .logo{
      width:40px; height:40px; border-radius:12px; display:grid; place-items:center; overflow:hidden;
      border:1px solid var(--ring);
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.02));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.12), 0 14px 28px rgba(0,0,0,0.28);
      position:relative;
    }
    #aerolume .logo::before{
      content:""; position:absolute; inset:7px; border-radius:9px;
      background: conic-gradient(from .2turn, var(--c1), var(--c2), var(--c3), var(--c4), var(--c1));
      -webkit-mask: radial-gradient(60% 60% at 50% 50%, #000 55%, transparent 56%);
              mask: radial-gradient(60% 60% at 50% 50%, #000 55%, transparent 56%);
      animation: spin 18s linear infinite;
    }
    @keyframes spin { to { transform: rotate(405deg)} }

    /* Controls */
    #aerolume .dock{ display:flex; align-items:center; flex-wrap:wrap; gap:10px;}
    #aerolume .chip, #aerolume .swatch{
      appearance:none; user-select:none; -webkit-tap-highlight-color:transparent; cursor:pointer;
      border:1px solid var(--ring); color:var(--ink);
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      border-radius:14px; box-shadow: 0 16px 36px rgba(0,0,0,0.18), inset 0 0 0 1px rgba(255,255,255,0.08);
      transition: transform .14s ease, box-shadow .2s ease, background .2s ease, opacity .2s ease;
    }
    #aerolume .chip{ padding:10px 14px; font-weight:800; letter-spacing:.2px; font-size:12px; }
    #aerolume .chip:hover{ transform: translateY(-1px); box-shadow: 0 24px 48px rgba(0,0,0,0.28), 0 0 0 6px rgba(255,255,255,0.03); }
    #aerolume .chip.primary{
      background:
        linear-gradient(180deg, rgba(255,255,255,0.16), rgba(255,255,255,0.06)),
        linear-gradient(90deg, var(--c1), var(--c3));
      background-blend-mode: overlay, normal; color:#0f1322; border-color: rgba(0,0,0,0.18);
    }
    #aerolume .swatch{
      width:26px; height:26px; border-radius:999px; padding:0; position:relative;
      background: conic-gradient(from .2turn, var(--c1), var(--c2), var(--c3), var(--c4));
    }
    #aerolume .swatch[data-theme="nocturne"]{ background: conic-gradient(from .2turn, #7aa6ff,#76ffe8,#ffd27a,#ff76d1);}
    #aerolume .swatch[data-theme="dawn"]{ background: conic-gradient(from .2turn, #ff8fb2,#ffd66e,#7ad8ff,#7affc4);}
    #aerolume .swatch[data-theme="mint"]{ background: conic-gradient(from .2turn, #46e2a8,#63d8ff,#ffd27a,#a07aff);}
    #aerolume .swatch[data-theme="solar"]{ background: conic-gradient(from .2turn, #ffb36e,#ffe36e,#7cffc1,#7aa6ff);}
    #aerolume .swatch.active::after{ content:""; position:absolute; inset:4px; border-radius:999px; border:2px solid rgba(255,255,255,0.95); }

    /* Hero */
    #aerolume .hero{ position:relative; z-index:2; display:grid; gap: clamp(6px,1.4vw,14px); margin: clamp(8px,3vw,24px) 0; }
    #aerolume .kicker{ color:var(--muted); text-transform:uppercase; letter-spacing:.28em; font-weight:900; font-size: clamp(11px,1.2vw,13px); }
    #aerolume .title{
      font-weight:950; letter-spacing:-0.02em; line-height:.9;
      font-size: clamp(48px,8.2vw,108px);
      background: linear-gradient(90deg, var(--ink) 0 8%, var(--c4) 35%, var(--c1) 58%, var(--c3));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow: 0 1px 0 rgba(255,255,255,0.12);
    }
    #aerolume .sub{ color:var(--muted); max-width:72ch; font-size: clamp(13px,1.7vw,18px); }

    /* Stage */
    #aerolume .stage{ position:relative; z-index:1; display:grid; place-items:center; margin: clamp(14px,4vw,36px) 0; }
    #aerolume .orb{
      width:min(92vw, 900px); aspect-ratio: 1/1; border-radius:50%; position:relative; overflow:hidden;
      border:1px solid var(--ring);
      transform-style:preserve-3d; transform: rotateX(var(--rx)) rotateY(var(--ry));
      background:
        radial-gradient(120% 120% at 50% 50%, rgba(255,255,255,0.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      box-shadow: 0 50px 140px rgba(0,0,0,0.3), inset 0 0 0 1px rgba(255,255,255,0.12);
      backdrop-filter: blur(10px) saturate(115%); -webkit-backdrop-filter: blur(10px) saturate(115%);
    }
    #aerolume canvas{ position:absolute; inset:0; width:100%; height:100%; display:block; }
    #aerolume .ring{
      position:absolute; inset:6%; border-radius:50%;
      background:
        conic-gradient(from 0turn, transparent 0 20%, color-mix(in lab, var(--c1), transparent 50%) 20% 34%,
                                 transparent 34% 64%, color-mix(in lab, var(--c4), transparent 40%) 64% 76%, transparent 76% 100%);
      -webkit-mask: radial-gradient(circle, transparent 60%, #000 62%, #000 64%, transparent 65%);
              mask: radial-gradient(circle, transparent 60%, #000 62%, #000 64%, transparent 65%);
      opacity:.75; filter: blur(0.4px);
    }
    #aerolume .ring-b{ inset:12%; opacity:.5; animation: ring 20s linear infinite reverse; }
    #aerolume .ring-a{ animation: ring 28s linear infinite; }
    @keyframes ring { to { transform: rotate(360deg)} }

    /* Hints */
    #aerolume .hints{ position:relative; z-index:2; display:flex; gap:10px; flex-wrap:wrap; justify-content:center; align-items:center;}
    #aerolume .pill{
      font-size:12px; color:var(--muted); display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--ring); border-radius:999px; padding:6px 10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04));
      box-shadow: 0 8px 18px rgba(0,0,0,0.22);
    }
    #aerolume kbd{
      font:700 11px/1 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      color:#0f1322; background: linear-gradient(90deg, var(--c4), var(--c1));
      padding:6px 8px; border-radius:8px; border:1px solid rgba(0,0,0,0.18);
      box-shadow: 0 2px 10px rgba(0,0,0,0.24); letter-spacing:.15px;
    }

    /* Footer */
    #aerolume .foot{ position:relative; z-index:2; margin-top:22px; display:flex; flex-direction:column; gap:10px; align-items:center; color:var(--muted); }
    #aerolume .rule{ height:1px; width:100%; border-radius:1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent); opacity:.12; }
    #aerolume .meta{
      display:inline-flex; gap:10px; align-items:center; font-size:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04));
      border:1px solid var(--ring); padding:6px 10px; border-radius:999px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.22);
    }
    #aerolume .tag{
      padding: 4px 8px; border-radius: 999px; font-size:11px; color:#0f1322;
      background: linear-gradient(90deg, var(--c2), var(--c4));
      box-shadow: 0 2px 12px rgba(0,0,0,0.28); font-weight:800; letter-spacing: .3px;
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      #aerolume, #aerolume *{ animation:none !important; transition:none !important; }
      #aerolume .halo, #aerolume .ring{ display:none !important; }
    }
  </style>

  <div class="halo" aria-hidden="true"></div>
  <div class="grain" aria-hidden="true"></div>

  <div class="top">
    <div class="brand" aria-label="Brand">
      <span class="logo" aria-hidden="true"></span>
      <span>Aerolume • Iteration 698</span>
    </div>
    <div class="dock" role="group" aria-label="Controls">
      <button class="swatch active" data-theme="nocturne" title="Nocturne"></button>
      <button class="swatch" data-theme="dawn" title="Dawn"></button>
      <button class="swatch" data-theme="mint" title="Mint"></button>
      <button class="swatch" data-theme="solar" title="Solar"></button>
      <button class="chip primary" id="pulse" title="Play or pause">Pause</button>
      <button class="chip" id="trail" title="Toggle trails">Trails: On</button>
      <button class="chip" id="bloom" title="Cycle glow">Bloom: 1×</button>
      <button class="chip" id="seeds" title="Change particle count">Seeds: 360</button>
    </div>
  </div>

  <div class="hero">
    <div class="kicker">Breathing light</div>
    <h1 class="title">The Lumen Garden</h1>
    <p class="sub">Tilt the orb with your pointer. Watch streams of color fold into living patterns. Click to awaken comets; wheel to bend the current.</p>
  </div>

  <div class="stage">
    <div class="orb" id="orb">
      <canvas id="field" aria-label="Interactive light field"></canvas>
      <div class="ring ring-a" aria-hidden="true"></div>
      <div class="ring ring-b" aria-hidden="true"></div>
    </div>
  </div>

  <div class="hints" aria-label="Shortcuts">
    <span class="pill"><kbd>Click</kbd> comets</span>
    <span class="pill"><kbd>Wheel</kbd> bend</span>
    <span class="pill"><kbd>Space</kbd> pause</span>
    <span class="pill"><kbd>T</kbd> theme</span>
    <span class="pill"><kbd>+</kbd>/<kbd>-</kbd> seeds</span>
  </div>

  <div class="foot">
    <div class="rule" aria-hidden="true"></div>
    <small class="meta">
      <span class="tag">Now Playing</span>
      <span id="last-updated">Last updated: 2025-11-17 09:18:36 EST</span>
    </small>
  </div>

  <script>
    (function(){
      const root   = document.getElementById('aerolume');
      const orb    = document.getElementById('orb');
      const canvas = document.getElementById('field');
      const ctx    = canvas.getContext('2d', { alpha:true });
      const updated= document.getElementById('last-updated');

      const swatches = [...root.querySelectorAll('.swatch')];
      const pulseBtn = document.getElementById('pulse');
      const trailBtn = document.getElementById('trail');
      const bloomBtn = document.getElementById('bloom');
      const seedsBtn = document.getElementById('seeds');

      // Timestamp
      try{
        const fmt = new Intl.DateTimeFormat([], { dateStyle:'medium', timeStyle:'medium' });
        updated.textContent = 'Last updated: ' + fmt.format(new Date());
      }catch{
        updated.textContent = 'Last updated: ' + new Date().toLocaleString();
      }

      // DPI fit
      let W=0, H=0, DPR=Math.min(2, window.devicePixelRatio||1);
      function fit(){
        const r = orb.getBoundingClientRect();
        W = Math.max(320, Math.floor(r.width));
        H = Math.max(320, Math.floor(r.height));
        canvas.width = Math.floor(W*DPR);
        canvas.height= Math.floor(H*DPR);
        canvas.style.width = W+'px'; canvas.style.height = H+'px';
        ctx.setTransform(DPR,0,0,DPR,0,0);
      }
      new ResizeObserver(fit).observe(orb);
      fit();

      // Palette
      function palette(){
        const cs = getComputedStyle(root);
        return ['--c1','--c2','--c3','--c4'].map(k=>cs.getPropertyValue(k).trim());
      }
      let colors = palette();

      // State
      let paused=false, trails=true;
      let bloom = 1;     // 1×, 2×, 3×
      let seedCount = 360;
      let time=0;
      const aim = { x: W*0.5, y:H*0.5, nx:0.5, ny:0.5, bend:1.0 };

      // Pointer + tilt
      function norm(e){
        const r = orb.getBoundingClientRect();
        const x = e.clientX - r.left, y = e.clientY - r.top;
        aim.x=x; aim.y=y; aim.nx = x/r.width; aim.ny = y/r.height;
        root.style.setProperty('--ry', ((aim.nx - 0.5) * 14).toFixed(2) + 'deg');
        root.style.setProperty('--rx', (-(aim.ny - 0.5) * 8).toFixed(2) + 'deg');
      }
      orb.addEventListener('pointermove', norm, { passive:true });
      orb.addEventListener('pointerleave', ()=>{ aim.nx=0.5; aim.ny=0.5; root.style.setProperty('--rx','0deg'); root.style.setProperty('--ry','0deg'); }, { passive:true });
      orb.addEventListener('wheel', (e)=>{ e.preventDefault(); aim.bend = Math.max(0.5, Math.min(2.6, aim.bend + (Math.sign(e.deltaY)>0?-0.08:0.08))); }, { passive:false });

      // Comets (click)
      const comets=[];
      orb.addEventListener('click', (e)=>{
        const r = orb.getBoundingClientRect();
        const x = e.clientX - r.left, y = e.clientY - r.top;
        for(let i=0;i<14;i++){
          const a = (i/14)*Math.PI*2 + Math.random()*0.3;
          const v = 90 + Math.random()*220;
          comets.push({ x,y, vx:Math.cos(a)*v, vy:Math.sin(a)*v, life:1, hue: colors[i%colors.length] });
        }
      }, { passive:true });

      // Particles
      let pts=[];
      function seed(n=seedCount){
        pts = [];
        colors = palette();
        for(let i=0;i<n;i++){
          const th = i/n * Math.PI*2;
          const r = (Math.min(W,H)*0.42) * (0.25 + Math.random()*0.75);
          const cx=W*0.5 + Math.cos(th)*r*0.18;
          const cy=H*0.5 + Math.sin(th)*r*0.18;
          pts.push({
            x: cx + (Math.random()-0.5)*40,
            y: cy + (Math.random()-0.5)*40,
            vx:0, vy:0,
            hue: colors[i%colors.length],
            jitter: 0.6 + Math.random()*0.7
          });
        }
        seedsBtn.textContent = 'Seeds: ' + n;
      }
      seed(seedCount);

      // Flow field
      function field(x,y,t){
        const kx = 0.0028 + aim.nx*0.0018;
        const ky = 0.0024 + aim.ny*0.0016;
        const a = Math.sin(x*kx*aim.bend + t*0.9) + Math.cos(y*ky*aim.bend + t*1.1);
        const b = Math.sin((x+y)*kx*0.6 + t*1.3) - Math.cos((x-y)*ky*0.7 + t*0.7);
        return Math.atan2(b, a);
      }

      // Controls
      pulseBtn.addEventListener('click', ()=>{ paused=!paused; pulseBtn.textContent = paused?'Resume':'Pause'; });
      trailBtn.addEventListener('click', ()=>{ trails=!trails; trailBtn.textContent = 'Trails: ' + (trails?'On':'Off'); if(!trails){ ctx.clearRect(0,0,W,H);} });
      bloomBtn.addEventListener('click', ()=>{
        bloom = bloom>=3 ? 1 : bloom+1;
        bloomBtn.textContent = 'Bloom: ' + bloom + '×';
      });
      seedsBtn.addEventListener('click', ()=>{
        seedCount = seedCount>=560 ? 200 : seedCount+80;
        seed(seedCount);
      });

      // Keyboard
      window.addEventListener('keydown', (e)=>{
        if(e.key===' '){ e.preventDefault(); pulseBtn.click(); }
        if(e.key==='t' || e.key==='T'){ cycleTheme(); }
        if(e.key==='+'){ seedCount=Math.min(800, seedCount+40); seed(seedCount); }
        if(e.key==='-'){ seedCount=Math.max(120, seedCount-40); seed(seedCount); }
      }, { passive:false });

      // Themes
      function setTheme(name){
        root.dataset.theme = name;
        swatches.forEach(s=>s.classList.toggle('active', s.dataset.theme===name));
        colors = palette();
      }
      function cycleTheme(){
        const order=['nocturne','dawn','mint','solar'];
        const i = order.indexOf(root.dataset.theme);
        setTheme(order[(i+1)%order.length]);
      }
      swatches.forEach(s=>s.addEventListener('click', ()=> setTheme(s.dataset.theme)));

      try{
        const h = new Date().getHours();
        if(h>=7 && h<12) setTheme('dawn');
        if(h>=12 && h<17) setTheme('mint');
        if(h>=17 && h<21) setTheme('solar');
        if(h>=21 || h<7) setTheme('nocturne');
      }catch{}

      // Render helpers
      function fadeFrame(){
        const dark = root.dataset.theme==='nocturne';
        const alpha = trails ? (dark? 0.06 : 0.10) : 1;
        ctx.fillStyle = (dark? 'rgba(8,10,18,'+alpha+')' : 'rgba(255,255,255,'+alpha+')');
        ctx.fillRect(0,0,W,H);
      }

      function draw(dt){
        fadeFrame();

        // particles
        ctx.save();
        ctx.globalCompositeOperation = 'screen';
        for(let i=0;i<pts.length;i++){
          const p = pts[i];
          const a = field(p.x - W*0.5, p.y - H*0.5, time) + (p.jitter-1.0)*0.6;
          const sp = 36 + 120*aim.bend;
          p.vx += Math.cos(a)*sp*dt;
          p.vy += Math.sin(a)*sp*dt;

          // mild attraction to pointer
          const dx = (aim.x - p.x), dy = (aim.y - p.y);
          const d2 = dx*dx + dy*dy + 1;
          const pull = 3000/d2;
          p.vx += dx*pull*dt*0.6;
          p.vy += dy*pull*dt*0.6;

          // damping
          p.vx *= 0.96; p.vy *= 0.96;

          const x0=p.x, y0=p.y;
          p.x += p.vx*dt; p.y += p.vy*dt;

          // wrap softly within orb
          const cx=W*0.5, cy=H*0.5;
          const r = Math.min(W,H)*0.48;
          const dist = Math.hypot(p.x-cx, p.y-cy);
          if(dist>r){
            const ang = Math.atan2(p.y-cy, p.x-cx);
            p.x = cx + Math.cos(ang)*r*0.98;
            p.y = cy + Math.sin(ang)*r*0.98;
            p.vx *= -0.2; p.vy *= -0.2;
          }

          // stroke
          ctx.strokeStyle = p.hue;
          ctx.lineWidth = (1 + 0.6*Math.sin(time*3+i))*bloom*0.8;
          ctx.globalAlpha = 0.55;
          ctx.beginPath();
          ctx.moveTo(x0, y0);
          ctx.lineTo(p.x, p.y);
          ctx.stroke();

          if(bloom>1){
            ctx.globalAlpha = 0.18*bloom;
            ctx.shadowColor = p.hue;
            ctx.shadowBlur = 12*bloom;
            ctx.beginPath();
            ctx.moveTo(p.x, p.y);
            ctx.lineTo(p.x - p.vx*0.03, p.y - p.vy*0.03);
            ctx.stroke();
            ctx.shadowBlur = 0;
          }
        }
        ctx.restore();

        // comets
        for(let i=comets.length-1;i>=0;i--){
          const c = comets[i];
          c.life -= dt*0.8;
          if(c.life<=0){ comets.splice(i,1); continue; }
          c.vx *= 0.987; c.vy *= 0.987;
          c.x += c.vx*dt; c.y += c.vy*dt;
          ctx.save();
          ctx.globalCompositeOperation = 'screen';
          ctx.globalAlpha = 0.6 * c.life;
          ctx.strokeStyle = c.hue;
          ctx.lineWidth = 2.2*bloom;
          ctx.lineCap = 'round';
          ctx.beginPath();
          ctx.moveTo(c.x, c.y);
          ctx.lineTo(c.x - c.vx*0.05, c.y - c.vy*0.05);
          ctx.stroke();
          ctx.globalAlpha = 0.35 * c.life;
          ctx.fillStyle = c.hue;
          ctx.shadowColor = c.hue; ctx.shadowBlur = 14;
          ctx.beginPath(); ctx.arc(c.x, c.y, 2*bloom, 0, Math.PI*2); ctx.fill();
          ctx.restore();
        }
      }

      // Loop
      let last = performance.now();
      const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
      function loop(ts){
        const dt = Math.min(0.033, (ts-last)/1000);
        last = ts;
        if(!paused && !reduce){
          time += dt;
          draw(dt);
        }
        raf = requestAnimationFrame(loop);
      }
      let raf = requestAnimationFrame(loop);
      window.addEventListener('beforeunload', ()=> cancelAnimationFrame(raf), { passive:true });

      // Reseed on resize for balance
      let t; window.addEventListener('resize', ()=>{ clearTimeout(t); t=setTimeout(()=> seed(seedCount), 120); }, { passive:true });
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


