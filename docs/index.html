<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="vibe1982" role="region" aria-label="Kaleidoscope Atelier — Daylight Loom">
  <style>
    .vibe1982 {
      --paper: #f7f8fb;
      --bg: #ffffff;
      --ink: #0e1015;
      --muted: #5a6475;
      --frame: #e6e9f2;
      --a1: #2563eb; /* blue */
      --a2: #22c55e; /* green */
      --a3: #f59e0b; /* amber */
      --ring: 37 99 235;
      position: relative;
      min-height: 760px;
      padding: clamp(18px, 3vw, 36px);
      border-radius: 32px;
      color: var(--ink);
      background:
        radial-gradient(160% 100% at 85% -10%, #fff0d6 0%, rgba(255,240,214,0) 50%),
        radial-gradient(120% 100% at 0% 0%, #e8f3ff 0%, rgba(232,243,255,0) 45%),
        linear-gradient(180deg, var(--bg), var(--paper));
      box-shadow:
        0 40px 90px rgba(0, 0, 0, .06),
        0 0 0 1px rgba(0, 0, 0, .04) inset;
      overflow: hidden;
      isolation: isolate;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    .vibe1982::before {
      content: "";
      position: absolute; inset: -20%;
      background:
        conic-gradient(from 120deg at 50% 50%, rgba(37,99,235,.08), rgba(34,197,94,.08), rgba(245,158,11,.08), rgba(37,99,235,.08));
      filter: blur(60px) saturate(120%);
      opacity: .35;
      mix-blend-mode: multiply;
      pointer-events: none;
    }
    .vibe1982::after {
      content: "";
      position: absolute; inset: 0;
      background:
        repeating-linear-gradient(0deg, rgba(0,0,0,.02) 0 1px, rgba(0,0,0,0) 1px 3px),
        repeating-linear-gradient(90deg, rgba(0,0,0,.012) 0 1px, rgba(0,0,0,0) 1px 4px);
      opacity: .35;
      mix-blend-mode: multiply;
      pointer-events: none;
    }

    .k-frame {
      position: relative;
      max-width: 1160px;
      margin: 0 auto;
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: clamp(16px, 2.6vw, 32px);
      z-index: 1;
    }

    .k-head {
      display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap;
    }
    .k-stamp {
      display: inline-flex; align-items: center; gap: 12px;
      padding: 10px 16px; border-radius: 999px;
      background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.7));
      border: 1px solid var(--frame);
      box-shadow: 0 10px 26px rgba(0,0,0,.08);
      font-size: 12px; letter-spacing: .08em; text-transform: uppercase;
      color: var(--muted); user-select: none; white-space: nowrap;
      backdrop-filter: blur(8px) saturate(130%); -webkit-backdrop-filter: blur(8px) saturate(130%);
    }
    .k-stamp::before {
      content: "";
      width: 10px; height: 10px; border-radius: 50%;
      background: radial-gradient(circle at 35% 35%, #fff, rgba(37,99,235,1));
      box-shadow: 0 0 10px rgba(37,99,235,.5), 0 0 0 1px rgba(37,99,235,.22) inset;
      flex: none;
    }

    .k-actions { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    .k-btn {
      appearance: none; border: 1px solid var(--frame);
      background: linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.7));
      color: var(--ink);
      padding: 10px 14px; border-radius: 12px; font-weight: 700; font-size: 12px; cursor: pointer;
      box-shadow: 0 1px 0 rgba(255,255,255,1) inset, 0 8px 18px rgba(0,0,0,.08);
      transition: transform .12s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease, color .2s ease;
      backdrop-filter: blur(6px) saturate(160%); -webkit-backdrop-filter: blur(6px) saturate(160%);
    }
    .k-btn:hover { transform: translateY(-1px); box-shadow: 0 1px 0 rgba(255,255,255,1) inset, 0 12px 26px rgba(0,0,0,.12); }
    .k-btn:active { transform: translateY(0); }
    .k-btn:focus-visible { outline: none; box-shadow: 0 0 0 3px rgba(var(--ring), .35); }

    .k-stage {
      position: relative; border-radius: 28px; overflow: hidden;
      border: 1px solid var(--frame);
      background:
        radial-gradient(120% 100% at 50% 0%, rgba(255,255,255,1), rgba(255,255,255,.8)),
        linear-gradient(180deg, rgba(255,255,255,.7), rgba(255,255,255,.5));
      min-height: 560px; display: grid; place-items: center;
      box-shadow:
        0 30px 80px rgba(0,0,0,.08) inset,
        0 1px 0 rgba(255,255,255,0.9) inset,
        0 24px 60px rgba(0,0,0,.12);
    }
    .k-art { position: absolute; inset: 0; width: 100%; height: 100%; display: block; filter: saturate(120%) contrast(110%); }

    .k-lens {
      position: absolute; inset: 10% 12%;
      border-radius: 24px;
      pointer-events: none;
      background:
        radial-gradient(80% 100% at 50% 45%, rgba(37,99,235,.08), rgba(34,197,94,.06) 40%, rgba(245,158,11,.06) 70%, rgba(0,0,0,0) 80%),
        radial-gradient(50% 60% at 30% 10%, rgba(255,255,255,.9), rgba(255,255,255,0) 60%);
      mix-blend-mode: multiply; opacity: .75;
    }
    .k-grid {
      position: absolute; inset: 0; pointer-events: none;
      background:
        linear-gradient(transparent, transparent),
        repeating-linear-gradient(0deg, rgba(0,0,0,.04) 0 1px, transparent 1px 32px),
        repeating-linear-gradient(90deg, rgba(0,0,0,.04) 0 1px, transparent 1px 32px);
      opacity: .18;
      mask-image: radial-gradient(80% 120% at 50% 50%, black, transparent);
    }

    .k-title {
      position: relative; z-index: 2; text-align: center;
      padding: 10px 14px; border-radius: 14px; border: 1px solid var(--frame);
      background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.7));
      box-shadow: 0 12px 40px rgba(0,0,0,0.08);
    }
    .k-title h1 {
      margin: 10px 0 6px; font-size: clamp(40px, 7.2vw, 86px); letter-spacing: -0.02em; line-height: .95;
      background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3));
      background-size: 200% 100%;
      -webkit-background-clip: text; background-clip: text; color: transparent;
      animation: hueSlide 16s ease-in-out infinite alternate;
      text-wrap: balance;
      filter: drop-shadow(0 10px 50px rgba(37,99,235,.15));
    }
    .k-title p { margin: 0 6px 8px; color: var(--muted); font-size: clamp(14px, 2vw, 18px); text-wrap: balance; }
    @keyframes hueSlide { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }

    .k-bar {
      display: flex; flex-wrap: wrap; align-items: center; gap: 10px; justify-content: space-between;
      background: linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.7));
      border: 1px solid var(--frame); border-radius: 16px; padding: 10px;
      box-shadow: 0 1px 0 rgba(255,255,255,1) inset, 0 8px 22px rgba(0,0,0,.08);
      color: var(--muted); font-size: 12px;
      backdrop-filter: blur(8px) saturate(160%); -webkit-backdrop-filter: blur(8px) saturate(160%);
    }
    .k-ctrls { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    .k-check { color: var(--muted); font-size: 12px; display: inline-flex; align-items: center; gap: 6px; user-select: none; }
    .k-range {
      -webkit-appearance: none; appearance: none; height: 8px; width: 160px; border-radius: 999px;
      background: linear-gradient(90deg, rgba(var(--ring),.45), rgba(34,197,94,.45));
      outline: none; border: 1px solid var(--frame);
      box-shadow: 0 1px 0 rgba(255,255,255,1) inset, 0 8px 12px rgba(0,0,0,.06) inset;
    }
    .k-range::-webkit-slider-thumb {
      -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background: #ffffff; border: 1px solid var(--frame);
      box-shadow: 0 6px 18px rgba(0,0,0,.12), 0 0 0 3px rgba(37,99,235,.15);
    }
    .k-range::-moz-range-thumb {
      width: 18px; height: 18px; border-radius: 50%;
      background: #ffffff; border: 1px solid var(--frame);
      box-shadow: 0 6px 18px rgba(0,0,0,.12), 0 0 0 3px rgba(37,99,235,.15);
    }
    .k-right { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    .k-tip { opacity: .9; }

    .grain-off { display: none; }

    @media (max-width: 900px) {
      .k-stage { min-height: 520px; }
      .k-right { width: 100%; justify-content: space-between; }
    }
    @media (prefers-reduced-motion: reduce) {
      .vibe1982, .vibe1982 * { animation: none !important; transition: none !important; }
    }
  </style>

  <div class="k-frame">
    <div class="k-head">
      <span class="k-stamp">Kaleidoscope Atelier — Iteration 1982</span>
      <div class="k-actions">
        <button class="k-btn" data-theme aria-label="Switch theme">Theme: Daylight</button>
        <button class="k-btn" data-mode aria-label="Switch scene">Scene: Kaleido</button>
        <button class="k-btn" data-run aria-pressed="false" aria-label="Toggle motion">Pause motion</button>
      </div>
    </div>

    <div class="k-stage" aria-label="Kaleidoscopic light loom">
      <canvas class="k-art" aria-hidden="true"></canvas>
      <div class="k-lens" data-lens></div>
      <div class="k-grid" data-grain></div>
      <div class="k-title" aria-live="polite">
        <h1>Daylight Loom</h1>
        <p>Symmetry, softened. Touch to weave.</p>
      </div>
    </div>

    <div class="k-bar" aria-label="Controls">
      <div class="k-ctrls">
        <label class="k-check">Segments
          <input class="k-range" type="range" min="4" max="24" step="1" value="12" data-seg aria-label="Segment count" />
        </label>
        <label class="k-check">Density
          <input class="k-range" type="range" min="3" max="40" step="1" value="18" data-den aria-label="Ribbon density" />
        </label>
        <label class="k-check">Bloom
          <input class="k-range" type="range" min="0" max="1" step="0.01" value="0.55" data-bloom aria-label="Glow strength" />
        </label>
        <label class="k-check"><input type="checkbox" data-grain-toggle checked /> Grid</label>
        <label class="k-check"><input type="checkbox" data-lens-toggle checked /> Lens</label>
        <label class="k-check"><input type="checkbox" data-spin checked /> Auto-rotate</label>
      </div>
      <div class="k-right">
        <span id="last-updated">Last updated: 2026-01-15 20:39:36 EST</span>
        <span class="k-tip">Tip: drag to steer • click to bloom</span>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const root = document.currentScript.parentElement;
      const canvas = root.querySelector('.k-art');
      const ctx = canvas.getContext('2d', { alpha: true });
      const lens = root.querySelector('[data-lens]');
      const grain = root.querySelector('[data-grain]');
      const themeBtn = root.querySelector('[data-theme]');
      const modeBtn = root.querySelector('[data-mode]');
      const runBtn = root.querySelector('[data-run]');
      const segRange = root.querySelector('[data-seg]');
      const denRange = root.querySelector('[data-den]');
      const bloomRange = root.querySelector('[data-bloom]');
      const grainT = root.querySelector('[data-grain-toggle]');
      const lensT = root.querySelector('[data-lens-toggle]');
      const spinT = root.querySelector('[data-spin]');
      const updated = root.querySelector('#last-updated');

      // Timestamp
      try {
        const locale = navigator.language || 'en-US';
        const now = new Date();
        updated.textContent = 'Updated ' + now.toLocaleString(locale, {
          year: 'numeric', month: 'short', day: '2-digit',
          hour: '2-digit', minute: '2-digit'
        });
      } catch (_) {
        updated.textContent = 'Updated ' + new Date().toString();
      }

      // Themes
      const themes = [
        { name: 'Daylight', vars: { paper:'#f7f8fb', bg:'#ffffff', ink:'#0e1015', muted:'#5a6475', frame:'#e6e9f2', a1:'#2563eb', a2:'#22c55e', a3:'#f59e0b', ring:'37 99 235' } },
        { name: 'Dusk', vars: { paper:'#0f1220', bg:'#0a0d18', ink:'#e6eaf7', muted:'#9aa3b7', frame:'#1b2233', a1:'#60a5fa', a2:'#f472b6', a3:'#f59e0b', ring:'96 165 250' } },
        { name: 'Mist', vars: { paper:'#eef6ff', bg:'#e8f3ff', ink:'#0d1526', muted:'#5b6b86', frame:'#c8d6ea', a1:'#22d3ee', a2:'#a78bfa', a3:'#10b981', ring:'34 211 238' } },
        { name: 'Midnight', vars: { paper:'#0a0a0d', bg:'#09090b', ink:'#f7f7fb', muted:'#a8a8b3', frame:'#1c1c22', a1:'#22d3ee', a2:'#a3e635', a3:'#f472b6', ring:'34 211 238' } }
      ];
      let themeIndex = 0;
      function applyVars(v) {
        root.style.setProperty('--paper', v.paper);
        root.style.setProperty('--bg', v.bg);
        root.style.setProperty('--ink', v.ink);
        root.style.setProperty('--muted', v.muted);
        root.style.setProperty('--frame', v.frame);
        root.style.setProperty('--a1', v.a1);
        root.style.setProperty('--a2', v.a2);
        root.style.setProperty('--a3', v.a3);
        root.style.setProperty('--ring', v.ring);
      }
      function setTheme(i) {
        themeIndex = (i + themes.length) % themes.length;
        applyVars(themes[themeIndex].vars);
        themeBtn.textContent = 'Theme: ' + themes[themeIndex].name;
        // tint stage shadows
        const light = ['Daylight','Mist'].includes(themes[themeIndex].name);
        root.querySelector('.k-stage').style.boxShadow = light
          ? '0 30px 80px rgba(0,0,0,.08) inset, 0 1px 0 rgba(255,255,255,0.9) inset, 0 24px 60px rgba(0,0,0,.12)'
          : '0 30px 80px rgba(0,0,0,.45) inset, 0 1px 0 rgba(255,255,255,0.1) inset, 0 24px 60px rgba(0,0,0,.45)';
      }
      setTheme(0);

      // Canvas sizing
      function resize() {
        const rect = canvas.getBoundingClientRect();
        const dpr = Math.min(2, window.devicePixelRatio || 1);
        canvas.width = Math.max(1, Math.floor(rect.width * dpr));
        canvas.height = Math.max(1, Math.floor(rect.height * dpr));
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      }
      window.addEventListener('resize', resize, { passive: true });

      // State
      let running = !window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      runBtn.setAttribute('aria-pressed', running ? 'false' : 'true');
      runBtn.textContent = running ? 'Pause motion' : 'Play motion';

      let mode = 'kaleido';
      modeBtn.textContent = 'Scene: ' + (mode === 'kaleido' ? 'Kaleido' : 'Wavefield');

      let segs = parseInt(segRange.value, 10);
      let dens = parseInt(denRange.value, 10);
      let bloom = parseFloat(bloomRange.value);
      let autoSpin = spinT.checked ? 1 : 0;

      const pointer = { x: 0.5, y: 0.5, tx: 0.5, ty: 0.5, down: false, inside: false };
      const blooms = [];
      let t = 0, baseRot = 0;

      function onMove(e) {
        const r = canvas.getBoundingClientRect();
        pointer.tx = (e.clientX - r.left) / Math.max(1, r.width);
        pointer.ty = (e.clientY - r.top) / Math.max(1, r.height);
        pointer.inside = pointer.tx >= 0 && pointer.tx <= 1 && pointer.ty >= 0 && pointer.ty <= 1;
      }
      canvas.addEventListener('pointermove', onMove);
      canvas.addEventListener('pointerdown', (e) => { pointer.down = true; onMove(e); });
      window.addEventListener('pointerup', () => { pointer.down = false; });

      canvas.addEventListener('click', (e) => {
        const r = canvas.getBoundingClientRect();
        blooms.push({ x: e.clientX - r.left, y: e.clientY - r.top, life: 1 });
      }, { passive: true });

      // Helpers
      function getVar(name) {
        return getComputedStyle(root).getPropertyValue(name).trim() || '#000000';
      }
      function lerp(a,b,t){ return a + (b-a)*t; }
      function mixColor(c1, c2, t) {
        const a = parseInt(c1.slice(1), 16);
        const b = parseInt(c2.slice(1), 16);
        const ar = (a >> 16) & 255, ag = (a >> 8) & 255, ab = a & 255;
        const br = (b >> 16) & 255, bg = (b >> 8) & 255, bb = b & 255;
        const r = Math.round(lerp(ar, br, t));
        const g = Math.round(lerp(ag, bg, t));
        const bl = Math.round(lerp(ab, bb, t));
        return 'rgb(' + r + ',' + g + ',' + bl + ')';
      }

      function drawKaleido(w, h) {
        const light = ['Daylight','Mist'].includes(themes[themeIndex].name);
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = light ? 'rgba(255,255,255,' + (0.08) + ')' : 'rgba(0,0,0,' + (0.12) + ')';
        ctx.fillRect(0,0,w,h);

        // smooth pointer
        pointer.x += (pointer.tx - pointer.x) * 0.08;
        pointer.y += (pointer.ty - pointer.y) * 0.08;

        if (autoSpin) baseRot += 0.002 + bloom * 0.001;
        const tilt = ((pointer.x - 0.5) * 2) * 0.2;

        const cx = w * 0.5, cy = h * 0.5;
        const R = Math.min(w, h) * 0.46;
        const a1 = getVar('--a1'), a2 = getVar('--a2'), a3 = getVar('--a3');

        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate(baseRot + tilt);

        const steps = 5;
        for (let j = 0; j < dens; j++) {
          const rMix = j / Math.max(1, dens - 1);
          const col = mixColor(mixColor(a1, a2, rMix*0.8), a3, Math.pow(rMix, 1.2) * 0.5);
          ctx.strokeStyle = col;
          ctx.lineWidth = 1.2 + bloom * 2.4;
          ctx.globalAlpha = 0.25 + bloom * 0.35;
          ctx.shadowColor = col;
          ctx.shadowBlur = 10 + bloom * 30;

          for (let s = 0; s < segs; s++) {
            ctx.save();
            ctx.rotate((s / segs) * Math.PI * 2);
            if (s % 2) ctx.scale(1, -1);

            // path
            ctx.beginPath();
            const amp = (0.05 + rMix * 0.25) * R * (pointer.down ? 1.4 : 1.0);
            const phase = t * (0.8 + rMix * 0.6) + j * 0.18;
            const start = 16 + rMix * 40;
            let lastX = start, lastY = Math.sin(phase) * amp * 0.3;
            ctx.moveTo(lastX, lastY);
            for (let k = 1; k <= steps; k++) {
              const x = lerp(start, R, k / steps);
              const sway = Math.sin(phase + k * 0.9 + pointer.x * 1.4) + Math.cos(phase * 0.6 + k * 0.7 - pointer.y * 1.2);
              const y = sway * amp;
              const mx = (lastX + x) * 0.5;
              const my = (lastY + y) * 0.5 + (y - lastY) * 0.15;
              ctx.quadraticCurveTo(mx, my, x, y);
              lastX = x; lastY = y;
            }
            ctx.stroke();

            ctx.restore();
          }
        }
        ctx.restore();

        // blooms (click bursts)
        for (let i = blooms.length - 1; i >= 0; i--) {
          const b = blooms[i];
          b.life *= 0.94;
          const r = (1 - b.life) * (R * 0.9);
          const grad = ctx.createRadialGradient(b.x, b.y, Math.max(0, r - 12), b.x, b.y, r + 20);
          grad.addColorStop(0, 'rgba(255,255,255,' + (0.10 + bloom * 0.25) + ')');
          grad.addColorStop(1, 'rgba(0,0,0,0)');
          ctx.globalCompositeOperation = 'lighter';
          ctx.globalAlpha = b.life * (0.7 + bloom * 0.3);
          ctx.fillStyle = grad;
          ctx.beginPath(); ctx.arc(b.x, b.y, r + 20, 0, Math.PI * 2); ctx.fill();
          ctx.globalCompositeOperation = 'source-over';
          ctx.globalAlpha = 1;
          if (b.life < 0.04) blooms.splice(i, 1);
        }
      }

      function drawWavefield(w, h) {
        const light = ['Daylight','Mist'].includes(themes[themeIndex].name);
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = light ? 'rgba(255,255,255,' + (0.10) + ')' : 'rgba(0,0,0,' + (0.14) + ')';
        ctx.fillRect(0,0,w,h);

        pointer.x += (pointer.tx - pointer.x) * 0.08;
        pointer.y += (pointer.ty - pointer.y) * 0.08;

        const a1 = getVar('--a1'), a2 = getVar('--a2');
        const rows = 18 + Math.round(dens * 0.8);
        const cols = 60;
        const amp = 16 + bloom * 28;
        const speed = 0.9;

        ctx.save();
        ctx.translate(0, 0);
        ctx.globalCompositeOperation = 'lighter';
        for (let r = 0; r < rows; r++) {
          const y = (r + 0.5) * (canvas.height / (window.devicePixelRatio || 1)) / rows;
          ctx.beginPath();
          for (let c = 0; c <= cols; c++) {
            const x = (c / cols) * (canvas.width / (window.devicePixelRatio || 1));
            const phase = t * speed + r * 0.15 + c * 0.05 + (pointer.x - 0.5) * 2;
            const bend = Math.sin(phase) + Math.cos(phase * 0.6 + pointer.y * Math.PI);
            const yy = y + bend * amp;
            if (c === 0) ctx.moveTo(x, yy); else ctx.lineTo(x, yy);
          }
          const mix = r / rows;
          ctx.strokeStyle = mixColor(a1, a2, mix);
          ctx.lineWidth = 0.6 + bloom * 1.6;
          ctx.globalAlpha = 0.25 + bloom * 0.35;
          ctx.shadowColor = mixColor(a1, a2, mix * 0.9);
          ctx.shadowBlur = 8 + bloom * 24;
          ctx.stroke();
        }
        ctx.restore();
        ctx.globalCompositeOperation = 'source-over';
        ctx.globalAlpha = 1;
      }

      function draw() {
        if (!running) return;
        requestAnimationFrame(draw);
        const rect = canvas.getBoundingClientRect();
        const w = rect.width, h = rect.height;
        if (mode === 'kaleido') drawKaleido(w, h); else drawWavefield(w, h);
        t += 0.016;
      }

      // Controls
      themeBtn.addEventListener('click', () => setTheme(themeIndex + 1));
      modeBtn.addEventListener('click', () => {
        mode = mode === 'kaleido' ? 'wave' : 'kaleido';
        modeBtn.textContent = 'Scene: ' + (mode === 'kaleido' ? 'Kaleido' : 'Wavefield');
        ctx.clearRect(0,0,canvas.width,canvas.height);
      });
      runBtn.addEventListener('click', () => {
        running = !running;
        runBtn.setAttribute('aria-pressed', running ? 'false' : 'true');
        runBtn.textContent = running ? 'Pause motion' : 'Play motion';
        if (running) requestAnimationFrame(draw);
      });
      segRange.addEventListener('input', (e) => { segs = parseInt(e.target.value, 10); });
      denRange.addEventListener('input', (e) => { dens = parseInt(e.target.value, 10); });
      bloomRange.addEventListener('input', (e) => { bloom = parseFloat(e.target.value); });
      grainT.addEventListener('change', (e) => { grain.style.display = e.target.checked ? '' : 'none'; });
      lensT.addEventListener('change', (e) => { lens.style.display = e.target.checked ? '' : 'none'; });
      spinT.addEventListener('change', (e) => { autoSpin = e.target.checked ? 1 : 0; });

      // Init
      function init() {
        resize();
        const light = ['Daylight','Mist'].includes(themes[themeIndex].name);
        ctx.fillStyle = light ? '#ffffff' : '#000000';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        if (running) requestAnimationFrame(draw);
      }
      init();
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


