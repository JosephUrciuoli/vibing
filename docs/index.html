<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="vibe-502" data-theme="mist" data-motion="on" aria-label="Vibe 502 — Light Loom">
  <style>
    .vibe-502 {
      --ink: #0e1320;
      --muted: #5a677e;
      --bg-a: #f7fbff;
      --bg-b: #eef4ff;
      --p1: #76b6ff;
      --p2: #7ff1d6;
      --p3: #b09cff;
      --p4: #ffd48f;
      --glass: rgba(255,255,255,.72);
      --chip: rgba(255,255,255,.6);
      --ring: rgba(14,19,32,.08);
      --radius: 34px;

      position: relative;
      border-radius: var(--radius);
      color: var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial;
      padding: clamp(24px, 5.2vw, 56px);
      background:
        radial-gradient(140% 120% at 0% 0%, rgba(255,255,255,.85), transparent 60%),
        radial-gradient(120% 140% at 100% 100%, rgba(255,255,255,.85), transparent 58%),
        linear-gradient(180deg, var(--bg-a), var(--bg-b));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.85), 0 44px 120px rgba(10,14,25,.18);
      overflow: hidden;
      isolation: isolate;
    }
    .vibe-502 * { box-sizing: border-box; }

    /* Soft grain + shifting glow */
    .vibe-502::before,
    .vibe-502::after {
      content: "";
      position: absolute; inset: -2px; border-radius: inherit; pointer-events: none;
    }
    .vibe-502::before {
      background:
        repeating-linear-gradient(0deg, rgba(0,0,0,.02) 0 1px, transparent 1px 18px),
        repeating-linear-gradient(90deg, rgba(0,0,0,.02) 0 1px, transparent 1px 18px);
      mix-blend-mode: multiply; opacity: .3;
      animation: v502-grain 16s ease-in-out infinite alternate;
    }
    .vibe-502::after {
      background:
        radial-gradient(120% 100% at 50% 0%, color-mix(in oklab, var(--p3), transparent 92%), transparent 60%),
        radial-gradient(100% 120% at 0% 100%, color-mix(in oklab, var(--p2), transparent 90%), transparent 58%),
        radial-gradient(110% 130% at 100% 100%, color-mix(in oklab, var(--p1), transparent 92%), transparent 60%);
      opacity: .9; filter: saturate(110%);
      animation: v502-shift 24s ease-in-out infinite alternate;
    }
    @keyframes v502-grain { 0% { transform: translateY(-10px);} 100% { transform: translateY(10px);} }
    @keyframes v502-shift {
      0% { transform: translate3d(0,0,0) scale(1); }
      100% { transform: translate3d(-2%,2%,0) scale(1.03); }
    }

    .vibe-502 .shell { position: relative; z-index: 1; max-width: 1200px; margin: 0 auto; display: grid; gap: clamp(18px, 3vw, 28px); }
    .vibe-502 .top {
      display: grid; grid-template-columns: 1.15fr 1fr; gap: clamp(16px, 3vw, 24px);
    }
    @media (max-width: 900px) {
      .vibe-502 .top { grid-template-columns: 1fr; }
    }

    .vibe-502 .badge {
      display: inline-flex; align-items: center; gap: 10px;
      padding: 8px 12px; border-radius: 999px;
      background: var(--glass);
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9), 0 12px 26px rgba(12,19,32,.14);
      backdrop-filter: blur(8px);
      font-weight: 900; letter-spacing: .22px;
      width: max-content;
    }
    .vibe-502 .spark {
      width: 10px; height: 10px; border-radius: 50%;
      background: conic-gradient(from 0deg, var(--p1), var(--p2), var(--p3), var(--p4), var(--p1));
      box-shadow: 0 0 0 6px color-mix(in oklab, var(--p2), transparent 78%);
      animation: v502-spin 8s linear infinite;
    }
    @keyframes v502-spin { to { transform: rotate(360deg);} }

    .vibe-502 h1 {
      margin: 14px 0 8px;
      font-size: clamp(46px, 10vw, 140px);
      line-height: .88;
      letter-spacing: -1.2px;
      color: transparent;
      background: linear-gradient(90deg, var(--p1), var(--p3), var(--p2), var(--p4));
      -webkit-background-clip: text; background-clip: text;
      text-wrap: balance;
      text-shadow: 0 12px 40px rgba(0,0,0,.06);
    }
    .vibe-502 .lede {
      max-width: 68ch;
      color: var(--muted);
      font-size: clamp(14px, 2.2vw, 18px);
      margin: 0;
    }

    /* Loom stage */
    .vibe-502 .loom {
      position: relative;
      height: min(64vmin, 540px);
      border-radius: 26px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.6), rgba(255,255,255,.4));
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.85), 0 32px 72px rgba(12,19,32,.18);
      overflow: hidden;
      transform-style: preserve-3d;
      perspective: 1000px;
    }
    .vibe-502 .loom::before {
      content: "";
      position: absolute; inset: 0;
      background:
        radial-gradient(100% 120% at 50% 50%, rgba(0,0,0,.06), transparent 60%),
        radial-gradient(40% 40% at 30% 30%, rgba(255,255,255,.3), transparent 60%) ;
      mix-blend-mode: soft-light; pointer-events: none;
    }
    .vibe-502 .loom-grid {
      position: absolute; inset: 8% 6%;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.6);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9), inset 0 -80px 120px rgba(255,255,255,.25);
      pointer-events: none;
      transform: translateZ(40px);
      mask: radial-gradient(circle at center, black 52%, transparent 56%);
      -webkit-mask: radial-gradient(circle at center, black 52%, transparent 56%);
    }
    .vibe-502 canvas#loom-canvas { position: absolute; inset: 0; width: 100%; height: 100%; display: block; }

    /* Controls */
    .vibe-502 .panel { display:flex; flex-wrap:wrap; align-items:center; gap: 10px 12px; }
    .vibe-502 .chips { display:flex; flex-wrap:wrap; gap: 8px; }
    .vibe-502 .chip, .vibe-502 .switch, .vibe-502 .action, .vibe-502 .knob {
      appearance: none; cursor: pointer;
      border: 1px solid rgba(0,0,0,.06);
      background: var(--chip);
      color: var(--ink); font-weight: 900; letter-spacing: .2px;
      padding: 8px 12px; border-radius: 12px;
      transition: transform .16s ease, filter .16s ease, box-shadow .2s ease, background .2s ease;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9), 0 10px 24px rgba(12,19,32,.10);
      backdrop-filter: blur(6px);
    }
    .vibe-502 .chip { border-radius: 999px; }
    .vibe-502 .chip[aria-pressed="true"] {
      background: rgba(255,255,255,.92);
      box-shadow: 0 14px 32px color-mix(in oklab, var(--p1), transparent 85%), inset 0 0 0 2px color-mix(in oklab, var(--p1), transparent 68%);
    }
    .vibe-502 .chip:hover, .vibe-502 .switch:hover, .vibe-502 .action:hover { transform: translateY(-1px) scale(1.01); filter: saturate(112%); }
    .vibe-502 .knob { display: inline-flex; align-items: center; gap: 10px; }
    .vibe-502 input[type="range"] {
      -webkit-appearance: none; width: 200px; height: 8px; border-radius: 999px; outline: none;
      background: linear-gradient(90deg, var(--p1), var(--p2));
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.08);
    }
    .vibe-502 input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background: #ffffff; border: 1px solid rgba(0,0,0,.12);
      box-shadow: 0 6px 16px rgba(12,19,32,.18), 0 0 0 6px color-mix(in oklab, var(--p1), transparent 75%) inset;
    }

    .vibe-502 .foot {
      display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between;
      color: var(--muted); font-size: 13px; gap: 10px;
    }

    /* Themes */
    .vibe-502[data-theme="mist"] {
      --ink:#0e1320; --muted:#5a677e;
      --bg-a:#f7fbff; --bg-b:#eef4ff;
      --p1:#76b6ff; --p2:#7ff1d6; --p3:#b09cff; --p4:#ffd48f;
      --glass: rgba(255,255,255,.72); --chip: rgba(255,255,255,.6);
    }
    .vibe-502[data-theme="midnight"] {
      --ink:#eaf1ff; --muted:#a6b4d2;
      --bg-a:#0b111b; --bg-b:#151b26;
      --p1:#7df3ff; --p2:#8ea2ff; --p3:#ff85cf; --p4:#ffd273;
      --glass: rgba(22,26,34,.6); --chip: rgba(22,26,34,.56);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 44px 120px rgba(0,0,0,.45);
    }
    .vibe-502[data-theme="meadow"] {
      --ink:#0e2118; --muted:#426252;
      --bg-a:#eefaf2; --bg-b:#e7f6ef;
      --p1:#58d59a; --p2:#63caff; --p3:#84f3b7; --p4:#ffd569;
      --glass: rgba(255,255,255,.74); --chip: rgba(255,255,255,.66);
    }
    .vibe-502[data-theme="ember"] {
      --ink:#2b1712; --muted:#7b5950;
      --bg-a:#fff4ec; --bg-b:#ffe9f4;
      --p1:#ff9a62; --p2:#ff6bb0; --p3:#ffd56d; --p4:#7bceff;
      --glass: rgba(255,255,255,.78); --chip: rgba(255,255,255,.7);
    }

    .vibe-502 .meta {
      display:flex; align-items:center; gap: 14px; flex-wrap:wrap;
    }

    /* Motion respect */
    .vibe-502[data-motion="off"] .spark { animation: none; }
    @media (prefers-reduced-motion: reduce) {
      .vibe-502 .spark { animation: none !important; }
      .vibe-502::before { animation: none !important; }
      .vibe-502::after { animation: none !important; }
    }
  </style>

  <div class="shell">
    <div class="meta">
      <div class="badge"><i class="spark"></i> Iteration 502 — Light Loom</div>
    </div>

    <div class="top">
      <div>
        <h1>Light Loom</h1>
        <p class="lede">Silken threads of color drift, braid, and breathe. Pull the weave, tune the wind, set the glow.</p>
      </div>
      <div class="loom" id="loom" role="img" aria-label="Generative woven light threads in motion">
        <canvas id="loom-canvas"></canvas>
        <div class="loom-grid" aria-hidden="true"></div>
      </div>
    </div>

    <div class="panel" role="group" aria-label="Studio Controls">
      <div class="chips" aria-label="Theme">
        <button class="chip" data-theme="mist" aria-pressed="true">Mist</button>
        <button class="chip" data-theme="midnight" aria-pressed="false">Midnight</button>
        <button class="chip" data-theme="meadow" aria-pressed="false">Meadow</button>
        <button class="chip" data-theme="ember" aria-pressed="false">Ember</button>
      </div>

      <div class="chips" aria-label="Mode">
        <button class="chip" data-mode="weave" aria-pressed="true">Weave</button>
        <button class="chip" data-mode="drift" aria-pressed="false">Drift</button>
        <button class="chip" data-mode="burst" aria-pressed="false">Burst</button>
      </div>

      <label class="knob" for="threads">Threads
        <input id="threads" type="range" min="12" max="140" step="1" value="48" aria-label="Thread count">
      </label>
      <label class="knob" for="glow">Glow
        <input id="glow" type="range" min="0.4" max="2.4" step="0.1" value="1.2" aria-label="Glow intensity">
      </label>
      <label class="knob" for="wind">Wind
        <input id="wind" type="range" min="0.2" max="2.2" step="0.1" value="1.0" aria-label="Wind speed">
      </label>

      <button class="switch" id="motion" aria-pressed="true">Motion: Weave</button>
      <button class="action" id="shuffle">Shuffle</button>
    </div>

    <div class="foot">
      <small>Thread by thread, the page exhales.</small>
      <span id="last-updated">Last updated: 2025-11-08 07:32:03 EST</span>
    </div>
  </div>

  <script>
    (function(){
      const root = document.currentScript.closest('.vibe-502');
      const stage = root.querySelector('#loom');
      const canvas = root.querySelector('#loom-canvas');
      const ctx = canvas.getContext('2d');

      const themeChips = root.querySelectorAll('.chip[data-theme]');
      const modeChips  = root.querySelectorAll('.chip[data-mode]');
      const threadsEl  = root.querySelector('#threads');
      const glowEl     = root.querySelector('#glow');
      const windEl     = root.querySelector('#wind');
      const motionBtn  = root.querySelector('#motion');
      const shuffleBtn = root.querySelector('#shuffle');
      const last       = root.querySelector('#last-updated');

      let raf, dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));
      let running = true;
      let t0 = performance.now();

      let THREADS = +threadsEl.value;
      let GLOW    = +glowEl.value;
      let WIND    = +windEl.value;
      let MODE    = 'weave';
      let tiltMod = 1;

      let seeds = [];

      function css(name){ return getComputedStyle(root).getPropertyValue(name).trim(); }
      function pal(){ return [css('--p1'), css('--p2'), css('--p3'), css('--p4')].filter(Boolean); }

      function resize(){
        const r = stage.getBoundingClientRect();
        canvas.width = Math.max(1, Math.floor(r.width * dpr));
        canvas.height = Math.max(1, Math.floor(r.height * dpr));
        canvas.style.width = r.width + 'px';
        canvas.style.height = r.height + 'px';
        ctx.setTransform(1,0,0,1,0,0);
        ctx.scale(dpr, dpr);
        initSeeds();
        drawFrame(0);
      }

      function initSeeds(){
        const w = canvas.width/dpr, h = canvas.height/dpr;
        const cx = w/2, cy = h/2;
        const radius = Math.min(w,h)*0.36;
        seeds = Array.from({length: THREADS}, (_, i) => {
          const a = (i/THREADS) * Math.PI*2;
          const r = radius * (0.6 + 0.35*Math.sin(i*1.7));
          return {
            x: cx + Math.cos(a)*r,
            y: cy + Math.sin(a)*r,
            hue: pal()[i % pal().length] || '#fff',
            w: 1.2 + 2.8*(i/THREADS)
          };
        });
      }

      // Field function — pseudo-noise with mode modifiers
      function field(nx, ny, time){
        // nx, ny in [-1,1]
        const s1 = Math.sin((nx*3.1 + time*0.6*WIND) + Math.cos(ny*2.3 - time*0.5*WIND));
        const s2 = Math.cos((ny*2.8 - time*0.9*WIND) + Math.sin(nx*2.1 + time*0.4*WIND));
        let angle = s1*1.1 + s2*0.9;

        if (MODE === 'drift'){
          angle *= 0.6;
          angle += Math.sin((nx+ny+time*0.25*WIND)*2.0)*0.6;
        } else if (MODE === 'burst'){
          angle += Math.atan2(ny, nx)*1.2 + Math.sin(time*0.7)*0.15;
        } else {
          // weave
          angle += Math.sin((nx-ny)*2.2 + time*0.3)*0.6;
        }
        return angle;
      }

      function drawThreads(time){
        const w = canvas.width/dpr, h = canvas.height/dpr;
        const cx = w/2, cy = h/2;

        ctx.globalCompositeOperation = 'lighter';
        for (let i=0;i<seeds.length;i++){
          const s = seeds[i];
          let x = s.x, y = s.y;

          const steps = 84; // segment count
          const stepLen = 1.8 + 0.8*Math.sin(i*0.6);
          ctx.beginPath();
          ctx.moveTo(x,y);
          for (let k=0;k<steps;k++){
            const nx = (x - cx) / (Math.min(w,h)/2);
            const ny = (y - cy) / (Math.min(w,h)/2);
            const ang = field(nx, ny, time) * tiltMod;
            x += Math.cos(ang) * stepLen;
            y += Math.sin(ang) * stepLen;
            ctx.lineTo(x,y);
          }
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round';
          ctx.shadowBlur = 10 * GLOW;
          ctx.shadowColor = s.hue;
          ctx.lineWidth = s.w;
          ctx.strokeStyle = s.hue;
          ctx.globalAlpha = 0.12 + 0.85*(i/(seeds.length));
          ctx.stroke();

          // thread highlight
          ctx.shadowBlur = 0;
          ctx.globalAlpha = 0.25;
          ctx.lineWidth = s.w * 0.45;
          ctx.strokeStyle = 'rgba(255,255,255,.9)';
          ctx.stroke();
          ctx.globalAlpha = 1;
        }
        ctx.globalCompositeOperation = 'source-over';
      }

      function clear(){
        ctx.clearRect(0,0,canvas.width/dpr,canvas.height/dpr);
        // subtle base fog for depth
        const w = canvas.width/dpr, h = canvas.height/dpr;
        const g = ctx.createLinearGradient(0,0,0,h);
        g.addColorStop(0, 'rgba(255,255,255,.18)');
        g.addColorStop(1, 'rgba(255,255,255,.06)');
        ctx.fillStyle = g;
        ctx.fillRect(0,0,w,h);
      }

      function drawFrame(t){
        clear();
        const time = (performance.now() - t0)/1000;
        drawThreads(time);
      }

      function loop(){
        if (!running) return;
        drawFrame();
        raf = requestAnimationFrame(loop);
      }

      function setTheme(theme){
        root.setAttribute('data-theme', theme);
        themeChips.forEach(c => c.setAttribute('aria-pressed', c.dataset.theme === theme ? 'true' : 'false'));
        initSeeds();
      }

      function setMode(mode){
        MODE = mode;
        modeChips.forEach(c => c.setAttribute('aria-pressed', c.dataset.mode === mode ? 'true' : 'false'));
        motionBtn.textContent = 'Motion: ' + (mode.charAt(0).toUpperCase()+mode.slice(1));
      }

      // Controls
      themeChips.forEach(btn => btn.addEventListener('click', () => setTheme(btn.dataset.theme)));
      modeChips.forEach(btn => btn.addEventListener('click', () => setMode(btn.dataset.mode)));
      threadsEl.addEventListener('input', () => { THREADS = +threadsEl.value; initSeeds(); drawFrame(0); });
      glowEl.addEventListener('input', () => { GLOW = +glowEl.value; });
      windEl.addEventListener('input', () => { WIND = +windEl.value; });

      function setMotion(on){
        root.setAttribute('data-motion', on ? 'on' : 'off');
        motionBtn.setAttribute('aria-pressed', on ? 'true' : 'false');
        if (on && !running){ running = true; raf = requestAnimationFrame(loop); }
        else if (!on && running){ running = false; cancelAnimationFrame(raf); drawFrame(0); }
      }
      motionBtn.addEventListener('click', () => setMotion(root.getAttribute('data-motion') !== 'on'));

      shuffleBtn.addEventListener('click', () => {
        const themes = ['mist','midnight','meadow','ember'];
        const modes  = ['weave','drift','burst'];
        setTheme(themes[Math.floor(Math.random()*themes.length)]);
        setMode(modes[Math.floor(Math.random()*modes.length)]);
        const th = Math.floor(12 + Math.random()*128);
        threadsEl.value = th; THREADS = th; initSeeds();
        const g = (0.4 + Math.random()*2.0).toFixed(1);
        glowEl.value = g; GLOW = +g;
        const w = (0.2 + Math.random()*2.0).toFixed(1);
        windEl.value = w; WIND = +w;
        setMotion(Math.random() > .2);
      });

      // Pointer tilt — nudge the field
      function pointerTilt(e){
        const r = stage.getBoundingClientRect();
        const nx = (e.clientX - r.left) / Math.max(1, r.width);
        const ny = (e.clientY - r.top) / Math.max(1, r.height);
        const rx = (0.5 - ny) * 8;
        const ry = (nx - 0.5) * 10;
        stage.style.transform = `rotateX(${rx.toFixed(2)}deg) rotateY(${ry.toFixed(2)}deg)`;
        tiltMod = 0.8 + nx*0.6;
      }
      root.addEventListener('pointermove', pointerTilt);
      root.addEventListener('pointerleave', () => { stage.style.transform = 'rotateX(0deg) rotateY(0deg)'; tiltMod = 1; });

      // Init
      const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      resize();
      setTheme(root.getAttribute('data-theme') || 'mist');
      setMode('weave');
      setMotion(!prefersReduced);

      // Resize observe
      let ro;
      if ('ResizeObserver' in window) {
        ro = new ResizeObserver(() => resize());
        ro.observe(stage);
      } else {
        window.addEventListener('resize', resize);
      }

      // Last updated
      try {
        const fmt = new Intl.DateTimeFormat(undefined, { dateStyle:'medium', timeStyle:'short' });
        last.textContent = 'Last updated: ' + fmt.format(new Date());
      } catch(e) {
        last.textContent = 'Last updated: ' + new Date().toLocaleString();
      }

      // Cleanup
      root.addEventListener('DOMNodeRemoved', () => { cancelAnimationFrame(raf); if (ro) ro.disconnect(); }, { once: true });
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


