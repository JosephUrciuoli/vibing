<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="atelier1922" role="region" aria-label="Lumen Orchard — Edition 1922">
  <style>
    /* LUMEN ORCHARD — 1922 */
    #atelier1922 {
      --h: 214;
      --ink: #0f1220;
      --muted: color-mix(in hsl, var(--ink) 55%, #ffffff 45%);
      --line: color-mix(in hsl, var(--ink) 16%, #ffffff 84%);
      --bgA: #f7f9ff;
      --bgB: #eef3ff;
      --glass: rgba(255,255,255,.72);
      --mx: 50%;
      --my: 50%;
      --tempo: 1.00;
      --grain: .10;
      --ring: 22px;
      position: relative;
      border-radius: 32px;
      padding: clamp(16px, 3.6vw, 36px);
      color: var(--ink);
      font-family: ui-sans-serif, -apple-system, Inter, Segoe UI, Helvetica, Arial, system-ui;
      background:
        radial-gradient(140% 160% at 0% 100%, rgba(255,255,255,.9), transparent 60%),
        radial-gradient(160% 140% at 100% 0%, rgba(255,255,255,.9), transparent 68%),
        linear-gradient(180deg, var(--bgA), var(--bgB));
      border: 1px solid var(--line);
      box-shadow: 0 140px 320px rgba(14,18,38,.14), inset 0 1px 0 rgba(255,255,255,.9);
      overflow: hidden;
      isolation: isolate;
    }
    #atelier1922[data-night="true"]{
      --ink: rgba(236,242,255,.96);
      --muted: rgba(236,242,255,.72);
      --line: rgba(255,255,255,.12);
      --bgA: #050812;
      --bgB: #0d1322;
      --glass: rgba(255,255,255,.085);
      --grain: .18;
      box-shadow: 0 180px 360px rgba(0,0,0,.86), inset 0 1px 0 rgba(255,255,255,.08);
      background:
        radial-gradient(140% 160% at 0% 100%, rgba(8,12,24,.6), transparent 60%),
        radial-gradient(160% 140% at 100% 0%, rgba(8,12,24,.6), transparent 68%),
        linear-gradient(180deg, var(--bgA), var(--bgB));
    }

    /* Header */
    #atelier1922 .hdr {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 14px;
      margin-bottom: 8px;
    }
    #atelier1922 .crest {
      width: 88px; height: 88px; border-radius: 28px; display:grid; place-items:center; overflow:hidden; position:relative;
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.62));
      border: 1px solid var(--line);
      box-shadow: 0 28px 64px rgba(12,16,28,.16), inset 0 1px 0 rgba(255,255,255,.92);
    }
    #atelier1922[data-night="true"] .crest {
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.08));
      box-shadow: 0 26px 60px rgba(0,0,0,.62), inset 0 1px 0 rgba(255,255,255,.06);
    }
    #atelier1922 .crest svg { width: 68px; height: 68px; display:block; }
    #atelier1922 .brand { display:grid; line-height: 1; }
    #atelier1922 .brand .t { font-weight: 900; letter-spacing: .35px; font-size: 19px; text-transform: uppercase; }
    #atelier1922 .brand .s { font-size: 13px; color: var(--muted); letter-spacing: .24px; }

    #atelier1922 .actions { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    #atelier1922 .chip {
      appearance:none; cursor:pointer; border:1px solid var(--line); border-radius:12px;
      background:linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.62));
      color:var(--ink); padding:9px 12px; font-size:12px; font-weight:800;
      box-shadow:0 14px 30px rgba(12,16,28,.14), inset 0 1px 0 rgba(255,255,255,.86);
      transition: transform .15s ease, filter .3s ease, background .3s ease;
    }
    #atelier1922 .chip:hover { transform: translateY(-1px); }
    #atelier1922[data-night="true"] .chip {
      background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
      box-shadow:0 16px 34px rgba(0,0,0,.6), inset 0 1px 0 rgba(255,255,255,.06);
    }

    /* Hero */
    #atelier1922 .hero { margin: 10px 2px 14px; }
    #atelier1922 .hero h1{
      margin: 0;
      font-size: clamp(42px, 9vw, 92px);
      line-height: .95;
      letter-spacing: .2px;
      background: linear-gradient(90deg,
        hsl(var(--h) 90% 56%),
        hsl(calc(var(--h)+78) 84% 58%),
        hsl(calc(var(--h)-62) 86% 60%));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      filter: drop-shadow(0 22px 46px rgba(12,16,28,.18));
      background-size: 220% 100%;
      animation: shimmer1922 16s ease-in-out infinite;
    }
    #atelier1922 .hero .sub { margin-top: 8px; color: var(--muted); font-size: 14px; }

    /* Stage */
    #atelier1922 .stage {
      position: relative;
      display: grid;
      grid-template-columns: 1fr;
      place-items: center;
      margin-top: 14px;
      perspective: 1400px;
    }
    #atelier1922 .portal {
      --tiltX: calc((var(--my) - 50%) * -0.9);
      --tiltY: calc((var(--mx) - 50%) * 1.0);
      width: min(94vw, 960px);
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.7), rgba(255,255,255,.45));
      box-shadow:
        0 40px 120px rgba(12,16,28,.16),
        inset 0 1px 0 rgba(255,255,255,.75);
      position: relative;
      overflow: hidden;
      transform: rotateX(var(--tiltX)) rotateY(var(--tiltY));
      transition: transform .25s ease;
      isolation: isolate;
      backdrop-filter: blur(10px) saturate(1.06);
    }
    #atelier1922[data-night="true"] .portal{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: 0 36px 110px rgba(0,0,0,.72), inset 0 1px 0 rgba(255,255,255,.06);
      backdrop-filter: blur(12px) saturate(1.08);
    }

    #atelier1922 canvas#orchard1922{
      position:absolute; inset:0; width:100%; height:100%; display:block;
      filter: saturate(1.06);
      transition: filter .35s ease, opacity .35s ease;
    }

    #atelier1922 .halo {
      position:absolute; inset: clamp(10px, 1.6vw, 18px); border-radius:50%; pointer-events:none;
      border: 1px dashed var(--line);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
      mix-blend-mode: soft-light;
    }

    #atelier1922 .ringglow{
      position:absolute; inset:0; pointer-events:none;
      background:
        radial-gradient(60% 60% at 50% 50%, rgba(255,255,255,.35), transparent 60%),
        conic-gradient(from 0deg at 50% 50%, transparent 0 18deg, rgba(255,255,255,.12) 18deg 20deg, transparent 20deg 360deg);
      opacity:.65;
      mix-blend-mode: overlay;
    }
    #atelier1922[data-night="true"] .ringglow{
      mix-blend-mode: screen; opacity:.5;
    }

    #atelier1922 .grain {
      position:absolute; inset:0; pointer-events:none; opacity: var(--grain);
      background-image:
        radial-gradient(1px 1px at 8% 12%, rgba(0,0,0,.6) 20%, transparent 21%),
        radial-gradient(1px 1px at 22% 78%, rgba(0,0,0,.6) 20%, transparent 21%),
        radial-gradient(1px 1px at 66% 42%, rgba(0,0,0,.6) 20%, transparent 21%),
        radial-gradient(1px 1px at 84% 16%, rgba(0,0,0,.6) 20%, transparent 21%),
        radial-gradient(1px 1px at 46% 66%, rgba(0,0,0,.6) 20%, transparent 21%);
      background-size: 140px 140px, 160px 160px, 120px 120px, 200px 200px, 180px 180px;
      animation: film1922 9s steps(60) infinite;
      mix-blend-mode: overlay;
    }
    #atelier1922[data-night="true"] .grain{ mix-blend-mode: screen; }

    /* Dock */
    #atelier1922 .dock { display:flex; flex-wrap:wrap; gap: 10px; align-items:center; justify-content:center; margin-top: 16px; }
    #atelier1922 .knob {
      -webkit-appearance: none; appearance: none; width: min(64vw, 420px); height: 30px; border-radius: 999px; outline: none;
      background: linear-gradient(90deg, hsl(var(--h) 88% 58%), hsl(calc(var(--h)+70) 78% 58%), hsl(calc(var(--h)-50) 84% 64%));
      border: 1px solid var(--line); box-shadow: inset 0 1px 0 rgba(255,255,255,.65), 0 10px 22px rgba(12,16,28,.14);
    }
    #atelier1922 .knob::-webkit-slider-thumb, #atelier1922 .knob::-moz-range-thumb {
      -webkit-appearance: none; appearance: none; width: 22px; height: 22px; border-radius: 50%;
      background: radial-gradient(100% 100% at 30% 30%, #fff, #e6ecff);
      border: 1px solid rgba(0,0,0,.12);
      box-shadow: 0 10px 20px rgba(12,16,28,.22), 0 0 0 4px rgba(255,255,255,.28);
      cursor: ew-resize;
    }
    #atelier1922 .bubble {
      min-width: 300px; text-align: center; padding: 8px 12px; border-radius: 12px; border: 1px solid var(--line);
      background: var(--glass); box-shadow: inset 0 1px 0 rgba(255,255,255,.72);
      color: var(--ink); font-variant-numeric: tabular-nums; font-size: 12px;
    }

    /* Footer */
    #atelier1922 .meta {
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-top: 18px; padding-top: 12px; border-top: 1px dashed var(--line); color: var(--muted); font-size: 12px;
    }
    #atelier1922 .tagline {
      display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
      border:1px dashed var(--line); background: rgba(255,255,255,.62);
    }
    #atelier1922[data-night="true"] .tagline { background: rgba(255,255,255,.06); }

    /* Watermark */
    #atelier1922 .mark {
      position: absolute; left: 8px; bottom: -16px; pointer-events: none; user-select: none;
      font-weight: 900; font-size: 106px; line-height: 1; letter-spacing: -3px;
      color: transparent;
      -webkit-text-stroke: 1px color-mix(in hsl, hsl(var(--h) 90% 50%) 46%, rgba(0,0,0,.26));
      text-stroke: 1px color-mix(in hsl, hsl(var(--h) 90% 50%) 46%, rgba(0,0,0,.26));
      opacity: .16; transform: rotate(-4deg); filter: blur(.2px);
    }

    /* Motions */
    @keyframes shimmer1922 { 0%,100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
    @keyframes film1922 { to { transform: translate3d(0,0,0); filter: hue-rotate(2deg) contrast(1.02); } }

    /* Responsive */
    @media (max-width: 760px) {
      #atelier1922 .hdr { grid-template-columns: auto 1fr; }
      #atelier1922 .actions { grid-column: 1 / -1; }
      #atelier1922 .mark { font-size: 86px; bottom: -10px; }
    }
    @media (prefers-reduced-motion: reduce) {
      #atelier1922 .hero h1 { animation: none !important; }
      #atelier1922 .portal { transition: none !important; transform: none !important; }
      #atelier1922 .grain { animation: none !important; opacity: .06 !important; }
    }
  </style>

  <div class="hdr">
    <div class="crest" aria-hidden="true">
      <svg viewBox="0 0 100 100" aria-hidden="true">
        <defs>
          <linearGradient id="grad1922" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="hsl(var(--h) 92% 58%)"/>
            <stop offset=".5" stop-color="hsl(calc(var(--h)+70) 88% 56%)"/>
            <stop offset="1" stop-color="hsl(calc(var(--h)-60) 86% 60%)"/>
          </linearGradient>
        </defs>
        <g transform="translate(50,50)">
          <circle r="30" fill="none" stroke="url(#grad1922)" stroke-width="7" opacity=".9"/>
          <circle r="6" fill="url(#grad1922)"/>
          <g opacity=".8">
            <path d="M0 -36 A36 36 0 0 1 31.2 -18" fill="none" stroke="url(#grad1922)" stroke-width="5" stroke-linecap="round"/>
            <path d="M-31.2 18 A36 36 0 0 1 0 36" fill="none" stroke="url(#grad1922)" stroke-width="5" stroke-linecap="round"/>
          </g>
        </g>
      </svg>
    </div>
    <div class="brand">
      <div class="t">Lumen Orchard</div>
      <div class="s">Edition 1922 — orbits of light that swell to your touch</div>
    </div>
    <div class="actions">
      <button id="night1922" class="chip" type="button" aria-label="Toggle Theme">Night</button>
      <button id="pulse1922" class="chip" type="button" aria-label="Toggle Pulse">Pulse ✓</button>
      <button id="glaze1922" class="chip" type="button" aria-label="Toggle Glaze">Glaze ✓</button>
      <button id="palette1922" class="chip" type="button" aria-label="Shuffle Palette">Palette</button>
      <button id="save1922" class="chip" type="button" aria-label="Save Image">Save</button>
    </div>
  </div>

  <div class="hero">
    <h1>Teach light to drift.</h1>
    <div class="sub">Drag across the lens to bend the orbit • Choose orbits • Let it pulse at night</div>
  </div>

  <div class="stage" aria-label="Orbital light garden">
    <div class="portal" id="portal1922">
      <canvas id="orchard1922" role="img" aria-label="A living field of luminous orbits that respond to time and touch"></canvas>
      <div class="ringglow" aria-hidden="true"></div>
      <div class="halo" aria-hidden="true"></div>
      <div class="grain" aria-hidden="true"></div>
    </div>
    <div class="mark" aria-hidden="true">1922</div>
  </div>

  <div class="dock">
    <input id="orbits1922" class="knob" type="range" min="24" max="180" step="1" value="96" aria-label="Orbits">
    <input id="tempo1922" class="knob" type="range" min="0.25" max="2.50" step="0.01" value="1.00" aria-label="Tempo">
    <div id="bubble1922" class="bubble" aria-live="polite">Orbits: 96 • Tempo: 1.00x • Pulse: on • Glaze: on</div>
  </div>

  <div class="meta">
    <span class="tagline">“Orbit is the handwriting of time.”</span>
    <span id="last-updated">Last updated: 2026-01-13 00:24:10 EST</span>
  </div>

  <script>
  (function(){
    const root = document.getElementById('atelier1922');
    const portal = root.querySelector('#portal1922');
    const canvas = root.querySelector('#orchard1922');
    const ctx = canvas.getContext('2d', { alpha: true });

    const bNight = root.querySelector('#night1922');
    const bPulse = root.querySelector('#pulse1922');
    const bGlaze = root.querySelector('#glaze1922');
    const bPal   = root.querySelector('#palette1922');
    const bSave  = root.querySelector('#save1922');

    const sOrbits = root.querySelector('#orbits1922');
    const sTempo  = root.querySelector('#tempo1922');
    const bubble  = root.querySelector('#bubble1922');
    const stampEl = root.querySelector('#last-updated');

    // State
    const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    let S=0, R=0, CX=0, CY=0;
    let ORBITS = parseInt(sOrbits.value,10) || 96;
    let PULSE  = true;
    let GLAZE  = true;
    let hueBase = parseInt(getComputedStyle(root).getPropertyValue('--h')) || 214;
    const pointer = { x:.5, y:.5, tx:.5, ty:.5, pressing:false };
    let particles = [];

    function stamp(){
      try{
        const now = new Date();
        const opts = { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' };
        stampEl.textContent = 'Updated ' + now.toLocaleString(undefined, opts);
      }catch(_){ stampEl.textContent = 'Updated just now'; }
    }

    function flash(){
      root.style.transition='filter .25s ease';
      root.style.filter='saturate(1.16)';
      setTimeout(()=>{ root.style.filter='saturate(1)'; root.style.transition=''; }, 280);
    }

    function resize(){
      const rect = portal.getBoundingClientRect();
      S = Math.max(1, Math.floor(Math.min(rect.width, rect.height) * DPR));
      canvas.width = S; canvas.height = S;
      R = S * 0.48; CX = S/2; CY = S/2;
      reseed();
    }

    function setHue(v){
      hueBase = ((v % 360) + 360) % 360;
      root.style.setProperty('--h', hueBase);
      flash();
    }
    function shuffleHue(){ setHue(Math.floor(Math.random()*360)); }

    function setTempo(val){
      const e = Math.max(0.25, Math.min(2.5, parseFloat(val) || 1));
      root.style.setProperty('--tempo', e.toFixed(2));
      bubble.textContent = 'Orbits: ' + ORBITS + ' • Tempo: ' + e.toFixed(2) + 'x • Pulse: ' + (PULSE?'on':'off') + ' • Glaze: ' + (GLAZE?'on':'off');
    }
    function setOrbits(val){
      ORBITS = Math.max(24, Math.min(180, parseInt(val,10)||96));
      reseed();
      setTempo(sTempo.value);
    }

    function toggleNight(force){
      const on = typeof force === 'boolean' ? force : !root.hasAttribute('data-night');
      if(on){ root.setAttribute('data-night','true'); bNight.textContent='Dawn'; }
      else  { root.removeAttribute('data-night'); bNight.textContent='Night'; }
      flash();
    }

    function togglePulse(){
      PULSE = !PULSE;
      bPulse.textContent = PULSE ? 'Pulse ✓' : 'Pulse';
      setTempo(sTempo.value);
      flash();
    }
    function toggleGlaze(){
      GLAZE = !GLAZE;
      bGlaze.textContent = GLAZE ? 'Glaze ✓' : 'Glaze';
      setTempo(sTempo.value);
      flash();
    }

    function onPointerMove(e){
      const r = portal.getBoundingClientRect();
      const x = (e.clientX - r.left) / r.width;
      const y = (e.clientY - r.top) / r.height;
      pointer.tx = Math.max(0, Math.min(1, x));
      pointer.ty = Math.max(0, Math.min(1, y));
    }
    function onPointerDown(){ pointer.pressing = true; }
    function onPointerUp(){ pointer.pressing = false; }

    portal.addEventListener('pointermove', onPointerMove);
    portal.addEventListener('pointerdown', onPointerDown);
    window.addEventListener('pointerup', onPointerUp);
    portal.addEventListener('pointerleave', ()=>{
      root.style.setProperty('--mx','50%'); root.style.setProperty('--my','50%');
    });

    sOrbits.addEventListener('input', ()=> setOrbits(sOrbits.value));
    sTempo.addEventListener('input', ()=> setTempo(sTempo.value));
    bNight.addEventListener('click', toggleNight);
    bPulse.addEventListener('click', togglePulse);
    bGlaze.addEventListener('click', toggleGlaze);
    bPal.addEventListener('click', shuffleHue);
    bSave.addEventListener('click', ()=>{
      try{
        const a = document.createElement('a');
        a.href = canvas.toDataURL('image/png');
        a.download = 'lumen-orchard-1922.png';
        a.click();
      }catch(_){}
    });

    window.addEventListener('keydown', (e)=>{
      const k = e.key.toLowerCase();
      if(k==='n'){ bNight.click(); }
      if(k==='p'){ bPulse.click(); }
      if(k==='g'){ bGlaze.click(); }
      if(k==='h'){ bPal.click(); }
      if(k==='s'){ bSave.click(); }
      if(k==='['){ sOrbits.value = Math.max(24, parseInt(sOrbits.value,10)-1); sOrbits.dispatchEvent(new Event('input')); }
      if(k===']'){ sOrbits.value = Math.min(180, parseInt(sOrbits.value,10)+1); sOrbits.dispatchEvent(new Event('input')); }
    });

    function rand(a=0,b=1){ return a + Math.random()*(b-a); }
    function reseed(){
      particles = [];
      const rings = Math.max(6, Math.floor(ORBITS/6));
      for(let r=0;r<rings;r++){
        const u = (r+1)/(rings+1);
        const radius = u * R * (0.95 - 0.05*Math.sin(u*6));
        const count = Math.max(4, Math.round( (4 + u*ORBITS*0.6) ));
        for(let i=0;i<count;i++){
          const a0 = (i/count)*Math.PI*2 + rand(-0.04,0.04);
          const omega = (0.12 + u*0.85) * (rand(0.8,1.2));
          const hue = (hueBase + u*180 + i*2) % 360;
          particles.push({ r: radius, a: a0, w: omega, hue, u, layer: r%2 });
        }
      }
    }

    function render(now){
      const t = now*0.001;
      const tempo = parseFloat(getComputedStyle(root).getPropertyValue('--tempo')) || 1;

      // Eased pointer + CSS vars for tilt
      pointer.x += (pointer.tx - pointer.x) * 0.08;
      pointer.y += (pointer.ty - pointer.y) * 0.08;
      root.style.setProperty('--mx', (pointer.x*100).toFixed(2)+'%');
      root.style.setProperty('--my', (pointer.y*100).toFixed(2)+'%');

      // Clear
      if(root.hasAttribute('data-night')) {
        ctx.fillStyle = 'rgba(0,0,0,0.18)';
      } else {
        ctx.fillStyle = 'rgba(255,255,255,0.18)';
      }
      ctx.globalCompositeOperation = 'source-over';
      ctx.fillRect(0,0,S,S);

      // Center ease influenced by pointer
      const dx = (pointer.x - 0.5) * R * 0.28;
      const dy = (pointer.y - 0.5) * R * 0.28;
      const attract = pointer.pressing ? 0.24 : 0.06;

      // Pulse
      const pulse = PULSE ? (0.5 + 0.5*Math.sin(t*1.6*tempo)) : 0.5;

      ctx.save();
      ctx.translate(CX, CY);

      // Background radial soft
      const grd = ctx.createRadialGradient(dx*0.2, dy*0.2, R*0.02, 0,0, R*1.02);
      grd.addColorStop(0, `hsla(${(hueBase+220)%360}, 96%, 62%, ${root.hasAttribute('data-night')?0.08:0.16})`);
      grd.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = grd;
      ctx.beginPath(); ctx.arc(0,0,R,0,Math.PI*2); ctx.fill();

      // Draw orbits
      for(let i=0;i<particles.length;i++){
        const p = particles[i];
        const sway = Math.sin(t*0.9*tempo + p.u*6) * 0.6;
        p.a += (p.w * 0.004 * tempo) * (p.layer?1:-1);
        const rr = p.r * (0.98 + 0.04*Math.sin(t*0.7*tempo + p.u*10) ) - (pointer.pressing? R*0.08*p.u : 0);
        const x = Math.cos(p.a + sway*0.02)*rr + dx*attract*p.u;
        const y = Math.sin(p.a + sway*0.02)*rr + dy*attract*p.u;

        // Orbit path stroke
        ctx.save();
        ctx.globalCompositeOperation = 'lighter';
        const lum = root.hasAttribute('data-night') ? 74 : 56;
        const alpha = root.hasAttribute('data-night') ? 0.18 : 0.14;

        // Glaze/shadow
        if(GLAZE){
          ctx.shadowColor = `hsla(${(p.hue+180)%360}, 92%, ${lum+6}%, ${alpha})`;
          ctx.shadowBlur = 22 * DPR * (0.6 + pulse*0.8);
        } else {
          ctx.shadowColor = 'transparent';
          ctx.shadowBlur = 0;
        }

        // Node
        const size = (1.6 + 3.2*(1-p.u) + 1.4*pulse) * DPR;
        const g = ctx.createRadialGradient(x,y, size*0.2, x,y, size);
        g.addColorStop(0, `hsla(${p.hue}, 98%, ${lum+6}%, ${alpha*1.4})`);
        g.addColorStop(1, `hsla(${(p.hue+30)%360}, 96%, ${lum-6}%, 0)`);
        ctx.fillStyle = g;
        ctx.beginPath(); ctx.arc(x,y, size, 0, Math.PI*2); ctx.fill();

        // Fine orbit arc
        ctx.lineWidth = Math.max(1, 2.2*DPR*(1-p.u));
        ctx.strokeStyle = `hsla(${(hueBase + p.u*210)%360}, 95%, ${lum-4}%, ${alpha*0.6})`;
        ctx.beginPath();
        const sweep = (0.6 + 0.8*pulse) * (Math.PI/6);
        ctx.arc(0,0, rr, p.a - sweep, p.a + sweep);
        ctx.stroke();

        ctx.restore();
      }

      ctx.restore();
    }

    let running = true;
    function loop(now){ if(!running) return; render(now); requestAnimationFrame(loop); }

    // Init
    resize();
    setOrbits(sOrbits.value);
    setTempo(sTempo.value);
    toggleNight(false);
    PULSE = true; GLAZE = true;
    shuffleHue();
    stamp();

    const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if(!prefersReduced){ requestAnimationFrame(loop); }
    else { running=false; render(performance.now()); }

    window.addEventListener('resize', ()=>{
      const was = running;
      running = false;
      resize();
      if(was){ running = true; requestAnimationFrame(loop); }
      else { render(performance.now()); }
    });
  }());
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


