<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="nocturne-520" aria-label="Midnight Prism Studio">
  <style>
    .nocturne-520 {
      --h: 266;
      --ink: hsl(220 20% 92%);
      --muted: hsl(220 14% 70%);
      --panel: hsla(0 0% 100% / .05);
      --edge: hsla(0 0% 100% / .14);
      --glow: hsla(var(--h) 90% 60% / .6);
      --glow-soft: hsla(var(--h) 90% 65% / .18);
      --flow: 60;   /* 0–100 */
      --bloom: 70;  /* 0–100 */
      position: relative;
      border-radius: 28px;
      overflow: hidden;
      color: var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:
        radial-gradient(1200px 600px at 8% -10%, hsla(calc(var(--h) - 30) 90% 50% / .25), transparent 55%),
        radial-gradient(1000px 700px at 110% 110%, hsla(calc(var(--h) + 60) 90% 50% / .22), transparent 60%),
        linear-gradient(180deg, hsl(230 35% 9%), hsl(230 55% 5%));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.06),
        0 30px 80px rgba(0,0,0,.55),
        0 10px 28px rgba(0,0,0,.35);
      isolation: isolate;
    }
    .nocturne-520::before {
      /* soft film grain + vignette */
      content: "";
      position: absolute;
      inset: -2px;
      pointer-events: none;
      background:
        radial-gradient(120% 140% at 50% 10%, transparent 0 56%, rgba(0,0,0,.25) 84%),
        repeating-linear-gradient(0deg, rgba(255,255,255,.02), rgba(255,255,255,.02) 1px, transparent 1px, transparent 3px);
      mix-blend-mode: soft-light;
      opacity: .7;
      z-index: 0;
    }

    .field {
      position: absolute;
      inset: 0;
      z-index: 1;
      filter: blur(calc((var(--bloom) - 30) * 0.08px));
      pointer-events: none;
    }

    .shell {
      position: relative;
      z-index: 2;
      max-width: 1120px;
      margin: 0 auto;
      padding: clamp(22px, 4.6vw, 48px);
      border-radius: 20px;
      background: linear-gradient(180deg, hsla(0 0% 100% / .06), hsla(0 0% 100% / .03));
      border: 1px solid var(--edge);
      box-shadow:
        0 24px 80px rgba(0,0,0,.45),
        inset 0 1px 0 rgba(255,255,255,.08);
      backdrop-filter: blur(10px) saturate(120%);
      transform: perspective(1200px) rotateX(var(--rx, 0deg)) rotateY(var(--ry, 0deg));
      transition: box-shadow 300ms ease, border-color 300ms ease, transform 400ms cubic-bezier(.2,.8,.2,1);
    }
    .shell:hover { border-color: hsla(var(--h) 90% 60% / .35); box-shadow: 0 36px 110px rgba(0,0,0,.55), 0 0 0 1px inset hsla(var(--h) 100% 60% / .08); }

    .bar {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 12px;
      margin-bottom: 6px;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      font-size: 11px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--muted);
      background: linear-gradient(180deg, hsla(0 0% 100% / .08), hsla(0 0% 100% / .03));
      border: 1px solid var(--edge);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
      user-select: none;
      white-space: nowrap;
    }
    .brand {
      justify-self: center;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      color: var(--muted);
      font-weight: 700;
      letter-spacing: .02em;
    }
    .brand svg { width: 22px; height: 22px; filter: drop-shadow(0 10px 24px var(--glow-soft)); }

    .title {
      margin: 10px 0 8px;
      text-align: center;
      font-weight: 900;
      letter-spacing: -0.02em;
      line-height: .95;
      font-size: clamp(42px, 7.8vw, 100px);
      color: transparent;
      background:
        linear-gradient(92deg,
          hsl(calc(var(--h) - 30) 90% 62%),
          hsl(var(--h) 95% 68%) 45%,
          hsl(calc(var(--h) + 50) 90% 60%)
        );
      -webkit-background-clip: text;
              background-clip: text;
      filter: drop-shadow(0 18px 38px var(--glow-soft));
    }
    .lede {
      margin: 10px auto 14px;
      max-width: 70ch;
      text-align: center;
      font-size: clamp(16px, 2.2vw, 20px);
      line-height: 1.75;
      color: var(--muted);
    }

    .controls {
      display: grid;
      grid-template-columns: minmax(220px, 280px) 1fr auto;
      gap: clamp(14px, 3.6vw, 36px);
      align-items: center;
      margin-top: clamp(12px, 3.8vw, 34px);
    }
    @media (max-width: 980px) { .controls { grid-template-columns: 1fr; } }

    .ring {
      --angle: 180deg;
      position: relative;
      width: clamp(220px, 32vw, 280px);
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      background:
        radial-gradient(circle at 50% 50%, hsla(0 0% 100% / .08), transparent 60%),
        conic-gradient(from -90deg,
          #f00 0, #ff0 60deg, #0f0 120deg, #0ff 180deg, #00f 240deg, #f0f 300deg, #f00 360deg);
      mask:
        radial-gradient(circle at 50% 50%, transparent 56%, #000 57% 100%);
      border: 1px solid var(--edge);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.1),
        0 18px 46px rgba(0,0,0,.5);
      cursor: grab;
      touch-action: none;
      outline: none;
    }
    .ring:active { cursor: grabbing; }
    .ring .halo {
      position: absolute;
      inset: 6%;
      border-radius: 50%;
      background:
        conic-gradient(from var(--angle),
          hsla(var(--h) 100% 65% / .25) 0 12deg,
          transparent 12deg 360deg);
      filter: blur(10px);
      pointer-events: none;
    }
    .ring .handle {
      position: absolute;
      left: 50%; top: 50%;
      width: 56%;
      height: 56%;
      transform: translate(-50%, -50%) rotate(var(--angle));
      transform-origin: center;
      transition: transform 120ms linear;
    }
    .ring .handle::before {
      content: "";
      position: absolute;
      left: 50%; top: 0%;
      transform: translate(-50%, -50%);
      width: 14px; height: 14px;
      border-radius: 50%;
      background: radial-gradient(circle at 40% 40%, #fff, hsl(var(--h) 100% 62%));
      border: 1px solid hsl(var(--h) 90% 60%);
      box-shadow:
        0 0 0 6px hsla(var(--h) 100% 60% / .16),
        0 18px 36px hsla(var(--h) 90% 60% / .35),
        inset 0 1px 0 rgba(255,255,255,.9);
    }
    .ring-label {
      color: var(--muted);
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
      text-align: center;
      margin-top: 8px;
    }

    .sliders {
      display: grid;
      gap: 14px;
    }
    .group { display: grid; gap: 6px; }
    .group label {
      color: var(--muted);
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
    }
    .slider {
      --pct: 50%;
      position: relative;
      height: 36px;
      border-radius: 12px;
      background: linear-gradient(180deg, hsla(0 0% 100% / .06), hsla(0 0% 100% / .03));
      border: 1px solid var(--edge);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
      display: grid;
      align-items: center;
      padding: 0 10px;
    }
    .slider::before {
      content: "";
      position: absolute;
      left: 10px; right: 10px; top: 50%;
      transform: translateY(-50%);
      height: 6px;
      border-radius: 6px;
      background:
        linear-gradient(90deg, hsla(var(--h) 90% 60% / .35), hsla(calc(var(--h) + 60) 90% 60% / .35));
      box-shadow: inset 0 0 0 1px hsla(0 0% 100% / .06);
    }
    .slider .thumb {
      position: absolute;
      left: calc(10px + (var(--pct) * (100% - 20px)));
      top: 50%;
      transform: translate(-50%, -50%);
      width: 18px; height: 18px;
      border-radius: 50%;
      background: radial-gradient(circle at 40% 40%, #fff, hsl(var(--h) 100% 62%));
      border: 1px solid hsl(var(--h) 90% 60%);
      box-shadow:
        0 0 0 6px hsla(var(--h) 100% 60% / .14),
        0 10px 22px hsla(var(--h) 90% 60% / .35),
        inset 0 1px 0 rgba(255,255,255,.9);
      pointer-events: none;
    }
    .slider input[type="range"] {
      appearance: none;
      width: 100%; height: 100%;
      background: transparent; outline: none; margin: 0; padding: 0;
      cursor: pointer;
    }
    .slider input[type="range"]::-webkit-slider-thumb { appearance: none; width: 0; height: 0; }
    .slider input[type="range"]::-moz-range-thumb { width: 0; height: 0; border: 0; }

    .actions {
      display: grid;
      grid-template-columns: repeat(2, minmax(120px, auto));
      gap: 10px;
      justify-content: end;
      align-content: start;
    }
    @media (max-width: 980px) { .actions { grid-template-columns: 1fr 1fr; } }
    .btn {
      appearance: none;
      border: 1px solid var(--edge);
      color: var(--ink);
      background: linear-gradient(180deg, hsla(0 0% 100% / .08), hsla(0 0% 100% / .03));
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 800;
      letter-spacing: .02em;
      cursor: pointer;
      box-shadow:
        0 14px 36px rgba(0,0,0,.45),
        inset 0 1px 0 rgba(255,255,255,.08);
      transition: transform 160ms ease, box-shadow 240ms ease, border-color 240ms ease, background 240ms ease;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
      will-change: transform;
    }
    .btn::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(140px 80px at var(--sx, 10%) -20%, hsla(0 0% 100% / .25), transparent 60%);
      mix-blend-mode: screen;
      opacity: .55;
      pointer-events: none;
      transition: opacity 200ms ease;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 22px 54px rgba(0,0,0,.55); }
    .btn:hover::after { opacity: .9; }
    .btn.primary {
      border-color: hsla(var(--h) 90% 60% / .4);
      box-shadow:
        0 18px 46px rgba(0,0,0,.5),
        0 0 0 1px inset hsla(var(--h) 90% 60% / .2),
        inset 0 1px 0 rgba(255,255,255,.08);
      background: linear-gradient(180deg, hsla(var(--h) 100% 65% / .22), hsla(0 0% 100% / .06));
    }

    .tiles {
      list-style: none;
      margin: 20px 0 0;
      padding: 0;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: clamp(12px, 2.6vw, 20px);
    }
    @media (max-width: 880px) { .tiles { grid-template-columns: 1fr; } }
    .tile {
      position: relative;
      border-radius: 16px;
      padding: clamp(14px, 2.2vw, 18px);
      background: linear-gradient(180deg, hsla(0 0% 100% / .06), hsla(0 0% 100% / .03));
      border: 1px solid var(--edge);
      box-shadow:
        0 18px 46px rgba(0,0,0,.5),
        inset 0 1px 0 rgba(255,255,255,.08);
      transition: transform 240ms cubic-bezier(.2,.7,.2,1), box-shadow 240ms ease, border-color 240ms ease;
    }
    .tile::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: linear-gradient(90deg, hsla(var(--h) 90% 60% / .18), transparent 30%, transparent 70%, hsla(calc(var(--h) + 50) 90% 60% / .16));
      opacity: .65;
      pointer-events: none;
    }
    .tile:hover {
      transform: translateY(-6px);
      border-color: hsla(var(--h) 90% 60% / .35);
      box-shadow: 0 26px 60px rgba(0,0,0,.6);
    }
    .tile h3 {
      margin: 8px 0 6px;
      font-size: clamp(16px, 2.2vw, 20px);
      letter-spacing: -0.01em;
      color: var(--ink);
    }
    .tile p {
      margin: 0;
      color: var(--muted);
      line-height: 1.7;
      font-size: 14.5px;
    }
    .ico {
      width: 28px; height: 28px;
      filter: drop-shadow(0 10px 22px var(--glow-soft));
    }

    .meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      margin-top: 18px;
      color: var(--muted);
      font-size: 12.5px;
      flex-wrap: wrap;
    }
    #last-updated {
      color: var(--ink);
      background: linear-gradient(180deg, hsla(0 0% 100% / .08), hsla(0 0% 100% / .03));
      border: 1px solid var(--edge);
      padding: 6px 10px;
      border-radius: 10px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
      white-space: nowrap;
    }

    @media (prefers-reduced-motion: reduce) {
      .field { display: none !important; }
      .ring .halo { display: none !important; }
      .btn::after { display: none !important; }
      .shell { transition: none !important; }
    }
  </style>

  <canvas class="field" aria-hidden="true"></canvas>

  <div class="shell" role="region" aria-label="Nocturne Console">
    <div class="bar">
      <span class="chip">Iteration 520</span>
      <span class="brand" aria-hidden="true">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <defs>
            <linearGradient id="g520" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="hsl(var(--h) 95% 68%)"/>
              <stop offset="1" stop-color="hsl(calc(var(--h) + 60) 95% 58%)"/>
            </linearGradient>
          </defs>
          <path d="M12 3l3 6 6 3-6 3-3 6-3-6-6-3 6-3z" fill="url(#g520)"/>
        </svg>
        Nocturne
      </span>
      <span class="chip">Aurora mode</span>
    </div>

    <h1 class="title">Midnight Prism</h1>
    <p class="lede">A night-coded interface study—glassy layers, neon edges, and a living aurora you can tune. Rotate the prism; the sky follows.</p>

    <div class="controls">
      <div class="ring" id="ring" tabindex="0" role="slider" aria-label="Prism hue" aria-valuemin="0" aria-valuemax="360" aria-valuenow="266" aria-valuetext="Hue 266 degrees">
        <div class="halo" aria-hidden="true"></div>
        <div class="handle" aria-hidden="true"></div>
        <div class="ring-label" aria-hidden="true">Rotate to color</div>
      </div>

      <div class="sliders">
        <div class="group">
          <label for="flow">Flow</label>
          <div class="slider" style="--pct: .6;">
            <span class="thumb" aria-hidden="true"></span>
            <input id="flow" type="range" min="0" max="100" value="60" aria-label="Flow">
          </div>
        </div>
        <div class="group">
          <label for="bloom">Bloom</label>
          <div class="slider" style="--pct: .7;">
            <span class="thumb" aria-hidden="true"></span>
            <input id="bloom" type="range" min="0" max="100" value="70" aria-label="Bloom">
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" type="button" id="pulse">Pulse</button>
        <button class="btn" type="button" id="cycle">Palette</button>
      </div>
    </div>

    <ul class="tiles" aria-label="Principles">
      <li class="tile">
        <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 3v18M3 12h18" stroke="hsl(var(--h) 95% 68%)" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <h3>1 — Focus</h3>
        <p>Night contrast with soft bloom. The important elements glow; the rest recedes.</p>
      </li>
      <li class="tile">
        <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="12" cy="12" r="6" fill="none" stroke="hsl(var(--h) 95% 68%)" stroke-width="2"/>
          <path d="M12 6a6 6 0 0 1 6 6" stroke="hsl(calc(var(--h) + 40) 95% 62%)" stroke-width="2" fill="none" stroke-linecap="round"/>
        </svg>
        <h3>2 — Mood</h3>
        <p>Color as narrative. Rotate the prism to retell the scene in new light.</p>
      </li>
      <li class="tile">
        <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M4 16c5-7 11-7 16 0" stroke="hsl(var(--h) 95% 68%)" stroke-width="2" fill="none" stroke-linecap="round"/>
          <circle cx="8" cy="10" r="2" fill="hsl(calc(var(--h) + 50) 95% 62%)"/>
        </svg>
        <h3>3 — Grace</h3>
        <p>Motion whispers. Micro-interactions signal intent without stealing attention.</p>
      </li>
    </ul>

    <div class="meta">
      <span class="note">Hue: <strong><span id="hue520">266</span>°</strong> • Flow: <strong><span id="flow520">60</span>%</strong> • Bloom: <strong><span id="bloom520">70</span>%</strong></span>
      <span id="last-updated">Last updated: 2025-11-09 05:16:13 EST</span>
    </div>
  </div>

  <script>
    (function () {
      const root = document.currentScript.closest('.nocturne-520');
      if (!root) return;

      // Timestamp
      const last = root.querySelector('#last-updated');
      try {
        const now = new Date();
        const date = now.toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'short' });
        last.textContent = 'Last updated: ' + date;
      } catch { last.textContent = 'Last updated: just now'; }

      // Shell parallax + magnetic buttons
      const shell = root.querySelector('.shell');
      shell.addEventListener('pointermove', (e) => {
        const r = shell.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width - 0.5;
        const y = (e.clientY - r.top) / r.height - 0.5;
        shell.style.setProperty('--rx', (-y * 5).toFixed(2) + 'deg');
        shell.style.setProperty('--ry', (x * 8).toFixed(2) + 'deg');
        root.querySelectorAll('.btn').forEach(btn => {
          const bx = (x * 10).toFixed(2);
          const by = (y * 10).toFixed(2);
          btn.style.transform = `translate(${bx}px, ${by}px)`;
          btn.style.setProperty('--sx', (x * 50 + 50) + '%');
        });
      });
      shell.addEventListener('pointerleave', () => {
        shell.style.setProperty('--rx', '0deg');
        shell.style.setProperty('--ry', '0deg');
        root.querySelectorAll('.btn').forEach(btn => btn.style.transform = '');
      });

      // Prism ring hue control
      const ring = root.querySelector('#ring');
      const hueReadout = root.querySelector('#hue520');
      const setHue = (h) => {
        const hue = Math.round(Math.max(0, Math.min(360, h)));
        root.style.setProperty('--h', hue);
        ring.style.setProperty('--angle', hue + 'deg');
        ring.setAttribute('aria-valuenow', String(hue));
        ring.setAttribute('aria-valuetext', 'Hue ' + hue + ' degrees');
        hueReadout.textContent = hue;
      };
      const getAngle = (clientX, clientY) => {
        const rect = ring.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top + rect.height / 2;
        const rad = Math.atan2(clientY - cy, clientX - cx);
        let deg = (rad * 180 / Math.PI) + 90; // start at top
        if (deg < 0) deg += 360;
        return deg % 360;
      };
      const initH = parseInt(getComputedStyle(root).getPropertyValue('--h')) || 266;
      setHue(initH);

      let dragging = false;
      const onMove = (e) => { if (!dragging) return; setHue(getAngle(e.clientX, e.clientY)); };
      ring.addEventListener('pointerdown', (e) => {
        dragging = true;
        ring.setPointerCapture(e.pointerId);
        setHue(getAngle(e.clientX, e.clientY));
      });
      ring.addEventListener('pointermove', onMove);
      ring.addEventListener('pointerup', (e) => { dragging = false; ring.releasePointerCapture(e.pointerId); });
      ring.addEventListener('pointercancel', () => { dragging = false; });
      ring.addEventListener('keydown', (e) => {
        const step = e.shiftKey ? 15 : 5;
        const current = parseInt(ring.getAttribute('aria-valuenow') || '0', 10);
        if (e.key === 'ArrowRight' || e.key === 'ArrowUp') { e.preventDefault(); setHue(current + step); }
        if (e.key === 'ArrowLeft' || e.key === 'ArrowDown') { e.preventDefault(); setHue(current - step); }
        if (e.key === 'Home') { e.preventDefault(); setHue(0); }
        if (e.key === 'End') { e.preventDefault(); setHue(360); }
        if (e.key === '1') { e.preventDefault(); setHue(266); }
        if (e.key === '2') { e.preventDefault(); setHue(32); }
        if (e.key === '3') { e.preventDefault(); setHue(180); }
        if (e.key === '4') { e.preventDefault(); setHue(136); }
        if (e.key === '5') { e.preventDefault(); setHue(320); }
      });

      // Sliders
      const flowSlider = root.querySelector('#flow');
      const bloomSlider = root.querySelector('#bloom');
      const flowOut = root.querySelector('#flow520');
      const bloomOut = root.querySelector('#bloom520');

      const setSliderPct = (el, v) => el.closest('.slider').style.setProperty('--pct', (v/100).toFixed(3));
      const applyFlow = (v) => { root.style.setProperty('--flow', v); flowOut.textContent = v; setSliderPct(flowSlider, v); };
      const applyBloom = (v) => { root.style.setProperty('--bloom', v); bloomOut.textContent = v; setSliderPct(bloomSlider, v); };

      applyFlow(parseInt(flowSlider.value, 10));
      applyBloom(parseInt(bloomSlider.value, 10));

      flowSlider.addEventListener('input', (e) => applyFlow(parseInt(e.target.value, 10)));
      bloomSlider.addEventListener('input', (e) => applyBloom(parseInt(e.target.value, 10)));

      // Palette cycle
      const palettes = [266, 32, 180, 136, 320];
      let pi = palettes.indexOf(initH);
      if (pi < 0) pi = 0;
      root.querySelector('#cycle')?.addEventListener('click', () => {
        pi = (pi + 1) % palettes.length;
        setHue(palettes[pi]);
        pulse(1.4);
      });

      // Aurora + stars canvas
      const canvas = root.querySelector('.field');
      const ctx = canvas.getContext('2d', { alpha: true });
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      let dpr = Math.max(1, window.devicePixelRatio || 1);

      function resize() {
        const r = root.getBoundingClientRect();
        canvas.width = Math.max(1, Math.floor(r.width * dpr));
        canvas.height = Math.max(1, Math.floor(r.height * dpr));
      }
      window.addEventListener('resize', resize);
      resize();

      const stars = [];
      function seedStars() {
        stars.length = 0;
        const count = Math.floor((canvas.width * canvas.height) / (14000 * dpr));
        for (let i = 0; i < count; i++) {
          stars.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            r: (Math.random() * 1.2 + 0.2) * dpr,
            tw: Math.random() * Math.PI * 2,
            sp: Math.random() * 0.02 + 0.005
          });
        }
      }
      seedStars();

      let t = 0;
      let ampBoost = 0;
      function pulse(mult = 1.25) {
        ampBoost = Math.max(ampBoost, 0.6 * mult);
      }
      root.querySelector('#pulse')?.addEventListener('click', () => pulse());

      let mouse = { x: 0.5, y: 0.3 };
      root.addEventListener('pointermove', (e) => {
        const r = root.getBoundingClientRect();
        mouse.x = (e.clientX - r.left) / r.width;
        mouse.y = (e.clientY - r.top) / r.height;
      });

      function drawAurora() {
        const w = canvas.width, h = canvas.height;
        ctx.clearRect(0, 0, w, h);

        // Twinkling stars
        for (let i = 0; i < stars.length; i++) {
          const s = stars[i];
          s.tw += s.sp;
          const a = 0.35 + Math.sin(s.tw) * 0.25;
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
          ctx.fillStyle = `hsla(${(parseInt(getComputedStyle(root).getPropertyValue('--h')) + 40) % 360}, 90%, 70%, ${a})`;
          ctx.fill();
        }

        // Aurora ribbons
        const baseHue = parseInt(getComputedStyle(root).getPropertyValue('--h')) || 266;
        const flow = parseInt(getComputedStyle(root).getPropertyValue('--flow')) || 60;
        const speed = 0.0008 + flow * 0.00006;
        t += prefersReduced ? 0 : speed * w;

        const layers = [
          { off: -40, h: baseHue - 30, alpha: 0.08, w: 5 * dpr, blur: 24 },
          { off: 0,   h: baseHue,      alpha: 0.10, w: 7 * dpr, blur: 28 },
          { off: 40,  h: baseHue + 50, alpha: 0.08, w: 5 * dpr, blur: 24 }
        ];
        const amp = (h * (0.05 + flow * 0.002)) * (1 + ampBoost);
        ampBoost *= prefersReduced ? 0 : 0.92;

        ctx.save();
        ctx.globalCompositeOperation = 'lighter';
        for (let L of layers) {
          const hue = ((L.h % 360) + 360) % 360;
          ctx.strokeStyle = `hsla(${hue}, 100%, 65%, ${L.alpha})`;
          ctx.lineWidth = L.w;
          ctx.shadowColor = `hsla(${hue}, 100%, 65%, .45)`;
          ctx.shadowBlur = L.blur;

          ctx.beginPath();
          const segments = 12;
          for (let i = 0; i <= segments; i++) {
            const px = (i / segments) * w;
            const n = i + L.off * 0.02;
            const yy =
              h * (0.35 + mouse.y * 0.2) +
              Math.sin((px + t * 1.3 + n * 20) * 0.003) * amp * 0.35 +
              Math.cos((px * 0.7 + t * 0.9 + n * 14) * 0.002) * amp * 0.25;
            if (i === 0) ctx.moveTo(px, yy);
            else ctx.lineTo(px, yy);
          }
          ctx.stroke();
        }
        ctx.restore();
      }

      let raf;
      function loop() {
        drawAurora();
        raf = requestAnimationFrame(loop);
      }
      if (!prefersReduced) loop(); else drawAurora();

      // Re-seed stars on resize DPI changes
      let dprCheck = dpr;
      setInterval(() => {
        const nowDpr = Math.max(1, window.devicePixelRatio || 1);
        if (nowDpr !== dprCheck) {
          dpr = nowDpr;
          resize(); seedStars();
          dprCheck = nowDpr;
        }
      }, 1000);

      // Initial flourish
      setTimeout(() => pulse(1.6), 260);
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


