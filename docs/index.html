<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="vibe1638" aria-label="Orbital Atelier — generative timepiece">
  <style>
    /* THEME TOKENS */
    #vibe1638{
      --bg0:#0b0f18;
      --bg1:#0f1730;
      --ink:#e8f0ff;
      --muted:#9fb0cf;
      --a:#7dd3fc; /* sky */
      --b:#a78bfa; /* violet */
      --c:#34d399; /* jade */
      --ring:rgba(255,255,255,.14);
      --glass:rgba(255,255,255,.06);
      --tiltX:0;
      --tiltY:0;
      --grain:.14;
      position: relative;
      isolation: isolate;
      min-height: 860px;
      border-radius: 28px;
      overflow: clip;
      color: var(--ink);
      background:
        radial-gradient(120% 140% at 20% 0%, color-mix(in oklab, var(--a) 8%, transparent), transparent 60%),
        radial-gradient(160% 140% at 100% 100%, color-mix(in oklab, var(--b) 8%, transparent), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      box-shadow: 0 28px 70px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.08);
      display: grid;
      grid-template-rows: auto 1fr auto;
    }
    #vibe1638::before{
      /* vignette + aurora veil */
      content:"";
      position:absolute; inset:-2%;
      background:
        radial-gradient(140% 140% at 50% 110%, transparent 60%, rgba(0,0,0,.38) 100%),
        conic-gradient(from 0deg at 70% 40%, rgba(125,211,252,.12), transparent 25%, rgba(167,139,250,.12), transparent 50%, rgba(52,211,153,.12), transparent 75%, rgba(125,211,252,.12));
      mix-blend-mode: screen;
      filter: blur(30px) saturate(130%);
      pointer-events:none;
      opacity:.5;
      animation: veil1638 18s ease-in-out infinite alternate;
    }
    @keyframes veil1638 { 0%{ transform: rotate(0deg) scale(1); opacity:.4 } 100%{ transform: rotate(8deg) scale(1.03); opacity:.6 } }
    #vibe1638::after{
      /* star grain */
      content:"";
      position:absolute; inset:0; pointer-events:none;
      opacity: var(--grain);
      background:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,.08), transparent 30%),
        repeating-conic-gradient(from 0deg, rgba(255,255,255,.06) 0 .5deg, transparent .5deg 2deg),
        repeating-linear-gradient(0deg, rgba(255,255,255,.035) 0 1px, transparent 1px 2px);
      mix-blend-mode: soft-light;
    }

    /* FRAME BAR */
    #vibe1638 .frame{
      position: relative; z-index: 5;
      margin: 16px; padding: 12px 14px;
      display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 12px;
      border-radius: 16px;
      border: 1px solid var(--ring);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      backdrop-filter: blur(14px) saturate(140%);
      box-shadow: 0 16px 38px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.12);
    }
    #vibe1638 .brand{
      display: inline-flex; align-items: center; gap: 12px;
      font: 800 12px/1 ui-sans-serif, system-ui; letter-spacing: .28em; text-transform: uppercase; color: var(--muted);
    }
    #vibe1638 .orb-dot{
      --s: 14px; width: var(--s); height: var(--s);
      border-radius: 50%;
      background:
        radial-gradient(circle at 35% 35%, #fff, var(--a) 60%),
        radial-gradient(circle at 65% 65%, color-mix(in oklab, var(--b) 50%, transparent), transparent 60%);
      box-shadow: 0 0 0 6px rgba(255,255,255,.08), 0 10px 18px rgba(0,0,0,.4), 0 0 16px color-mix(in oklab, var(--a) 60%, transparent);
      animation: spin-d1638 12s linear infinite;
    }
    @keyframes spin-d1638 { to{ transform: rotate(360deg) } }

    #vibe1638 .controls{ display: inline-flex; gap: 10px; flex-wrap: wrap; }
    #vibe1638 .chip{
      display: inline-flex; align-items: center; gap: 8px;
      padding: 9px 14px; border-radius: 999px; cursor: pointer; user-select: none;
      border: 1px solid var(--ring);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      color: var(--ink); font: 700 12px/1 ui-sans-serif, system-ui; letter-spacing: .2px;
      box-shadow: 0 12px 26px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.16);
      transition: transform .12s ease, box-shadow .2s ease, background .2s ease, color .2s ease;
    }
    #vibe1638 .chip:hover{ transform: translateY(-1px); box-shadow: 0 18px 44px rgba(0,0,0,.45); }
    #vibe1638 .dot{ width: 8px; height: 8px; border-radius: 999px; background: radial-gradient(circle at 35% 35%, #fff, var(--a)); box-shadow: 0 0 10px color-mix(in oklab, var(--a), transparent 40%); }

    /* SCENE */
    #vibe1638 .stage{
      position: relative; z-index: 1;
      display: grid; place-items: center;
      padding: clamp(8px, 3vw, 24px);
    }

    /* HALO INSTRUMENT */
    #vibe1638 .halo{
      position: relative;
      width: min(86vmin, 1100px); aspect-ratio: 1/1;
      border-radius: 50%;
      background:
        radial-gradient(60% 60% at 50% 50%, rgba(255,255,255,.08), transparent 70%),
        radial-gradient(100% 100% at 50% 50%, rgba(255,255,255,.06), transparent 80%);
      border: 1px solid var(--ring);
      box-shadow: 0 40px 120px rgba(0,0,0,.6), inset 0 1px 0 rgba(255,255,255,.16), inset 0 -40px 120px rgba(0,0,0,.35);
      backdrop-filter: blur(18px) saturate(140%);
      transform:
        perspective(1200px)
        rotateY(calc(var(--tiltX)*8deg))
        rotateX(calc(var(--tiltY)*-8deg))
        translate3d(calc(var(--tiltX)*14px), calc(var(--tiltY)*14px), 0);
      transition: transform .2s ease;
      overflow: hidden;
    }
    #vibe1638 .rim{
      position:absolute; inset:4%; border-radius:50%;
      background:
        conic-gradient(from 0deg, color-mix(in oklab, var(--a) 50%, transparent), transparent 26%, color-mix(in oklab, var(--b) 55%, transparent), transparent 52%, color-mix(in oklab, var(--c) 55%, transparent), transparent 78%, color-mix(in oklab, var(--a) 50%, transparent));
      filter: blur(18px) saturate(140%);
      opacity:.6; mix-blend-mode: screen; pointer-events:none;
      animation: rim-spin 20s linear infinite;
    }
    @keyframes rim-spin { to { transform: rotate(360deg) } }

    /* Tick ring */
    #vibe1638 .ticks{
      position:absolute; inset:2.2%; border-radius:50%;
      background:
        repeating-conic-gradient(from 0deg,
          rgba(255,255,255,.22) 0 1deg, transparent 1deg 6deg),
        radial-gradient(closest-side, transparent 82%, rgba(255,255,255,.08) 83% 84%, transparent 85%);
      mask: radial-gradient(circle at 50% 50%, transparent 68%, #000 69%);
      -webkit-mask: radial-gradient(circle at 50% 50%, transparent 68%, #000 69%);
      pointer-events:none; opacity:.6;
      animation: tick-slow 120s linear infinite;
    }
    @keyframes tick-slow { to{ transform: rotate(360deg) } }

    /* Canvas sits under overlays */
    #vibe1638 canvas#orb{ position:absolute; inset:0; width:100%; height:100%; display:block; }

    /* Title */
    #vibe1638 .title-wrap{
      position: absolute; inset: 12% 12% auto 12%;
      display: grid; place-items: center;
      pointer-events:none;
    }
    #vibe1638 .title{
      margin:0; text-align:center;
      font: 900 clamp(34px, 6.2vw, 92px)/.88 ui-serif, ui-sans-serif, system-ui;
      letter-spacing:.01em;
      background: linear-gradient(100deg, var(--ink), color-mix(in oklab, var(--a), var(--ink) 40%), var(--b), var(--c));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter: drop-shadow(0 10px 24px rgba(0,0,0,.4));
    }
    #vibe1638 .subtitle{
      margin:10px 0 0;
      text-align:center; color: var(--muted);
      font: 400 clamp(12px,1.8vw,18px)/1.7 ui-sans-serif, system-ui;
      letter-spacing:.02em;
    }

    /* Controls dock (bottom of halo) */
    #vibe1638 .dock{
      position:absolute; left:50%; bottom:6%;
      transform: translateX(-50%);
      display:flex; gap:10px; flex-wrap:wrap; z-index:4;
    }
    #vibe1638 .btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 14px; border-radius:12px; cursor:pointer; user-select:none;
      border: 1px solid var(--ring);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04));
      color: var(--ink); font: 800 12px/1 ui-sans-serif, system-ui; letter-spacing:.2px;
      box-shadow: 0 10px 24px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.14);
      transition: transform .12s ease, box-shadow .2s ease, filter .2s ease;
    }
    #vibe1638 .btn:hover{ transform: translateY(-1px); box-shadow: 0 18px 44px rgba(0,0,0,.6); }

    /* Footer */
    #vibe1638 .foot{
      position: relative; z-index: 6;
      margin: 16px; padding-top: 12px;
      border-top: 1px dashed var(--ring);
      color: var(--muted);
      display: flex; align-items: center; justify-content: space-between; gap: 16px;
      font: 400 12px/1.6 ui-sans-serif, system-ui;
    }
    #vibe1638 .hint{ display:flex; align-items:center; gap:8px; }
    #vibe1638 .pulse{ width:8px; height:8px; border-radius:50%; background: radial-gradient(circle at 30% 30%, #fff, var(--c)); box-shadow: 0 0 14px color-mix(in oklab, var(--c), transparent 30%); animation: ping1638 3s ease-in-out infinite; }
    @keyframes ping1638 { 0%,100%{ transform: scale(1); opacity:.9 } 50%{ transform: scale(1.25); opacity:1 } }

    /* Pause and reduced-motion */
    #vibe1638.paused, #vibe1638.paused * { animation-play-state: paused !important; }
    @media (prefers-reduced-motion: reduce){
      #vibe1638 .rim, #vibe1638 .ticks, #vibe1638 .orb-dot, #vibe1638::before { animation: none !important; }
    }
  </style>

  <div class="frame" role="toolbar" aria-label="Instrument controls">
    <div class="brand"><span class="orb-dot" aria-hidden="true"></span> Orbital Atelier</div>
    <div class="controls">
      <button class="chip" id="pal"><span class="dot" aria-hidden="true"></span>Palette</button>
      <button class="chip" id="remix"><span class="dot" aria-hidden="true"></span>Remix</button>
      <button class="chip" id="pause"><span class="dot" aria-hidden="true"></span>Pause</button>
      <button class="chip" id="speed"><span class="dot" aria-hidden="true"></span>Speed</button>
      <button class="chip" id="glow"><span class="dot" aria-hidden="true"></span>Glow</button>
      <button class="chip" id="grain"><span class="dot" aria-hidden="true"></span>Grain</button>
    </div>
  </div>

  <div class="stage" id="stage">
    <div class="halo" id="halo">
      <canvas id="orb" aria-label="Orbit sketch" role="img"></canvas>
      <div class="rim" aria-hidden="true"></div>
      <div class="ticks" aria-hidden="true"></div>

      <div class="title-wrap">
        <h2 class="title">ORBITAL ATELIER</h2>
        <p class="subtitle">A slow timepiece for curious eyes. Nudge space with your cursor.</p>
      </div>

      <div class="dock" aria-label="Dock controls">
        <button class="btn" id="center"><span class="dot" aria-hidden="true"></span>Center</button>
        <button class="btn" id="invert"><span class="dot" aria-hidden="true"></span>Invert</button>
        <button class="btn" id="trail"><span class="dot" aria-hidden="true"></span>Trails</button>
      </div>
    </div>
  </div>

  <div class="foot">
    <div class="hint"><span class="pulse" aria-hidden="true"></span> P palette • R remix • Space pause • S speed • G glow • T trails • I invert</div>
    <span id="last-updated">Last updated: 2025-12-31 00:23:31 EST</span>
  </div>

  <script>
    (function(){
      const root = document.getElementById('vibe1638');
      const halo = document.getElementById('halo');
      const canvas = document.getElementById('orb');
      const ctx = canvas.getContext('2d');
      const updated = document.getElementById('last-updated');

      const palBtn = document.getElementById('pal');
      const remixBtn = document.getElementById('remix');
      const pauseBtn = document.getElementById('pause');
      const speedBtn = document.getElementById('speed');
      const glowBtn = document.getElementById('glow');
      const grainBtn = document.getElementById('grain');
      const centerBtn = document.getElementById('center');
      const invertBtn = document.getElementById('invert');
      const trailBtn = document.getElementById('trail');

      // timestamp
      const fmt = new Intl.DateTimeFormat([], { dateStyle: 'medium', timeStyle: 'short' });
      updated.textContent = 'Last updated: ' + fmt.format(new Date());

      // palettes (dark + light options)
      const PALETTES = [
        { name:'Lumen Night', vars:{'--bg0':'#0b0f18','--bg1':'#0f1730','--ink':'#e8f0ff','--muted':'#9fb0cf','--a':'#7dd3fc','--b':'#a78bfa','--c':'#34d399'} },
        { name:'Citrus Noir', vars:{'--bg0':'#0d0a0c','--bg1':'#171114','--ink':'#ffeef4','--muted':'#d7bac7','--a':'#fb7185','--b':'#f59e0b','--c':'#22d3ee'} },
        { name:'Polar Dawn', vars:{'--bg0':'#f5fbff','--bg1':'#eef4ff','--ink':'#0b1020','--muted':'#4f5e7a','--a':'#3b82f6','--b':'#22c55e','--c':'#f59e0b'} },
        { name:'Mint Nebula', vars:{'--bg0':'#081510','--bg1':'#0f1e1a','--ink':'#eafff7','--muted':'#a7d3c3','--a':'#10b981','--b':'#60a5fa','--c':'#f472b6'} },
        { name:'Graphite Halo', vars:{'--bg0':'#0a0a0a','--bg1':'#141414','--ink':'#f2f2f2','--muted':'#bdbdbd','--a':'#e5e5e5','--b':'#a3a3a3','--c':'#737373'} }
      ];
      let pi = 0;
      function applyPalette(p){
        Object.entries(p.vars).forEach(([k,v])=> root.style.setProperty(k, v));
        palBtn.setAttribute('aria-label', 'Palette: '+p.name);
      }
      applyPalette(PALETTES[0]);
      palBtn.addEventListener('click', ()=>{ pi=(pi+1)%PALETTES.length; applyPalette(PALETTES[pi]); });

      // Grain toggle
      let grainOn = true;
      grainBtn.addEventListener('click', ()=>{
        grainOn = !grainOn;
        root.style.setProperty('--grain', grainOn?'.14':'0');
        grainBtn.setAttribute('aria-pressed', String(grainOn));
      });

      // Tilt parallax on halo
      let rect = root.getBoundingClientRect();
      function updateRect(){
        rect = root.getBoundingClientRect();
        resizeCanvas();
      }
      addEventListener('resize', updateRect);
      root.addEventListener('pointermove', e=>{
        const x = (e.clientX - rect.left) / rect.width - .5;
        const y = (e.clientY - rect.top) / rect.height - .5;
        root.style.setProperty('--tiltX', x.toFixed(3));
        root.style.setProperty('--tiltY', y.toFixed(3));
        pointer.active = true;
        pointer.x = (e.clientX - rect.left) - rect.width/2;
        pointer.y = (e.clientY - rect.top) - rect.height/2;
        lastMove = performance.now();
      });
      root.addEventListener('pointerleave', ()=>{
        root.style.setProperty('--tiltX', 0);
        root.style.setProperty('--tiltY', 0);
        pointer.active = false;
      });

      // micro magnet
      root.querySelectorAll('.chip, .btn').forEach(el=>{
        el.addEventListener('pointermove', (e)=>{
          const r = el.getBoundingClientRect();
          const x = (e.clientX - r.left)/r.width - .5;
          const y = (e.clientY - r.top)/r.height - .5;
          el.style.transform = `translate(${x*6}px, ${y*6}px)`;
        });
        el.addEventListener('pointerleave', ()=> el.style.transform = '');
      });

      // Canvas sizing
      let DPR = Math.min(2, devicePixelRatio || 1);
      let W = 0, H = 0, CX = 0, CY = 0, R = 0;
      function resizeCanvas(){
        const r = canvas.getBoundingClientRect();
        W = Math.max(1, Math.floor(r.width));
        H = Math.max(1, Math.floor(r.height));
        CX = W/2; CY = H/2; R = Math.min(W,H)/2;
        canvas.width = Math.floor(W * DPR);
        canvas.height = Math.floor(H * DPR);
        ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      }
      resizeCanvas();

      // Orbital system
      let glow = true;
      let trails = true;
      let speedMode = 1; // 0 slow, 1 normal, 2 fast
      const speedScales = [0.5, 1, 1.8];
      const pointer = { x: 0, y: 0, active: false };

      let system = null;
      function mixCols(t){
        const styles = getComputedStyle(root);
        const a = styles.getPropertyValue('--a').trim();
        const b = styles.getPropertyValue('--b').trim();
        const c = styles.getPropertyValue('--c').trim();
        const seg = (t%1)*3;
        const mix = (x,y,u)=>`color-mix(in oklab, ${x} ${(1-u)*100}%, ${y} ${u*100}%)`;
        if(seg<1) return mix(a,b,seg);
        if(seg<2) return mix(b,c,seg-1);
        return mix(c,a,seg-2);
      }
      function createSystem(){
        const ringCount = 6 + Math.floor(Math.random()*7); // 6-12
        const rings = [];
        const particles = [];
        for(let i=0;i<ringCount;i++){
          const rad = R * (0.18 + (i+1)/(ringCount+2) * 0.72);
          const w = (Math.random()*0.8 + 0.2) * (Math.random()<.5?1:-1);
          const count = 10 + Math.floor(rad / (R*0.06)) + Math.floor(Math.random()*12);
          const hue = Math.random();
          rings.push({r:rad, w, hue, count});
          for(let k=0;k<count;k++){
            particles.push({
              ring:i,
              r: rad + (Math.random()-0.5) * 4,
              a: Math.random()*Math.PI*2,
              s: (Math.random()*0.6 + 0.7) * (Math.random()<.6?1:-1),
              hue: (hue + k/count*0.2) % 1,
              px:0, py:0
            });
          }
        }
        system = { rings, particles };
      }
      createSystem();

      centerBtn.addEventListener('click', ()=>{
        pointer.x = 0; pointer.y = 0;
      });

      invertBtn.addEventListener('click', ()=>{
        // Swap bg/ink for a quick invert effect within theme
        const cs = getComputedStyle(root);
        const bg0 = cs.getPropertyValue('--bg0').trim();
        const bg1 = cs.getPropertyValue('--bg1').trim();
        const ink = cs.getPropertyValue('--ink').trim();
        const muted = cs.getPropertyValue('--muted').trim();
        root.style.setProperty('--bg0', ink);
        root.style.setProperty('--bg1', ink);
        root.style.setProperty('--ink', bg0);
        root.style.setProperty('--muted', bg1);
      });

      trailBtn.addEventListener('click', ()=>{
        trails = !trails;
        trailBtn.setAttribute('aria-pressed', String(trails));
      });

      glowBtn.addEventListener('click', ()=>{
        glow = !glow;
        glowBtn.setAttribute('aria-pressed', String(glow));
      });

      speedBtn.addEventListener('click', ()=>{
        speedMode = (speedMode + 1) % speedScales.length;
        const labels = ['Slow','Normal','Fast'];
        speedBtn.lastChild.nodeValue = labels[speedMode];
      });
      speedBtn.lastChild.nodeValue = 'Normal';

      remixBtn.addEventListener('click', ()=>{
        createSystem();
      });

      let paused = false;
      function setPaused(v){
        paused = v;
        root.classList.toggle('paused', paused);
        pauseBtn.setAttribute('aria-pressed', String(paused));
        pauseBtn.lastChild.nodeValue = paused ? 'Play' : 'Pause';
      }
      pauseBtn.addEventListener('click', ()=> setPaused(!paused));

      // Drawing
      let lastRAF = performance.now();
      let lastMove = performance.now();

      function loop(now){
        const dt = Math.min(2.5, (now - lastRAF) * 0.001 * 60) * speedScales[speedMode];
        lastRAF = now;

        // fade canvas for trails
        if(trails){
          ctx.globalCompositeOperation = 'source-over';
          ctx.fillStyle = 'rgba(0,0,0,' + (getComputedStyle(root).getPropertyValue('--bg0').trim().startsWith('#') ? '0.08' : '0.08') + ')';
          // Blend a subtle fade depending on theme; dark themes benefit from darker fades
          ctx.fillStyle = 'rgba(0,0,0,0.10)';
          ctx.fillRect(0,0,W,H);
        }else{
          ctx.clearRect(0,0,W,H);
        }

        if(!paused){
          // idle pointer orbit
          if(now - lastMove > 3000){
            const t = now*0.0005;
            pointer.x = Math.sin(t)*R*0.08;
            pointer.y = Math.cos(t*1.2)*R*0.08;
          }

          // draw particles
          const { rings, particles } = system;
          const g = glow ? 14 : 0;
          for(const p of particles){
            const ring = rings[p.ring];
            p.px = CX + Math.cos(p.a) * p.r;
            p.py = CY + Math.sin(p.a) * p.r;

            // perturbation by pointer gravity
            if(pointer.active){
              const dx = CX + pointer.x - p.px;
              const dy = CY + pointer.y - p.py;
              const d = Math.hypot(dx, dy);
              const pull = Math.max(0, 1 - d/(R*0.55)) * 0.02;
              p.a += (dx* -Math.sin(p.a) + dy* Math.cos(p.a)) * 0.00002 * pull * dt;
              p.r += (dx*Math.cos(p.a) + dy*Math.sin(p.a)) * 0.00003 * pull * dt;
            }

            // advance angle
            p.a += (ring.w * 0.006 + p.s * 0.002) * dt;

            // keep radius near ring radius
            p.r += (ring.r - p.r) * 0.02 * dt;

            // new position
            const nx = CX + Math.cos(p.a) * p.r;
            const ny = CY + Math.sin(p.a) * p.r;

            // draw segment
            ctx.globalCompositeOperation = 'lighter';
            ctx.strokeStyle = mixCols(p.hue + now*0.00006);
            ctx.globalAlpha = 0.9;
            ctx.lineWidth = 1.0;
            ctx.shadowColor = ctx.strokeStyle;
            ctx.shadowBlur = g;
            ctx.beginPath();
            ctx.moveTo(p.px, p.py);
            // little curve towards center for calligraphic feel
            const mx = (p.px + nx)/2 + (CX - nx)*0.06;
            const my = (p.py + ny)/2 + (CY - ny)*0.06;
            ctx.quadraticCurveTo(mx, my, nx, ny);
            ctx.stroke();
          }
          ctx.shadowBlur = 0;
          ctx.globalAlpha = 1;
        }

        requestAnimationFrame(loop);
      }
      requestAnimationFrame(loop);

      // keyboard
      root.addEventListener('keydown', (e)=>{
        const k = e.key.toLowerCase();
        if(k==='p'){ palBtn.click(); }
        if(k==='r'){ remixBtn.click(); }
        if(k===' '){ e.preventDefault(); pauseBtn.click(); }
        if(k==='s'){ speedBtn.click(); }
        if(k==='g'){ glowBtn.click(); }
        if(k==='t'){ trailBtn.click(); }
        if(k==='i'){ invertBtn.click(); }
      });
      root.tabIndex = 0;

      // sync canvas size if halo changes
      const ro = new ResizeObserver(()=> resizeCanvas());
      ro.observe(halo);
    }());
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


