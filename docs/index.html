<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<style>
  .aurora-816 {
    --ink: hsl(223 28% 12%);
    --muted: hsl(223 14% 42%);
    --edge: hsl(223 20% 85% / .5);
    --glass: hsl(0 0% 100% / .65);
    --mist-a: hsl(196 100% 92% / .7);
    --mist-b: hsl(284 100% 95% / .6);
    --ax: 0deg;
    --ay: 0deg;
    --glow: 210;
    position: relative;
    border-radius: 32px;
    padding: clamp(18px, 5vw, 56px);
    color: var(--ink);
    overflow: hidden;
    isolation: isolate;
    background:
      radial-gradient(1200px 900px at -10% -10%, var(--mist-a), transparent 60%),
      radial-gradient(1000px 800px at 110% 120%, var(--mist-b), transparent 62%),
      linear-gradient(180deg, hsl(210 70% 98%), hsl(210 65% 97%));
    box-shadow: 0 30px 90px hsl(220 50% 20% / .14), inset 0 0 0 1px var(--edge);
  }
  .aurora-816[data-theme="night"] {
    --ink: hsl(0 0% 98%);
    --muted: hsl(210 18% 82%);
    --edge: hsl(0 0% 100% / .12);
    --glass: hsl(0 0% 100% / .12);
    --mist-a: hsl(230 70% 20% / .7);
    --mist-b: hsl(260 70% 18% / .65);
    background:
      radial-gradient(1200px 900px at -10% -10%, var(--mist-a), transparent 60%),
      radial-gradient(1000px 800px at 110% 120%, var(--mist-b), transparent 62%),
      linear-gradient(180deg, hsl(232 48% 9%), hsl(232 50% 8%));
    box-shadow: 0 30px 110px hsl(220 70% 8% / .6), inset 0 0 0 1px var(--edge);
  }
  .aurora-816::after {
    content: "";
    position: absolute; inset: -25%;
    background:
      radial-gradient(60% 60% at 25% 10%, hsl(0 0% 100% / .18), transparent 55%),
      conic-gradient(from 180deg at 50% 50%, hsl(0 0% 100% / .06), transparent 25%, hsl(0 0% 100% / .04) 50%, transparent 75%, hsl(0 0% 100% / .06));
    mix-blend-mode: soft-light;
    opacity: .35;
    pointer-events: none;
    z-index: 0;
    filter: blur(6px);
  }

  .aurora-816 .bar {
    position: relative; z-index: 3;
    display: grid; grid-template-columns: 1fr auto; gap: clamp(12px, 3vw, 28px);
    align-items: start;
    margin-bottom: clamp(16px, 3.6vw, 40px);
  }
  .aurora-816 .brand { display: grid; gap: 8px; }
  .aurora-816 .brand h1 {
    margin: 0;
    font: 900 clamp(30px, 7vw, 92px)/.92 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    letter-spacing: -0.02em;
    background:
      linear-gradient(90deg, var(--ink), var(--ink)) padding-box,
      conic-gradient(from 0deg, hsl(var(--glow) 90% 55%), hsl(calc(var(--glow) + 60) 90% 58%), hsl(calc(var(--glow) + 120) 90% 60%), hsl(calc(var(--glow) + 200) 90% 62%), hsl(var(--glow) 90% 55%)) text;
    -webkit-background-clip: padding-box, text; background-clip: padding-box, text;
    color: transparent; -webkit-text-fill-color: transparent;
  }
  .aurora-816 .brand p {
    margin: 0;
    font: 600 clamp(12px, 1.5vw, 16px)/1.55 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    color: var(--muted);
  }

  .aurora-816 .controls {
    display: grid; grid-auto-flow: column; gap: 10px; align-items: center;
  }
  .aurora-816 .chip {
    appearance: none; border: 0; cursor: pointer;
    font: 800 12px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    padding: 11px 14px; border-radius: 999px; color: var(--ink);
    background: linear-gradient(180deg, var(--glass), hsl(0 0% 100% / .55));
    border: 1px solid var(--edge);
    box-shadow: 0 12px 24px hsl(220 30% 20% / .12), inset 0 1px 0 hsl(0 0% 100% / .6);
    transform: translateZ(0);
    transition: transform 160ms ease, box-shadow 160ms ease, background 160ms ease;
    position: relative; overflow: hidden;
  }
  .aurora-816[data-theme="night"] .chip {
    background: linear-gradient(180deg, hsl(0 0% 100% / .1), hsl(0 0% 100% / .08));
    color: hsl(0 0% 98%);
    box-shadow: 0 12px 24px hsl(220 30% 6% / .45), inset 0 1px 0 hsl(0 0% 100% / .15);
  }
  .aurora-816 .chip:hover { transform: translateY(-2px); box-shadow: 0 18px 34px hsl(220 30% 20% / .18); }
  .aurora-816 .chip .ink {
    position: absolute; inset: 0; border-radius: inherit; pointer-events: none;
    background: radial-gradient(160px 160px at var(--mx,50%) var(--my,50%), hsl(0 0% 100% / .35), transparent 66%);
    opacity: 0; transition: opacity 160ms ease;
  }
  .aurora-816 .chip:hover .ink { opacity: 1; }

  .aurora-816 .knob {
    display: inline-grid; grid-auto-flow: column; align-items: center; gap: 10px;
    padding: 8px 12px; border-radius: 999px;
    background: linear-gradient(180deg, var(--glass), hsl(0 0% 100% / .54));
    border: 1px solid var(--edge);
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .6);
    color: var(--ink);
    font: 600 12px ui-sans-serif, system-ui;
  }
  .aurora-816 input[type="range"] {
    -webkit-appearance: none; appearance: none; width: 150px; height: 28px; background: transparent;
  }
  .aurora-816 input[type="range"]::-webkit-slider-runnable-track {
    height: 8px; border-radius: 999px;
    background: linear-gradient(90deg, hsl(calc(var(--glow) - 10) 90% 55%), hsl(calc(var(--glow) + 70) 90% 58%));
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .5);
  }
  .aurora-816 input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none; appearance: none; width: 18px; height: 18px; margin-top: -5px; border-radius: 50%;
    background: white; border: 1px solid var(--edge);
    box-shadow: 0 4px 10px hsl(220 30% 20% / .2);
  }
  .aurora-816 input[type="range"]::-moz-range-track {
    height: 8px; border-radius: 999px;
    background: linear-gradient(90deg, hsl(calc(var(--glow) - 10) 90% 55%), hsl(calc(var(--glow) + 70) 90% 58%));
  }
  .aurora-816 input[type="range"]::-moz-range-thumb {
    width: 18px; height: 18px; border-radius: 50%; background: white; border: 1px solid var(--edge);
  }

  .aurora-816 .stage-wrap { position: relative; z-index: 1; perspective: 1600px; }
  .aurora-816 .stage {
    position: relative; border-radius: 26px; overflow: hidden;
    min-height: clamp(300px, 50vw, 600px);
    border: 1px solid var(--edge);
    background: linear-gradient(180deg, hsl(0 0% 100% / .72), hsl(0 0% 100% / .5));
    box-shadow: 0 40px 90px hsl(220 40% 20% / .14), inset 0 1px 0 hsl(0 0% 100% / .65);
    transform-style: preserve-3d;
    transform: rotateX(var(--ax)) rotateY(var(--ay));
  }
  .aurora-816[data-theme="night"] .stage {
    background: linear-gradient(180deg, hsl(0 0% 100% / .08), hsl(0 0% 100% / .06));
    box-shadow: 0 40px 110px hsl(220 40% 8% / .5), inset 0 1px 0 hsl(0 0% 100% / .12);
  }
  .aurora-816 .field { position: absolute; inset: -1px; display: block; width: 100%; height: 100%; }
  .aurora-816 .sheen {
    position: absolute; inset: -10%;
    background:
      radial-gradient(80% 80% at 20% 10%, hsl(calc(var(--glow) + 20) 100% 70% / .3), transparent 60%),
      radial-gradient(90% 90% at 80% 90%, hsl(calc(var(--glow) + 120) 100% 70% / .25), transparent 60%),
      radial-gradient(120% 120% at 50% 50%, hsl(calc(var(--glow) + 200) 100% 70% / .14), transparent 68%);
    mix-blend-mode: soft-light; filter: blur(40px);
    pointer-events: none; z-index: 0;
  }

  .aurora-816 .caption {
    position: relative; z-index: 2; display: grid; place-items: center; text-align: center;
    padding: clamp(18px, 4vw, 28px);
  }
  .aurora-816 .caption .big {
    font: 900 clamp(24px, 5.6vw, 64px)/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    letter-spacing: -0.02em; margin: 0 0 8px 0;
    background: linear-gradient(90deg, var(--ink), var(--ink)) text; -webkit-background-clip: text; background-clip: text;
    color: transparent; -webkit-text-fill-color: transparent;
  }
  .aurora-816 .caption .sub {
    font: 500 clamp(13px, 1.6vw, 18px)/1.6 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    color: var(--muted); transition: opacity 300ms ease, transform 300ms ease;
  }
  .aurora-816 .caption .sub.fade { opacity: 0; transform: translateY(6px); }

  .aurora-816 .foot {
    position: relative; z-index: 2;
    margin-top: clamp(16px, 3.2vw, 26px);
    display: flex; justify-content: space-between; align-items: center; gap: 12px;
    color: var(--muted);
    font: 500 12px/1.4 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  }
  .aurora-816 .hint {
    font: 700 11px/1 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    background: hsl(0 0% 100% / .55);
    border: 1px solid var(--edge);
    padding: 6px 8px; border-radius: 8px; color: var(--ink);
  }
  .aurora-816[data-theme="night"] .hint { background: hsl(0 0% 100% / .12); color: hsl(0 0% 98%); }

  .aurora-816[data-zen="true"] .controls, .aurora-816[data-zen="true"] .hint { opacity: 0; pointer-events: none; filter: blur(2px); }
</style>

<div class="aurora-816" id="aur816" role="region" aria-label="Aurora 816" data-theme="dawn" data-zen="false" data-paused="false">
  <div class="bar">
    <div class="brand">
      <h1>AURORA · 816</h1>
      <p>Living gradient studio. Paint with motion.</p>
    </div>
    <div class="controls" role="group" aria-label="Controls">
      <button class="chip" id="theme816" type="button" aria-pressed="false"><span class="ink" aria-hidden="true"></span>Night / Dawn</button>
      <button class="chip" id="pal816" type="button"><span class="ink" aria-hidden="true"></span>Palette</button>
      <span class="knob" aria-label="Flux">
        <span>Flux</span>
        <input id="flux816" type="range" min="10" max="220" value="120" aria-label="Flux slider">
      </span>
      <span class="knob" aria-label="Ribbons">
        <span>Ribbons</span>
        <input id="rib816" type="range" min="200" max="2400" value="1100" aria-label="Ribbons slider">
      </span>
      <button class="chip" id="pause816" type="button" aria-pressed="false"><span class="ink" aria-hidden="true"></span>Pause</button>
      <button class="chip" id="zen816" type="button" aria-pressed="false"><span class="ink" aria-hidden="true"></span>Zen</button>
    </div>
  </div>

  <div class="stage-wrap">
    <div class="stage" id="stage816" tabindex="0" aria-live="polite">
      <canvas class="field" id="aurCanvas816" aria-hidden="true"></canvas>
      <div class="sheen" aria-hidden="true"></div>
      <div class="caption">
        <p class="big" id="lineA816">Paint the air.</p>
        <p class="sub" id="lineB816">Move to guide the light. Double‑click to refresh the flow.</p>
      </div>
    </div>
  </div>

  <div class="foot">
    <span class="hint" aria-hidden="true">Tip: higher flux = longer trails · ZEN hides controls (toggle again to restore)</span>
    <span id="last-updated">Last updated: 2025-11-22 20:40:58 EST</span>
  </div>
</div>

<script>
(function () {
  const root = document.getElementById('aur816');
  const stage = document.getElementById('stage816');
  const canvas = document.getElementById('aurCanvas816');
  const ctx = canvas.getContext('2d');

  const themeBtn = document.getElementById('theme816');
  const palBtn = document.getElementById('pal816');
  const flux = document.getElementById('flux816');
  const rib = document.getElementById('rib816');
  const pauseBtn = document.getElementById('pause816');
  const zenBtn = document.getElementById('zen816');

  const lineA = document.getElementById('lineA816');
  const lineB = document.getElementById('lineB816');
  const last = document.getElementById('last-updated');

  // Timestamp
  try {
    const now = new Date();
    const opts = { year: 'numeric', month: 'short', day: '2-digit', hour: '2-digit', minute: '2-digit' };
    last.textContent = 'Last updated: ' + now.toLocaleString(undefined, opts);
  } catch { last.textContent = 'Last updated: just now'; }

  // Ink hover
  function inkPos(e) {
    const b = e.currentTarget.getBoundingClientRect();
    e.currentTarget.style.setProperty('--mx', ((e.clientX - b.left) / b.width) * 100 + '%');
    e.currentTarget.style.setProperty('--my', ((e.clientY - b.top) / b.height) * 100 + '%');
  }
  [themeBtn, palBtn, pauseBtn, zenBtn].forEach(btn => btn.addEventListener('pointermove', inkPos, { passive: true }));

  // Theme toggle
  themeBtn.addEventListener('click', () => {
    const night = root.getAttribute('data-theme') === 'night';
    root.setAttribute('data-theme', night ? 'dawn' : 'night');
    themeBtn.setAttribute('aria-pressed', String(!night));
  });

  // Zen toggle
  zenBtn.addEventListener('click', () => {
    const zen = root.getAttribute('data-zen') === 'true';
    root.setAttribute('data-zen', zen ? 'false' : 'true');
    zenBtn.setAttribute('aria-pressed', String(!zen));
  });

  // Pause toggle
  pauseBtn.addEventListener('click', () => {
    const paused = root.getAttribute('data-paused') === 'true';
    root.setAttribute('data-paused', paused ? 'false' : 'true');
    pauseBtn.textContent = paused ? 'Pause' : 'Resume';
    pauseBtn.appendChild(document.createElement('span')).className = 'ink';
    if (!paused) drawStatic();
  });

  // Tilt + mouse
  const mouse = { x: 0, y: 0, active: false };
  function tilt(e) {
    const r = stage.getBoundingClientRect();
    const px = (e.clientX - r.left) / r.width - 0.5;
    const py = (e.clientY - r.top) / r.height - 0.5;
    const max = 8;
    root.style.setProperty('--ay', (px * max).toFixed(2) + 'deg');
    root.style.setProperty('--ax', (-py * max).toFixed(2) + 'deg');
    mouse.x = (e.clientX - r.left) * dpr;
    mouse.y = (e.clientY - r.top) * dpr;
    mouse.active = true;
  }
  stage.addEventListener('pointermove', tilt, { passive: true });
  stage.addEventListener('mouseleave', () => {
    root.style.setProperty('--ay', '0deg');
    root.style.setProperty('--ax', '0deg');
    mouse.active = false;
  });

  stage.addEventListener('dblclick', () => refresh(true));

  // Canvas sizing
  let w = 0, h = 0, dpr = Math.max(1, window.devicePixelRatio || 1);
  function fit() {
    const b = stage.getBoundingClientRect();
    w = Math.max(1, Math.floor(b.width));
    h = Math.max(1, Math.floor(b.height));
    canvas.width = Math.floor(w * dpr);
    canvas.height = Math.floor(h * dpr);
    canvas.style.width = w + 'px';
    canvas.style.height = h + 'px';
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }

  // Palettes (HSL hue sets)
  const palettes = [
    { name: 'Glacier', hues: [190, 210, 230, 260] },
    { name: 'Solar', hues: [22, 40, 55, 12] },
    { name: 'Fuchsia Drift', hues: [290, 315, 335, 260] },
    { name: 'Lagoon', hues: [150, 175, 200, 220] },
    { name: 'Candy Nebula', hues: [330, 10, 60, 200] }
  ];
  let palIndex = 0;
  function setGlowFromPalette() {
    const base = palettes[palIndex].hues[0] || 210;
    root.style.setProperty('--glow', base);
  }

  palBtn.addEventListener('click', () => {
    palIndex = (palIndex + 1) % palettes.length;
    setGlowFromPalette();
    refresh(false);
    cycleLines();
  });

  // Particles
  let particles = [];
  let particleCount = parseInt(rib.value, 10);
  let time = 0;
  let raf = null;

  function rand(a, b) { return a + Math.random() * (b - a); }

  function createParticles(count) {
    particles = new Array(count).fill(0).map((_, i) => {
      const t = i / Math.max(1, count - 1);
      const hues = palettes[palIndex].hues;
      const hue = mixHues(hues, t);
      return {
        x: Math.random() * w,
        y: Math.random() * h,
        px: null, py: null,
        hue,
        speed: rand(0.3, 1.2),
        life: rand(60, 600),
        thick: Math.max(0.5, 0.8 + t * 1.5)
      };
    });
  }

  function mixHues(hues, t) {
    // interpolate across provided hues
    const seg = (hues.length - 1) * t;
    const i = Math.min(hues.length - 2, Math.floor(seg));
    const f = seg - i;
    const a = hues[i], b = hues[i + 1];
    // shortest hue interpolation
    let d = ((b - a + 540) % 360) - 180;
    return (a + d * f + 360) % 360;
  }

  // Flow field
  function fieldAngle(x, y, t) {
    const s = 0.0016; // spatial scale
    const a = Math.sin((x + t * 120) * s) * 2.2;
    const b = Math.cos((y - t * 90) * s) * 2.4;
    const c = Math.sin((x + y) * s * 0.5 - t * 0.8) * 1.6;
    let ang = a + b + c;

    if (mouse.active) {
      const dx = x - mouse.x, dy = y - mouse.y;
      const dist = Math.hypot(dx, dy) + 0.0001;
      const swirl = Math.min(2.6, 180 / dist);
      ang += Math.atan2(dy, dx) + swirl * 0.2;
    }
    return ang;
  }

  // Drawing
  function frame(ts) {
    if (root.getAttribute('data-paused') === 'true') return;
    const night = root.getAttribute('data-theme') === 'night';

    time += (parseInt(flux.value, 10) / 120) * 0.016;

    // Fade the canvas for trails
    ctx.globalCompositeOperation = 'source-over';
    ctx.fillStyle = night ? 'rgba(6,8,13,0.18)' : 'rgba(255,255,255,0.24)';
    ctx.fillRect(0, 0, w, h);

    ctx.globalCompositeOperation = 'lighter';

    const baseAlpha = night ? 0.08 : 0.06;
    for (let i = 0; i < particles.length; i++) {
      const p = particles[i];
      if (p.px === null) { p.px = p.x; p.py = p.y; }

      const ang = fieldAngle(p.x * dpr, p.y * dpr, time);
      const spd = p.speed * (parseInt(flux.value, 10) / 100);
      p.x += Math.cos(ang) * spd;
      p.y += Math.sin(ang) * spd;

      // Wrap
      if (p.x < -10 || p.x > w + 10 || p.y < -10 || p.y > h + 10 || --p.life <= 0) {
        p.x = Math.random() * w; p.y = Math.random() * h;
        p.px = p.x; p.py = p.y;
        p.life = rand(60, 600);
      }

      // Stroke
      ctx.strokeStyle = `hsla(${p.hue}, 90%, ${night ? 70 : 50}%, ${baseAlpha})`;
      ctx.lineWidth = Math.max(0.4, p.thick * (night ? 1.2 : 1));
      ctx.beginPath();
      ctx.moveTo(p.px, p.py);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();

      // Glow dot
      if ((i % 37) === 0) {
        const gr = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, 18);
        gr.addColorStop(0, `hsla(${p.hue}, 100%, ${night ? 80 : 60}%, ${baseAlpha * 1.6})`);
        gr.addColorStop(1, `hsla(${p.hue}, 100%, 60%, 0)`);
        ctx.fillStyle = gr;
        ctx.beginPath(); ctx.arc(p.x, p.y, 12, 0, Math.PI * 2); ctx.fill();
      }

      p.px = p.x; p.py = p.y;
    }

    raf = requestAnimationFrame(frame);
  }

  function drawStatic() {
    const night = root.getAttribute('data-theme') === 'night';
    ctx.globalCompositeOperation = 'source-over';
    ctx.fillStyle = night ? 'rgba(6,8,13,0.42)' : 'rgba(255,255,255,0.42)';
    ctx.fillRect(0, 0, w, h);
    ctx.globalCompositeOperation = 'lighter';
    // render a few quick passes for a pleasant still
    for (let k = 0; k < 40; k++) {
      for (let i = 0; i < particles.length; i++) {
        const p = particles[i];
        const ang = fieldAngle(p.x * dpr, p.y * dpr, time + k * 0.01);
        const spd = p.speed * 0.6;
        const ox = p.x, oy = p.y;
        p.x += Math.cos(ang) * spd;
        p.y += Math.sin(ang) * spd;
        ctx.strokeStyle = `hsla(${p.hue}, 90%, ${night ? 70 : 50}%, ${night ? 0.06 : 0.05})`;
        ctx.lineWidth = Math.max(0.4, p.thick * 0.9);
        ctx.beginPath(); ctx.moveTo(ox, oy); ctx.lineTo(p.x, p.y); ctx.stroke();
      }
    }
  }

  function start() {
    stop();
    raf = requestAnimationFrame(frame);
  }
  function stop() {
    if (raf) cancelAnimationFrame(raf);
    raf = null;
  }

  function refresh(jolt) {
    // re-tone hues a little
    if (jolt) {
      palettes[palIndex].hues = palettes[palIndex].hues.map(h => (h + 30 + Math.random() * 90) % 360);
      setGlowFromPalette();
    }
    createParticles(particleCount);
  }

  // Ribbons slider
  rib.addEventListener('input', () => {
    particleCount = Math.max(50, parseInt(rib.value, 10) || 800);
    createParticles(particleCount);
  });

  // Accessibility: reduced motion
  const media = window.matchMedia('(prefers-reduced-motion: reduce)');
  function setReducedMotion(state) {
    root.setAttribute('data-paused', state ? 'true' : 'false');
    pauseBtn.textContent = state ? 'Resume' : 'Pause';
    if (state) { drawStatic(); stop(); } else { start(); }
  }
  setReducedMotion(media.matches);
  media.addEventListener?.('change', (e) => setReducedMotion(e.matches));

  // Lines cycle
  const lines = [
    ['Paint the air.', 'Let gradients move you.'],
    ['Hold the moment.', 'Motion is color over time.'],
    ['Make quiet storms.', 'Small inputs, vast ripples.'],
    ['Aurora, handheld.', 'Everything returns, slightly changed.']
  ];
  let idx = 0;
  function cycleLines() {
    idx = (idx + 1) % lines.length;
    lineB.classList.add('fade');
    setTimeout(() => {
      lineA.textContent = lines[idx][0];
      lineB.textContent = lines[idx][1];
      lineB.classList.remove('fade');
    }, 260);
  }
  let cycleTimer = setInterval(cycleLines, 4800);

  // Boot
  function boot() {
    fit();
    setGlowFromPalette();
    particleCount = parseInt(rib.value, 10);
    createParticles(particleCount);
    if (root.getAttribute('data-paused') === 'true') {
      drawStatic();
    } else {
      start();
    }
  }
  window.addEventListener('resize', () => {
    fit();
    createParticles(particleCount);
    if (root.getAttribute('data-paused') === 'true') drawStatic();
  });

  boot();

  // Clean up
  window.addEventListener('beforeunload', () => {
    clearInterval(cycleTimer);
    stop();
  });
})();
</script>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


