<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="loom2262" data-theme="dark" aria-label="Chroma Flow â€” Edition 2262">
  <style>
    /* Design tokens */
    #loom2262{
      --r: 28px;
      --pad: clamp(18px, 5vw, 56px);
      --ink: #eaf2ff;
      --muted: color-mix(in hsl, var(--ink) 60%, transparent);
      --bg-1: #0b0f17;
      --bg-2: #0e1421;
      --edge: rgba(255,255,255,0.14);
      --glass: 18,20,30;
      --a1: 210 88% 62%;
      --a2: 272 86% 64%;
      --a3: 328 86% 66%;
      --shadow: 0 40px 120px rgba(0,0,0,.24);
      position: relative; isolation: isolate;
      border-radius: var(--r);
      padding: var(--pad);
      color: var(--ink);
      background:
        radial-gradient(140% 100% at 0% 0%, hsl(var(--a1) / .18), transparent 50%),
        radial-gradient(140% 100% at 100% 100%, hsl(var(--a3) / .20), transparent 55%),
        linear-gradient(180deg, var(--bg-1), var(--bg-2));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06), var(--shadow);
      font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial, system-ui;
      color-scheme: dark;
      overflow: clip;
    }
    #loom2262[data-theme="light"]{
      --ink: #0f1424;
      --muted: color-mix(in hsl, var(--ink) 58%, transparent);
      --bg-1: #f7fafc;
      --bg-2: #eef5ff;
      --edge: rgba(0,0,0,0.12);
      color-scheme: light;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.85), var(--shadow);
      background:
        radial-gradient(140% 100% at 0% 0%, hsl(var(--a1) / .14), transparent 50%),
        radial-gradient(140% 100% at 100% 100%, hsl(var(--a3) / .18), transparent 55%),
        linear-gradient(180deg, var(--bg-1), var(--bg-2));
    }

    /* Ambient aurora sweep */
    #loom2262::before{
      content:""; position:absolute; inset:-20%;
      background:
        conic-gradient(from 0deg at 25% 30%, hsl(var(--a1) / .28), transparent 35% 55%, hsl(var(--a2) / .22), transparent 75%),
        conic-gradient(from 180deg at 75% 70%, hsl(var(--a3) / .22), transparent 40% 70%, hsl(var(--a1) / .20));
      filter: blur(50px) saturate(120%);
      mix-blend-mode: overlay; pointer-events:none;
      animation: sweep2262 80s linear infinite;
      opacity:.42;
    }
    @keyframes sweep2262 { to{ transform: rotate(360deg); } }

    /* Header */
    #loom2262 .top{
      display:flex; align-items:center; justify-content:space-between; gap:16px;
      margin-bottom: clamp(12px, 3vw, 24px); position:relative; z-index:2;
    }
    #loom2262 .crest{
      display:flex; align-items:center; gap:14px;
      padding:12px 16px; border-radius:999px; font-weight:900; letter-spacing:.01em;
      background: rgba(var(--glass), .55);
      backdrop-filter: blur(10px) saturate(160%);
      box-shadow: inset 0 0 0 1px var(--edge), 0 14px 36px rgba(0,0,0,.22);
    }
    #loom2262 .mark{
      width:28px; height:28px; border-radius:50%; position:relative; overflow:hidden; display:grid; place-items:center;
      background: radial-gradient(18px 18px at 30% 30%, hsl(var(--a1)), transparent 60%);
      box-shadow: 0 0 0 10px color-mix(in hsl, hsl(var(--a2) / 26%), transparent);
      isolation:isolate;
    }
    #loom2262 .mark::after{
      content:""; width:70%; height:70%; border-radius:50%;
      background: conic-gradient(from 0deg, hsl(var(--a1)), hsl(var(--a2)), hsl(var(--a3)), hsl(var(--a1)));
      filter: blur(2px); mix-blend-mode: screen; animation: orb2262 5s ease-in-out infinite;
    }
    @keyframes orb2262 { 50%{ transform: scale(1.1) rotate(24deg); } }
    #loom2262 .ed{ opacity:.6; font-weight:800; font-size:12px; letter-spacing:.16em; text-transform:uppercase; margin-left:6px; }

    #loom2262 .actions{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    #loom2262 .chip, #loom2262 .btn{
      appearance:none; border:0; cursor:pointer;
      font-weight:850; font-size:14px; letter-spacing:.02em;
      padding:11px 15px; border-radius:14px;
      background: rgba(var(--glass), .55); color: var(--ink);
      box-shadow: inset 0 0 0 1px var(--edge), 0 12px 28px rgba(0,0,0,.18);
      backdrop-filter: blur(10px) saturate(160%);
      transition: transform .14s ease, background .25s ease, box-shadow .25s ease;
    }
    #loom2262 .chip:hover, #loom2262 .btn:hover{ transform: translateY(-1px); background: rgba(var(--glass), .70); }

    /* Hero */
    #loom2262 .hero{ position:relative; z-index:2; display:grid; gap:10px; margin-bottom: clamp(8px, 3.6vw, 20px); }
    #loom2262 h1{
      margin:0; line-height:.9; letter-spacing:-0.02em; font-weight:1000;
      font-size: clamp(50px, 9vw, 120px);
      color: transparent;
      background: linear-gradient(120deg, hsl(var(--a1)), hsl(var(--a2)), hsl(var(--a3)));
      background-size: 220% 220%;
      -webkit-background-clip:text; background-clip:text;
      animation: hue2262 16s ease-in-out infinite;
      filter: drop-shadow(0 8px 24px rgba(0,0,0,.28));
      text-wrap: balance;
    }
    #loom2262 .lede{ margin:0; color: var(--muted); font-size: clamp(14px, 2.1vw, 18px); text-wrap: pretty; }
    @keyframes hue2262 { 50%{ background-position: 100% 0%; } }

    /* Stage */
    #loom2262 .stage{
      --w: min(96vw, 1180px);
      width: var(--w); aspect-ratio: 21/9; margin: clamp(10px, 3vw, 22px) auto;
      border-radius: 36px; position:relative; z-index:2; overflow:hidden;
      display:grid; place-items:center; cursor: crosshair;
      background:
        radial-gradient(100% 80% at 50% 0%, rgba(255,255,255,.06), transparent 70%),
        linear-gradient(180deg, color-mix(in hsl, hsl(var(--a1) / 10%), transparent), transparent 60%);
      box-shadow:
        inset 0 0 0 1px var(--edge),
        inset 0 0 160px rgba(255,255,255,0.08),
        0 40px 120px rgba(0,0,0,.28);
      transform-style: preserve-3d; transition: transform 160ms ease;
    }
    #loom2262 canvas{ width:100%; height:100%; display:block; }
    #loom2262 .rim{
      position:absolute; inset:-1px; border-radius:inherit; pointer-events:none;
      background:
        radial-gradient(100% 100% at 50% 0%, hsl(var(--a1) / .35), transparent 60%),
        radial-gradient(100% 100% at 0% 100%, hsl(var(--a2) / .35), transparent 60%),
        radial-gradient(100% 100% at 100% 100%, hsl(var(--a3) / .35), transparent 60%);
      mask: radial-gradient(90% 80% at 50% 50%, #000 60%, transparent);
      opacity:.45;
    }
    #loom2262 .grain{
      position:absolute; inset:0; pointer-events:none;
      background:
        repeating-linear-gradient(90deg, rgba(255,255,255,.02) 0 1px, transparent 1px 3px),
        repeating-linear-gradient(0deg, rgba(255,255,255,.02) 0 1px, transparent 1px 3px);
      mix-blend-mode: soft-light; opacity:.12;
      animation: grain2262 20s linear infinite;
    }
    @keyframes grain2262 { to{ background-position: 240px 0, 0 240px; } }

    /* Dock controls */
    #loom2262 .dock{
      display:flex; flex-wrap:wrap; align-items:center; justify-content:center;
      gap: 12px 14px; margin: clamp(16px, 3.2vw, 28px) auto 0; position:relative; z-index:2;
    }
    #loom2262 .seg{ display:inline-flex; padding:4px; border-radius:14px; background: rgba(var(--glass), .55);
      box-shadow: inset 0 0 0 1px var(--edge); backdrop-filter: blur(10px) saturate(160%); }
    #loom2262 .sw{
      border:0; background:transparent; color: var(--ink); font-weight:900; font-size:13px; padding:8px 12px; border-radius:12px; cursor:pointer;
      display:inline-flex; align-items:center; gap:8px; transition: background .2s ease, transform .16s ease;
    }
    #loom2262 .sw[aria-pressed="true"]{ background: color-mix(in hsl, hsl(var(--a2) / 18%), transparent); box-shadow: inset 0 0 0 1px var(--edge); }
    #loom2262 .dot{ width:12px; height:12px; border-radius:50%;
      background: conic-gradient(from 0deg, hsl(var(--a1)), hsl(var(--a2)), hsl(var(--a3)), hsl(var(--a1)));
      box-shadow: 0 0 0 3px color-mix(in hsl, hsl(var(--a1) / 30%), transparent);
    }
    #loom2262 .group{
      display:inline-flex; align-items:center; gap:10px;
      padding: 8px 10px; border-radius:14px; font-weight:800; font-size:14px;
      color: var(--muted); background: rgba(var(--glass), .55);
      box-shadow: inset 0 0 0 1px var(--edge); backdrop-filter: blur(10px) saturate(160%);
    }
    #loom2262 input[type="range"]{
      -webkit-appearance:none; appearance:none; width:min(44vw, 300px); height:24px; background:transparent; cursor:pointer;
    }
    #loom2262 input[type="range"]::-webkit-slider-runnable-track,
    #loom2262 input[type="range"]::-moz-range-track{
      height:6px; border-radius:999px;
      background: linear-gradient(90deg, hsl(var(--a1)), hsl(var(--a2)), hsl(var(--a3)));
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.18);
    }
    #loom2262 input[type="range"]::-webkit-slider-thumb,
    #loom2262 input[type="range"]::-moz-range-thumb{
      width:18px; height:18px; border-radius:50%;
      background: #fff; border:2px solid hsl(var(--a2));
      box-shadow: 0 4px 12px rgba(0,0,0,0.22);
      -webkit-appearance:none; appearance:none; margin-top:-6px;
    }

    /* Footer meta */
    #loom2262 .meta{
      display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between; gap:12px;
      margin-top: clamp(18px, 3.6vw, 26px);
      padding-top: 14px; border-top: 1px solid var(--edge);
      color: var(--muted); font-size:12.5px; position:relative; z-index:2;
    }
    #loom2262 .live{ display:inline-flex; align-items:center; gap:8px; }
    #loom2262 .pulse{
      width:9px; height:9px; border-radius:50%;
      background: hsl(var(--a1));
      box-shadow: 0 0 0 0 color-mix(in hsl, hsl(var(--a1) / 55%), transparent);
      animation: pulse2262 2s ease-out infinite;
    }
    @keyframes pulse2262{ 0%{ box-shadow: 0 0 0 0 color-mix(in hsl, hsl(var(--a1) / 55%), transparent);} 100%{ box-shadow: 0 0 0 14px transparent;} }

    /* Motion safety */
    @media (prefers-reduced-motion: reduce){
      #loom2262 *{ animation: none !important; transition: none !important; }
    }
  </style>

  <div class="top">
    <div class="crest">
      <span class="mark" aria-hidden="true"></span>
      Chroma Flow
      <span class="ed">Edition 2262</span>
    </div>
    <div class="actions">
      <button id="theme2262" class="chip" aria-pressed="true" title="Toggle light/dark">Dark</button>
      <button id="shot2262" class="chip" title="Save snapshot">Capture</button>
      <button id="bloom2262" class="chip" aria-pressed="true" title="Glow bloom">Bloom</button>
      <button id="reset2262" class="btn" aria-pressed="false">Reset</button>
    </div>
  </div>

  <div class="hero">
    <h1>Paint with motion</h1>
    <p class="lede">Your cursor bends the current. Threads of color obey the field.</p>
  </div>

  <div class="stage" id="stage2262" aria-label="Chroma flow field">
    <canvas id="sky2262" role="img" aria-label="Silky, glowing ribbons weaving across a field"></canvas>
    <div class="rim" aria-hidden="true"></div>
    <div class="grain" aria-hidden="true"></div>
  </div>

  <div class="dock" aria-label="Controls">
    <div class="seg" role="tablist" aria-label="Palette">
      <button class="sw" id="aster2262" role="tab" aria-pressed="true">
        <span class="dot" aria-hidden="true" style="background: conic-gradient(from 0deg, hsl(210 88% 62%), hsl(272 86% 64%), hsl(328 86% 66%), hsl(210 88% 62%)); box-shadow: 0 0 0 3px color-mix(in hsl, hsl(210 88% 62% / 30%), transparent);"></span>
        Aster
      </button>
      <button class="sw" id="lagoon2262" role="tab" aria-pressed="false">
        <span class="dot" aria-hidden="true" style="background: conic-gradient(from 0deg, hsl(188 88% 56%), hsl(162 78% 58%), hsl(216 82% 64%), hsl(188 88% 56%)); box-shadow: 0 0 0 3px color-mix(in hsl, hsl(188 88% 56% / 30%), transparent);"></span>
        Lagoon
      </button>
      <button class="sw" id="rose2262" role="tab" aria-pressed="false">
        <span class="dot" aria-hidden="true" style="background: conic-gradient(from 0deg, hsl(12 88% 62%), hsl(346 86% 66%), hsl(42 86% 62%), hsl(12 88% 62%)); box-shadow: 0 0 0 3px color-mix(in hsl, hsl(12 88% 62% / 30%), transparent);"></span>
        Rose
      </button>
      <button class="sw" id="graphite2262" role="tab" aria-pressed="false">
        <span class="dot" aria-hidden="true" style="background: conic-gradient(from 0deg, hsl(0 0% 92%), hsl(0 0% 60%), hsl(0 0% 28%), hsl(0 0% 92%)); box-shadow: 0 0 0 3px color-mix(in hsl, hsl(0 0% 70% / 30%), transparent);"></span>
        Graphite
      </button>
    </div>

    <div class="group" aria-label="Flow">
      Flow
      <input id="flow2262" type="range" min="6" max="28" value="14" aria-valuemin="6" aria-valuemax="28" aria-valuenow="14" aria-label="Field complexity">
    </div>
    <div class="group" aria-label="Density">
      Density
      <input id="dens2262" type="range" min="120" max="1200" value="520" aria-valuemin="120" aria-valuemax="1200" aria-valuenow="520" aria-label="Particle count">
    </div>
    <div class="group" aria-label="Fade">
      Fade
      <input id="fade2262" type="range" min="2" max="26" value="8" aria-valuemin="2" aria-valuemax="26" aria-valuenow="8" aria-label="Trail persistence">
    </div>
  </div>

  <div class="meta">
    <div class="live"><span class="pulse" aria-hidden="true"></span> Studio is live</div>
    <span id="last-updated">Last updated: 2026-01-28 23:06:17 EST</span>
  </div>

  <script>
    (function(){
      const root = document.getElementById('loom2262');
      const stage = document.getElementById('stage2262');
      const canvas = document.getElementById('sky2262');
      const ctx = canvas.getContext('2d', { alpha: true });

      const themeBtn = document.getElementById('theme2262');
      const shotBtn = document.getElementById('shot2262');
      const bloomBtn = document.getElementById('bloom2262');
      const resetBtn = document.getElementById('reset2262');

      const palAster = document.getElementById('aster2262');
      const palLagoon = document.getElementById('lagoon2262');
      const palRose = document.getElementById('rose2262');
      const palGraphite = document.getElementById('graphite2262');

      const flowEl = document.getElementById('flow2262');
      const densEl = document.getElementById('dens2262');
      const fadeEl = document.getElementById('fade2262');

      // Last updated
      const updated = document.getElementById('last-updated');
      try{
        const now = new Date();
        const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'local';
        const fmt = { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' };
        updated.textContent = `Updated ${now.toLocaleString(undefined, fmt)} (${tz})`;
      }catch(_){ updated.textContent = 'Updated just now'; }

      // Palettes
      const palettes = {
        aster:   { accents: [[210,88,62],[272,86,64],[328,86,66]], hues:[210,272,328], glow:[210,90,70] },
        lagoon:  { accents: [[188,88,56],[162,78,58],[216,82,64]], hues:[188,162,216], glow:[196,86,66] },
        rose:    { accents: [[12,88,62],[346,86,66],[42,86,62]],   hues:[12,346,42],   glow:[16,88,70] },
        graphite:{ accents: [[0,0,90],[0,0,60],[0,0,28]],          hues:[0,0,0],       glow:[210,6,76] }
      };
      let current = palettes.aster;

      function setAccents(a){
        root.style.setProperty('--a1', `${a[0][0]} ${a[0][1]}% ${a[0][2]}%`);
        root.style.setProperty('--a2', `${a[1][0]} ${a[1][1]}% ${a[1][2]}%`);
        root.style.setProperty('--a3', `${a[2][0]} ${a[2][1]}% ${a[2][2]}%`);
      }
      function applyPalette(p){
        current = p; setAccents(p.accents);
        [palAster,palLagoon,palRose,palGraphite].forEach(b=>b.setAttribute('aria-pressed','false'));
        const map = new Map([[palAster,palettes.aster],[palLagoon,palettes.lagoon],[palRose,palettes.rose],[palGraphite,palettes.graphite]]);
        for(const [btn, pal] of map){ if(p===pal) btn.setAttribute('aria-pressed','true'); }
        seed = Math.random()*10000;
        paletteDirty = true;
      }
      palAster.addEventListener('click', ()=>applyPalette(palettes.aster));
      palLagoon.addEventListener('click', ()=>applyPalette(palettes.lagoon));
      palRose.addEventListener('click', ()=>applyPalette(palettes.rose));
      palGraphite.addEventListener('click', ()=>applyPalette(palettes.graphite));

      // State
      let complexity = parseInt(flowEl.value,10)||14;
      let target = parseInt(densEl.value,10)||520;
      let fade = (parseInt(fadeEl.value,10)||8) / 100; // as alpha
      let bloom = true;

      flowEl.addEventListener('input', e=>{ complexity = Math.max(6, Math.min(28, parseInt(e.target.value,10)||14)); flowEl.setAttribute('aria-valuenow', String(complexity)); });
      densEl.addEventListener('input', e=>{ target = Math.max(120, Math.min(1200, parseInt(e.target.value,10)||520)); densEl.setAttribute('aria-valuenow', String(target)); adjustDensity(); });
      fadeEl.addEventListener('input', e=>{ const v = Math.max(2, Math.min(26, parseInt(e.target.value,10)||8)); fade = v/100; fadeEl.setAttribute('aria-valuenow', String(v)); });

      // Resize & DPR
      let dpr = Math.min(2, window.devicePixelRatio || 1);
      function resize(){
        const r = stage.getBoundingClientRect();
        canvas.width = Math.max(2, Math.floor(r.width * dpr));
        canvas.height = Math.max(2, Math.floor(r.height * dpr));
        canvas.style.width = r.width + 'px';
        canvas.style.height = r.height + 'px';
        ctx.setTransform(1,0,0,1,0,0);
        ctx.scale(dpr, dpr);
        clear(true);
      }
      function clear(hard){
        const r = stage.getBoundingClientRect();
        const isLight = root.getAttribute('data-theme')==='light';
        ctx.globalCompositeOperation = 'source-over';
        ctx.globalAlpha = 1;
        ctx.fillStyle = isLight ? '#f7fafc' : '#0b0f17';
        ctx.fillRect(0,0,r.width,r.height);
        if(!hard){
          // add subtle center glow
          const cg = ctx.createRadialGradient(r.width/2, r.height/2, Math.min(r.width,r.height)*0.08, r.width/2, r.height/2, Math.max(r.width,r.height)*0.7);
          if(isLight){
            cg.addColorStop(0, 'rgba(255,255,255,0.45)');
            cg.addColorStop(1, 'rgba(255,255,255,0)');
          }else{
            cg.addColorStop(0, 'rgba(255,255,255,0.10)');
            cg.addColorStop(1, 'rgba(0,0,0,0)');
          }
          ctx.fillStyle = cg; ctx.fillRect(0,0,r.width,r.height);
        }
      }
      resize();
      addEventListener('resize', ()=>{ dpr = Math.min(2, window.devicePixelRatio || 1); resize(); });

      // Theme
      themeBtn.addEventListener('click', ()=>{
        const next = root.getAttribute('data-theme')==='light' ? 'dark' : 'light';
        root.setAttribute('data-theme', next);
        themeBtn.textContent = next.charAt(0).toUpperCase() + next.slice(1);
        themeBtn.setAttribute('aria-pressed', next==='dark' ? 'true' : 'false');
        clear(true);
      });

      // Tilt and pointer
      let px=.5, py=.5, pointer={x:0,y:0,down:false};
      stage.addEventListener('pointermove', (e)=>{
        const r = stage.getBoundingClientRect();
        px = Math.min(1, Math.max(0, (e.clientX - r.left)/r.width));
        py = Math.min(1, Math.max(0, (e.clientY - r.top)/r.height));
        pointer.x = (e.clientX - r.left); pointer.y = (e.clientY - r.top);
        stage.style.transform = `rotateX(${-(py - 0.5)*6}deg) rotateY(${(px - 0.5)*8}deg)`;
      }, {passive:true});
      stage.addEventListener('pointerleave', ()=>{ stage.style.transform = 'rotateX(0deg) rotateY(0deg)'; pointer.down=false; });
      stage.addEventListener('pointerdown', ()=>{ pointer.down=true; });
      stage.addEventListener('pointerup', ()=>{ pointer.down=false; });

      // Particles
      const TWO = Math.PI*2;
      let seed = Math.random()*10000;
      function rnd(){ const x = Math.sin(seed+=0.12345)*43758.5453; return x-Math.floor(x); }

      const particles = [];
      let paletteDirty = true;

      function colorFor(i){
        const hues = current.hues.length ? current.hues : [0];
        const h = hues[i % hues.length];
        const s = current===palettes.graphite ? 0 : 86;
        const l = 58 + ((i*7)%20);
        return {h,s,l};
      }

      function hatch(n){
        const r = stage.getBoundingClientRect();
        for(let i=0;i<n;i++){
          const x = rnd()*r.width, y = rnd()*r.height;
          const c = colorFor(particles.length);
          particles.push({x,y,px:x,py:y,h:c.h,s:c.s,l:c.l,life: 200 + Math.floor(rnd()*400)});
        }
      }
      function adjustDensity(){
        const r = stage.getBoundingClientRect();
        while(particles.length < target){ hatch(Math.min(200, target - particles.length)); }
        while(particles.length > target){ particles.splice(0, Math.min(200, particles.length - target)); }
        if(paletteDirty){
          for(let i=0;i<particles.length;i++){ const c = colorFor(i); particles[i].h=c.h; particles[i].s=c.s; particles[i].l=c.l; }
          paletteDirty = false;
        }
        clear(true);
      }

      // Initialize
      adjustDensity();

      // Flow field (domain-warped trig for velvet motion)
      function field(x,y,t){
        const r = stage.getBoundingClientRect();
        const f = complexity / 600; // frequency
        const nx = x * f, ny = y * f;
        const warp = Math.sin(nx*1.3 - t*0.6) * Math.cos(ny*1.1 + t*0.7) * 2.2;
        const angle = Math.sin(nx + warp + t*0.35) + Math.cos(ny - warp - t*0.27);
        const dirx = Math.cos(angle), diry = Math.sin(angle);
        // pointer influence (repel or attract)
        let fx = dirx, fy = diry;
        if(pointer.x || pointer.y){
          const dx = x - pointer.x, dy = y - pointer.y;
          const d2 = Math.max(24, dx*dx + dy*dy);
          const force = pointer.down ? -18 : 12; // press to attract
          fx += (dx / d2) * force;
          fy += (dy / d2) * force;
        }
        return {x:fx, y:fy};
      }

      // Animation
      let t0 = performance.now();
      function step(now){
        const r = stage.getBoundingClientRect();
        const w = r.width, h = r.height;
        const dt = Math.min(32, now - t0) * 0.016;
        const t = now*0.001;

        // Fade the canvas slightly each frame for trails
        ctx.globalCompositeOperation = 'source-over';
        ctx.globalAlpha = fade;
        const isLight = root.getAttribute('data-theme')==='light';
        ctx.fillStyle = isLight ? 'rgba(247,250,252,0.08)' : 'rgba(11,15,23,0.08)';
        ctx.fillRect(0,0,w,h);

        ctx.globalCompositeOperation = 'lighter';
        for(let i=0;i<particles.length;i++){
          const p = particles[i];
          const v = field(p.x, p.y, t);
          const speed = 1.2 + (i%7)*0.06;
          p.px = p.x; p.py = p.y;
          p.x += v.x * speed; p.y += v.y * speed;

          // wrap
          if(p.x < -2) p.x = w+2; if(p.x > w+2) p.x = -2;
          if(p.y < -2) p.y = h+2; if(p.y > h+2) p.y = -2;

          // color and stroke
          const l1 = p.l, l2 = Math.min(92, p.l+12);
          const grad = ctx.createLinearGradient(p.px, p.py, p.x, p.y);
          grad.addColorStop(0, `hsla(${p.h}, ${p.s}%, ${l1}%, ${bloom?0.25:0.18})`);
          grad.addColorStop(1, `hsla(${(p.h+28)%360}, ${p.s}%, ${l2}%, ${bloom?0.45:0.30})`);
          ctx.strokeStyle = grad;
          ctx.lineWidth = bloom ? 1.2 : 0.9;
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round';
          ctx.shadowColor = `hsla(${p.h}, 90%, 70%, ${bloom?0.35:0.18})`;
          ctx.shadowBlur = bloom ? 18 : 8;

          ctx.beginPath();
          ctx.moveTo(p.px, p.py);
          ctx.lineTo(p.x, p.y);
          ctx.stroke();

          // life refresh for diversity
          if(--p.life <= 0){
            p.life = 200 + Math.floor(rnd()*400);
            p.x = rnd()*w; p.y = rnd()*h; p.px=p.x; p.py=p.y;
            const c = colorFor(i); p.h=c.h; p.s=c.s; p.l=c.l;
          }
        }

        t0 = now;
        requestAnimationFrame(step);
      }

      // Snapshot
      function snapshotName(){ return `chroma-flow-2262.png`; }
      shotBtn.addEventListener('click', ()=>{
        try{
          const rect = stage.getBoundingClientRect();
          const tmp = document.createElement('canvas');
          const tctx = tmp.getContext('2d');
          const scale = Math.min(2, window.devicePixelRatio || 1);
          tmp.width = Math.floor(rect.width * scale);
          tmp.height = Math.floor(rect.height * scale);
          tctx.scale(scale, scale);

          // background
          const isLight = root.getAttribute('data-theme')==='light';
          tctx.fillStyle = isLight ? '#f7fafc' : '#0b0f17';
          tctx.fillRect(0,0,rect.width,rect.height);
          // draw current frame
          tctx.drawImage(canvas, 0, 0, rect.width, rect.height);
          const a = document.createElement('a');
          a.href = tmp.toDataURL('image/png');
          a.download = snapshotName();
          document.body.appendChild(a); a.click(); a.remove();
        }catch(_){}
      });

      // Bloom
      bloomBtn.addEventListener('click', ()=>{
        bloom = !bloom;
        bloomBtn.setAttribute('aria-pressed', bloom?'true':'false');
        bloomBtn.textContent = bloom ? 'Bloom' : 'Clean';
      });

      // Reset
      resetBtn.addEventListener('click', ()=>{
        particles.length = 0;
        adjustDensity();
        clear(true);
      });

      // Keyboard shortcuts
      window.addEventListener('keydown', (e)=>{
        const k = e.key.toLowerCase();
        if(k==='t') themeBtn.click();
        if(k==='s') shotBtn.click();
        if(k==='b') bloomBtn.click();
        if(k==='r') resetBtn.click();
        if(k==='1') palAster.click();
        if(k==='2') palLagoon.click();
        if(k==='3') palRose.click();
        if(k==='4') palGraphite.click();
      });

      // Start
      setAccents(current.accents);
      requestAnimationFrame(step);

      // Respect reduced motion
      const prefersReduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
      if(prefersReduce){
        for(let i=0;i<80;i++){ step(performance.now()+i*16); }
      }
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


