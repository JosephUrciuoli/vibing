<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="a2451 orrery" aria-label="Orrery of Light">
  <style>
    .a2451{
      --ink:#0e1220;
      --muted:rgba(14,18,32,.72);
      --line:rgba(14,18,32,.14);
      --bg0:#f6f9ff;
      --bg1:#ffffff;
      --a1:#6ee7f0;
      --a2:#6c7dff;
      --a3:#ffa06a;
      --bloom:1.0;
      position:relative;
      padding:clamp(26px,3.6vw,48px);
      border-radius:32px;
      color:var(--ink);
      background:
        radial-gradient(1200px 800px at var(--mx,70%) var(--my,20%), rgba(108,125,255,.12), transparent 60%),
        linear-gradient(150deg, var(--bg0) 0%, var(--bg1) 100%);
      border:1px solid var(--line);
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,.6),
        0 40px 120px rgba(10,14,28,.10);
      overflow:hidden;
      font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      transform: perspective(1100px) rotateX(var(--rx,0deg)) rotateY(var(--ry,0deg));
      transition: transform 600ms cubic-bezier(.2,.8,.2,1), background .7s ease, color .4s ease, box-shadow .6s ease;
      isolation:isolate;
    }
    .a2451.noct{
      --ink:#e7ecfb;
      --muted:rgba(231,236,251,.72);
      --line:rgba(255,255,255,.16);
      --bg0:#0a0f1c;
      --bg1:#101a2e;
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,.06),
        0 50px 140px rgba(2,8,22,.7);
    }
    .a2451 .grain{
      position:absolute; inset:-2% -2% -2% -2%; z-index:0; pointer-events:none; opacity:.15; mix-blend-mode:soft-light;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence baseFrequency='.7' numOctaves='2' type='fractalNoise'/%3E%3CfeComponentTransfer%3E%3CfeFuncA type='table' tableValues='0 0 .25 0'/%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)'/%3E%3C/svg%3E");
      background-size:220px 220px; animation:gn 16s steps(60) infinite;
    }
    @keyframes gn{to{background-position:220px 220px}}

    /* Halo wheels */
    .a2451 .halo{
      position:absolute; top:clamp(-70px,-6vw,-90px); left:clamp(-70px,-6vw,-90px);
      width: clamp(280px, 32vw, 480px); height: clamp(280px, 32vw, 480px); z-index:1; opacity:.55; pointer-events:none;
      filter: drop-shadow(0 24px 60px rgba(108,125,255,.18));
    }
    .a2451.noct .halo{opacity:.5}
    .a2451 .halo .r{transform-origin:50% 50%; animation:spin 45s linear infinite}
    .a2451 .halo .r:nth-child(2){animation-duration:26s}
    .a2451 .halo .r:nth-child(3){animation-duration:16s}
    @keyframes spin{to{transform:rotate(1turn)}}

    .a2451 .wrap{position:relative; z-index:2; display:grid; gap:18px}
    .a2451 .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}

    .a2451 .badge{
      display:inline-flex; align-items:center; gap:10px; font-size:12px; letter-spacing:.16em; text-transform:uppercase;
      padding:9px 14px; border-radius:999px; color:var(--muted);
      border:1px solid var(--line);
      background:
        linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.22)) padding-box,
        linear-gradient(90deg, var(--a1), var(--a2), var(--a3)) border-box;
      backdrop-filter: blur(8px);
    }
    .a2451 .dot{width:8px; height:8px; border-radius:50%; background: radial-gradient(circle, var(--a1) 0 60%, transparent 61%); box-shadow:0 0 12px var(--a1); animation:pulse 2.2s ease-in-out infinite}
    @keyframes pulse{0%,100%{transform:scale(1);opacity:.9}50%{transform:scale(1.35);opacity:1}}

    .a2451 .mode{
      margin-left:auto; display:inline-flex; align-items:center; gap:10px; cursor:pointer; user-select:none;
      padding:10px 14px; border-radius:999px; border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.2));
      color:inherit; box-shadow:0 12px 30px rgba(0,0,0,.12);
      transition: transform .25s ease, background .35s ease, border-color .35s ease, box-shadow .4s ease;
    }
    .a2451 .mode:hover{transform:translateY(-2px)}
    .a2451 .mode .knob{
      width:22px; height:22px; border-radius:50%;
      background:
        radial-gradient(circle at 35% 35%, #fff 0 55%, transparent 56%),
        conic-gradient(from 0deg, rgba(0,0,0,0) 0 30%, rgba(0,0,0,.25) 30% 70%, rgba(0,0,0,0) 70% 100%);
      box-shadow: inset -4px -4px 8px rgba(0,0,0,.12), 0 0 0 1px rgba(255,255,255,.28);
      transition: transform .5s ease;
    }
    .a2451.noct .mode .knob{transform:rotate(200deg)}

    .a2451 .title{
      margin:4px 0 0 0; line-height:1; letter-spacing:-.02em;
      font-weight:900; font-size: clamp(44px, 9vw, 108px);
      background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3));
      background-size: 200% 100%;
      -webkit-background-clip:text; background-clip:text; color:transparent;
      animation: sheen 8s ease-in-out infinite;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,.16));
    }
    @keyframes sheen{50%{background-position:100% 0}}

    .a2451 .sub{margin:0; max-width:72ch; color:var(--muted); font-size:clamp(14px,1.6vw,20px)}

    .a2451 .controls{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .a2451 .chip{
      display:inline-flex; align-items:center; gap:10px; padding:10px 12px; border-radius:14px; font-size:13px;
      border:1px solid var(--line); color:inherit;
      background: linear-gradient(180deg, rgba(255,255,255,.88), rgba(255,255,255,.18));
      box-shadow:0 10px 28px rgba(0,0,0,.10);
      position:relative; overflow:hidden;
    }
    .a2451 .chip::after{
      content:""; position:absolute; inset:-120% -40% auto -40%; height:260%; pointer-events:none; mix-blend-mode:overlay; opacity:.0;
      background: radial-gradient(220px 120px at var(--lx,50%) -20%, rgba(255,255,255,.9), rgba(255,255,255,.22));
      transition: opacity .3s ease;
    }
    .a2451 .chip:hover::after{opacity:1}
    .a2451 input[type="range"]{appearance:none; width:160px; height:6px; border-radius:999px; background:linear-gradient(90deg, var(--a1), var(--a2)); outline:none}
    .a2451 input[type="range"]::-webkit-slider-thumb{appearance:none; width:18px; height:18px; border-radius:50%; background:#fff; border:1px solid var(--line); box-shadow:0 2px 8px rgba(0,0,0,.2)}
    .a2451.noct input[type="range"]::-webkit-slider-thumb{background:#0e1428;border-color:rgba(255,255,255,.22)}
    .a2451 select{appearance:none;background:transparent;border:none;color:inherit;font-weight:700}

    .a2451 .stage{
      position:relative; margin-top:10px; min-height:380px; border-radius:24px; overflow:hidden;
      border:1px solid var(--line);
      background:
        radial-gradient(900px 600px at var(--mx,70%) var(--my,35%), rgba(110,231,240,.12), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.88), rgba(255,255,255,.22));
      box-shadow: 0 18px 68px rgba(0,0,0,.14);
      transition: box-shadow .4s ease, transform .35s ease, background .4s ease, filter .3s ease;
      filter: saturate(1) brightness(1) drop-shadow(0 12px 40px rgba(0,0,0,.06));
    }
    .a2451.noct .stage{
      background:
        radial-gradient(900px 600px at var(--mx,70%) var(--my,35%), rgba(108,125,255,.18), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: 0 18px 68px rgba(0,0,0,.38);
      filter: saturate(1.05) brightness(1.05) drop-shadow(0 22px 50px rgba(0,0,0,.3));
    }
    .a2451 .stage:hover{transform: translateY(-4px)}

    .a2451 canvas.sky{position:absolute; inset:0; width:100%; height:100%; display:block; filter: blur(calc((var(--bloom) - 1) * 3px)) saturate(calc(var(--bloom) * 1.05));}
    .a2451 .glow{
      position:absolute; inset:-35% -35% -35% -35%; pointer-events:none; z-index:2; opacity:.28; mix-blend-mode:soft-light;
      background: conic-gradient(from 100deg at 65% 30%, var(--a1), transparent 22% 40%, var(--a2), transparent 58% 70%, var(--a3), transparent 85% 100%);
      animation:orbitGlow 28s linear infinite;
    }
    @keyframes orbitGlow{to{transform:rotate(1turn)}}

    .a2451 .meta{
      margin-top:16px; display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
      color:var(--muted); border-top:1px solid var(--line); padding-top:12px;
    }
    .a2451 .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      background: rgba(255,255,255,.7); border:1px solid var(--line); padding:2px 6px; border-radius:6px; color:inherit;
    }
    .a2451.noct .kbd{ background: rgba(255,255,255,.12) }

    @media (prefers-reduced-motion: reduce){
      .a2451, .a2451 *{ animation:none !important; transition:none !important; transform:none !important; }
      .a2451 .grain, .a2451 .glow, .a2451 .halo{ display:none !important; }
    }
  </style>

  <div class="grain" aria-hidden="true"></div>

  <svg class="halo" viewBox="0 0 200 200" aria-hidden="true">
    <defs>
      <linearGradient id="hue" x1="0" x2="1" y1="0" y2="0">
        <stop offset="0%" stop-color="var(--a1)" stop-opacity=".9"/>
        <stop offset="60%" stop-color="var(--a2)" stop-opacity=".9"/>
        <stop offset="100%" stop-color="var(--a3)" stop-opacity=".9"/>
      </linearGradient>
    </defs>
    <g fill="none" stroke="url(#hue)">
      <circle class="r" cx="100" cy="100" r="88" stroke-width="1.8" stroke-dasharray="4 8" stroke-linecap="round"/>
      <circle class="r" cx="100" cy="100" r="62" stroke-width="1.2" stroke-dasharray="2 6" stroke-linecap="round"/>
      <circle class="r" cx="100" cy="100" r="38" stroke-width="1.2" stroke-dasharray="1 5" stroke-linecap="round"/>
    </g>
  </svg>

  <div class="wrap">
    <div class="row">
      <span class="badge"><span class="dot" aria-hidden="true"></span> Orrery of Light â€” Build 2451</span>
      <button class="mode" type="button" aria-pressed="false" aria-label="Toggle theme">
        <span class="knob" aria-hidden="true"></span> Mode
      </button>
    </div>

    <h1 class="title" aria-label="Orrery of Light">Orrery<br>of&nbsp;Light</h1>
    <p class="sub">A kinetic study in time and color. Planets glide; comets bloom; light bends to your hand.</p>

    <div class="controls" role="group" aria-label="Controls">
      <span class="chip">
        Gravity <input id="gravity" type="range" min="40" max="160" value="100" aria-label="Gravity">
      </span>
      <span class="chip">
        Bloom <input id="bloom" type="range" min="80" max="180" value="110" aria-label="Bloom">
      </span>
      <span class="chip">
        Palette
        <select id="pal" aria-label="Palette">
          <option value="aurora">Aurora</option>
          <option value="sunset">Sunset</option>
          <option value="mint">Mint</option>
        </select>
      </span>
      <button class="chip" id="pause" type="button" aria-pressed="false" aria-label="Pause or resume">
        Pause
      </button>
    </div>

    <section class="stage" aria-label="Orbital stage">
      <canvas class="sky" aria-hidden="true"></canvas>
      <div class="glow" aria-hidden="true"></div>
    </section>

    <div class="meta">
      <small>Drag pointer to tilt; click to launch a comet; press <span class="kbd">Space</span> to pause; press <span class="kbd">T</span> to toggle mode.</small>
      <small>Refreshed <span id="last-updated">Last updated: 2026-02-07 12:24:15 EST</span></small>
    </div>
  </div>

  <script>
    (function(){
      const root = document.currentScript.closest('.a2451');
      if(!root) return;

      // Timestamp
      const ts = new Date();
      const fmt = new Intl.DateTimeFormat([], {
        year:'numeric', month:'short', day:'2-digit',
        hour:'2-digit', minute:'2-digit', second:'2-digit',
        hour12:false, timeZoneName:'short'
      });
      const lu = root.querySelector('#last-updated');
      if (lu) lu.textContent = fmt.format(ts);

      // Theme toggle
      const mode = root.querySelector('.mode');
      function syncModeBtn(){ mode?.setAttribute('aria-pressed', String(root.classList.contains('noct'))); }
      mode?.addEventListener('click', ()=>{ root.classList.toggle('noct'); syncModeBtn(); });
      window.addEventListener('keydown', e=>{ if(e.key.toLowerCase()==='t'){ root.classList.toggle('noct'); syncModeBtn(); }});
      syncModeBtn();

      // Pointer parallax
      const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      function onMove(e){
        const r = root.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width;
        const y = (e.clientY - r.top) / r.height;
        root.style.setProperty('--mx', (x*100).toFixed(2) + '%');
        root.style.setProperty('--my', (y*100).toFixed(2) + '%');
        if(!prefersReduced){
          const rx = ((0.5 - y) * 10).toFixed(2);
          const ry = ((x - 0.5) * 12).toFixed(2);
          root.style.setProperty('--rx', rx + 'deg');
          root.style.setProperty('--ry', ry + 'deg');
        }
      }
      function onLeave(){
        root.style.setProperty('--mx', '70%');
        root.style.setProperty('--my', '20%');
        root.style.setProperty('--rx', '0deg');
        root.style.setProperty('--ry', '0deg');
      }
      root.addEventListener('pointermove', onMove);
      root.addEventListener('pointerleave', onLeave);

      // Controls
      const gEl = root.querySelector('#gravity');
      const bEl = root.querySelector('#bloom');
      const pEl = root.querySelector('#pal');
      const pauseBtn = root.querySelector('#pause');

      const palettes = {
        aurora: ['#6ee7f0','#6c7dff','#ffa06a'],
        sunset: ['#ff8a8a','#ffd36a','#6cc6ff'],
        mint:   ['#5eead4','#7cdbff','#ffdf8a']
      };
      function setPalette(key){
        const [a,b,c] = palettes[key] || palettes.aurora;
        root.style.setProperty('--a1', a);
        root.style.setProperty('--a2', b);
        root.style.setProperty('--a3', c);
      }
      setPalette(pEl.value);
      pEl.addEventListener('change', e=> setPalette(e.target.value));

      function setBloom(){
        const v = (+bEl.value)/100;
        root.style.setProperty('--bloom', String(v.toFixed(2)));
      }
      setBloom();
      bEl.addEventListener('input', setBloom);

      // Chip shine tracking
      root.querySelectorAll('.chip').forEach(ch=>{
        ch.addEventListener('pointermove', (e)=>{
          const b = ch.getBoundingClientRect();
          const x = ((e.clientX - b.left) / b.width) * 100;
          ch.style.setProperty('--lx', x + '%');
        });
      });

      // Stage setup
      const stage = root.querySelector('.stage');
      const c = root.querySelector('canvas.sky');
      const ctx = c.getContext('2d', { alpha:true, desynchronized:true });
      let dpr = Math.min(2, window.devicePixelRatio || 1);
      function fit(){
        const b = stage.getBoundingClientRect();
        c.width = Math.max(1, Math.floor(b.width * dpr));
        c.height = Math.max(1, Math.floor(b.height * dpr));
        c.style.width = b.width + 'px';
        c.style.height = b.height + 'px';
      }
      fit();

      // State
      const state = {
        paused:false,
        grav: +gEl.value,
        pointer:{inside:false, x:.5, y:.5},
        comets:[]
      };
      gEl.addEventListener('input', ()=> state.grav = +gEl.value);
      pauseBtn.addEventListener('click', ()=>{
        state.paused = !state.paused;
        pauseBtn.textContent = state.paused ? 'Resume' : 'Pause';
        pauseBtn.setAttribute('aria-pressed', String(state.paused));
        if(!state.paused && !prefersReduced) raf = requestAnimationFrame(loop);
      });

      // Pointer on stage
      stage.addEventListener('pointerenter', e=>{
        const r = stage.getBoundingClientRect();
        state.pointer.inside = true;
        state.pointer.x = (e.clientX - r.left) / r.width;
        state.pointer.y = (e.clientY - r.top) / r.height;
      });
      stage.addEventListener('pointermove', e=>{
        const r = stage.getBoundingClientRect();
        state.pointer.x = (e.clientX - r.left) / r.width;
        state.pointer.y = (e.clientY - r.top) / r.height;
      });
      stage.addEventListener('pointerleave', ()=>{ state.pointer.inside = false; });

      // Comets on click
      stage.addEventListener('click', e=>{
        const r = stage.getBoundingClientRect();
        const sx = (e.clientX - r.left) / r.width;
        const sy = (e.clientY - r.top) / r.height;
        state.comets.push({
          x:sx, y:sy,
          vx:(Math.random()-.5)*0.006,
          vy:(Math.random()-.5)*0.006,
          life:1, hue: Math.random()
        });
      });

      // Orrery model
      function planets(w,h){
        const min = Math.min(w,h);
        const cx = w/2, cy = h/2;
        const R = min*0.42;
        return [
          {r:R*0.18, speed: 0.012, size: min*0.010, e:0.08},
          {r:R*0.30, speed: 0.008, size: min*0.014, e:0.12},
          {r:R*0.40, speed: 0.006, size: min*0.018, e:0.06}
        ].map((p,i)=> ({...p, phase: i*1.2 + 0.3}));
      }

      // Draw
      function draw(t){
        if(!ctx) return;
        const w = c.width, h = c.height;
        const W = w, H = h;
        ctx.clearRect(0,0,W,H);

        // Base wash
        const wash = ctx.createRadialGradient(W*0.55, H*0.3, Math.max(W,H)*0.05, W*0.5, H*0.5, Math.max(W,H)*0.7);
        wash.addColorStop(0, 'rgba(255,255,255,0.02)');
        wash.addColorStop(1, 'rgba(0,0,0,0.03)');
        ctx.fillStyle = wash;
        ctx.fillRect(0,0,W,H);

        const p = planets(W,H);
        const k = t * 0.001 * (state.grav/100);

        // Orbits
        ctx.save();
        ctx.translate(W/2, H/2);

        // Pointer tilt
        const tiltX = (state.pointer.y - 0.5) * 0.35;
        const tiltY = (state.pointer.x - 0.5) * -0.35;
        ctx.transform(1, tiltX, tiltY, 1, 0, 0);

        // Orbit rings
        const gradOrbit = ctx.createLinearGradient(-W/2,0,W/2,0);
        gradOrbit.addColorStop(0, getComputedStyle(root).getPropertyValue('--a1').trim());
        gradOrbit.addColorStop(0.6, getComputedStyle(root).getPropertyValue('--a2').trim());
        gradOrbit.addColorStop(1, getComputedStyle(root).getPropertyValue('--a3').trim());
        ctx.strokeStyle = gradOrbit;
        ctx.lineWidth = Math.max(1, Math.floor(dpr));
        ctx.globalAlpha = 0.45;
        p.forEach(pl=>{
          ctx.beginPath();
          ctx.ellipse(0,0, pl.r, pl.r*(1-pl.e), 0, 0, Math.PI*2);
          ctx.stroke();
        });
        ctx.globalAlpha = 1;

        // Sun
        const sunR = Math.min(W,H)*0.028;
        const gSun = ctx.createRadialGradient(0,0,0,0,0,sunR*4);
        const a1 = getComputedStyle(root).getPropertyValue('--a1').trim();
        const a2 = getComputedStyle(root).getPropertyValue('--a2').trim();
        gSun.addColorStop(0, a1);
        gSun.addColorStop(1, 'rgba(255,255,255,0)');
        ctx.globalCompositeOperation = root.classList.contains('noct') ? 'lighter' : 'screen';
        ctx.fillStyle = gSun;
        ctx.beginPath(); ctx.arc(0,0,sunR*4,0,Math.PI*2); ctx.fill();
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = a2;
        ctx.beginPath(); ctx.arc(0,0,sunR,0,Math.PI*2); ctx.fill();

        // Planets
        const a3 = getComputedStyle(root).getPropertyValue('--a3').trim();
        p.forEach((pl,i)=>{
          const ang = k*pl.speed*Math.pow(1.12, i+1) + pl.phase;
          const rx = pl.r, ry = pl.r*(1-pl.e);
          const x = rx*Math.cos(ang);
          const y = ry*Math.sin(ang);

          // Trail
          ctx.save();
          ctx.globalAlpha = 0.25;
          ctx.strokeStyle = i%2? a3 : a1;
          ctx.lineWidth = Math.max(1, Math.floor(dpr));
          ctx.beginPath();
          for(let j=0;j<80;j++){
            const ta = ang - j*0.06;
            const tx = rx*Math.cos(ta), ty = ry*Math.sin(ta);
            if(j===0) ctx.moveTo(tx,ty); else ctx.lineTo(tx,ty);
          }
          ctx.stroke();
          ctx.restore();

          // Planet glow
          const pg = ctx.createRadialGradient(x,y,0,x,y,pl.size*3);
          pg.addColorStop(0, i%2 ? a3 : a1);
          pg.addColorStop(1, 'rgba(255,255,255,0)');
          ctx.globalCompositeOperation = root.classList.contains('noct') ? 'lighter' : 'screen';
          ctx.fillStyle = pg;
          ctx.beginPath(); ctx.arc(x,y,pl.size*3,0,Math.PI*2); ctx.fill();
          ctx.globalCompositeOperation = 'source-over';

          // Planet body
          ctx.fillStyle = i%2? a3 : a1;
          ctx.beginPath(); ctx.arc(x,y,pl.size,0,Math.PI*2); ctx.fill();
        });

        ctx.restore();

        // Comets
        for(let i=state.comets.length-1;i>=0;i--){
          const m = state.comets[i];
          const vx = m.vx * (state.grav/100 + 0.4);
          const vy = m.vy * (state.grav/100 + 0.4);
          m.x += vx;
          m.y += vy;
          m.life -= 0.006 * (state.grav/100);
          const cx = m.x * W, cy = m.y * H;

          // tail
          const tail = ctx.createRadialGradient(cx, cy, 0, cx, cy, Math.max(W,H)*0.12);
          tail.addColorStop(0, `hsla(${m.hue*360},90%,70%,.30)`);
          tail.addColorStop(1, 'rgba(255,255,255,0)');
          ctx.globalCompositeOperation = root.classList.contains('noct') ? 'lighter' : 'screen';
          ctx.fillStyle = tail;
          ctx.beginPath(); ctx.arc(cx, cy, Math.max(W,H)*0.12, 0, Math.PI*2); ctx.fill();
          ctx.globalCompositeOperation = 'source-over';

          // head
          ctx.fillStyle = `hsla(${m.hue*360},95%,70%,${Math.max(0,m.life)})`;
          ctx.beginPath(); ctx.arc(cx, cy, Math.max(2, 5*dpr), 0, Math.PI*2); ctx.fill();

          // cleanup
          if(m.life<=0 || cx< -50 || cy< -50 || cx> W+50 || cy> H+50){ state.comets.splice(i,1); }
        }
      }

      // Loop
      let raf;
      function loop(t){
        if(state.paused || prefersReduced) return;
        draw(t);
        raf = requestAnimationFrame(loop);
      }
      if(!prefersReduced) raf = requestAnimationFrame(loop);
      else draw(performance.now());

      // Keyboard pause
      window.addEventListener('keydown', e=>{
        if(e.code==='Space'){
          e.preventDefault();
          state.paused = !state.paused;
          pauseBtn.textContent = state.paused ? 'Resume' : 'Pause';
          pauseBtn.setAttribute('aria-pressed', String(state.paused));
          if(!state.paused && !prefersReduced) raf = requestAnimationFrame(loop);
        }
      });

      // Resize
      const ro = new ResizeObserver(()=>{ dpr = Math.min(2, window.devicePixelRatio || 1); fit(); });
      ro.observe(stage);
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


