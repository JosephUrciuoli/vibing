<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="vibe2324" role="region" aria-label="Prismatic Garden — a living gradient workshop" data-scheme="light">
  <style>
    /* Tokens */
    #vibe2324{
      --h: 288;
      --ink: #10131a;
      --muted: #5b657a;
      --line: color-mix(in oklab, var(--ink) 14%, transparent);
      --bg0: #f6f7fb;
      --bg1: #e9eef7;
      --glass: rgba(255,255,255,0.62);
      --r: 26px;
      color-scheme: light;
      color: var(--ink);
      font: 600 14px/1.6 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      border-radius: var(--r);
      padding: clamp(22px, 4vw, 36px);
      background:
        radial-gradient(140% 120% at 0% -10%, hsl(var(--h),85%,88%) 0%, transparent 40%),
        radial-gradient(140% 120% at 120% 120%, hsl(calc(var(--h) + 70),85%,87%) 0%, transparent 40%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.75), 0 40px 120px rgba(13,24,45,0.12);
      position: relative;
      isolation: isolate;
      overflow: hidden;
    }
    #vibe2324[data-scheme="dark"]{
      --ink: #eaf2ff;
      --muted: #9bb0c8;
      --bg0: #090e14;
      --bg1: #0b131e;
      --glass: rgba(10,14,20,0.55);
      --line: color-mix(in oklab, var(--ink) 18%, transparent);
      color-scheme: dark;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), 0 60px 180px rgba(0,0,0,0.6);
    }

    /* Ambient aurora veils */
    #vibe2324::before, #vibe2324::after{
      content:""; position:absolute; inset:-30%;
      background:
        conic-gradient(from 110deg at 40% 30%, rgba(255,255,255,0.10), transparent 28% 72%, rgba(255,255,255,0.10) 0),
        radial-gradient(65% 45% at 70% 70%, color-mix(in oklab, hsl(var(--h),85%,70%) 26%, transparent), transparent 60%);
      mix-blend-mode: soft-light; filter: blur(12px) saturate(1.05);
      pointer-events:none; opacity:.7;
    }
    #vibe2324::before{ animation: v24-sway1 40s ease-in-out infinite; }
    #vibe2324::after{ animation: v24-sway2 65s ease-in-out infinite; }
    @keyframes v24-sway1{ 50%{ transform: translate3d(1.4%,-0.8%,0) rotate(.9deg) scale(1.02); } }
    @keyframes v24-sway2{ 50%{ transform: translate3d(-1.1%,1.2%,0) rotate(-.8deg) scale(1.03); } }

    /* Header */
    #vibe2324 .top{
      display:grid; grid-template-columns: 1fr auto; gap: 14px; align-items:center;
      margin-bottom: clamp(12px, 3vw, 26px);
    }
    #vibe2324 .brand{ display:grid; grid-template-columns:auto 1fr; gap:12px; align-items:center; }
    #vibe2324 .mark{
      width:38px; height:38px; border-radius:12px; position:relative; overflow:hidden;
      background: linear-gradient(160deg, hsl(var(--h),90%,55%), hsl(calc(var(--h) + 90),90%,58%));
      box-shadow: inset 0 1px 8px rgba(255,255,255,.55), 0 10px 22px rgba(0,0,0,.12);
    }
    #vibe2324 .mark::after{
      content:""; position:absolute; inset:1px; border-radius:10px;
      background:
        radial-gradient(120% 80% at -10% 0%, rgba(255,255,255,.8), transparent 50%),
        radial-gradient(80% 120% at 100% 100%, rgba(255,255,255,.25), transparent 60%);
      mix-blend-mode: overlay; animation: v24-breathe 6s ease-in-out infinite;
    }
    @keyframes v24-breathe{ 50%{ transform: translateY(1px) scale(1.02); filter: brightness(1.06);} }
    #vibe2324 h1{ margin:0; font-size: clamp(16px, 2.2vw, 22px); letter-spacing:.28em; text-transform:uppercase; color:var(--muted); }
    #vibe2324 .tag{ margin:0; grid-column: 1 / -1; font-weight:800; letter-spacing:-.02em; color: color-mix(in oklab, var(--ink) 70%, transparent); font-size: clamp(22px, 5vw, 42px); }
    #vibe2324 .actions{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-self:end; }
    #vibe2324 .btn{
      appearance:none; border:1px solid var(--line); border-radius:999px; padding:8px 12px; cursor:pointer;
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.6));
      color:var(--ink); font-weight:800; letter-spacing:.02em;
      box-shadow: 0 10px 18px rgba(0,0,0,0.08);
      transition: transform .14s ease, filter .18s ease, box-shadow .18s ease, background .18s ease;
    }
    #vibe2324[data-scheme="dark"] .btn{
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      box-shadow: 0 10px 18px rgba(0,0,0,0.25); color: var(--ink);
    }
    #vibe2324 .btn:hover{ transform: translateY(-1px); filter: brightness(1.06); }
    #vibe2324 .btn:active{ transform: translateY(0); filter: brightness(.98); }
    #vibe2324 .btn.primary{
      border:none; color:#fff; text-shadow:0 1px 0 rgba(0,0,0,0.25);
      background: linear-gradient(90deg, hsl(var(--h),90%,55%), hsl(calc(var(--h) + 90),90%,60%));
      box-shadow: 0 16px 30px rgba(47,108,255,.22);
    }

    /* Stage */
    #vibe2324 .stage{
      position:relative;
      display:grid; grid-template-rows: 1fr auto; gap: clamp(14px, 3vw, 22px);
      border-radius: clamp(20px,3.4vw,30px);
      min-height: clamp(560px, 66vh, 900px);
      border: 1px solid var(--line);
      background:
        radial-gradient(55% 44% at 50% 0%, color-mix(in oklab, var(--bg1) 65%, transparent), transparent 65%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.5), 0 24px 70px rgba(0,0,0,.12);
      overflow: hidden;
    }

    /* Prism container (hex mask) */
    #vibe2324 .prism{
      position:relative; width:100%; display:grid; place-items:center; overflow:hidden;
      aspect-ratio: 16 / 10; margin:auto;
      filter: drop-shadow(0 30px 60px rgba(0,0,0,.18));
      clip-path: polygon(25% 6%, 75% 6%, 100% 50%, 75% 94%, 25% 94%, 0% 50%);
      border: 1px solid var(--line); border-radius: 18px; /* soft corners behind hex */
      background: radial-gradient(120% 120% at 50% 20%, rgba(255,255,255,0.35), transparent 55%);
      cursor: grab; touch-action: none;
    }
    #vibe2324 .prism:active{ cursor: grabbing; }
    #vibe2324 .prism::before{
      content:""; position:absolute; inset:0; pointer-events:none;
      background: conic-gradient(from 0deg at 50% 50%, color-mix(in oklab, hsl(var(--h),95%,65%) 40%, transparent), transparent 30% 70%, color-mix(in oklab, hsl(calc(var(--h)+120),95%,65%) 40%, transparent));
      mix-blend-mode: soft-light; opacity:.5; animation: v24-spin 40s linear infinite;
    }
    @keyframes v24-spin{ to{ transform: rotate(360deg); } }

    #vibe2324 canvas.field{
      position:absolute; inset:0; width:100%; height:100%; display:block;
      mix-blend-mode: normal;
    }

    /* Hex border glow */
    #vibe2324 .ring{
      position:absolute; inset:3%; pointer-events:none;
      border: 1px solid color-mix(in oklab, var(--ink) 20%, transparent);
      clip-path: polygon(25% 6%, 75% 6%, 100% 50%, 75% 94%, 25% 94%, 0% 50%);
      box-shadow: 0 0 0 1px rgba(255,255,255,.5) inset, 0 14px 40px rgba(0,0,0,.18) inset, 0 0 40px hsl(var(--h),90%,60%,.25);
    }

    /* Readout */
    #vibe2324 .readout{
      position:absolute; inset:0; display:grid; place-items:center; pointer-events:none; text-align:center;
    }
    #vibe2324 .readout h2{
      margin:0; font-weight:900; letter-spacing:-.02em; text-transform: lowercase;
      font-size: clamp(46px, 9vw, 124px);
      background: linear-gradient(120deg, hsl(var(--h),90%,55%), hsl(calc(var(--h) + 90),90%,60%));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter: drop-shadow(0 1px 0 rgba(255,255,255,.4));
    }
    #vibe2324 .readout p{ margin:.5em 0 0; font-size:13px; color:var(--muted); }

    /* Controls panel */
    #vibe2324 .panel{
      position:relative; z-index:3; display:grid; gap:14px; width: min(1000px, 100%); justify-self:center;
      padding: clamp(12px,2vw,16px);
      background: var(--glass);
      border: 1px solid var(--line);
      border-radius: 18px;
      box-shadow: 0 18px 50px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.22);
      backdrop-filter: blur(14px) saturate(1.08);
    }
    #vibe2324 .grid{ display:grid; grid-template-columns: repeat(5, minmax(0,1fr)); gap:10px; }
    @media (max-width:960px){ #vibe2324 .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); } }
    @media (max-width:560px){ #vibe2324 .grid{ grid-template-columns: 1fr 1fr; } }
    @media (max-width:420px){ #vibe2324 .grid{ grid-template-columns: 1fr; } }

    #vibe2324 label{ display:grid; gap:6px; font-size:11px; color:var(--muted); letter-spacing:.08em; text-transform:uppercase; }
    #vibe2324 input[type="range"]{
      -webkit-appearance:none; appearance:none; width:100%; height:12px;
      border-radius:999px; border:1px solid var(--line);
      background:
        linear-gradient(90deg, hsl(var(--h),90%,55%), hsl(calc(var(--h)+90),90%,60%)) left/var(--pct,50%) 100% no-repeat,
        rgba(0,0,0,.08);
      box-shadow: inset 0 2px 6px rgba(0,0,0,.12);
      outline:none;
    }
    #vibe2324 input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none; appearance:none; width:18px; height:18px; border-radius:50%;
      background: radial-gradient(circle at 35% 35%, #fff, #e6edf7);
      border:1px solid var(--line); box-shadow:0 6px 12px rgba(0,0,0,.18); cursor:pointer;
    }
    #vibe2324 input[type="range"]::-moz-range-thumb{
      width:18px; height:18px; border-radius:50%;
      background: radial-gradient(circle at 35% 35%, #fff, #e6edf7);
      border:1px solid var(--line); box-shadow:0 6px 12px rgba(0,0,0,.18); cursor:pointer;
    }
    #vibe2324 .row{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    #vibe2324 .chip{
      appearance:none; border:1px solid var(--line); border-radius:999px; padding:8px 12px; cursor:pointer;
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.6));
      color:var(--ink); font-weight:800; letter-spacing:.02em;
      box-shadow: 0 8px 16px rgba(0,0,0,0.08);
      transition: transform .14s ease, background .18s ease, box-shadow .18s ease;
    }
    #vibe2324[data-scheme="dark"] .chip{
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    #vibe2324 .chip[aria-pressed="true"]{
      border-color: transparent;
      background: linear-gradient(90deg, hsl(var(--h),90%,55%), hsl(calc(var(--h)+90),90%,60%));
      color:#fff; text-shadow:0 1px 0 rgba(0,0,0,0.25);
      box-shadow: 0 14px 24px rgba(47,108,255,.22);
    }
    #vibe2324 .meta{ display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap; font-size:12px; color:var(--muted); }

    /* Focus */
    #vibe2324 .btn:focus, #vibe2324 .chip:focus, #vibe2324 input:focus{ outline: 2px solid hsl(var(--h),90%,60%); outline-offset: 2px; }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      #vibe2324 *, #vibe2324::before, #vibe2324::after{ animation:none !important; transition:none !important; }
    }
  </style>

  <div class="top" aria-label="Header">
    <div class="brand">
      <div class="mark" aria-hidden="true"></div>
      <h1>Prismatic Garden</h1>
      <p class="tag" id="mood24">weave light. breathe color.</p>
    </div>
    <div class="actions">
      <button class="btn" id="theme24" type="button" aria-pressed="false" title="Toggle theme">Dark</button>
      <button class="btn primary" id="snap24" type="button" title="Save artwork">Capture</button>
      <button class="btn" id="reset24" type="button" title="Reset">Reset</button>
    </div>
  </div>

  <section class="stage" aria-label="Prismatic canvas. Drag to rotate. Space to pause. T for theme.">
    <div class="prism" id="prism24">
      <canvas class="field" id="field24"></canvas>
      <div class="ring" aria-hidden="true"></div>
      <div class="readout" aria-live="polite">
        <h2 id="title24">kaleidoscope</h2>
        <p id="sub24">drag to steer | S to save</p>
      </div>
    </div>

    <aside class="panel" aria-label="Controls">
      <div class="grid">
        <label for="hue24">Hue
          <input id="hue24" type="range" min="0" max="360" step="1" value="288" aria-valuemin="0" aria-valuemax="360" aria-valuenow="288">
        </label>
        <label for="sectors24">Sectors
          <input id="sectors24" type="range" min="4" max="24" step="1" value="12" aria-valuemin="4" aria-valuemax="24" aria-valuenow="12">
        </label>
        <label for="speed24">Speed
          <input id="speed24" type="range" min="0" max="100" step="1" value="60" aria-valuemin="0" aria-valuemax="100" aria-valuenow="60">
        </label>
        <label for="complex24">Complexity
          <input id="complex24" type="range" min="1" max="20" step="1" value="10" aria-valuemin="1" aria-valuemax="20" aria-valuenow="10">
        </label>
        <label for="grain24">Grain
          <input id="grain24" type="range" min="0" max="100" step="1" value="12" aria-valuemin="0" aria-valuemax="100" aria-valuenow="12">
        </label>
      </div>
      <div class="row">
        <button class="chip" id="auto24" type="button" aria-pressed="true" title="Auto-rotate">Auto</button>
        <button class="chip" id="mono24" type="button" aria-pressed="false" title="Mono palette">Mono</button>
        <button class="chip" id="glow24" type="button" aria-pressed="true" title="Glow overlay">Glow</button>
        <button class="chip" id="pause24" type="button" aria-pressed="false" title="Pause animation">Pause</button>
      </div>
      <div class="meta" role="contentinfo">
        <span class="hint">Tip: Rotate the prism to remix symmetry. Press T for theme.</span>
        <span id="last-updated">Last updated: 2026-01-31 23:58:59 EST</span>
      </div>
    </aside>
  </section>

  <script>
  (function(){
    const root = document.getElementById('vibe2324');
    const canvas = document.getElementById('field24');
    const ctx = canvas.getContext('2d', { alpha: true, desynchronized: true });
    const prism = document.getElementById('prism24');

    const themeBtn = document.getElementById('theme24');
    const snapBtn = document.getElementById('snap24');
    const resetBtn = document.getElementById('reset24');

    const hue = document.getElementById('hue24');
    const sectors = document.getElementById('sectors24');
    const speed = document.getElementById('speed24');
    const complex = document.getElementById('complex24');
    const grain = document.getElementById('grain24');

    const autoBtn = document.getElementById('auto24');
    const monoBtn = document.getElementById('mono24');
    const glowBtn = document.getElementById('glow24');
    const pauseBtn = document.getElementById('pause24');

    const title = document.getElementById('title24');
    const sub = document.getElementById('sub24');
    const mood = document.getElementById('mood24');
    const updated = document.getElementById('last-updated');

    // last updated
    function fmt(d){
      try{
        return new Intl.DateTimeFormat(undefined,{
          year:'numeric', month:'short', day:'2-digit',
          hour:'2-digit', minute:'2-digit', second:'2-digit'
        }).format(d);
      }catch{ return d.toLocaleString(); }
    }
    updated.textContent = 'Last updated: ' + fmt(new Date());

    // tokens
    function setHue(h){ root.style.setProperty('--h', String(h)); }

    // range fill
    function fillRange(el){
      const min = +el.min, max = +el.max, val = +el.value;
      const pct = ((val - min) / (max - min)) * 100;
      el.style.setProperty('--pct', pct + '%');
      el.setAttribute('aria-valuenow', String(val));
    }
    [hue, sectors, speed, complex, grain].forEach(r => { fillRange(r); r.addEventListener('input', ()=>fillRange(r)); });

    // theme
    function toggleTheme(){
      const dark = root.getAttribute('data-scheme') === 'dark';
      root.setAttribute('data-scheme', dark ? 'light' : 'dark');
      themeBtn.textContent = dark ? 'Dark' : 'Light';
      themeBtn.setAttribute('aria-pressed', (!dark).toString());
      clearCanvas();
    }
    themeBtn.addEventListener('click', toggleTheme);

    // sizing
    let dpr = Math.min(3, window.devicePixelRatio || 1);
    function size(){
      const r = canvas.getBoundingClientRect();
      canvas.width = Math.max(1, Math.floor(r.width * dpr));
      canvas.height = Math.max(1, Math.floor(r.height * dpr));
      ctx.setTransform(1,0,0,1,0,0);
      ctx.scale(dpr, dpr);
      clearCanvas();
    }
    const ro = new ResizeObserver(size);
    ro.observe(canvas);
    let rsT=0;
    addEventListener('resize', ()=>{ clearTimeout(rsT); rsT=setTimeout(size, 80); });

    // canvas helpers
    function clearCanvas(){
      const r = canvas.getBoundingClientRect();
      const scheme = root.getAttribute('data-scheme');
      ctx.globalCompositeOperation='source-over';
      ctx.fillStyle = scheme==='dark' ? 'rgba(9,14,20,1)' : 'rgba(246,247,251,1)';
      ctx.fillRect(0,0,r.width,r.height);
    }

    // state
    let rot = 0; // radians
    let dragging = false;
    let dragStart = 0;
    let paused = false;
    let auto = true;
    let glowOn = true;
    let mono = false;

    setHue(hue.value);

    // mood words
    const moods = ['glow', 'hush', 'dawn', 'arc', 'bloom', 'drift', 'pulse', 'glint', 'soar', 'melt'];
    function setMood(){
      const h = (+hue.value)%360;
      const ix = Math.round((h/360) * (moods.length-1));
      title.textContent = moods[ix] || 'kaleidoscope';
      mood.textContent = 'prismatic garden — ' + (moods[ix] || 'weave light');
    }
    setMood();

    hue.addEventListener('input', ()=>{ setHue(hue.value); setMood(); });

    // drag to rotate
    function setRotFromPointer(e){
      const r = prism.getBoundingClientRect();
      const cx = r.left + r.width/2;
      const cy = r.top + r.height/2;
      const dx = e.clientX - cx;
      const dy = e.clientY - cy;
      rot = Math.atan2(dy, dx);
    }
    prism.addEventListener('pointerdown', (e)=>{ dragging = true; prism.setPointerCapture(e.pointerId); dragStart = rot; setRotFromPointer(e); });
    prism.addEventListener('pointermove', (e)=>{ if(dragging){ auto=false; autoBtn.setAttribute('aria-pressed','false'); setRotFromPointer(e);} });
    prism.addEventListener('pointerup', (e)=>{ dragging=false; prism.releasePointerCapture(e.pointerId); });

    // buttons
    autoBtn.addEventListener('click', ()=>{ auto=!auto; autoBtn.setAttribute('aria-pressed', String(auto)); });
    monoBtn.addEventListener('click', ()=>{ mono=!mono; monoBtn.setAttribute('aria-pressed', String(mono)); });
    glowBtn.addEventListener('click', ()=>{ glowOn=!glowOn; glowBtn.setAttribute('aria-pressed', String(glowOn)); });
    pauseBtn.addEventListener('click', ()=>{
      paused=!paused; pauseBtn.setAttribute('aria-pressed', String(paused));
      pauseBtn.textContent = paused ? 'Resume' : 'Pause';
      if(!paused){ prev = performance.now(); rafId = requestAnimationFrame(frame); }
    });
    resetBtn.addEventListener('click', ()=>{
      hue.value='288'; sectors.value='12'; speed.value='60'; complex.value='10'; grain.value='12';
      [hue,sectors,speed,complex,grain].forEach(fillRange);
      setHue(hue.value); setMood();
      mono=false; monoBtn.setAttribute('aria-pressed','false');
      auto=true; autoBtn.setAttribute('aria-pressed','true');
      glowOn=true; glowBtn.setAttribute('aria-pressed','true');
      rot = 0;
      clearCanvas();
    });

    // keys
    root.addEventListener('keydown', (e)=>{
      if(e.code==='Space'){ e.preventDefault(); pauseBtn.click(); }
      if(e.key?.toLowerCase()==='t'){ e.preventDefault(); themeBtn.click(); }
      if(e.key?.toLowerCase()==='s'){ e.preventDefault(); snapBtn.click(); }
    });

    // capture
    snapBtn.addEventListener('click', ()=>{
      try{
        const a = document.createElement('a');
        a.download = `prismatic-${new Date().toISOString().replace(/[:.]/g,'-')}.png`;
        a.href = canvas.toDataURL('image/png');
        a.click();
      }catch(e){}
    });

    // renderer (downsampled kaleidoscope)
    const off = document.createElement('canvas');
    const octx = off.getContext('2d', { alpha: false });

    function hslToRgb(h, s, l){
      h = ((h%360)+360)%360;
      const C = (1 - Math.abs(2*l - 1)) * s;
      const Hp = h/60;
      const X = C * (1 - Math.abs((Hp % 2) - 1));
      let r=0,g=0,b=0;
      if(0<=Hp && Hp<1){ r=C; g=X; b=0; }
      else if(1<=Hp && Hp<2){ r=X; g=C; b=0; }
      else if(2<=Hp && Hp<3){ r=0; g=C; b=X; }
      else if(3<=Hp && Hp<4){ r=0; g=X; b=C; }
      else if(4<=Hp && Hp<5){ r=X; g=0; b=C; }
      else if(5<=Hp && Hp<6){ r=C; g=0; b=X; }
      const m = l - C/2;
      return [
        Math.round((r+m)*255),
        Math.round((g+m)*255),
        Math.round((b+m)*255)
      ];
    }

    function render(tms){
      const r = canvas.getBoundingClientRect();
      const W = Math.max(220, Math.floor(r.width/4));
      const H = Math.max(180, Math.floor(r.height/4));
      if(off.width !== W || off.height !== H){ off.width=W; off.height=H; }
      const img = octx.createImageData(W, H);
      const data = img.data;

      const t = tms * 0.001 * (+speed.value/60);
      const sec = Math.max(4, Math.min(24, +sectors.value));
      const sectorAngle = (Math.PI*2)/sec;
      const comp = +complex.value;
      const hueBase = parseFloat(getComputedStyle(root).getPropertyValue('--h')) || 288;

      let i=0;
      for(let y=0;y<H;y++){
        const ny = (y/H) - 0.5;
        for(let x=0;x<W;x++){
          const nx = (x/W) - 0.5;
          let rr = Math.hypot(nx, ny);
          let ang = Math.atan2(ny, nx) + rot;

          // kaleidoscope mirror
          let a = ang % sectorAngle; if(a<0) a += sectorAngle;
          if(a > sectorAngle/2){ a = sectorAngle - a; }
          // reconstruct coordinates
          const sx = Math.cos(a) * rr;
          const sy = Math.sin(a) * rr;

          // pattern: layered sines + swirl
          const k1 = 4.0 + (comp*0.18);
          const k2 = 6.0 + (comp*0.22);
          const v =
            Math.sin((sx*k1) + t*1.1) * 0.5 +
            Math.cos((sy*k2) - t*0.9) * 0.5 +
            Math.sin((sx+sy)*(3.0 + comp*0.1) + t*0.35) * 0.4;

          const swirl = Math.sin(rr*12 + t*1.2) * 0.25;
          let lum = (v*0.5 + 0.5) * (1 - Math.min(1, rr*1.6)) + swirl*0.5;

          // grain
          lum += (+grain.value/100) * (Math.random()*0.15);
          lum = Math.max(0, Math.min(1, lum));

          const s1 = mono ? 0 : 0.6;
          const s2 = mono ? 0 : 0.85;
          const l1 = 0.55 + lum*0.25;
          const l2 = 0.45 + lum*0.4;

          const c1 = hslToRgb(hueBase, s1, l1);
          const c2 = hslToRgb(hueBase+100, s2, l2);

          const m = 0.45 + lum*0.55;
          data[i++] = c1[0]*(1-m) + c2[0]*m;
          data[i++] = c1[1]*(1-m) + c2[1]*m;
          data[i++] = c1[2]*(1-m) + c2[2]*m;
          data[i++] = 255;
        }
      }
      octx.putImageData(img,0,0);
      ctx.globalCompositeOperation = 'source-over';
      ctx.drawImage(off, 0, 0, r.width, r.height);

      if(glowOn){
        ctx.globalCompositeOperation = 'lighter';
        ctx.filter = `blur(${2 + (+complex.value/3)}px)`;
        ctx.drawImage(off, 0, 0, r.width, r.height);
        ctx.filter = 'none';
      }
    }

    // loop
    let prev = performance.now();
    let rafId = 0;
    function frame(now){
      const dt = Math.min(50, now - prev);
      prev = now;

      if(auto && !dragging){
        rot += (dt/1000) * 0.3 * (+speed.value/60);
      }

      render(now);
      if(!paused) rafId = requestAnimationFrame(frame);
    }

    // reduced motion + visibility
    const media = matchMedia('(prefers-reduced-motion: reduce)');
    media.addEventListener?.('change', ()=>{
      if(media.matches){ cancelAnimationFrame(rafId); }
      else if(!paused){ prev = performance.now(); rafId = requestAnimationFrame(frame); }
    });
    document.addEventListener('visibilitychange', ()=>{
      if(document.hidden) cancelAnimationFrame(rafId);
      else if(!paused) rafId = requestAnimationFrame(frame);
    });

    // init
    function init(){
      size();
      cancelAnimationFrame(rafId);
      paused = false;
      pauseBtn.textContent = 'Pause';
      prev = performance.now();
      rafId = requestAnimationFrame(frame);
    }
    init();
  })();
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


