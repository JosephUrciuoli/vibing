<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="v1431 aurora" data-theme="dawn" data-play="on" aria-label="Aurora Atlas — morphing field study">
  <style>
    .v1431 {
      --r: 28px;
      --ink: #0c1022;
      --muted: #3b4a66;
      --line: rgba(14,18,32,0.18);
      --bg0: #fff8f1;
      --bg1: #eef6ff;
      --a1: #ff7aa2; --a2: #ffd58a;
      --b1: #57d6ff; --b2: #86f7a5;
      --c1: #6f7cff; --c2: #ff9cf2;

      position: relative;
      display: grid;
      gap: 20px;
      padding: clamp(18px, 4vw, 34px);
      border-radius: var(--r);
      color: var(--ink);
      background:
        radial-gradient(1200px 800px at var(--mx, 60%) var(--my, 30%), rgba(56,103,255,0.08), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.7),
        0 30px 80px rgba(3,7,18,0.15);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      isolation: isolate;
      overflow: hidden;
    }
    .v1431::before {
      content:"";
      position:absolute; inset:-20%;
      background:
        radial-gradient(1.2px 1.2px at 12% 20%, rgba(0,0,0,0.04), transparent 40%),
        radial-gradient(1.1px 1.1px at 36% 82%, rgba(0,0,0,0.04), transparent 40%),
        radial-gradient(1.3px 1.3px at 78% 32%, rgba(0,0,0,0.04), transparent 42%),
        radial-gradient(1.0px 1.0px at 62% 15%, rgba(0,0,0,0.03), transparent 42%);
      background-size: 900px 900px, 1000px 1000px, 1100px 1100px, 1200px 1200px;
      mix-blend-mode: soft-light;
      opacity: .6;
      pointer-events: none;
    }
    .v1431[data-theme="midnight"] {
      --ink: #e9f0ff;
      --muted: #a1b3d9;
      --line: rgba(140,170,255,0.18);
      --bg0: #060914;
      --bg1: #0d1630;
      --a1: #7cf4ff; --a2: #f59e0b;
      --b1: #a78bfa; --b2: #34d399;
      --c1: #3867ff; --c2: #ff8da1;

      background:
        radial-gradient(1200px 800px at var(--mx, 60%) var(--my, 30%), rgba(124,244,255,0.12), transparent 60%),
        conic-gradient(from 220deg at 20% 0%, #0b1737, #09112a, #0a1027, #0d1630),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.06),
        0 30px 80px rgba(3,7,18,0.55);
    }

    .v1431 .frame {
      position: relative;
      display: grid;
      gap: 18px;
      padding: clamp(16px, 3.2vw, 24px);
      border-radius: calc(var(--r) - 4px);
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.22));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.6),
        0 20px 50px rgba(7,12,28,0.18);
      backdrop-filter: blur(16px) saturate(140%);
      -webkit-backdrop-filter: blur(16px) saturate(140%);
      transform-style: preserve-3d;
      z-index: 1;
    }
    .v1431[data-theme="midnight"] .frame {
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.08),
        0 20px 50px rgba(7,12,28,0.45);
    }

    .v1431 .mast {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 14px;
    }
    .v1431 .brand {
      display: grid; grid-auto-flow: column; align-items: center; gap: 14px; min-width: 0;
    }
    .v1431 .mark {
      width: 56px; height: 56px; border-radius: 16px;
      background: conic-gradient(from 0deg, var(--a1), var(--b1), var(--c1), var(--a2));
      position: relative; overflow: hidden;
      animation: v1431-spin 18s linear infinite;
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.4),
        0 10px 26px rgba(0,0,0,0.14);
    }
    .v1431 .mark::after {
      content:"";
      position:absolute; inset:10px; border-radius: 12px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.85), transparent 60%);
      mix-blend-mode: overlay;
    }
    @keyframes v1431-spin { to { transform: rotate(360deg); } }

    .v1431 .title {
      margin: 0;
      font-weight: 900;
      letter-spacing: -0.02em;
      font-size: clamp(28px, 4.8vw, 52px);
      line-height: 1.02;
      background: linear-gradient(90deg, var(--c1), var(--a1) 45%, var(--a2));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-shadow: 0 0 24px rgba(56,103,255,0.16);
      white-space: nowrap;
    }
    .v1431[data-theme="midnight"] .title { text-shadow: 0 0 24px rgba(124,244,255,0.18); }
    .v1431 .tag { margin: 0; opacity: .95; font-size: 13px; color: var(--muted); }

    .v1431 .controls { display:flex; flex-wrap: wrap; gap: 10px; justify-content: flex-end; }
    .v1431 .btn, .v1431 .chip, .v1431 .slider {
      -webkit-tap-highlight-color: transparent;
      display: inline-flex; align-items: center; gap: 10px;
      padding: 10px 14px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.2));
      color: var(--ink);
      font-weight: 800; font-size: 12px; letter-spacing: 0.2px;
      cursor: pointer; user-select: none;
      transition: transform 220ms ease, box-shadow 220ms ease, background 220ms ease, opacity 220ms ease, color 220ms ease;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.6), 0 8px 22px rgba(8,12,26,0.15);
    }
    .v1431[data-theme="midnight"] .btn, .v1431[data-theme="midnight"] .chip, .v1431[data-theme="midnight"] .slider {
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), 0 8px 22px rgba(8,12,26,0.5);
    }
    .v1431 .btn:hover, .v1431 .chip:hover { transform: translateY(-2px); }
    .v1431 .btn[aria-pressed="true"] {
      outline: none;
      background: linear-gradient(180deg, color-mix(in oklab, var(--a1) 20%, transparent), color-mix(in oklab, var(--a1) 8%, transparent));
      border-color: color-mix(in srgb, var(--a1) 45%, transparent);
      box-shadow: 0 10px 28px color-mix(in srgb, var(--a1) 22%, transparent), inset 0 1px 0 rgba(255,255,255,0.18);
    }
    .v1431 .slider { gap: 12px; padding: 8px 12px; font-weight: 800; }

    .v1431 input[type="range"] {
      -webkit-appearance: none; appearance: none;
      width: 150px; height: 24px; background: transparent;
    }
    .v1431 input[type="range"]::-webkit-slider-runnable-track {
      height: 8px; border-radius: 999px;
      background: linear-gradient(90deg, var(--c1), var(--a1));
      border: 1px solid var(--line);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.4);
    }
    .v1431 input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      position: relative; margin-top: -6px;
      width: 20px; height: 20px; border-radius: 50%;
      border: 1px solid rgba(190,210,255,0.5);
      background: radial-gradient(circle at 30% 30%, #fff, #cfe1ff);
      box-shadow: 0 8px 18px rgba(13,20,41,0.2);
      cursor: pointer;
    }
    .v1431 input[type="range"]::-moz-range-track {
      height: 8px; border-radius: 999px;
      background: linear-gradient(90deg, var(--c1), var(--a1));
      border: 1px solid var(--line);
    }
    .v1431 input[type="range"]::-moz-range-thumb {
      width: 20px; height: 20px; border-radius: 50%;
      border: 1px solid rgba(190,210,255,0.5);
      background: radial-gradient(circle at 30% 30%, #fff, #cfe1ff);
      box-shadow: 0 8px 18px rgba(13,20,41,0.2);
      cursor: pointer;
    }

    .v1431 .grid {
      display: grid;
      grid-template-columns: 0.9fr 1fr;
      align-items: center;
      gap: clamp(16px, 4.5vw, 30px);
    }
    @media (max-width: 980px) { .v1431 .grid { grid-template-columns: 1fr; } }

    .v1431 .display {
      margin: 0 0 10px 0;
      font-weight: 900;
      letter-spacing: -0.02em;
      font-size: clamp(30px, 5.4vw, 62px);
      line-height: 1.02;
      background: linear-gradient(90deg, var(--a2), var(--a1) 50%, var(--c2));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-shadow: 0 0 34px color-mix(in srgb, var(--a1) 16%, transparent);
    }
    .v1431 .copy p {
      margin: 0 0 14px 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.7;
    }

    .v1431 .stage {
      position: relative;
      width: min(760px, 100%);
      margin-inline: auto;
      aspect-ratio: 3 / 2;
      border-radius: 24px;
      border: 1px solid var(--line);
      background:
        linear-gradient(180deg, rgba(255,255,255,0.55), rgba(255,255,255,0.2));
      overflow: hidden;
      perspective: 1000px;
      transform-style: preserve-3d;
      transition: transform 380ms cubic-bezier(.2,.7,.2,1), box-shadow 300ms ease;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.5), 0 24px 60px rgba(7,12,28,0.18);
    }
    .v1431[data-theme="midnight"] .stage {
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), 0 24px 60px rgba(7,12,28,0.6);
    }
    .v1431 .stage::after {
      content:"";
      position:absolute; inset:-10%;
      background-image:
        radial-gradient(1px 1px at 20% 30%, rgba(0,0,0,0.03), transparent 49%),
        radial-gradient(1px 1px at 70% 60%, rgba(0,0,0,0.03), transparent 49%);
      background-size: 400px 400px, 500px 500px;
      mix-blend-mode: soft-light;
      pointer-events: none;
    }
    .v1431 .halo {
      position: absolute; inset: -25%;
      background: radial-gradient(40% 40% at var(--mx,50%) var(--my,50%), color-mix(in srgb, var(--a1) 18%, transparent), transparent 60%);
      mix-blend-mode: overlay;
      pointer-events: none;
      transform: translateZ(10px);
    }

    .v1431 svg.field {
      position: absolute; inset: 0;
      width: 100%; height: 100%; display: block;
      filter: drop-shadow(0 10px 34px color-mix(in srgb, var(--a1) 24%, transparent));
      transform: translateZ(26px);
    }
    .v1431[data-theme="midnight"] svg.field {
      filter: drop-shadow(0 10px 34px color-mix(in srgb, var(--a1) 32%, transparent));
    }
    .v1431 .overlay-lines {
      position:absolute; inset:0; pointer-events:none;
      background:
        repeating-linear-gradient(90deg, color-mix(in srgb, var(--ink) 6%, transparent), color-mix(in srgb, var(--ink) 6%, transparent) 1px, transparent 1px, transparent 22px),
        repeating-linear-gradient(0deg, color-mix(in srgb, var(--ink) 6%, transparent), color-mix(in srgb, var(--ink) 6%, transparent) 1px, transparent 1px, transparent 22px);
      opacity: .06;
      mix-blend-mode: soft-light;
      transform: translateZ(28px);
    }

    .v1431 .foot {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center; gap: 12px;
      font-size: 12px;
      color: var(--muted);
    }
    @media (max-width: 560px) { .v1431 .foot { grid-template-columns: 1fr; } }
    .v1431 .meta { display: inline-flex; align-items: center; gap: 8px; white-space: nowrap; }
    .v1431 .led { width: 8px; height: 8px; border-radius: 50%; background: var(--c1); box-shadow: 0 0 0 6px color-mix(in srgb, var(--c1) 22%, transparent); animation: v1431-pulse 2.6s ease-in-out infinite; }
    @keyframes v1431-pulse { 0%,100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.2); opacity: .9; } }

    @media (prefers-reduced-motion: reduce) {
      .v1431, .v1431 * { animation: none !important; transition: none !important; }
    }
  </style>

  <div class="frame">
    <div class="mast">
      <div class="brand">
        <div class="mark" aria-hidden="true"></div>
        <div>
          <h2 class="title">Aurora Atlas</h2>
          <p class="tag">Ink-soft light forms, breathing on paper.</p>
        </div>
      </div>

      <div class="controls" role="group" aria-label="Controls">
        <button class="btn do-play" type="button" aria-pressed="true" title="Toggle motion">Play</button>
        <button class="btn do-theme" type="button" aria-pressed="false" title="Switch theme">Dawn</button>
        <button class="chip do-save" type="button" title="Save a poster">Save Poster</button>
        <label class="slider" title="Flow">
          Flow
          <input class="flow" type="range" min="0" max="140" value="60" aria-label="Flow">
        </label>
        <label class="slider" title="Detail">
          Detail
          <input class="detail" type="range" min="6" max="18" value="10" aria-label="Detail">
        </label>
        <label class="slider" title="Focus">
          Focus
          <input class="focus" type="range" min="6" max="40" value="18" aria-label="Focus">
        </label>
      </div>
    </div>

    <div class="grid">
      <div class="copy">
        <h1 class="display">A moving poster for your cursor.</h1>
        <p>Three layers of aurora ink glide and fold. Nudge the light with your pointer, tune the flow, save a still.</p>
        <p class="tag">Tip: press Play to pause; switch to Midnight for a velvet palette.</p>
      </div>

      <div class="stage" aria-live="polite">
        <svg class="field" viewBox="0 0 1200 800" role="img" aria-label="Morphing aurora field">
          <defs>
            <linearGradient id="gradA" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" />
              <stop offset="100%" />
            </linearGradient>
            <linearGradient id="gradB" x1="1" y1="0" x2="0" y2="1">
              <stop offset="0%" />
              <stop offset="100%" />
            </linearGradient>
            <linearGradient id="gradC" x1="0" y1="1" x2="1" y2="0">
              <stop offset="0%" />
              <stop offset="100%" />
            </linearGradient>
            <filter id="soften">
              <feGaussianBlur in="SourceGraphic" stdDeviation="18" result="b"/>
              <feColorMatrix in="b" type="matrix"
                values="1 0 0 0 0
                        0 1 0 0 0
                        0 0 1 0 0
                        0 0 0 .9 0" />
            </filter>
          </defs>

          <!-- Background wash inside SVG so exports look correct -->
          <linearGradient id="paper" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" />
            <stop offset="100%" />
          </linearGradient>
          <rect width="1200" height="800" fill="url(#paper)"></rect>

          <g filter="url(#soften)">
            <path class="blob blobA" fill="url(#gradA)" opacity="0.85"></path>
            <path class="blob blobB" fill="url(#gradB)" opacity="0.75" style="mix-blend-mode: screen;"></path>
            <path class="blob blobC" fill="url(#gradC)" opacity="0.65" style="mix-blend-mode: screen;"></path>
          </g>
        </svg>
        <div class="overlay-lines" aria-hidden="true"></div>
        <div class="halo" aria-hidden="true"></div>
      </div>
    </div>

    <div class="foot">
      <div class="meta">
        <span class="led" aria-hidden="true"></span>
        Theme: <span class="state-theme">Dawn</span> • Motion: <span class="state-play">On</span> • Flow: <span class="state-flow">60</span> • Detail: <span class="state-detail">10</span> • Focus: <span class="state-focus">18</span>
      </div>
      <div class="meta">
        Updated <span id="last-updated">Last updated: 2025-12-21 08:27:24 EST</span>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const root = document.currentScript.closest('.v1431');
      const stage = root.querySelector('.stage');
      const svg = root.querySelector('svg.field');
      const blobA = svg.querySelector('.blobA');
      const blobB = svg.querySelector('.blobB');
      const blobC = svg.querySelector('.blobC');

      const playBtn = root.querySelector('.do-play');
      const themeBtn = root.querySelector('.do-theme');
      const saveBtn = root.querySelector('.do-save');
      const flowEl = root.querySelector('.flow');
      const detailEl = root.querySelector('.detail');
      const focusEl = root.querySelector('.focus');

      const sPlay = root.querySelector('.state-play');
      const sTheme = root.querySelector('.state-theme');
      const sFlow = root.querySelector('.state-flow');
      const sDetail = root.querySelector('.state-detail');
      const sFocus = root.querySelector('.state-focus');

      const last = root.querySelector('#last-updated');
      try {
        const now = new Date();
        const opts = { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' };
        const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
        last.textContent = "— " + new Intl.DateTimeFormat([], opts).format(now) + " " + (tz || "").replaceAll('_',' ');
      } catch(e){ last.textContent = "— " + new Date().toLocaleString(); }

      // Helpers
      const gs = () => getComputedStyle(root);
      function themeColors(){
        const g = gs();
        return {
          a1: g.getPropertyValue('--a1').trim(),
          a2: g.getPropertyValue('--a2').trim(),
          b1: g.getPropertyValue('--b1').trim(),
          b2: g.getPropertyValue('--b2').trim(),
          c1: g.getPropertyValue('--c1').trim(),
          c2: g.getPropertyValue('--c2').trim(),
          bg0: g.getPropertyValue('--bg0').trim(),
          bg1: g.getPropertyValue('--bg1').trim()
        };
      }
      function applyGradientStops(){
        const col = themeColors();
        const gradA = svg.querySelector('#gradA').querySelectorAll('stop');
        const gradB = svg.querySelector('#gradB').querySelectorAll('stop');
        const gradC = svg.querySelector('#gradC').querySelectorAll('stop');
        gradA[0].setAttribute('stop-color', col.a1);
        gradA[1].setAttribute('stop-color', col.a2);
        gradB[0].setAttribute('stop-color', col.b1);
        gradB[1].setAttribute('stop-color', col.b2);
        gradC[0].setAttribute('stop-color', col.c1);
        gradC[1].setAttribute('stop-color', col.c2);
        const paper = svg.querySelector('#paper').querySelectorAll('stop');
        paper[0].setAttribute('stop-color', col.bg1);
        paper[1].setAttribute('stop-color', col.bg0);
      }

      // Geometry
      const W = 1200, H = 800, CX = W/2, CY = H/2;
      const state = {
        raf: 0,
        playing: true,
        t: 0,
        flow: Number(flowEl.value),
        detail: Number(detailEl.value),
        focus: Number(focusEl.value),
        mx: 0.5, my: 0.5,
        layers: [
          { seed: Math.random()*1000, base: 260, amp: 0.24, speed: 0.5, path: blobA },
          { seed: Math.random()*1000, base: 310, amp: 0.28, speed: 0.35, path: blobB },
          { seed: Math.random()*1000, base: 380, amp: 0.32, speed: 0.26, path: blobC }
        ]
      };

      function noise(x){
        // Simple smooth pseudo-noise from stacked sines
        return Math.sin(x) * 0.5 + Math.sin(1.7*x + 1.3) * 0.3 + Math.sin(2.3*x + 5.1) * 0.2;
      }

      function pointsFor(layer, n, t){
        const pts = [];
        const step = (Math.PI*2)/n;
        const flow = (state.flow/60) * layer.speed;
        for (let i=0;i<n;i++){
          const a = i*step;
          const wob = noise(a*2.2 + t*flow + layer.seed) * layer.amp;
          const r = layer.base * (1 + wob);
          const x = CX + Math.cos(a + t*flow*0.15) * r;
          const y = CY + Math.sin(a + t*flow*0.15) * r * (H/W); // slight aspect
          pts.push({x,y});
        }
        return pts;
      }

      function pathFromPoints(pts){
        // Smooth closed curve via midpoint quadratic method
        const n = pts.length;
        if (n < 3) return '';
        const m = [];
        for (let i=0;i<n;i++){
          const p = pts[i], q = pts[(i+1)%n];
          m.push({x:(p.x+q.x)/2, y:(p.y+q.y)/2});
        }
        let d = `M ${m[0].x.toFixed(2)} ${m[0].y.toFixed(2)} `;
        for (let i=0;i<n;i++){
          const p = pts[(i+1)%n];
          const mid = m[(i+1)%n];
          d += `Q ${p.x.toFixed(2)} ${p.y.toFixed(2)} ${mid.x.toFixed(2)} ${mid.y.toFixed(2)} `;
        }
        return d + 'Z';
      }

      function draw(ts){
        if (!state.playing) return;
        state.t = ts * 0.001;

        // Update blur focus
        const g = svg.querySelector('#soften').querySelector('feGaussianBlur');
        g.setAttribute('stdDeviation', String(state.focus));

        // Update paths
        for (const layer of state.layers){
          const pts = pointsFor(layer, state.detail, state.t);
          layer.path.setAttribute('d', pathFromPoints(pts));
        }

        state.raf = requestAnimationFrame(draw);
      }

      // Pointer parallax and light aim
      function onMove(e){
        const r = root.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width;
        const y = (e.clientY - r.top) / r.height;
        root.style.setProperty('--mx', (x*100).toFixed(2) + '%');
        root.style.setProperty('--my', (y*100).toFixed(2) + '%');
        state.mx = x; state.my = y;

        const dr = stage.getBoundingClientRect();
        const dx = ((e.clientX - (dr.left + dr.width/2)) / (dr.width/2));
        const dy = ((e.clientY - (dr.top + dr.height/2)) / (dr.height/2));
        const clamp = n => Math.max(-1, Math.min(1, n));
        stage.style.transform = `rotateX(${clamp(-dy)*8}deg) rotateY(${clamp(dx)*10}deg)`;
      }
      root.addEventListener('pointermove', onMove);
      root.addEventListener('pointerleave', () => { stage.style.transform = ''; });

      // Controls
      function setPlay(on){
        root.setAttribute('data-play', on ? 'on' : 'off');
        playBtn.setAttribute('aria-pressed', String(on));
        state.playing = on;
        sPlay.textContent = on ? 'On' : 'Off';
        if (on){
          cancelAnimationFrame(state.raf);
          state.raf = requestAnimationFrame(draw);
        }
      }
      playBtn.addEventListener('click', () => setPlay(playBtn.getAttribute('aria-pressed') !== 'true'));

      function toggleTheme(){
        const isMid = root.getAttribute('data-theme') === 'midnight';
        root.setAttribute('data-theme', isMid ? 'dawn' : 'midnight');
        themeBtn.textContent = isMid ? 'Dawn' : 'Midnight';
        themeBtn.setAttribute('aria-pressed', String(!isMid));
        sTheme.textContent = isMid ? 'Dawn' : 'Midnight';
        applyGradientStops();
      }
      themeBtn.addEventListener('click', toggleTheme);

      flowEl.addEventListener('input', () => {
        state.flow = Number(flowEl.value);
        sFlow.textContent = String(state.flow);
      });
      detailEl.addEventListener('input', () => {
        state.detail = Number(detailEl.value);
        sDetail.textContent = String(state.detail);
      });
      focusEl.addEventListener('input', () => {
        state.focus = Number(focusEl.value);
        sFocus.textContent = String(state.focus);
      });

      saveBtn.addEventListener('click', () => {
        try {
          // Serialize SVG with current gradients (already concrete)
          const clone = svg.cloneNode(true);
          // Remove drop-shadow filter (canvas will render differently); keep Gaussian blur
          clone.style.filter = 'none';
          const ser = new XMLSerializer().serializeToString(clone);
          const blob = new Blob([ser], {type: 'image/svg+xml;charset=utf-8'});
          const url = URL.createObjectURL(blob);

          const img = new Image();
          img.onload = () => {
            const scale = Math.min(2, window.devicePixelRatio || 1.5);
            const cw = Math.floor(stage.clientWidth * scale);
            const ch = Math.floor(stage.clientHeight * scale);
            const c = document.createElement('canvas');
            c.width = cw; c.height = ch;
            const ctx = c.getContext('2d');
            ctx.fillStyle = themeColors().bg0;
            ctx.fillRect(0,0,cw,ch);
            ctx.drawImage(img, 0, 0, cw, ch);
            URL.revokeObjectURL(url);
            const a = document.createElement('a');
            a.href = c.toDataURL('image/png');
            a.download = 'aurora-atlas.png';
            document.body.appendChild(a); a.click(); a.remove();
          };
          img.src = url;
        } catch(e){ console.warn('Save failed', e); }
      });

      // Reduced motion
      const prefersReduce = matchMedia('(prefers-reduced-motion: reduce)');
      if (prefersReduce.matches) setPlay(false);

      // Init
      applyGradientStops();
      if (!prefersReduce.matches) setPlay(true);

      // Visibility management
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          setPlay(false);
        } else if (playBtn.getAttribute('aria-pressed') === 'true') {
          setPlay(true);
        }
      });
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


