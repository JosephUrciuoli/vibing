<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="lumen-1933" role="region" aria-label="Kinetic Loom — Edition 1933">
  <style>
    /* KINETIC LOOM — 1933 */
    #lumen-1933{
      --h: 290;                     /* primary hue seed */
      --ink: #0b0e14;
      --muted: rgba(11,14,20,.64);
      --line: rgba(11,14,20,.12);
      --bg-a: hsl(222 55% 98%);
      --bg-b: hsl(210 60% 92%);
      --glass: rgba(255,255,255,.6);
      --shadow: 0 160px 380px rgba(0,0,0,.14), 0 50px 120px rgba(0,0,0,.10), inset 0 1px 0 rgba(255,255,255,.9);
      position: relative;
      border-radius: 40px;
      padding: clamp(22px, 6.2vw, 64px);
      color: var(--ink);
      font-family: ui-sans-serif, -apple-system, Inter, Segoe UI, Helvetica, Arial, system-ui;
      background:
        radial-gradient(120% 120% at 0% 10%, rgba(255,255,255,.9), transparent 60%),
        radial-gradient(160% 160% at 100% 100%, rgba(255,255,255,.6), transparent 60%),
        linear-gradient(180deg, var(--bg-a), var(--bg-b));
      box-shadow: var(--shadow);
      overflow: hidden;
      isolation: isolate;
    }
    #lumen-1933[data-dark="true"]{
      --ink: rgba(236,240,246,.96);
      --muted: rgba(236,240,246,.68);
      --line: rgba(255,255,255,.12);
      --bg-a: hsl(245 16% 9%);
      --bg-b: hsl(250 14% 6%);
      --glass: rgba(255,255,255,.08);
      --shadow: 0 260px 520px rgba(0,0,0,.82), 0 70px 160px rgba(0,0,0,.66), inset 0 1px 0 rgba(255,255,255,.06);
      background:
        radial-gradient(120% 120% at 0% 8%, rgba(255,255,255,.12), transparent 60%),
        radial-gradient(160% 160% at 100% 100%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, var(--bg-a), var(--bg-b));
    }

    /* pearlescent wash + grain */
    #lumen-1933::before{
      content:""; position:absolute; inset:-2px; z-index:0; pointer-events:none; opacity:.18;
      background:
        conic-gradient(from .0turn at 70% 10%,
          color-mix(in hsl, hsl(var(--h) 96% 64%) 26%, transparent),
          transparent 60%),
        radial-gradient(60% 60% at 20% 60%,
          color-mix(in hsl, hsl(calc(var(--h)+90) 92% 64%) 20%, transparent),
          transparent 70%);
      filter: blur(30px) saturate(1.05);
      mix-blend-mode: overlay;
    }
    #lumen-1933[data-dark="true"]::before{ opacity:.12; mix-blend-mode: screen; }

    #lumen-1933::after{
      content:""; position:absolute; inset:0; pointer-events:none; z-index:1; opacity:.14;
      background-image:
        radial-gradient(1px 1px at 12% 28%, rgba(0,0,0,.6) 50%, transparent 51%),
        radial-gradient(1px 1px at 82% 72%, rgba(0,0,0,.6) 50%, transparent 51%),
        radial-gradient(1px 1px at 32% 82%, rgba(0,0,0,.6) 50%, transparent 51%),
        radial-gradient(1px 1px at 62% 42%, rgba(0,0,0,.6) 50%, transparent 51%);
      background-size: 200px 200px, 220px 220px, 260px 260px, 180px 180px;
      mix-blend-mode: overlay;
      animation: grain-1933 18s steps(80) infinite;
    }
    #lumen-1933[data-dark="true"]::after{ mix-blend-mode: screen; opacity:.2; }

    /* Layout */
    #lumen-1933 .wrap{
      position: relative; z-index: 2;
      display: grid; gap: clamp(18px, 3.6vw, 36px);
      grid-template-columns: 1.05fr .95fr;
      align-items: center;
    }
    @media (max-width: 980px){ #lumen-1933 .wrap{ grid-template-columns: 1fr; } }

    /* Typographic poster */
    #lumen-1933 .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:999px; font-weight:900; letter-spacing:.26em;
      text-transform:uppercase; font-size:11px;
      background: var(--glass);
      border: 1px solid var(--line);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.8);
      color: var(--muted);
    }
    #lumen-1933 h1{
      margin:.22em 0 .06em 0;
      font-weight:1000; letter-spacing:-1.6px; line-height:.86;
      font-size: clamp(58px, 12vw, 160px);
      background:
        linear-gradient(90deg,
          hsl(var(--h) 92% 60%),
          hsl(calc(var(--h)+70) 92% 58%),
          hsl(calc(var(--h)+140) 92% 56%),
          hsl(calc(var(--h)+210) 92% 60%));
      background-size: 220% 100%;
      -webkit-background-clip: text; background-clip: text; color: transparent;
      animation: slideHue-1933 18s ease-in-out infinite;
      filter: drop-shadow(0 30px 60px rgba(0,0,0,.16));
    }
    #lumen-1933 .sub{
      color: var(--muted);
      font-size: clamp(14px, 1.6vw, 20px);
      line-height:1.74;
      max-width: 72ch;
    }

    /* Viewport (diamond) */
    #lumen-1933 .viewport{
      position: relative; width: 100%; aspect-ratio: 4 / 5; transform: rotate(7deg);
      filter: saturate(1.04);
      border-radius: 34px;
      background: linear-gradient(180deg, rgba(255,255,255,.7), rgba(255,255,255,.28));
      border: 1px solid var(--line);
      box-shadow: 0 80px 220px rgba(0,0,0,.14), inset 0 1px 0 rgba(255,255,255,.86);
      overflow: hidden;
      clip-path: polygon(50% 0%, 100% 35%, 50% 100%, 0% 65%);
      transform-style: preserve-3d;
    }
    #lumen-1933[data-dark="true"] .viewport{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: 0 70px 200px rgba(0,0,0,.76), inset 0 1px 0 rgba(255,255,255,.06);
    }
    #lumen-1933 .viewport::after{
      content:""; position:absolute; inset:-2px; pointer-events:none; mix-blend-mode: screen; opacity:.8;
      background:
        conic-gradient(from .0turn,
          hsla(var(--h), 92%, 60%, .46),
          hsla(calc(var(--h)+60), 92%, 60%, .26),
          hsla(calc(var(--h)+120), 92%, 60%, .18),
          hsla(calc(var(--h)+240), 92%, 60%, .36),
          hsla(var(--h), 92%, 60%, .46));
      -webkit-mask: linear-gradient(#000,#000) content-box, linear-gradient(#000,#000);
      mask: linear-gradient(#000,#000) content-box, linear-gradient(#000,#000);
      padding:2px; border-radius: 34px;
      -webkit-mask-composite: xor; mask-composite: exclude;
      animation: ring-1933 40s linear infinite;
    }
    #lumen-1933 canvas#loomCanvas1933{ position:absolute; inset:0; width:100%; height:100%; display:block; }

    /* Controls */
    #lumen-1933 .controls{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-top: 12px; }
    #lumen-1933 .chip{
      appearance:none; -webkit-appearance:none; cursor:pointer; user-select:none;
      border:1px solid var(--line); border-radius:999px; padding:10px 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.64));
      color: var(--ink); font-weight:900; font-size:12px; letter-spacing:.2px;
      box-shadow: 0 14px 30px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.9);
      transition: transform .15s ease, filter .3s ease, background .3s ease, box-shadow .3s ease;
    }
    #lumen-1933 .chip:hover{ transform: translateY(-1px); }
    #lumen-1933[data-dark="true"] .chip{
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
      box-shadow: 0 14px 30px rgba(0,0,0,.6), inset 0 1px 0 rgba(255,255,255,.06);
    }
    #lumen-1933 .dial{
      -webkit-appearance:none; appearance:none; width: 100%;
      height: 14px; border-radius: 999px; outline:none; margin-top: 14px;
      background:
        linear-gradient(90deg,
          hsl(var(--h) 92% 56%),
          hsl(calc(var(--h)+60) 86% 56%),
          hsl(calc(var(--h)-60) 90% 62%));
      border: 1px solid var(--line);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.65), 0 10px 22px rgba(0,0,0,.14);
    }
    #lumen-1933 .dial::-webkit-slider-thumb, #lumen-1933 .dial::-moz-range-thumb{
      -webkit-appearance:none; appearance:none; width:22px; height:22px; border-radius:50%;
      background: radial-gradient(100% 100% at 30% 30%, #fff, #e6ecff);
      border:1px solid rgba(0,0,0,.12);
      box-shadow: 0 10px 20px rgba(0,0,0,.22), 0 0 0 4px rgba(255,255,255,.28);
      cursor: ew-resize;
    }
    #lumen-1933 .readout{
      display:inline-flex; align-items:center; gap:10px; min-height:34px;
      padding:8px 12px; border-radius:12px; border: 1px solid var(--line);
      background: var(--glass); box-shadow: inset 0 1px 0 rgba(255,255,255,.72);
      color: var(--ink); font-variant-numeric: tabular-nums; font-size:12px;
      margin-top: 10px;
    }

    /* Meta */
    #lumen-1933 .meta{
      display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between; gap:12px;
      margin-top:28px; padding-top:16px; border-top: 1px dashed var(--line); color: var(--muted); font-size:12px; z-index:2; position:relative;
    }
    #lumen-1933 .ticker{
      --c: color-mix(in hsl, hsl(var(--h) 92% 60%) 56%, rgba(0,0,0,.4));
      display:inline-flex; gap:16px; align-items:center; white-space:nowrap;
      padding:6px 10px; border-radius:999px; border:1px dashed var(--line);
      background: color-mix(in hsl, #fff 50%, transparent);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.8);
      mask-image: linear-gradient(90deg, transparent, #000 10%, #000 90%, transparent);
      overflow:hidden; position:relative;
    }
    #lumen-1933 .ticker span{ color: var(--muted); }
    #lumen-1933 .dot{
      display:inline-block; width:6px; height:6px; border-radius:50%;
      background: var(--c);
      box-shadow: 0 0 0 3px color-mix(in hsl, var(--c) 20%, transparent);
      animation: blink-1933 2.4s ease-in-out infinite;
    }

    /* Watermark */
    #lumen-1933 .wm{
      position:absolute; left: 12px; top: -8px; pointer-events:none; user-select:none; z-index:0;
      font-weight: 1000; font-size: clamp(86px, 15.5vw, 180px); line-height:1; letter-spacing:-2px;
      color: transparent;
      -webkit-text-stroke: 1px color-mix(in hsl, hsl(var(--h) 90% 52%) 60%, rgba(0,0,0,.28));
      text-stroke: 1px color-mix(in hsl, hsl(var(--h) 90% 52%) 60%, rgba(0,0,0,.28));
      opacity:.12; transform: rotate(-6deg); filter: blur(.3px);
    }

    /* Motion */
    @keyframes slideHue-1933{ 0%,100%{ background-position: 0% 50%; } 50%{ background-position: 100% 50%; } }
    @keyframes ring-1933{ to{ transform: rotate(360deg);} }
    @keyframes grain-1933{ to{ transform: rotate(.6deg) translateY(.2px); filter: hue-rotate(1deg) contrast(1.02);} }
    @keyframes blink-1933{ 0%,100%{ opacity:.5; transform: scale(1);} 50%{ opacity:1; transform: scale(1.1);} }

    @media (prefers-reduced-motion: reduce){
      #lumen-1933 h1, #lumen-1933 .viewport::after, #lumen-1933::after{ animation: none !important; }
    }
  </style>

  <div class="wrap">
    <div class="copy">
      <span class="badge">Kinetic Loom — Edition 1933</span>
      <h1>Bend the horizon.</h1>
      <p class="sub">
        A diamond window of flowing ribbons. Nudge the field with your pointer, tune the flow, and let geometry breathe.
      </p>

      <div class="controls" role="toolbar" aria-label="Controls">
        <button class="chip" id="theme-1933" type="button" aria-label="Toggle Theme">Night</button>
        <button class="chip" id="palette-1933" type="button" aria-label="Shuffle Palette">Pulse</button>
        <button class="chip" id="save-1933" type="button" aria-label="Save Still">Still</button>
      </div>

      <input id="flow-1933" class="dial" type="range" min="0.20" max="3.00" step="0.01" value="1.00" aria-label="Flow">
      <div id="readout-1933" class="readout" aria-live="polite">Flow: 1.00 • Theme: day</div>
    </div>

    <div class="viewport" id="vp1933" aria-label="Diamond viewport with kinetic ribbons reacting to your pointer">
      <canvas id="loomCanvas1933" role="img" aria-label="Color ribbons drifting across a diamond lattice"></canvas>
    </div>
  </div>

  <div class="wm" aria-hidden="true">1933</div>

  <div class="meta">
    <div class="ticker" aria-hidden="true">
      <span>— luminous threads</span><i class="dot" aria-hidden="true"></i>
      <span>— gentle velocity</span><i class="dot" aria-hidden="true"></i>
      <span>— measured drift</span><i class="dot" aria-hidden="true"></i>
    </div>
    <span id="last-updated">Last updated: 2026-01-13 12:24:57 EST</span>
  </div>

  <script>
    (function(){
      const root   = document.getElementById('lumen-1933');
      const vp     = document.getElementById('vp1933');
      const canvas = document.getElementById('loomCanvas1933');
      const ctx    = canvas.getContext('2d', { alpha: true });

      const bTheme = document.getElementById('theme-1933');
      const bPulse = document.getElementById('palette-1933');
      const bSave  = document.getElementById('save-1933');

      const sFlow  = document.getElementById('flow-1933');
      const read   = document.getElementById('readout-1933');
      const stamp  = document.getElementById('last-updated');

      const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      let W=0, H=0, running=true;

      let FLOW = parseFloat(sFlow.value);
      const pointer = { x:.5, y:.5, tx:.5, ty:.5, inside:false };
      let hueJolt = 0;

      function updateStamp(){
        try{
          const now = new Date();
          const opts = { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' };
          stamp.textContent = 'Updated ' + now.toLocaleString(undefined, opts);
        }catch(_){
          stamp.textContent = 'Updated just now';
        }
      }

      function getHue(){ return parseInt(getComputedStyle(root).getPropertyValue('--h')) || 290; }
      function setHue(h){ const hue = ((h%360)+360)%360; root.style.setProperty('--h', hue); flash(); updateStamp(); }
      function shuffleHue(){ setHue(Math.floor(Math.random()*360)); hueJolt = 1; }

      function flash(){
        root.style.transition = 'filter .3s ease';
        root.style.filter = 'saturate(1.24)';
        setTimeout(()=>{ root.style.filter='none'; root.style.transition=''; }, 320);
      }

      function toggleTheme(force){
        const on = typeof force === 'boolean' ? force : !root.hasAttribute('data-dark');
        if(on){ root.setAttribute('data-dark','true'); bTheme.textContent='Day'; }
        else  { root.removeAttribute('data-dark'); bTheme.textContent='Night'; }
        syncReadout();
        flash();
        updateStamp();
      }
      function setFlow(v){
        FLOW = Math.max(0.20, Math.min(3.00, parseFloat(v)||1.0));
        syncReadout();
      }
      function syncReadout(){
        const theme = root.hasAttribute('data-dark') ? 'night' : 'day';
        read.textContent = `Flow: ${FLOW.toFixed(2)} • Theme: ${theme}`;
      }

      function resize(){
        const r = vp.getBoundingClientRect();
        const w = Math.max(2, Math.floor(r.width * DPR));
        const h = Math.max(2, Math.floor(r.height * DPR));
        W = w; H = h;
        canvas.width = W; canvas.height = H;
        canvas.style.width = r.width + 'px'; canvas.style.height = r.height + 'px';
        drawOne(performance.now());
      }

      // Pointer interactions
      vp.addEventListener('pointermove', (e)=>{
        const r = vp.getBoundingClientRect();
        const px = Math.max(0, Math.min(1, (e.clientX - r.left) / r.width));
        const py = Math.max(0, Math.min(1, (e.clientY - r.top) / r.height));
        pointer.tx = px; pointer.ty = py; pointer.inside = true;

        // Tilt diamond
        const dx = (px - 0.5) * 16;
        const dy = (0.5 - py) * 14;
        vp.style.transform = `rotate(7deg) perspective(900px) rotateX(${dy}deg) rotateY(${dx}deg)`;
      });
      vp.addEventListener('mouseleave', ()=>{
        pointer.inside = false;
        vp.style.transform = 'rotate(7deg)';
      });

      // Controls
      bTheme.addEventListener('click', toggleTheme);
      bPulse.addEventListener('click', shuffleHue);
      bSave.addEventListener('click', ()=>{
        try{
          const a = document.createElement('a');
          a.href = canvas.toDataURL('image/png');
          a.download = 'kinetic-loom-1933.png';
          a.click();
        }catch(_){}
      });
      sFlow.addEventListener('input', ()=> setFlow(sFlow.value));

      window.addEventListener('keydown', (e)=>{
        const k = e.key.toLowerCase();
        if(k==='t') bTheme.click();
        if(k==='p') bPulse.click();
        if(k==='s') bSave.click();
        if(k==='['){ sFlow.value = Math.max(0.20, parseFloat(sFlow.value)-0.02).toFixed(2); sFlow.dispatchEvent(new Event('input')); }
        if(k===']'){ sFlow.value = Math.min(3.00, parseFloat(sFlow.value)+0.02).toFixed(2); sFlow.dispatchEvent(new Event('input')); }
        if(k===' '){ hueJolt = 1; }
      });

      // KINETIC RIBBONS
      const CFG = { ribbons: 18, steps: 140, stepLen: 3.6, thickness: 2.5 };
      const particlePool = new Array(CFG.ribbons).fill(0).map(()=>({ x:0, y:0, seed: Math.random()*1000, hue:0, wob: Math.random()*10 }));

      function noise(x, y, t){
        // lightweight pseudo-noise from trigs
        return Math.sin(x*0.018 + t*0.6) + Math.cos(y*0.021 - t*0.45) + Math.sin((x+y)*0.008 + t*0.25);
      }

      function flowAngle(x, y, t){
        const n = noise(x, y, t);
        return n*1.8 + Math.sin((x*0.006 + y*0.004) + t*0.2)*0.8;
      }

      function initParticles(){
        const baseHue = getHue();
        for(let i=0;i<particlePool.length;i++){
          const p = particlePool[i];
          // scatter along a ring-ish band
          const ang = Math.random()*Math.PI*2;
          const rad = Math.min(W,H)* (0.18 + Math.random()*0.34);
          p.x = W*0.5 + Math.cos(ang)*rad;
          p.y = H*0.5 + Math.sin(ang)*rad;
          p.seed = Math.random()*1000;
          p.hue = (baseHue + i*(360/particlePool.length)) % 360;
        }
      }

      function backdrop(night, t){
        const g = ctx.createRadialGradient(W*0.5, H*0.5, 0, W*0.5, H*0.5, Math.min(W,H)*0.62);
        const base = getHue();
        g.addColorStop(0, `hsla(${(base+20)%360}, 80%, ${night?14:96}%, ${night?.10:.18})`);
        g.addColorStop(1, `hsla(${(base-60+360)%360}, 80%, ${night?10:92}%, ${night?.06:.10})`);
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = g;
        ctx.fillRect(0,0,W,H);

        // soft vignette spin
        ctx.save();
        ctx.translate(W*0.5,H*0.5);
        ctx.rotate(t*0.02);
        const g2 = ctx.createRadialGradient(0,0,0, 0,0, Math.min(W,H)*0.52);
        g2.addColorStop(0, 'rgba(255,255,255,0.02)');
        g2.addColorStop(1, night ? 'rgba(0,0,0,0.07)' : 'rgba(255,255,255,0.06)');
        ctx.fillStyle = g2;
        ctx.beginPath();
        ctx.arc(0,0,Math.min(W,H)*0.52,0,Math.PI*2);
        ctx.fill();
        ctx.restore();
      }

      function drawRibbons(t, night){
        const cx = W*0.5 + (pointer.x-0.5)*W*0.08;
        const cy = H*0.5 + (pointer.y-0.5)*H*0.08;

        ctx.save();
        ctx.globalCompositeOperation = night ? 'screen' : 'lighter';

        for(let i=0;i<particlePool.length;i++){
          const p = particlePool[i];

          // slight pull toward pointer target
          p.x += (cx - p.x) * 0.002 * (pointer.inside ? 1.6 : 0.6) * FLOW;
          p.y += (cy - p.y) * 0.002 * (pointer.inside ? 1.6 : 0.6) * FLOW;

          let x = p.x, y = p.y;
          const hue = (p.hue + hueJolt*20) % 360;
          const widthBase = (CFG.thickness + (Math.sin(t*1.2 + p.wob)*0.6 + 0.8)) * DPR;

          for(let s=0; s<CFG.steps; s++){
            const ang = flowAngle(x + Math.sin(t*0.6)*60, y + Math.cos(t*0.4)*60, t) + (i*0.02);
            const vx = Math.cos(ang) * CFG.stepLen * FLOW * DPR;
            const vy = Math.sin(ang) * CFG.stepLen * FLOW * DPR;

            const nx = x + vx;
            const ny = y + vy;

            const prog = s/CFG.steps;
            const l = widthBase * (1.0 - prog*0.85);
            const lightness = night ? 78 : 58 + (1-prog)*10;
            const alpha = (night ? 0.22 : 0.18) * (1.0 - prog*0.6);

            ctx.strokeStyle = `hsla(${(hue + prog*120)%360}, 98%, ${lightness}%, ${alpha})`;
            ctx.lineWidth = Math.max(0.6, l);
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(nx, ny);
            ctx.stroke();

            x = nx; y = ny;

            // soft wrapping inside diamond-ish bounds
            const dx = x - W*0.5, dy = y - H*0.5;
            const m = Math.hypot(dx,dy);
            const maxR = Math.min(W,H)*0.5*0.96;
            if(m > maxR){
              const a = Math.atan2(dy,dx)+Math.PI*0.6;
              x = W*0.5 + Math.cos(a) * (maxR-10);
              y = H*0.5 + Math.sin(a) * (maxR-10);
            }
          }

          // update particle head for next frame
          p.x = x; p.y = y;
        }

        ctx.restore();
        hueJolt += (0 - hueJolt) * 0.06;
      }

      function drawOne(now){
        const t = now*0.001;
        const night = root.hasAttribute('data-dark');

        // smooth pointer
        pointer.x += (pointer.tx - pointer.x) * 0.08;
        pointer.y += (pointer.ty - pointer.y) * 0.08;

        backdrop(night, t);
        drawRibbons(t, night);
      }

      function loop(now){ if(!running) return; drawOne(now); requestAnimationFrame(loop); }

      // init
      function init(){
        // Theme from system
        const sysDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        toggleTheme(sysDark);
        // Palette from time
        const now = new Date();
        const dayHue = (now.getHours()/24)*360;
        setHue(dayHue);

        resize();
        initParticles();
        setFlow(sFlow.value);
        updateStamp();

        const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if(!prefersReduced){ requestAnimationFrame(loop); }
        else { running=false; drawOne(performance.now()); }
      }

      window.addEventListener('resize', ()=>{
        const was = running;
        running = false;
        resize();
        initParticles();
        if(was){ running = true; requestAnimationFrame(loop); }
        else { drawOne(performance.now()); }
      });

      init();
    }());
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


