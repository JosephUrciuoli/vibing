<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="bloom671" data-theme="porcelain" data-motion="on" role="region" aria-label="Bloom 671 — kinetic poster studio">
  <style>
    .bloom671 {
      --r: 26px;
      --ink: 16, 24, 40;
      --muted: 82, 94, 112;
      --bg1: #fcfcff; --bg2: #f7f4ff; --bg3: #fff8f1;
      --a1: #7c3aed; --a2: #06b6d4; --a3: #f59e0b; --a4: #ef4444;
      --glass: rgba(255,255,255,.6);
      --border: rgba(16,24,40,.08);
      --shadow: 0 30px 80px rgba(16,24,40,.12), inset 0 1px 0 rgba(255,255,255,.7);
      position: relative;
      border-radius: var(--r);
      padding: clamp(16px, 4.5vmin, 56px);
      color: rgb(var(--ink));
      font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Display", Inter, "Segoe UI", Roboto, Helvetica, Arial;
      background:
        radial-gradient(140% 120% at 0% 0%, color-mix(in srgb, var(--a2), transparent 92%), transparent 60%),
        radial-gradient(140% 140% at 100% 0%, color-mix(in srgb, var(--a1), transparent 92%), transparent 58%),
        radial-gradient(160% 160% at 100% 100%, color-mix(in srgb, var(--a3), transparent 93%), transparent 62%),
        linear-gradient(180deg, var(--bg1), var(--bg2) 55%, var(--bg3));
      box-shadow: var(--shadow);
      overflow: clip;
      isolation: isolate;
      transform: perspective(1200px) rotateX(calc(var(--my, 0) * -2deg)) rotateY(calc(var(--mx, 0) * 4deg));
      transition: transform .25s cubic-bezier(.2,.8,.2,1), background .4s ease;
    }
    .bloom671::after {
      content: "";
      position: absolute; inset: -20%;
      pointer-events: none;
      background:
        conic-gradient(from 180deg at 60% 40%, rgba(0,0,0,.06), transparent 20% 40%, rgba(0,0,0,.05), transparent 60% 80%, rgba(255,255,255,.06)),
        radial-gradient(120% 100% at 45% 55%, rgba(255,255,255,.45), transparent 50%);
      mix-blend-mode: soft-light;
      opacity: .35;
      animation: b671-sheen 22s linear infinite;
    }
    @keyframes b671-sheen { 0% { transform: translate3d(0,0,0) rotate(0deg);} 50% { transform: translate3d(1%, -1%, 0) rotate(.7deg);} 100% { transform: translate3d(0,0,0) rotate(0deg);} }

    /* Themes */
    .bloom671[data-theme="porcelain"] { --bg1:#fcfcff; --bg2:#f7f4ff; --bg3:#fff8f1; --a1:#7c3aed; --a2:#06b6d4; --a3:#f59e0b; --a4:#22c55e; --ink:16,24,40; --glass: rgba(255,255,255,.62); --border: rgba(16,24,40,.08); }
    .bloom671[data-theme="dusk"]      { --bg1:#171923; --bg2:#0f172a; --bg3:#0b1220; --a1:#8b5cf6; --a2:#22d3ee; --a3:#f472b6; --a4:#34d399; --ink:236,242,248; --glass: rgba(255,255,255,.08); --border: rgba(255,255,255,.14); }
    .bloom671[data-theme="noir"]      { --bg1:#0a0b0f; --bg2:#0a0a0a; --bg3:#0a0a0a; --a1:#60a5fa; --a2:#38bdf8; --a3:#fde68a; --a4:#f472b6; --ink:240,245,255; --glass: rgba(255,255,255,.07); --border: rgba(255,255,255,.12); }

    .bloom671 .mast {
      position: relative; z-index: 3;
      display: grid; grid-template-columns: 1fr auto; gap: 14px; align-items: end;
      margin-bottom: clamp(12px, 3.6vmin, 28px);
    }
    .bloom671 .title {
      display: grid; gap: 6px;
    }
    .bloom671 h1 {
      margin: 0;
      font-family: ui-serif, Georgia, "Times New Roman", serif;
      font-weight: 900;
      font-size: clamp(42px, 10vw, 120px);
      letter-spacing: -0.04em;
      line-height: .84;
      background: linear-gradient(90deg, color-mix(in srgb, var(--a1), #000 15%), color-mix(in srgb, var(--a2), #000 10%), color-mix(in srgb, var(--a3), #000 10%));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      filter: drop-shadow(0 12px 34px rgba(16,24,40,.18));
    }
    .bloom671 .tag {
      margin: 0;
      color: rgba(var(--muted), .95);
      font-weight: 600;
      letter-spacing: .02em;
      font-size: clamp(12px, 1.8vmin, 16px);
    }

    .bloom671 .hud {
      display: flex; flex-wrap: wrap; gap: 10px;
      align-items: center; justify-content: flex-end;
    }
    .bloom671 .btn {
      appearance: none; cursor: pointer; user-select: none; border: none;
      border-radius: 999px; font-weight: 800; letter-spacing: .05em;
      font-size: 12px; padding: 10px 14px;
      color: rgb(var(--ink));
      background:
        linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.55)) padding-box;
      border: 1px solid var(--border);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9), 0 14px 32px rgba(16,24,40,.12);
      backdrop-filter: blur(8px) saturate(160%);
      transition: transform .18s cubic-bezier(.2,.7,.2,1), box-shadow .18s cubic-bezier(.2,.7,.2,1);
    }
    .bloom671[data-theme="dusk"] .btn,
    .bloom671[data-theme="noir"] .btn {
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      color: rgb(var(--ink));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.25), 0 14px 32px rgba(0,0,0,.4);
    }
    .bloom671 .btn:hover { transform: translateY(-2px); }
    .bloom671 .btn.primary {
      color: #0a0f1a;
      background: linear-gradient(180deg, color-mix(in srgb, var(--a2), #fff 58%), color-mix(in srgb, var(--a1), #000 6%));
      border-color: color-mix(in srgb, var(--a2), #000 45%);
      text-shadow: 0 1px 0 rgba(255,255,255,.5);
    }
    .bloom671[data-theme="dusk"] .btn.primary,
    .bloom671[data-theme="noir"] .btn.primary {
      color: #06121c;
    }

    .bloom671 .stage {
      position: relative; z-index: 1;
      height: clamp(420px, 60vmin, 860px);
      border-radius: 22px;
      border: 1px solid var(--border);
      background:
        radial-gradient(120% 100% at 50% 0%, rgba(255,255,255,.75), rgba(255,255,255,.35));
      box-shadow: 0 40px 120px rgba(16,24,40,.18), inset 0 1px 0 rgba(255,255,255,.7);
      overflow: hidden;
      transform: translateZ(0);
    }
    .bloom671 canvas#bloom {
      position: absolute; inset: 0; width: 100%; height: 100%;
      filter: saturate(var(--sat, 120%)) blur(var(--blur, 4px)) contrast(108%);
    }

    .bloom671 .panel {
      position: absolute; inset: auto 12px 12px 12px;
      display: grid; gap: 10px;
      background: var(--glass); border: 1px solid var(--border);
      border-radius: 16px; padding: 10px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7), 0 18px 48px rgba(16,24,40,.14);
      backdrop-filter: blur(10px) saturate(160%);
    }
    .bloom671 .row { display: flex; flex-wrap: wrap; align-items: center; gap: 10px; }
    .bloom671 .chip {
      padding: 8px 12px; border-radius: 999px;
      background: rgba(255,255,255,.7);
      border: 1px solid var(--border);
      color: rgb(var(--ink));
      font-weight: 800; letter-spacing: .035em;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9);
    }
    .bloom671[data-theme="dusk"] .chip,
    .bloom671[data-theme="noir"] .chip {
      background: rgba(255,255,255,.08);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.25);
    }

    .bloom671 label.range {
      display: inline-flex; align-items: center; gap: 10px;
      padding: 8px 10px; border-radius: 12px; border: 1px solid var(--border);
      background: rgba(255,255,255,.7);
      color: rgb(var(--ink)); font-weight: 800; letter-spacing: .02em;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9);
    }
    .bloom671[data-theme="dusk"] label.range,
    .bloom671[data-theme="noir"] label.range {
      background: rgba(255,255,255,.08);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.25);
    }
    .bloom671 input[type="range"] { appearance: none; width: 160px; height: 28px; background: transparent; }
    .bloom671 input[type="range"]::-webkit-slider-runnable-track { height: 6px; border-radius: 999px; background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3), var(--a4)); }
    .bloom671 input[type="range"]::-webkit-slider-thumb {
      appearance: none; width: 18px; height: 18px; border-radius: 50%; margin-top: -6px;
      background: #fff; border: 1px solid rgba(0,0,0,.14); box-shadow: 0 10px 24px rgba(0,0,0,.25);
    }
    .bloom671 input[type="range"]::-moz-range-track { height: 6px; border-radius: 999px; background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3), var(--a4)); }
    .bloom671 input[type="range"]::-moz-range-thumb {
      width: 18px; height: 18px; border-radius: 50%; border: 1px solid rgba(0,0,0,.14);
      background: #fff; box-shadow: 0 10px 24px rgba(0,0,0,.25);
    }

    .bloom671 .footer {
      margin-top: 12px;
      display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px;
      color: rgba(var(--muted), .95); font-size: 12px;
    }
    .bloom671 .pulse { display: inline-flex; align-items: center; gap: 8px; }
    .bloom671 .dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--a2);
      box-shadow: 0 0 0 0 color-mix(in srgb, var(--a2), transparent 40%);
      animation: b671-pulse 1.8s ease-in-out infinite;
    }
    @keyframes b671-pulse { 0%{box-shadow:0 0 0 0 color-mix(in srgb, var(--a2), transparent 40%); transform:scale(1)} 70%{box-shadow:0 0 0 10px transparent; transform:scale(1.1)} 100%{box-shadow:0 0 0 0 transparent; transform:scale(1)} }

    @media (prefers-reduced-motion: reduce) {
      .bloom671, .bloom671 * { animation: none !important; transition: none !important; }
      .bloom671 { --mx: 0; --my: 0; }
    }
    @media (max-width: 840px) {
      .bloom671 .stage { height: clamp(360px, 66vmin, 760px); }
      .bloom671 .hud { justify-content: flex-start; }
      .bloom671 label.range { width: 100%; justify-content: space-between; }
    }
  </style>

  <div class="mast">
    <div class="title">
      <h1 aria-live="polite">BLOOM 671</h1>
      <p class="tag">A kinetic poster that paints with ribbons of math.</p>
    </div>
    <div class="hud" role="toolbar" aria-label="Controls">
      <button class="btn primary" data-action="motion" aria-pressed="true" title="Toggle motion">Pause</button>
      <button class="btn" data-action="theme" title="Cycle theme">Theme</button>
      <button class="btn" data-action="snap" title="Export image">Export</button>
    </div>
  </div>

  <div class="stage" aria-label="Bloom ribbons canvas">
    <canvas id="bloom" aria-hidden="true"></canvas>

    <div class="panel" role="group" aria-label="Live status and tuning">
      <div class="row">
        <span class="chip" data-chip="theme">Theme: porcelain</span>
        <span class="chip pulse"><span class="dot" aria-hidden="true"></span>live</span>
        <span class="chip"><span id="last-updated">Last updated: 2025-11-16 04:16:59 EST</span></span>
      </div>
      <div class="row">
        <label class="range" for="density">Density
          <input id="density" type="range" min="6" max="40" step="1" value="18" aria-label="Ribbon count">
        </label>
        <label class="range" for="tempo">Tempo
          <input id="tempo" type="range" min="0.2" max="2.5" step="0.05" value="1" aria-label="Animation tempo">
        </label>
        <label class="range" for="soften">Softness
          <input id="soften" type="range" min="0" max="14" step="1" value="4" aria-label="Blur amount">
        </label>
      </div>
    </div>
  </div>

  <div class="footer">
    <span>Tip: Drag to bend the bloom • T theme • Space pause • S export</span>
    <span>Hold click for pulse rings</span>
  </div>

  <script>
    (function(){
      const root = document.currentScript.closest('.bloom671');
      const canvas = root.querySelector('#bloom');
      const ctx = canvas.getContext('2d', { alpha: false });
      const stage = root.querySelector('.stage');

      const btnMotion = root.querySelector('[data-action="motion"]');
      const btnTheme  = root.querySelector('[data-action="theme"]');
      const btnSnap   = root.querySelector('[data-action="snap"]');
      const chipTheme = root.querySelector('[data-chip="theme"]');
      const h1 = root.querySelector('h1');

      // Inputs
      const rDensity = root.querySelector('#density');
      const rTempo   = root.querySelector('#tempo');
      const rSoft    = root.querySelector('#soften');

      // Last updated
      const lu = root.querySelector('#last-updated');
      const now = new Date();
      try { lu.textContent = 'Updated ' + now.toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'short' }); }
      catch { lu.textContent = 'Updated ' + now.toString(); }

      // DPI + size
      let dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      function fit(){
        const rect = stage.getBoundingClientRect();
        const w = Math.max(1, Math.floor(rect.width));
        const h = Math.max(1, Math.floor(rect.height));
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        canvas.style.width = w + 'px';
        canvas.style.height = h + 'px';
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }
      new ResizeObserver(fit).observe(stage);
      fit();

      // Theme palette
      const THEMES = {
        porcelain: ['#7c3aed','#06b6d4','#f59e0b','#22c55e','#ef4444','#0ea5e9'],
        dusk:      ['#8b5cf6','#22d3ee','#f472b6','#34d399','#60a5fa','#fde68a'],
        noir:      ['#60a5fa','#38bdf8','#fde68a','#f472b6','#a7f3d0','#e879f9']
      };
      const order = ['porcelain','dusk','noir'];
      let theme = root.dataset.theme || 'porcelain';
      let palette = THEMES[theme].slice();

      function applyTheme(name){
        theme = name;
        palette = THEMES[name].slice();
        root.dataset.theme = name;
        chipTheme.textContent = 'Theme: ' + name;
        h1.animate([{letterSpacing:'-0.04em'},{letterSpacing:'-0.015em'},{letterSpacing:'-0.04em'}], {duration:420, easing:'cubic-bezier(.2,.8,.2,1)'});
        root.style.setProperty('--sat', theme === 'noir' ? '145%' : theme === 'dusk' ? '135%' : '120%');
      }
      btnTheme.addEventListener('click', () => {
        const idx = (order.indexOf(theme)+1) % order.length;
        applyTheme(order[idx]);
        seed(true);
      });

      // Motion control
      function setMotion(on){
        root.dataset.motion = on ? 'on' : 'off';
        btnMotion.setAttribute('aria-pressed', String(on));
        btnMotion.textContent = on ? 'Pause' : 'Resume';
      }
      btnMotion.addEventListener('click', () => setMotion(root.dataset.motion !== 'on'));
      if (matchMedia && matchMedia('(prefers-reduced-motion: reduce)').matches) setMotion(false);

      // Controls
      let density = parseInt(rDensity.value, 10);
      let tempo   = parseFloat(rTempo.value);
      let blur    = parseInt(rSoft.value, 10);
      rDensity.addEventListener('input', () => { density = parseInt(rDensity.value,10); remakeRibbons(); });
      rTempo.addEventListener('input', () => { tempo = parseFloat(rTempo.value); });
      rSoft.addEventListener('input', () => { blur = parseInt(rSoft.value,10); canvas.style.setProperty('--blur', blur + 'px'); });
      canvas.style.setProperty('--blur', blur + 'px');

      // Parallax tilt
      function onPointer(e){
        const r = root.getBoundingClientRect();
        const x = ((e.clientX - r.left)/r.width - .5) * 2;
        const y = ((e.clientY - r.top)/r.height - .5) * 2;
        root.style.setProperty('--mx', (x*4).toFixed(2));
        root.style.setProperty('--my', (y*3).toFixed(2));
      }
      root.addEventListener('mousemove', onPointer, { passive:true });
      root.addEventListener('mouseleave', () => { root.style.removeProperty('--mx'); root.style.removeProperty('--my'); });

      // Model
      const TWO = Math.PI*2;
      let ribbons = [];
      let pulses = [];
      let t = 0;
      let last = performance.now();
      let pointer = { x: stage.clientWidth/2, y: stage.clientHeight/2, down:false };
      let target = { x: pointer.x, y: pointer.y };

      function rand(a,b){ return a + Math.random()*(b-a); }
      function choice(arr){ return arr[(Math.random()*arr.length)|0]; }

      function makeRibbon(i){
        const color = choice(palette);
        return {
          base: rand(60, 220),
          weight: rand(0.6, 1.8),
          freq: Math.round(rand(2, 6)),
          phase: rand(0, TWO),
          rot: rand(-0.6, 0.6),
          hue: color,
          tw: Math.random()*1000 + i*37
        };
      }
      function remakeRibbons(){
        ribbons = [];
        for (let i=0;i<density;i++) ribbons.push(makeRibbon(i));
      }
      function seed(recolor=false){
        if (recolor) {
          for (let i=0;i<ribbons.length;i++) ribbons[i].hue = choice(palette);
        }
        pulses.push({ x: target.x, y: target.y, r: 10, grow: rand(90,180), life: 1, color: choice(palette) });
        if (pulses.length>10) pulses.splice(0, pulses.length-10);
      }

      remakeRibbons();
      seed();

      // Pointer interactions
      stage.addEventListener('pointerdown', (e) => {
        const r = stage.getBoundingClientRect();
        target.x = e.clientX - r.left;
        target.y = e.clientY - r.top;
        pointer.down = true;
        seed();
        stage.setPointerCapture && stage.setPointerCapture(e.pointerId);
      });
      stage.addEventListener('pointermove', (e) => {
        if (!pointer.down && (e.buttons & 1) === 0) return;
        const r = stage.getBoundingClientRect();
        target.x = e.clientX - r.left;
        target.y = e.clientY - r.top;
        if (pointer.down) pulses.push({ x: target.x, y: target.y, r: 6, grow: rand(120,200), life: 1, color: choice(palette) });
      });
      addEventListener('pointerup', () => { pointer.down = false; });

      // Export
      btnSnap.addEventListener('click', () => {
        try {
          const a = document.createElement('a');
          a.href = canvas.toDataURL('image/png');
          a.download = 'bloom-671.png';
          a.click();
        } catch(e){}
      });

      // Draw helpers
      function drawRibbon(rib, time, cx, cy){
        const W = stage.clientWidth, H = stage.clientHeight;
        const radBase = Math.min(W, H) * 0.35 + rib.base;
        ctx.lineWidth = rib.weight;
        ctx.strokeStyle = rib.hue + 'cc';
        ctx.globalAlpha = 0.85;
        ctx.beginPath();
        const k = rib.freq;
        const spin = rib.rot * time*0.2;
        const amp = 0.28 + 0.08*Math.sin((time*0.6 + rib.tw)*0.002);
        const step = 0.06;
        for (let a=0; a<=TWO+step; a+=step){
          const wave = Math.sin(a*k + time*0.002*tempo + rib.phase);
          const r = radBase * (0.75 + amp*wave);
          const x = cx + r * Math.cos(a + spin);
          const y = cy + r * Math.sin(a + spin);
          if (a===0) ctx.moveTo(x,y);
          else ctx.lineTo(x,y);
        }
        ctx.stroke();
      }

      function drawPulse(p){
        const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r);
        grad.addColorStop(0, p.color + 'cc');
        grad.addColorStop(.5, p.color + '55');
        grad.addColorStop(1, '#00000000');
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, TWO);
        ctx.fill();
      }

      // Animation
      function tick(ts){
        const dt = Math.max(0.016, Math.min(0.06, (ts - last)/1000));
        last = ts;
        t += dt * 1000 * tempo;

        // Fit if resized
        const w = stage.clientWidth, h = stage.clientHeight;
        if (canvas.width !== Math.floor(w*dpr) || canvas.height !== Math.floor(h*dpr)) fit();

        // smooth center to pointer target
        pointer.x += (target.x - pointer.x) * 0.08;
        pointer.y += (target.y - pointer.y) * 0.08;

        // background fade (trails)
        ctx.globalCompositeOperation = 'source-over';
        const fade = theme === 'noir' ? 0.08 : theme === 'dusk' ? 0.06 : 0.08;
        const bg = theme === 'porcelain' ? `rgba(255,255,255,${fade})` : `rgba(0,0,0,${fade})`;
        ctx.fillStyle = bg;
        ctx.fillRect(0,0,w,h);

        // luminous ribbons
        ctx.globalCompositeOperation = theme === 'porcelain' ? 'multiply' : 'lighter';
        for (let i=0;i<ribbons.length;i++) drawRibbon(ribbons[i], t, pointer.x, pointer.y);

        // pulses overlay
        ctx.globalCompositeOperation = 'screen';
        for (let i=pulses.length-1; i>=0; i--){
          const p = pulses[i];
          p.r += dt * p.grow * (0.6 + 0.4*Math.sin((t*0.001 + i)*0.8));
          p.life -= dt * 0.5;
          ctx.globalAlpha = Math.max(0, Math.min(1, p.life));
          drawPulse(p);
          if (p.life <= 0) pulses.splice(i,1);
        }
        ctx.globalAlpha = 1;

        // title shimmer
        h1.style.backgroundPosition = `${(ts * 0.04) % 240}% 0%`;

        if (root.dataset.motion === 'on') requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);

      // visibility
      document.addEventListener('visibilitychange', () => { if (document.hidden) setMotion(false); });

      // keyboard
      addEventListener('keydown', (e) => {
        const k = e.key.toLowerCase();
        if (k === 't') { e.preventDefault(); btnTheme.click(); }
        if (e.code === 'Space') { e.preventDefault(); btnMotion.click(); }
        if (k === 's') { e.preventDefault(); btnSnap.click(); }
        if (k === '+' || k === '=') { e.preventDefault(); rDensity.value = Math.min(40, parseInt(rDensity.value,10)+1); density = parseInt(rDensity.value,10); remakeRibbons(); }
        if (k === '-' || k === '_') { e.preventDefault(); rDensity.value = Math.max(6, parseInt(rDensity.value,10)-1); density = parseInt(rDensity.value,10); remakeRibbons(); }
      });

      // init
      applyTheme(theme);
      // gentle center
      const rect = stage.getBoundingClientRect();
      target.x = rect.width * 0.52; target.y = rect.height * 0.48;
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


