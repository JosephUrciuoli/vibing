<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="vibe66" data-theme="dawn" data-palette="dawn" data-grid="false" aria-label="Kinetic Loom">
  <style>
    .vibe66 {
      /* Theme tokens */
      --ink: #0e1220;
      --muted: #4c556a;
      --line: rgba(0, 0, 0, 0.12);

      /* Palette tokens (overridden by [data-palette]) */
      --p1: #fb7185; /* dawn coral */
      --p2: #f59e0b; /* dawn amber */
      --p3: #f472b6; /* dawn pink */

      --bg0: #ffffff;
      --bg1: #f7f9ff;

      --mx: 50%;
      --my: 50%;

      position: relative;
      min-height: 760px;
      border-radius: 40px;
      overflow: hidden;
      color: var(--ink);
      background:
        radial-gradient(1200px 900px at var(--mx) var(--my), color-mix(in srgb, var(--p2), transparent 88%), transparent 60%),
        radial-gradient(900px 700px at calc(100% - var(--mx)) calc(100% - var(--my)), color-mix(in srgb, var(--p3), transparent 90%), transparent 70%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      box-shadow:
        0 40px 120px rgba(0, 0, 0, 0.18),
        inset 0 1px 0 rgba(255, 255, 255, 0.7);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      isolation: isolate;
    }

    .vibe66::before {
      content: "";
      position: absolute; inset: -30%;
      background:
        conic-gradient(from 0deg at 50% 50%,
          color-mix(in srgb, var(--p1), transparent 80%),
          color-mix(in srgb, var(--p2), transparent 82%),
          color-mix(in srgb, var(--p3), transparent 80%),
          color-mix(in srgb, var(--p1), transparent 80%));
      filter: blur(70px) saturate(140%);
      opacity: .28;
      transform: translateZ(0);
      animation: v66_spin 80s linear infinite;
      pointer-events: none;
      mix-blend-mode: multiply;
    }

    .vibe66[data-theme="dusk"] {
      --ink: #eef2ff;
      --muted: #a9b2c8;
      --line: rgba(255,255,255,0.14);
      --bg0: #0b0f18;
      --bg1: #0e1422;
      background:
        radial-gradient(1300px 1000px at var(--mx) var(--my), color-mix(in srgb, var(--p2), transparent 84%), transparent 60%),
        radial-gradient(900px 700px at 20% 10%, color-mix(in srgb, var(--p3), transparent 88%), transparent 70%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      box-shadow: 0 50px 140px rgba(0,0,0,0.55), inset 0 1px 0 rgba(255,255,255,0.06);
    }

    /* Palettes */
    .vibe66[data-palette="dawn"]   { --p1:#fb7185; --p2:#f59e0b; --p3:#f472b6; }
    .vibe66[data-palette="reef"]   { --p1:#06b6d4; --p2:#22d3ee; --p3:#60a5fa; }
    .vibe66[data-palette="orchid"] { --p1:#a78bfa; --p2:#ec4899; --p3:#8b5cf6; }

    /* Optional grid overlay */
    .vibe66[data-grid="true"]::after {
      content: "";
      position: absolute; inset: 0;
      background:
        repeating-linear-gradient(0deg, rgba(0,0,0,0.06) 0 1px, transparent 1px 40px),
        repeating-linear-gradient(90deg, rgba(0,0,0,0.06) 0 1px, transparent 1px 40px);
      mix-blend-mode: overlay;
      opacity: .35;
      pointer-events: none;
    }
    .vibe66[data-theme="dusk"][data-grid="true"]::after {
      background:
        repeating-linear-gradient(0deg, rgba(255,255,255,0.07) 0 1px, transparent 1px 40px),
        repeating-linear-gradient(90deg, rgba(255,255,255,0.07) 0 1px, transparent 1px 40px);
    }

    .vibe66 .frame {
      position: relative;
      z-index: 2;
      width: min(1100px, 92vw);
      margin: 0 auto;
      padding: clamp(20px, 4.2vw, 50px);
    }

    /* Header */
    .vibe66 .mast .tag {
      display: inline-flex; align-items: center; gap: 10px;
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 800; letter-spacing: .03em; text-transform: uppercase;
      color: var(--muted);
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.6));
      border: 1px solid var(--line);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.7);
    }
    .vibe66[data-theme="dusk"] .mast .tag {
      background: linear-gradient(180deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.15);
    }
    .vibe66 .mast .tag::before {
      content: "";
      width: 9px; height: 9px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, var(--p1), transparent 60%);
      box-shadow: 0 0 12px var(--p1);
    }
    .vibe66 h1 {
      margin: 14px 0 10px;
      font: 900 clamp(44px, 8.8vw, 108px)/1.02 ui-serif, Georgia, Cambria, "Times New Roman", serif;
      letter-spacing: -0.02em;
      color: var(--ink);
    }
    .vibe66 .accent {
      display: inline-block;
      height: 10px; width: 180px; border-radius: 999px;
      background: linear-gradient(90deg, var(--p1), var(--p2), var(--p3));
      filter: drop-shadow(0 8px 24px color-mix(in srgb, var(--p2), #000 60%));
    }
    .vibe66 .sub {
      margin: 18px 0 0; max-width: 70ch;
      font-size: clamp(14px, 2vw, 20px);
      color: color-mix(in srgb, var(--ink), #000 30%);
    }
    .vibe66[data-theme="dusk"] .sub {
      color: color-mix(in srgb, var(--ink), #000 15%);
    }

    /* Stage */
    .vibe66 .stage {
      position: relative;
      margin-top: clamp(20px, 4vw, 40px);
      border-radius: 26px;
      background: linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.55));
      border: 1px solid var(--line);
      box-shadow:
        0 30px 80px rgba(0,0,0,0.15),
        inset 0 1px 0 rgba(255,255,255,0.7);
      overflow: hidden;
      min-height: 420px;
    }
    .vibe66[data-theme="dusk"] .stage {
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      box-shadow:
        0 40px 100px rgba(0,0,0,0.55),
        inset 0 1px 0 rgba(255,255,255,0.06);
    }

    /* Canvas ribbons */
    .vibe66 .loom {
      position: relative;
      display: block;
      width: 100%;
      height: clamp(360px, 50vmin, 520px);
      border-radius: 24px;
      overflow: hidden;
    }
    .vibe66 canvas.weave {
      position: absolute; inset: 0; width: 100%; height: 100%;
      mix-blend-mode: multiply;
      filter: saturate(115%);
    }
    .vibe66[data-theme="dusk"] canvas.weave { mix-blend-mode: screen; }

    /* Floating tiles */
    .vibe66 .tiles {
      position: absolute; inset: 0; pointer-events: none;
    }
    .vibe66 .tile {
      position: absolute;
      width: clamp(120px, 16vmin, 220px); height: clamp(80px, 10vmin, 160px);
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.55));
      border: 1px solid var(--line);
      box-shadow: 0 18px 40px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.7);
      transform: translate3d(0,0,0) rotate(var(--r, 0deg));
    }
    .vibe66[data-theme="dusk"] .tile {
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
      box-shadow: 0 18px 50px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.12);
    }
    .vibe66 .tile::after {
      content: "";
      position: absolute; inset: 1px;
      border-radius: 15px;
      background: linear-gradient(135deg, color-mix(in srgb, var(--p1), transparent 85%), color-mix(in srgb, var(--p2), transparent 85%));
      -webkit-mask: linear-gradient(#000, #000) content-box, linear-gradient(#000, #000);
              mask: linear-gradient(#000, #000) content-box, linear-gradient(#000, #000);
      -webkit-mask-composite: xor; mask-composite: exclude;
      padding: 1px;
      opacity: .7;
    }
    .vibe66 .tile.t1 { left: 6%; top: 10%; --r: -6deg; }
    .vibe66 .tile.t2 { right: 10%; top: 16%; --r: 4deg; }
    .vibe66 .tile.t3 { left: 18%; bottom: 10%; --r: 7deg; }

    /* Controls */
    .vibe66 .controls {
      margin-top: 18px;
      display: flex; flex-wrap: wrap; gap: 12px; align-items: center;
    }
    .vibe66 .btn {
      appearance: none; border: 0; cursor: pointer; font-weight: 900; letter-spacing: .02em;
      border-radius: 14px; padding: 12px 16px; color: #0e1220;
      background: linear-gradient(135deg, var(--p1), var(--p2));
      box-shadow: 0 14px 36px color-mix(in srgb, var(--p1), #000 60%);
      transition: transform .15s ease, box-shadow .25s ease, filter .25s ease;
    }
    .vibe66 .btn:hover { transform: translateY(-2px); }
    .vibe66 .btn.ghost {
      color: var(--ink); background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.6));
      border: 1px solid var(--line); box-shadow: 0 10px 22px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.7);
    }
    .vibe66[data-theme="dusk"] .btn.ghost {
      background: linear-gradient(180deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
      box-shadow: 0 10px 22px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.12);
    }
    .vibe66 .btn:focus-visible { outline: 2px solid color-mix(in srgb, var(--p2), #fff 30%); outline-offset: 2px; }

    .vibe66 .slider {
      --track: rgba(0,0,0,0.18);
      display: inline-flex; align-items: center; gap: 10px;
      padding: 8px 12px; border-radius: 14px; color: var(--muted);
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.6));
      position: relative;
    }
    .vibe66[data-theme="dusk"] .slider { --track: rgba(255,255,255,0.25); background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); }
    .vibe66 .slider input[type="range"] {
      -webkit-appearance: none; appearance: none; width: 220px; height: 26px; background: transparent;
    }
    .vibe66 .slider input[type="range"]::-webkit-slider-runnable-track,
    .vibe66 .slider input[type="range"]::-moz-range-track {
      height: 6px; border-radius: 999px; background: var(--track);
    }
    .vibe66 .slider input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none; width: 18px; height: 18px; margin-top: -6px;
      border-radius: 50%; background: var(--p1);
      border: 2px solid rgba(255,255,255,0.85);
      box-shadow: 0 3px 10px color-mix(in srgb, var(--p1), #000 40%);
    }
    .vibe66 .slider .bar {
      position: absolute; left: 92px; width: 0; height: 6px; border-radius: 999px;
      background: linear-gradient(90deg, var(--p1), var(--p2), var(--p3));
      transform: translateY(-15px);
      mix-blend-mode: multiply; opacity: .95; pointer-events: none;
    }
    .vibe66[data-theme="dusk"] .slider .bar { mix-blend-mode: screen; }

    /* Swatches */
    .vibe66 .swatches { display: inline-flex; gap: 8px; align-items: center; margin-left: 6px; }
    .vibe66 .swatch {
      width: 24px; height: 24px; border-radius: 50%; border: 2px solid rgba(0,0,0,0.18);
      box-shadow: 0 6px 14px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.7);
      cursor: pointer; transition: transform .12s ease;
    }
    .vibe66[data-theme="dusk"] .swatch { border-color: rgba(255,255,255,0.3); box-shadow: 0 6px 14px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.12); }
    .vibe66 .swatch:hover { transform: translateY(-2px); }
    .vibe66 .swatch.dawn   { background: linear-gradient(135deg, #fb7185, #f59e0b, #f472b6); }
    .vibe66 .swatch.reef   { background: linear-gradient(135deg, #06b6d4, #22d3ee, #60a5fa); }
    .vibe66 .swatch.orchid { background: linear-gradient(135deg, #a78bfa, #ec4899, #8b5cf6); }

    /* Meta */
    .vibe66 .meta {
      margin-top: 18px; display: flex; justify-content: space-between; align-items: center;
      gap: 12px; font-size: 12px; color: color-mix(in srgb, var(--ink), #000 30%);
      padding: 10px 14px; border-radius: 12px; border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.6));
    }
    .vibe66[data-theme="dusk"] .meta {
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      color: color-mix(in srgb, var(--ink), #000 15%);
    }

    /* Motion-reduced */
    @media (prefers-reduced-motion: reduce) {
      .vibe66::before { animation: none; }
    }

    @keyframes v66_spin { to { transform: rotate(1turn); } }

    @media (max-width: 780px) {
      .vibe66 .tile { display: none; }
      .vibe66 h1 { line-height: 1.06; }
    }
  </style>

  <div class="frame">
    <div class="mast">
      <span class="tag">Iteration 66 • Kinetic Loom</span>
      <h1>Weave the Light</h1>
      <span class="accent" aria-hidden="true"></span>
      <p class="sub">Silk-thin ribbons flow to your touch—geometry breathing, color listening.</p>
    </div>

    <div class="stage" role="region" aria-label="Weaving stage">
      <div class="loom">
        <canvas class="weave" aria-hidden="true"></canvas>
        <div class="tiles" aria-hidden="true">
          <div class="tile t1"></div>
          <div class="tile t2"></div>
          <div class="tile t3"></div>
        </div>
      </div>
    </div>

    <div class="controls" role="group" aria-label="Controls">
      <button id="play66" class="btn" type="button" aria-pressed="true">Pause Weave</button>
      <button id="theme66" class="btn ghost" type="button" aria-pressed="false">Dusk Mode</button>
      <button id="grid66" class="btn ghost" type="button" aria-pressed="false">Gridlines</button>

      <label class="slider" for="vel66">
        <span style="font-weight:800;color:var(--p1);">Velocity</span>
        <input id="vel66" type="range" min="0" max="100" value="55" aria-label="Weave velocity">
        <span class="bar" aria-hidden="true"></span>
        <div class="swatches" role="group" aria-label="Palette">
          <span class="swatch dawn" title="Dawn" data-palette="dawn" tabindex="0" aria-label="Dawn palette"></span>
          <span class="swatch reef" title="Reef" data-palette="reef" tabindex="0" aria-label="Reef palette"></span>
          <span class="swatch orchid" title="Orchid" data-palette="orchid" tabindex="0" aria-label="Orchid palette"></span>
        </div>
      </label>
    </div>

    <div class="meta">
      <span class="tip">Tip: move your cursor to nudge the weave, toggle Dusk, try Reef or Orchid.</span>
      <span id="last-updated">Last updated: 2025-10-19 15:13:04 EST</span>
    </div>
  </div>

  <script>
    (function(){
      const root = document.currentScript.closest('.vibe66');
      const canvas = root.querySelector('canvas.weave');
      const ctx = canvas.getContext('2d');
      const stage = root.querySelector('.loom');
      const tiles = Array.from(root.querySelectorAll('.tile'));
      const playBtn = root.querySelector('#play66');
      const themeBtn = root.querySelector('#theme66');
      const gridBtn = root.querySelector('#grid66');
      const vel = root.querySelector('#vel66');
      const bar = root.querySelector('.slider .bar');
      const swatches = Array.from(root.querySelectorAll('.swatch'));
      const updated = root.querySelector('#last-updated');

      // Timestamp
      try {
        const d = new Date();
        const fmt = new Intl.DateTimeFormat([], { year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false, timeZoneName:'short' });
        updated.textContent = 'Last updated: ' + fmt.format(d);
      } catch(e) {
        updated.textContent = 'Last updated: ' + new Date().toLocaleString();
      }

      // Canvas fit
      function fit(){
        const dpr = Math.min(2, window.devicePixelRatio || 1);
        const rect = stage.getBoundingClientRect();
        canvas.width = Math.max(1, rect.width * dpr);
        canvas.height = Math.max(1, rect.height * dpr);
        canvas.style.width = rect.width + 'px';
        canvas.style.height = rect.height + 'px';
        ctx.setTransform(1,0,0,1,0,0);
        ctx.scale(dpr, dpr);
      }
      fit();
      window.addEventListener('resize', fit, { passive: true });

      // Pointer
      let mx = 0.5, my = 0.5;
      function onMove(e){
        const rect = root.getBoundingClientRect();
        mx = Math.min(1, Math.max(0, (e.clientX - rect.left) / rect.width));
        my = Math.min(1, Math.max(0, (e.clientY - rect.top) / rect.height));
        root.style.setProperty('--mx', (mx*100).toFixed(2) + '%');
        root.style.setProperty('--my', (my*100).toFixed(2) + '%');
        // Tile parallax
        const dx = (mx - 0.5), dy = (my - 0.5);
        tiles.forEach((tile, i) => {
          const p = (i + 1) * 10;
          tile.style.transform = `translate3d(${dx * p * 8}px, ${dy * p * 6}px, 0) rotate(var(--r))`;
        });
      }
      root.addEventListener('pointermove', onMove, { passive: true });
      root.addEventListener('pointerleave', () => {
        mx = 0.5; my = 0.5;
        root.style.setProperty('--mx', '50%');
        root.style.setProperty('--my', '50%');
        tiles.forEach(tile => { tile.style.transform = `translate3d(0,0,0) rotate(var(--r))`; });
      });

      // Velocity bar UI
      function updateBar(){
        const pct = (+vel.value - +vel.min) / (+vel.max - +vel.min);
        bar.style.width = Math.round(pct * 220) + 'px';
      }
      vel.addEventListener('input', updateBar);
      updateBar();

      // Palette
      function setPalette(p){ root.setAttribute('data-palette', p); refreshColors(); }
      swatches.forEach(sw => {
        const p = sw.getAttribute('data-palette');
        const apply = () => setPalette(p);
        sw.addEventListener('click', apply);
        sw.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); apply(); } });
      });

      // Theme toggle
      themeBtn.addEventListener('click', () => {
        const dusk = root.getAttribute('data-theme') === 'dusk';
        if (dusk) {
          root.setAttribute('data-theme', 'dawn');
          themeBtn.textContent = 'Dusk Mode';
          themeBtn.setAttribute('aria-pressed','false');
        } else {
          root.setAttribute('data-theme', 'dusk');
          themeBtn.textContent = 'Dawn Mode';
          themeBtn.setAttribute('aria-pressed','true');
        }
      });

      // Grid toggle
      gridBtn.addEventListener('click', () => {
        const on = root.getAttribute('data-grid') === 'true';
        root.setAttribute('data-grid', on ? 'false' : 'true');
        gridBtn.setAttribute('aria-pressed', String(!on));
      });

      // Weave engine
      const state = {
        t: 0,
        running: true,
        speed: +vel.value / 100,
        colors: []
      };

      // Read current CSS palette colors
      function refreshColors(){
        const cs = getComputedStyle(root);
        const c1 = cs.getPropertyValue('--p1').trim();
        const c2 = cs.getPropertyValue('--p2').trim();
        const c3 = cs.getPropertyValue('--p3').trim();
        state.colors = [c1, c2, c3];
      }
      refreshColors();

      vel.addEventListener('input', () => { state.speed = +vel.value / 100; });

      // Ribbons configuration
      const strands = Array.from({length: 7}).map((_, i) => ({
        ax: 1 + i*0.07,
        ay: 1.8 + i*0.09,
        phase: i * Math.PI / 7,
        width: 2 + (i%3),
        opacity: 0.62 + (i % 2) * 0.08
      }));

      function draw(){
        const rect = stage.getBoundingClientRect();
        const w = rect.width, h = rect.height;
        ctx.clearRect(0,0,w,h);

        const cx = w/2, cy = h/2;
        const amp = Math.min(w, h) * (0.28 + (mx-0.5)*0.06 + (my-0.5)*0.06);

        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        const themeDusk = root.getAttribute('data-theme') === 'dusk';
        ctx.globalCompositeOperation = themeDusk ? 'screen' : 'multiply';

        strands.forEach((s, i) => {
          const t = state.t * (1 + i*0.04);
          const steps = 420;
          const A = amp * (0.6 + i*0.04);
          const B = amp * (0.4 + i*0.03);

          // Gradient stroke across the canvas
          const g = ctx.createLinearGradient(0, 0, w, h);
          g.addColorStop(0, state.colors[0]);
          g.addColorStop(0.5, state.colors[1]);
          g.addColorStop(1, state.colors[2]);

          ctx.strokeStyle = g;
          ctx.globalAlpha = s.opacity;
          ctx.lineWidth = s.width;

          ctx.beginPath();
          for (let k = 0; k <= steps; k++) {
            const u = k / steps;
            const angle = u * Math.PI * 2;
            const x = cx + Math.sin(s.ax * angle + t + s.phase) * A * (0.9 + 0.1*Math.sin(t*0.5 + i));
            const y = cy + Math.sin(s.ay * angle - t - s.phase) * B * (0.9 + 0.1*Math.cos(t*0.4 + i));
            if (k === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          }
          ctx.stroke();
        });

        // Soft center glow
        const glow = ctx.createRadialGradient(cx, cy, 0, cx, cy, Math.max(w,h)*0.4);
        glow.addColorStop(0, themeDusk ? 'rgba(255,255,255,0.08)' : 'rgba(0,0,0,0.04)');
        glow.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.globalAlpha = 1;
        ctx.globalCompositeOperation = themeDusk ? 'screen' : 'multiply';
        ctx.fillStyle = glow;
        ctx.fillRect(0,0,w,h);
      }

      // Loop
      let raf = null;
      function loop(){
        if (!state.running || window.matchMedia('(prefers-reduced-motion: reduce)').matches) { raf = null; return; }
        state.t += 0.6 + state.speed * 1.8;
        draw();
        raf = requestAnimationFrame(loop);
      }
      function start(){ if (!raf) raf = requestAnimationFrame(loop); }
      function stop(){ if (raf) cancelAnimationFrame(raf); raf = null; }

      // Play/Pause
      playBtn.addEventListener('click', () => {
        state.running = !state.running;
        playBtn.textContent = state.running ? 'Pause Weave' : 'Resume Weave';
        playBtn.setAttribute('aria-pressed', String(state.running));
        state.running ? start() : stop();
      });

      // Respect reduced motion
      const mq = window.matchMedia('(prefers-reduced-motion: reduce)');
      function sync(){ if (mq.matches) stop(); else if (state.running) start(); }
      try { mq.addEventListener('change', sync); } catch(_) {}
      sync();
      if (!mq.matches) start();

      // Redraw on palette/theme changes
      const ro = new MutationObserver(() => { refreshColors(); draw(); });
      ro.observe(root, { attributes: true, attributeFilter: ['data-palette', 'data-theme'] });

      // Initial paint after sizing
      draw();
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


