<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<style>
  .k817 {
    --ink: hsl(232 24% 12%);
    --muted: hsl(232 12% 42%);
    --panel: hsl(0 0% 100% / .6);
    --edge: hsl(232 30% 85% / .5);
    --ring-a: hsl(210 90% 62%);
    --ring-b: hsl(290 86% 66%);
    --ring-c: hsl(350 86% 62%);
    --glow: 210;
    position: relative;
    border-radius: 28px;
    padding: clamp(20px, 4.8vw, 56px);
    color: var(--ink);
    overflow: hidden;
    isolation: isolate;
    background:
      radial-gradient(1200px 900px at -10% -10%, hsl(194 100% 95% / .8), transparent 60%),
      radial-gradient(1000px 800px at 110% 120%, hsl(320 100% 96% / .7), transparent 62%),
      linear-gradient(180deg, hsl(218 62% 98%), hsl(218 64% 97%));
    box-shadow:
      0 40px 120px hsl(220 50% 18% / .16),
      inset 0 0 0 1px var(--edge);
  }
  .k817[data-theme="dark"] {
    --ink: hsl(0 0% 98%);
    --muted: hsl(220 12% 78%);
    --panel: hsl(0 0% 100% / .12);
    --edge: hsl(0 0% 100% / .14);
    background:
      radial-gradient(1200px 900px at -10% -10%, hsl(230 70% 18% / .7), transparent 60%),
      radial-gradient(1000px 800px at 110% 120%, hsl(260 70% 18% / .65), transparent 62%),
      linear-gradient(180deg, hsl(232 48% 9%), hsl(232 50% 8%));
    box-shadow:
      0 50px 160px hsl(220 70% 7% / .7),
      inset 0 0 0 1px var(--edge);
  }
  .k817::after {
    content: "";
    position: absolute; inset: -20%;
    background:
      conic-gradient(from 0deg at 50% 50%, hsl(0 0% 100% / .08), transparent 12%, hsl(0 0% 100% / .04) 28%, transparent 40%, hsl(0 0% 100% / .08) 55%, transparent 70%, hsl(0 0% 100% / .06) 88%, transparent 100%);
    mix-blend-mode: soft-light;
    filter: blur(8px);
    pointer-events: none;
  }

  .k817-bar {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: clamp(12px, 3vw, 28px);
    align-items: start;
    margin-bottom: clamp(16px, 4vw, 40px);
    position: relative; z-index: 3;
  }
  .k817-brand { display: grid; gap: 6px; align-content: start; }
  .k817-brand h1 {
    margin: 0;
    font: 900 clamp(28px, 7vw, 86px)/.92 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    letter-spacing: -0.02em;
    background:
      linear-gradient(90deg, var(--ink), var(--ink)) padding-box,
      conic-gradient(from 120deg, var(--ring-a), var(--ring-b), var(--ring-c), var(--ring-a)) text;
    -webkit-background-clip: padding-box, text; background-clip: padding-box, text;
    color: transparent; -webkit-text-fill-color: transparent;
  }
  .k817-brand p {
    margin: 0;
    font: 600 clamp(12px, 1.6vw, 16px)/1.6 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    color: var(--muted);
  }

  .k817-ctrls {
    display: grid; grid-auto-flow: column; gap: 10px; align-items: center; justify-content: end;
  }
  .k817 .chip {
    appearance: none; border: 0; cursor: pointer;
    font: 800 12px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    padding: 11px 14px; border-radius: 999px; color: var(--ink);
    background: linear-gradient(180deg, var(--panel), hsl(0 0% 100% / .5));
    border: 1px solid var(--edge);
    box-shadow: 0 12px 24px hsl(220 30% 20% / .12), inset 0 1px 0 hsl(0 0% 100% / .6);
    position: relative; overflow: hidden; transform: translateZ(0);
    transition: transform 160ms ease, box-shadow 160ms ease, background 160ms ease;
  }
  .k817[data-theme="dark"] .chip {
    background: linear-gradient(180deg, hsl(0 0% 100% / .1), hsl(0 0% 100% / .08));
    color: hsl(0 0% 98%);
    box-shadow: 0 12px 24px hsl(220 30% 6% / .45), inset 0 1px 0 hsl(0 0% 100% / .15);
  }
  .k817 .chip:hover { transform: translateY(-2px); box-shadow: 0 18px 34px hsl(220 30% 20% / .18); }
  .k817 .chip .ink {
    position: absolute; inset: 0; border-radius: inherit; pointer-events: none;
    background: radial-gradient(140px 140px at var(--mx,50%) var(--my,50%), hsl(0 0% 100% / .35), transparent 66%);
    opacity: 0; transition: opacity 160ms ease;
  }
  .k817 .chip:hover .ink { opacity: 1; }

  .k817 .knob {
    display: inline-grid; grid-auto-flow: column; align-items: center; gap: 8px;
    padding: 8px 12px; border-radius: 999px;
    background: linear-gradient(180deg, var(--panel), hsl(0 0% 100% / .5));
    border: 1px solid var(--edge);
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .6);
    color: var(--ink);
    font: 600 12px ui-sans-serif, system-ui;
  }
  .k817[data-theme="dark"] .knob {
    background: linear-gradient(180deg, hsl(0 0% 100% / .1), hsl(0 0% 100% / .08));
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .15);
    color: hsl(0 0% 98%);
  }
  .k817 input[type="range"] { -webkit-appearance: none; appearance: none; width: 140px; height: 28px; background: transparent; }
  .k817 input[type="range"]::-webkit-slider-runnable-track {
    height: 8px; border-radius: 999px;
    background: linear-gradient(90deg, var(--ring-a), var(--ring-b), var(--ring-c));
    box-shadow: inset 0 1px 0 hsl(0 0% 100% / .5);
  }
  .k817 input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none; appearance: none; width: 18px; height: 18px; margin-top: -5px; border-radius: 50%;
    background: white; border: 1px solid var(--edge);
    box-shadow: 0 4px 10px hsl(220 30% 20% / .2);
  }
  .k817 input[type="range"]::-moz-range-track {
    height: 8px; border-radius: 999px;
    background: linear-gradient(90deg, var(--ring-a), var(--ring-b), var(--ring-c));
  }
  .k817 input[type="range"]::-moz-range-thumb {
    width: 18px; height: 18px; border-radius: 50%; background: white; border: 1px solid var(--edge);
  }

  .k817-stage {
    position: relative; z-index: 2;
    display: grid; place-items: center;
  }
  .k817-wheel {
    position: relative;
    width: min(84vw, 760px);
    aspect-ratio: 1/1;
    border-radius: 50%;
    border: 1px solid var(--edge);
    background: radial-gradient(120% 120% at 50% 50%, hsl(0 0% 100% / .8), hsl(0 0% 100% / .5));
    box-shadow:
      0 50px 100px hsl(220 40% 20% / .16),
      inset 0 1px 0 hsl(0 0% 100% / .65);
    overflow: hidden;
  }
  .k817[data-theme="dark"] .k817-wheel {
    background: radial-gradient(120% 120% at 50% 50%, hsl(0 0% 100% / .08), hsl(0 0% 100% / .06));
    box-shadow:
      0 60px 160px hsl(220 40% 8% / .5),
      inset 0 1px 0 hsl(0 0% 100% / .12);
  }
  .k817-ring {
    position: absolute; inset: -2%;
    pointer-events: none;
    background:
      radial-gradient(60% 60% at 50% 50%, hsl(0 0% 100% / .16), transparent 60%),
      conic-gradient(from 0deg, var(--ring-a), var(--ring-b), var(--ring-c), var(--ring-a));
    mix-blend-mode: soft-light;
    filter: blur(18px);
  }
  .k817-glare {
    position: absolute; inset: 0;
    background: radial-gradient(100% 100% at 20% 15%, hsl(0 0% 100% / .18), transparent 60%),
                radial-gradient(140% 140% at 80% 85%, hsl(0 0% 100% / .12), transparent 60%);
    pointer-events: none; mix-blend-mode: screen;
  }
  .k817-canvas { position: absolute; inset: 0; width: 100%; height: 100%; display: block; }
  .k817-pointer {
    position: absolute; width: 10px; height: 10px; border-radius: 50%;
    background: radial-gradient(circle, white, var(--ring-a));
    box-shadow: 0 6px 14px hsl(220 70% 40% / .35);
    transform: translate(-50%, -50%);
    pointer-events: none; opacity: .0; transition: opacity .2s ease;
  }
  .k817-stage:has(.drawing) .k817-pointer { opacity: .9; }

  .k817-caption {
    text-align: center; margin-top: clamp(14px, 3vw, 24px);
    color: var(--muted);
    font: 500 clamp(13px, 1.6vw, 18px)/1.6 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  }

  .k817-foot {
    position: relative; z-index: 2;
    margin-top: clamp(18px, 3.2vw, 28px);
    display: flex; justify-content: space-between; align-items: center; gap: 12px;
    color: var(--muted);
    font: 500 12px/1.4 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  }
  .k817 .hint {
    font: 700 11px/1 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    background: hsl(0 0% 100% / .55);
    border: 1px solid var(--edge);
    padding: 6px 8px; border-radius: 8px; color: var(--ink);
  }
  .k817[data-theme="dark"] .hint { background: hsl(0 0% 100% / .12); color: hsl(0 0% 98%); }
</style>

<div class="k817" id="k817" data-theme="light">
  <div class="k817-bar">
    <div class="k817-brand">
      <h1>KALEIDOSCOPE · 817</h1>
      <p>Fold light. Multiply joy.</p>
    </div>
    <div class="k817-ctrls" role="group" aria-label="Controls">
      <button class="chip" id="k817-theme" type="button" aria-pressed="false"><span class="ink" aria-hidden="true"></span>Dark / Light</button>
      <button class="chip" id="k817-pal" type="button"><span class="ink" aria-hidden="true"></span>Palette</button>
      <span class="knob" aria-label="Symmetry">
        <span>Sym</span>
        <input id="k817-sym" type="range" min="4" max="24" value="12" aria-label="Symmetry segments">
      </span>
      <span class="knob" aria-label="Spin">
        <span>Spin</span>
        <input id="k817-spin" type="range" min="-90" max="90" value="18" aria-label="Spin speed">
      </span>
      <span class="knob" aria-label="Weight">
        <span>Wt</span>
        <input id="k817-wt" type="range" min="1" max="24" value="8" aria-label="Brush weight">
      </span>
      <button class="chip" id="k817-clear" type="button"><span class="ink" aria-hidden="true"></span>Clear</button>
      <button class="chip" id="k817-save" type="button"><span class="ink" aria-hidden="true"></span>Save</button>
    </div>
  </div>

  <div class="k817-stage" id="k817-stage">
    <div class="k817-wheel" id="k817-wheel" aria-live="polite">
      <canvas class="k817-canvas" id="k817-view" aria-label="Kaleidoscope canvas"></canvas>
      <div class="k817-ring" aria-hidden="true"></div>
      <div class="k817-glare" aria-hidden="true"></div>
      <div class="k817-pointer" id="k817-dot" aria-hidden="true"></div>
    </div>
    <p class="k817-caption" id="k817-caption">Drag across the circle to weave symmetry. Double‑click to refresh the flow.</p>
  </div>

  <div class="k817-foot">
    <span class="hint" aria-hidden="true">Tip: change symmetry while drawing for wild folds · Save to PNG anytime</span>
    <span id="last-updated">Last updated: 2025-11-22 22:25:52 EST</span>
  </div>
</div>

<script>
(function () {
  const root = document.getElementById('k817');
  const wheel = document.getElementById('k817-wheel');
  const view = document.getElementById('k817-view');
  const dot = document.getElementById('k817-dot');
  const caption = document.getElementById('k817-caption');

  const themeBtn = document.getElementById('k817-theme');
  const palBtn = document.getElementById('k817-pal');
  const sym = document.getElementById('k817-sym');
  const spin = document.getElementById('k817-spin');
  const wt = document.getElementById('k817-wt');
  const clearBtn = document.getElementById('k817-clear');
  const saveBtn = document.getElementById('k817-save');
  const last = document.getElementById('last-updated');

  // Timestamp
  try {
    const now = new Date();
    const opts = { year: 'numeric', month: 'short', day: '2-digit', hour: '2-digit', minute: '2-digit' };
    last.textContent = 'Last updated: ' + now.toLocaleString(undefined, opts);
  } catch { last.textContent = 'Last updated: just now'; }

  // Ink hover pos
  function inkPos(e) {
    const b = e.currentTarget.getBoundingClientRect();
    e.currentTarget.style.setProperty('--mx', ((e.clientX - b.left) / b.width) * 100 + '%');
    e.currentTarget.style.setProperty('--my', ((e.clientY - b.top) / b.height) * 100 + '%');
  }
  [themeBtn, palBtn, clearBtn, saveBtn].forEach(btn => btn.addEventListener('pointermove', inkPos, { passive: true }));

  // Canvas setup
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  let W = 0, H = 0, CX = 0, CY = 0, R = 0;

  const vctx = view.getContext('2d', { willReadFrequently: false, alpha: true });
  // Offscreen wedge canvas
  let brush = document.createElement('canvas');
  let bctx = brush.getContext('2d', { alpha: true });

  let SEG = parseInt(sym.value, 10);
  let wedge = (Math.PI * 2) / SEG;

  let palIndex = 0;
  const palettes = [
    { name: 'Glacier', hues: [190, 210, 230, 260] },
    { name: 'Solar', hues: [20, 40, 55, 12] },
    { name: 'Fuchsia Drift', hues: [290, 315, 335, 260] },
    { name: 'Lagoon', hues: [150, 175, 200, 220] },
    { name: 'Candy', hues: [330, 10, 60, 200] },
    { name: 'Citrus Mint', hues: [55, 95, 175, 210] }
  ];
  function setRingsFromPalette() {
    const hues = palettes[palIndex].hues;
    root.style.setProperty('--ring-a', `hsl(${hues[0]} 90% 60%)`);
    root.style.setProperty('--ring-b', `hsl(${hues[1]} 90% 62%)`);
    root.style.setProperty('--ring-c', `hsl(${hues[2]} 90% 64%)`);
  }

  function fit() {
    const rect = wheel.getBoundingClientRect();
    const s = Math.floor(Math.min(rect.width, rect.height));
    W = H = Math.max(1, s) * dpr;
    view.width = brush.width = W;
    view.height = brush.height = H;
    view.style.width = brush.style.width = s + 'px';
    view.style.height = brush.style.height = s + 'px';
    vctx.setTransform(1, 0, 0, 1, 0, 0);
    bctx.setTransform(1, 0, 0, 1, 0, 0);
    CX = W / 2; CY = H / 2; R = Math.hypot(W, H);
    applyWedgeClip();
    clear(true);
  }

  function applyWedgeClip() {
    bctx.restore?.();
    bctx.save();
    // Clear and clip to wedge
    bctx.clearRect(0, 0, W, H);
    bctx.beginPath();
    bctx.moveTo(CX, CY);
    bctx.arc(CX, CY, R, -wedge / 2, wedge / 2, false);
    bctx.closePath();
    bctx.clip();
  }

  // Drawing state
  let drawing = false;
  let prev = null;
  let theta = 0; // rotation
  let lastTime = performance.now();

  function wrapMod(a, m) { return ((a % m) + m) % m; }
  function foldToWedge(x, y) {
    const dx = x - CX, dy = y - CY;
    const r = Math.hypot(dx, dy);
    if (r < 0.001) return { x: CX, y: CY };
    let ang = Math.atan2(dy, dx); // -PI..PI
    let norm = wrapMod(ang + Math.PI, wedge); // 0..wedge
    if (norm > wedge / 2) norm = wedge - norm; // mirror
    const fold = norm - wedge / 2; // center on 0
    return { x: CX + Math.cos(fold) * r, y: CY + Math.sin(fold) * r };
  }

  function stroke(from, to) {
    const night = root.getAttribute('data-theme') === 'dark';
    const w = parseInt(wt.value, 10) * (night ? 1.1 : 1.0);
    // color along radius + time
    const dx = to.x - CX, dy = to.y - CY;
    const r = Math.min(1, Math.hypot(dx, dy) / (W * 0.5));
    const hues = palettes[palIndex].hues;
    const seg = r * (hues.length - 1);
    const i = Math.min(hues.length - 2, Math.floor(seg));
    const f = seg - i;
    const a = hues[i], b = hues[i + 1];
    const dh = ((b - a + 540) % 360) - 180;
    const hue = (a + dh * f + 360) % 360;

    bctx.globalCompositeOperation = 'lighter';
    bctx.lineCap = 'round';
    bctx.lineJoin = 'round';
    bctx.strokeStyle = `hsla(${hue}, 95%, ${night ? 70 : 55}%, 0.9)`;
    bctx.lineWidth = Math.max(1, w);
    bctx.beginPath();
    bctx.moveTo(from.x, from.y);
    bctx.lineTo(to.x, to.y);
    bctx.stroke();

    // occasional sparkle
    if (Math.random() < 0.12) {
      const s = w * 0.9;
      const g = bctx.createRadialGradient(to.x, to.y, 0, to.x, to.y, s * 3);
      g.addColorStop(0, `hsla(${hue},100%,${night ? 82 : 68}%, .55)`);
      g.addColorStop(1, `hsla(${hue},100%,60%, 0)`);
      bctx.fillStyle = g;
      bctx.beginPath(); bctx.arc(to.x, to.y, s * 2.2, 0, Math.PI * 2); bctx.fill();
    }
  }

  function render(ts) {
    const dt = Math.min(1/20, (ts - lastTime) / 1000);
    lastTime = ts;

    // fade trails on view for motion persistence
    const night = root.getAttribute('data-theme') === 'dark';
    vctx.globalCompositeOperation = 'source-over';
    vctx.fillStyle = night ? 'rgba(6,8,13,0.18)' : 'rgba(255,255,255,0.22)';
    vctx.fillRect(0, 0, W, H);

    // spin
    const speed = parseInt(spin.value, 10); // deg/sec
    theta += (speed * Math.PI / 180) * dt;

    // draw segments
    vctx.globalCompositeOperation = 'lighter';
    vctx.save();
    vctx.translate(CX, CY);
    vctx.rotate(theta);
    for (let i = 0; i < SEG; i++) {
      vctx.save();
      vctx.rotate(i * wedge);
      if (i % 2) vctx.scale(1, -1);
      vctx.drawImage(brush, -CX, -CY);
      vctx.restore();
    }
    vctx.restore();

    raf = requestAnimationFrame(render);
  }

  function clear(hard) {
    vctx.clearRect(0, 0, W, H);
    bctx.clearRect(0, 0, W, H);
    if (hard) {
      // soft base
      bctx.save();
      bctx.globalAlpha = 0.08;
      bctx.fillStyle = root.getAttribute('data-theme') === 'dark' ? '#0b0f18' : '#ffffff';
      bctx.fillRect(0, 0, W, H);
      bctx.restore();
      applyWedgeClip();
    }
  }

  // Events
  let raf = null;
  function start() { if (!raf) raf = requestAnimationFrame(render); }
  function stop() { if (raf) cancelAnimationFrame(raf); raf = null; }

  function onPointerMove(e) {
    const rect = view.getBoundingClientRect();
    const x = (e.clientX - rect.left) * dpr;
    const y = (e.clientY - rect.top) * dpr;
    const p = foldToWedge(x, y);

    // pointer dot
    dot.style.left = e.clientX + 'px';
    dot.style.top = e.clientY + 'px';

    if (!drawing) return;
    const q = prev || p;
    stroke(q, p);
    prev = p;
  }

  function onPointerDown(e) {
    drawing = true;
    wheel.classList.add('drawing');
    prev = null;
    onPointerMove(e);
  }
  function onPointerUp() {
    drawing = false;
    wheel.classList.remove('drawing');
    prev = null;
  }

  wheel.addEventListener('pointerdown', onPointerDown);
  window.addEventListener('pointermove', onPointerMove, { passive: true });
  window.addEventListener('pointerup', onPointerUp);

  wheel.addEventListener('dblclick', () => {
    // re-tone palette subtly
    const src = palettes[palIndex].hues;
    palettes[palIndex].hues = src.map(h => (h + 20 + Math.random() * 80) % 360);
    setRingsFromPalette();
    caption.textContent = 'Refolded hues. Keep weaving.';
    clear(true);
  });

  // Controls
  themeBtn.addEventListener('click', () => {
    const dark = root.getAttribute('data-theme') === 'dark';
    root.setAttribute('data-theme', dark ? 'light' : 'dark');
    themeBtn.setAttribute('aria-pressed', String(!dark));
  });
  palBtn.addEventListener('click', () => {
    palIndex = (palIndex + 1) % palettes.length;
    setRingsFromPalette();
    caption.textContent = 'Palette: ' + palettes[palIndex].name;
  });
  sym.addEventListener('input', () => {
    SEG = Math.max(4, parseInt(sym.value, 10) || 12);
    wedge = (Math.PI * 2) / SEG;
    applyWedgeClip();
  });
  spin.addEventListener('input', () => {
    // nothing else; render loop reads it
  });
  wt.addEventListener('input', () => {});
  clearBtn.addEventListener('click', () => clear(true));
  saveBtn.addEventListener('click', () => {
    // compose flattened image
    const out = document.createElement('canvas');
    out.width = W; out.height = H;
    const octx = out.getContext('2d');
    octx.fillStyle = root.getAttribute('data-theme') === 'dark' ? '#0b0f18' : '#ffffff';
    octx.fillRect(0, 0, W, H);
    octx.drawImage(view, 0, 0);
    const link = document.createElement('a');
    link.download = 'kaleidoscope-817.png';
    link.href = out.toDataURL('image/png');
    link.click();
  });

  // Resize
  window.addEventListener('resize', fit);

  // Reduced motion
  const media = window.matchMedia('(prefers-reduced-motion: reduce)');
  function setReduced(state) {
    if (state) stop(); else start();
  }
  setReduced(media.matches);
  media.addEventListener?.('change', e => setReduced(e.matches));

  // Boot
  setRingsFromPalette();
  fit();
  start();

  // Cleanup
  window.addEventListener('beforeunload', stop);
})();
</script>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


