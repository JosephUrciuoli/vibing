<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="vibe1979" role="region" aria-label="Aurora Observatory — Orbital Chorus">
  <style>
    .vibe1979 {
      --ink: #eaf1ff;
      --muted: #9fb1cc;
      --bg-0: #0b1020;
      --bg-1: #0e1730;
      --ring: 120 180 255;
      --a: #66e3ff;
      --b: #8a7bff;
      --c: #ff9bd7;
      --glow: 255 255 255;
      position: relative;
      min-height: 760px;
      padding: clamp(18px, 3vw, 36px);
      border-radius: 32px;
      color: var(--ink);
      background:
        radial-gradient(120% 180% at 50% 0%, var(--bg-1), var(--bg-0) 60%),
        linear-gradient(180deg, #091225, #0a0f1e);
      box-shadow:
        0 30px 80px rgba(0, 10, 30, 0.45),
        0 0 0 1px rgba(180, 200, 255, 0.04) inset;
      overflow: hidden;
      isolation: isolate;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    .vibe1979::before,
    .vibe1979::after {
      content: "";
      position: absolute;
      inset: -30%;
      background:
        conic-gradient(from 200deg at 20% 30%, rgba(102, 227, 255, 0.18), rgba(0,0,0,0) 35%),
        conic-gradient(from 20deg at 80% 70%, rgba(255, 155, 215, 0.16), rgba(0,0,0,0) 45%),
        radial-gradient(50% 60% at 50% 0%, rgba(138, 123, 255, 0.25), rgba(0,0,0,0) 60%);
      filter: blur(32px) saturate(120%);
      pointer-events: none;
      mix-blend-mode: screen;
      animation: auroraShift 18s ease-in-out infinite alternate;
    }
    .vibe1979::after {
      animation-duration: 24s;
      transform: scale(1.05) rotate(8deg);
      opacity: .8;
    }
    @keyframes auroraShift {
      0% { transform: translate3d(-2%, -1%, 0) rotate(-3deg) scale(1.02); }
      100% { transform: translate3d(2%, 1%, 0) rotate(3deg) scale(1.06); }
    }

    .v79-frame {
      position: relative;
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: clamp(16px, 2.4vw, 28px);
      z-index: 1;
    }

    .v79-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .v79-stamp {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 16px;
      border-radius: 999px;
      font-size: 12px;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: var(--muted);
      background: linear-gradient(180deg, rgba(18, 28, 60, 0.66), rgba(18, 28, 60, 0.36));
      border: 1px solid rgba(var(--ring), 0.28);
      box-shadow:
        0 0 0 6px rgba(var(--ring), .10) inset,
        0 10px 26px rgba(0,0,0,.35);
      user-select: none;
      white-space: nowrap;
      backdrop-filter: blur(6px) saturate(130%);
      -webkit-backdrop-filter: blur(6px) saturate(130%);
    }
    .v79-stamp::before {
      content: "";
      width: 10px; height: 10px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(var(--ring),1));
      box-shadow: 0 0 14px rgba(var(--ring),.9), 0 0 0 1px rgba(160, 200, 255, .28) inset;
      flex: none;
    }
    .v79-actions { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }

    .v79-btn {
      appearance: none;
      border: 1px solid rgba(var(--ring), 0.26);
      background: linear-gradient(180deg, rgba(18, 28, 60, 0.65), rgba(18, 28, 60, 0.45));
      color: var(--ink);
      padding: 10px 14px;
      border-radius: 14px;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset, 0 8px 18px rgba(0,0,0,.35);
      transition: transform .12s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
      backdrop-filter: blur(6px) saturate(150%);
      -webkit-backdrop-filter: blur(6px) saturate(150%);
    }
    .v79-btn:hover { transform: translateY(-1px); }
    .v79-btn:active { transform: translateY(0); }
    .v79-btn:focus-visible { outline: none; box-shadow: 0 0 0 3px rgba(var(--ring), .35); }

    .v79-stage {
      position: relative;
      border-radius: 24px;
      overflow: hidden;
      border: 1px solid rgba(180, 200, 255, 0.10);
      background: radial-gradient(120% 100% at 50% 20%, rgba(70,100,255,0.08), rgba(0,0,0,0) 60%), rgba(6,10,20,0.35);
      min-height: 560px;
      display: grid;
      place-items: center;
      box-shadow:
        0 20px 60px rgba(0,0,0,.45) inset,
        0 1px 0 rgba(255,255,255,0.08) inset;
      transform-style: preserve-3d;
      perspective: 1000px;
    }

    .v79-canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
      filter: saturate(120%) contrast(110%);
    }

    .v79-titleblock {
      position: relative;
      z-index: 2;
      text-align: center;
      padding: 12px 16px;
      border-radius: 16px;
      border: 1px solid rgba(180,200,255,0.10);
      background: linear-gradient(180deg, rgba(16,24,48,0.66), rgba(16,24,48,0.42));
      backdrop-filter: blur(6px) saturate(130%);
      -webkit-backdrop-filter: blur(6px) saturate(130%);
      box-shadow: 0 12px 40px rgba(0,0,0,0.35);
    }
    .v79-title {
      margin: clamp(14px, 3vw, 22px) 0 6px;
      font-size: clamp(38px, 7.4vw, 92px);
      letter-spacing: -0.02em;
      line-height: .95;
      background: linear-gradient(90deg, color-mix(in oklab, var(--a) 78%, #ffffff), color-mix(in oklab, var(--c) 72%, #ffffff));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 12px 72px rgba(120,160,255,.22), 0 20px 80px rgba(255,155,215,.20);
      text-wrap: balance;
    }
    .v79-sub {
      margin: 0 8px 8px;
      color: var(--muted);
      font-size: clamp(14px, 2vw, 18px);
      text-wrap: balance;
    }

    .v79-aurora {
      position: absolute;
      inset: -20%;
      z-index: 1;
      pointer-events: none;
      background:
        radial-gradient(80% 60% at 70% 30%, rgba(102, 227, 255, 0.15), rgba(0,0,0,0) 60%),
        radial-gradient(60% 80% at 30% 70%, rgba(138, 123, 255, 0.12), rgba(0,0,0,0) 65%),
        conic-gradient(from 140deg at 50% 50%, rgba(255,155,215,0.10), rgba(0,0,0,0) 45%);
      filter: blur(26px) saturate(130%);
      mix-blend-mode: screen;
      animation: drift 28s ease-in-out infinite alternate;
    }
    @keyframes drift {
      0% { transform: translate3d(-4%, 2%, 0) rotate(-6deg) scale(1.02); }
      100% { transform: translate3d(4%, -2%, 0) rotate(6deg) scale(1.06); }
    }

    .v79-bar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      justify-content: space-between;
      background: linear-gradient(180deg, rgba(16,24,48,0.66), rgba(16,24,48,0.44));
      border: 1px solid rgba(180, 200, 255, 0.12);
      border-radius: 16px;
      padding: 10px;
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset, 0 8px 22px rgba(0,0,0,.35);
      backdrop-filter: blur(6px) saturate(140%);
      -webkit-backdrop-filter: blur(6px) saturate(140%);
    }
    .v79-controls { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }

    .v79-range {
      -webkit-appearance: none; appearance: none;
      height: 8px; width: 160px; border-radius: 999px;
      background: linear-gradient(90deg, rgba(var(--ring),.55), rgba(255,155,215,.45));
      outline: none; border: 1px solid rgba(180, 200, 255, 0.16);
      box-shadow: 0 1px 0 rgba(255,255,255,.05) inset, 0 8px 12px rgba(0,0,0,.28) inset;
    }
    .v79-range::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px; height: 18px; border-radius: 50%;
      background: white;
      border: 1px solid rgba(120,140,200,0.45);
      box-shadow: 0 4px 12px rgba(0,0,0,.35);
    }
    .v79-range::-moz-range-thumb {
      width: 18px; height: 18px; border-radius: 50%;
      background: white; border: 1px solid rgba(120,140,200,0.45);
      box-shadow: 0 4px 12px rgba(0,0,0,.35);
    }

    .v79-check {
      color: var(--muted);
      font-size: 12px;
      display: inline-flex; align-items: center; gap: 6px;
      user-select: none;
    }
    .v79-right {
      display: flex; align-items: center; gap: 12px; flex-wrap: wrap;
      color: var(--muted);
      font-size: 12px;
    }
    .v79-tip { opacity: .9; }

    .v79-grain {
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: .15;
      mix-blend-mode: soft-light;
      background:
        repeating-linear-gradient(0deg, rgba(255,255,255,.02) 0 2px, rgba(0,0,0,0) 2px 4px),
        repeating-linear-gradient(90deg, rgba(0,0,0,.02) 0 2px, rgba(0,0,0,0) 2px 4px);
      filter: contrast(110%) saturate(110%);
      z-index: 0;
    }
    .v79-grain.hidden { opacity: 0; }

    @media (max-width: 900px) {
      .v79-stage { min-height: 520px; }
      .v79-right { width: 100%; justify-content: space-between; }
    }
    @media (prefers-reduced-motion: reduce) {
      .vibe1979, .vibe1979 * { animation: none !important; transition: none !important; }
    }
  </style>

  <div class="v79-frame">
    <div class="v79-head">
      <span class="v79-stamp">Murmur Studio — Iteration 1979</span>
      <div class="v79-actions">
        <button class="v79-btn" data-theme aria-label="Switch theme">Theme: Cosmos</button>
        <button class="v79-btn" data-run aria-pressed="false" aria-label="Toggle motion">Pause motion</button>
      </div>
    </div>

    <div class="v79-stage" aria-label="Orbital Chorus" data-tiltable>
      <canvas class="v79-canvas" aria-hidden="true"></canvas>

      <div class="v79-titleblock" aria-live="polite">
        <h1 class="v79-title">Aurora Observatory</h1>
        <p class="v79-sub">Light writes orbits. You steer the chorus.</p>
      </div>

      <div class="v79-aurora"></div>
      <div class="v79-grain"></div>
    </div>

    <div class="v79-bar" aria-label="Controls">
      <div class="v79-controls">
        <label class="v79-check">Gravity
          <input class="v79-range" type="range" min="10" max="140" step="1" value="72" data-gravity aria-label="Gravity" />
        </label>
        <label class="v79-check">Trail
          <input class="v79-range" type="range" min="0" max="1" step="0.01" value="0.86" data-trail aria-label="Trail persistence" />
        </label>
        <label class="v79-check"><input type="checkbox" data-grain checked /> Grain</label>
        <label class="v79-check"><input type="checkbox" data-tilt checked /> Tilt</label>
      </div>
      <div class="v79-right">
        <span id="last-updated">Last updated: 2026-01-15 16:19:48 EST</span>
        <span class="v79-tip">Tip: drag to bend space • click to birth a comet</span>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const root = document.currentScript.parentElement;
      const stage = root.querySelector('.v79-stage');
      const canvas = root.querySelector('.v79-canvas');
      const ctx = canvas.getContext('2d', { alpha: true });
      const grainLayer = root.querySelector('.v79-grain');
      const runBtn = root.querySelector('[data-run]');
      const gravityRange = root.querySelector('[data-gravity]');
      const trailRange = root.querySelector('[data-trail]');
      const themeBtn = root.querySelector('[data-theme]');
      const tiltToggle = root.querySelector('[data-tilt]');
      const updated = root.querySelector('#last-updated');

      // Last updated (localized)
      try {
        const locale = navigator.language || 'en-US';
        const now = new Date();
        updated.textContent = 'Updated ' + now.toLocaleString(locale, {
          year: 'numeric', month: 'short', day: '2-digit',
          hour: '2-digit', minute: '2-digit'
        });
      } catch (_) {
        updated.textContent = 'Updated ' + new Date().toString();
      }

      // Themes
      const themes = [
        {
          name: 'Cosmos',
          vars: {
            ink:'#eaf1ff', muted:'#9fb1cc',
            bg0:'#0b1020', bg1:'#0e1730', ring:'120 180 255',
            a:'#66e3ff', b:'#8a7bff', c:'#ff9bd7', glow:'255 255 255'
          }
        },
        {
          name: 'Lagoon',
          vars: {
            ink:'#eafff7', muted:'#9ad0c0',
            bg0:'#061418', bg1:'#0a1f2a', ring:'56 189 248',
            a:'#4cf3c4', b:'#58b6ff', c:'#a3ffe1', glow:'200 255 235'
          }
        },
        {
          name: 'Solstice',
          vars: {
            ink:'#fff6eb', muted:'#e7c8a8',
            bg0:'#1a0f08', bg1:'#2b1b0e', ring:'255 180 80',
            a:'#ffb36a', b:'#ff6a8a', c:'#ffd48a', glow:'255 210 150'
          }
        },
        {
          name: 'Mono',
          vars: {
            ink:'#f0f3f8', muted:'#a9b0bf',
            bg0:'#0b0d12', bg1:'#141722', ring:'180 190 210',
            a:'#b6c2ff', b:'#e2e7ff', c:'#b6c2ff', glow:'230 235 245'
          }
        }
      ];
      let themeIndex = 0;
      function applyTheme(v) {
        root.style.setProperty('--ink', v.ink);
        root.style.setProperty('--muted', v.muted);
        root.style.setProperty('--bg-0', v.bg0);
        root.style.setProperty('--bg-1', v.bg1);
        root.style.setProperty('--ring', v.ring);
        root.style.setProperty('--a', v.a);
        root.style.setProperty('--b', v.b);
        root.style.setProperty('--c', v.c);
        root.style.setProperty('--glow', v.glow);
      }
      function setTheme(i) {
        themeIndex = (i + themes.length) % themes.length;
        applyTheme(themes[themeIndex].vars);
        themeBtn.textContent = 'Theme: ' + themes[themeIndex].name;
      }
      setTheme(0);

      // Canvas sizing
      function resize() {
        const rect = canvas.getBoundingClientRect();
        const dpr = Math.min(2, window.devicePixelRatio || 1);
        canvas.width = Math.max(1, Math.floor(rect.width * dpr));
        canvas.height = Math.max(1, Math.floor(rect.height * dpr));
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        buildSystem();
      }
      window.addEventListener('resize', resize, { passive: true });

      // Orbital system
      let particles = [];
      let comets = [];
      let G = parseFloat(gravityRange.value);
      let trail = parseFloat(trailRange.value);
      let running = !window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      runBtn.setAttribute('aria-pressed', running ? 'false' : 'true');
      runBtn.textContent = running ? 'Pause motion' : 'Play motion';

      const pointer = { x: 0.5, y: 0.5, tx: 0.5, ty: 0.5, down: false, inside: false };
      function getVar(name) {
        return getComputedStyle(root).getPropertyValue(name).trim() || '#fff';
      }

      function buildSystem() {
        const rect = canvas.getBoundingClientRect();
        const w = rect.width, h = rect.height;
        particles = [];
        comets = [];
        const cx = w * 0.5, cy = h * 0.54;
        const rings = [
          { r: Math.min(w, h) * 0.10, n: 60, jitter: 0.02 },
          { r: Math.min(w, h) * 0.18, n: 80, jitter: 0.03 },
          { r: Math.min(w, h) * 0.28, n: 100, jitter: 0.05 }
        ];
        const colors = [getVar('--a'), getVar('--b'), getVar('--c')];

        for (let k = 0; k < rings.length; k++) {
          const ring = rings[k];
          for (let i = 0; i < ring.n; i++) {
            const a = (i / ring.n) * Math.PI * 2 + Math.random() * ring.jitter;
            const x = cx + Math.cos(a) * ring.r;
            const y = cy + Math.sin(a) * ring.r * 0.98;
            const v = Math.sqrt(G / Math.max(20, ring.r)); // simple speed fit
            const vx = -Math.sin(a) * v * (1 + (Math.random() - 0.5) * 0.1);
            const vy = Math.cos(a) * v * (1 + (Math.random() - 0.5) * 0.1);
            particles.push({
              x, y, vx, vy,
              hue: colors[k],
              size: 1 + (k * 0.4) + Math.random() * 0.6
            });
          }
        }
      }

      // Pointer interactions
      function onMove(e) {
        const r = canvas.getBoundingClientRect();
        pointer.tx = (e.clientX - r.left) / Math.max(1, r.width);
        pointer.ty = (e.clientY - r.top) / Math.max(1, r.height);
        pointer.inside = pointer.tx >= 0 && pointer.tx <= 1 && pointer.ty >= 0 && pointer.ty <= 1;
      }
      stage.addEventListener('pointermove', onMove);
      stage.addEventListener('pointerdown', (e) => { pointer.down = true; onMove(e); });
      window.addEventListener('pointerup', () => { pointer.down = false; });

      // Click = comet birth
      stage.addEventListener('click', (e) => {
        const r = canvas.getBoundingClientRect();
        const x = e.clientX - r.left, y = e.clientY - r.top;
        const speed = 2 + Math.random() * 1.2;
        const a = Math.random() * Math.PI * 2;
        comets.push({
          x, y,
          vx: Math.cos(a) * speed,
          vy: Math.sin(a) * speed,
          life: 1,
          color: Math.random() < 0.5 ? getVar('--a') : getVar('--c')
        });
      }, { passive: true });

      // Tilt effect
      let tiltEnabled = true;
      function applyTilt() {
        if (!tiltEnabled) { stage.style.transform = 'none'; return; }
        const r = canvas.getBoundingClientRect();
        const dx = (pointer.tx - 0.5) * 2;
        const dy = (pointer.ty - 0.5) * 2;
        const rotX = dy * 6;
        const rotY = -dx * 6;
        stage.style.transform = 'rotateX(' + rotX.toFixed(2) + 'deg) rotateY(' + rotY.toFixed(2) + 'deg)';
      }

      // Draw loop
      let t = 0;
      function draw() {
        if (!running) return;
        requestAnimationFrame(draw);
        const rect = canvas.getBoundingClientRect();
        const w = rect.width, h = rect.height;
        const cx = w * 0.5, cy = h * 0.54;

        // smooth pointer
        pointer.x += (pointer.tx - pointer.x) * 0.06;
        pointer.y += (pointer.ty - pointer.y) * 0.06;
        applyTilt();

        // fade for trails
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = 'rgba(0, 0, 0, ' + (1 - trail).toFixed(3) + ')';
        ctx.fillRect(0, 0, w, h);

        // central glow
        const grad = ctx.createRadialGradient(cx, cy, 0, cx, cy, Math.min(w, h) * 0.22);
        grad.addColorStop(0, 'rgba(var(--glow), 0.35)'.replace('--glow', getComputedStyle(root).getPropertyValue('--glow')));
        grad.addColorStop(1, 'rgba(255,255,255,0)');
        ctx.globalCompositeOperation = 'lighter';
        ctx.fillStyle = grad;
        ctx.beginPath(); ctx.arc(cx, cy, Math.min(w, h) * 0.22, 0, Math.PI * 2); ctx.fill();
        ctx.globalCompositeOperation = 'source-over';

        // gravity well (center + optional pointer)
        const attractors = [{ x: cx, y: cy, g: G }];
        if (pointer.inside && pointer.down) {
          attractors.push({ x: pointer.x * w, y: pointer.y * h, g: G * 1.6 });
        }

        // orbit lines (soft)
        ctx.strokeStyle = 'rgba(180,200,255,0.05)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        for (let r = Math.min(w, h) * 0.10; r <= Math.min(w, h) * 0.32; r += Math.min(w, h) * 0.06) {
          ctx.moveTo(cx + r, cy);
          ctx.arc(cx, cy, r, 0, Math.PI * 2);
        }
        ctx.stroke();

        // particles
        for (let i = 0; i < particles.length; i++) {
          const p = particles[i];

          // attraction
          for (let k = 0; k < attractors.length; k++) {
            const a = attractors[k];
            const dx = a.x - p.x, dy = a.y - p.y;
            const rr = Math.max(40, dx*dx + dy*dy);
            const f = a.g / rr;
            p.vx += f * dx;
            p.vy += f * dy;
          }

          // integrate
          p.x += p.vx;
          p.y += p.vy;

          // wrap edges slightly
          if (p.x < -10) p.x = w + 10;
          if (p.x > w + 10) p.x = -10;
          if (p.y < -10) p.y = h + 10;
          if (p.y > h + 10) p.y = -10;

          // draw
          ctx.beginPath();
          ctx.fillStyle = p.hue;
          ctx.globalAlpha = 0.85;
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fill();
        }
        ctx.globalAlpha = 1;

        // comets
        for (let i = comets.length - 1; i >= 0; i--) {
          const c = comets[i];

          // attractors influence
          for (let k = 0; k < attractors.length; k++) {
            const a = attractors[k];
            const dx = a.x - c.x, dy = a.y - c.y;
            const rr = Math.max(80, dx*dx + dy*dy);
            const f = a.g / rr;
            c.vx += f * dx;
            c.vy += f * dy;
          }

          c.x += c.vx;
          c.y += c.vy;
          c.life *= 0.992;

          // tail
          ctx.globalCompositeOperation = 'lighter';
          const tail = ctx.createRadialGradient(c.x, c.y, 0, c.x, c.y, 24);
          tail.addColorStop(0, c.color + 'ee');
          tail.addColorStop(1, 'rgba(255,255,255,0)');
          ctx.fillStyle = tail;
          ctx.beginPath(); ctx.arc(c.x, c.y, 24, 0, Math.PI * 2); ctx.fill();
          ctx.globalCompositeOperation = 'source-over';

          ctx.fillStyle = c.color;
          ctx.globalAlpha = Math.max(0.4, c.life);
          ctx.beginPath(); ctx.arc(c.x, c.y, 2.4, 0, Math.PI * 2); ctx.fill();
          ctx.globalAlpha = 1;

          if (c.life < 0.12 || c.x < -40 || c.x > canvas.width + 40 || c.y < -40 || c.y > canvas.height + 40) {
            comets.splice(i, 1);
          }
        }

        t += 0.016;
      }

      // Controls
      themeBtn.addEventListener('click', () => setTheme(themeIndex + 1));
      runBtn.addEventListener('click', () => {
        running = !running;
        runBtn.setAttribute('aria-pressed', running ? 'false' : 'true');
        runBtn.textContent = running ? 'Pause motion' : 'Play motion';
        if (running) requestAnimationFrame(draw);
      });
      gravityRange.addEventListener('input', (e) => { G = parseFloat(e.target.value); });
      trailRange.addEventListener('input', (e) => { trail = parseFloat(e.target.value); });

      root.querySelector('[data-grain]').addEventListener('change', (e) => {
        grainLayer.classList.toggle('hidden', !e.target.checked);
      });
      tiltToggle.addEventListener('change', (e) => { tiltEnabled = e.target.checked; if (!tiltEnabled) stage.style.transform = 'none'; });

      // Init
      resize();
      if (running) requestAnimationFrame(draw);
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


