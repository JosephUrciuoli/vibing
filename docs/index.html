<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div class="vibe417" aria-label="Aurora Loom — Generative Ribbon Composer">
  <style>
    .vibe417{
      --bg-1:#0a0f1a;
      --bg-2:#121c2e;
      --ink:#ebf3ff;
      --muted:#9fb0cf;
      --line:rgba(255,255,255,0.15);
      --glass:rgba(255,255,255,0.06);
      --accent:#7afcc8;
      --accent-2:#6aa7ff;
      --accent-3:#c89bff;
      --shadow:0 26px 80px rgba(4,12,30,0.55);
      color:var(--ink);
      font:500 15.5px/1.55 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      position:relative; isolation:isolate;
      border-radius:26px; padding:clamp(16px,3.6vw,36px);
      min-height:560px; overflow:hidden;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    .vibe417.is-light{
      --bg-1:#f7fbff;
      --bg-2:#e9f3ff;
      --ink:#0f1626;
      --muted:#576780;
      --line:rgba(0,20,60,0.16);
      --glass:rgba(255,255,255,0.66);
      --accent:#02c39a; --accent-2:#2e7dff; --accent-3:#b24bff;
      --shadow:0 20px 56px rgba(10,40,90,0.18);
    }

    /* Deep backdrop */
    .vibe417 .field{
      position:absolute; inset:-8vmax;
      background:
        radial-gradient(80vmax 80vmax at -10% 110%, color-mix(in oklab, var(--accent-3) 18%, transparent), transparent 70%),
        radial-gradient(90vmax 60vmax at 120% -10%, color-mix(in oklab, var(--accent-2) 18%, transparent), transparent 68%),
        linear-gradient(140deg, var(--bg-1), var(--bg-2));
      filter:saturate(1.08);
      z-index:-3;
    }
    .vibe417 .orb{
      position:absolute; width:60vmax; height:60vmax; border-radius:50%;
      background:conic-gradient(from 0deg, color-mix(in oklab, var(--accent) 30%, transparent), transparent 22% 30%, color-mix(in oklab, var(--accent-2) 35%, transparent), transparent 55% 64%, color-mix(in oklab, var(--accent-3) 35%, transparent), transparent);
      filter:blur(40px) saturate(1.2);
      mix-blend-mode:screen; opacity:0.5; z-index:-2;
      animation:v417-spin 48s linear infinite;
    }
    .vibe417.is-light .orb{ mix-blend-mode:multiply; opacity:0.42; filter:blur(48px) saturate(1.05);}
    .vibe417 .orb.o1{ top:-28vmax; left:-22vmax; animation-duration:52s;}
    .vibe417 .orb.o2{ bottom:-30vmax; right:-24vmax; animation-duration:64s; animation-direction:reverse;}
    @keyframes v417-spin{ to{ transform:rotate(360deg);} }

    .vibe417 .grid{
      position:absolute; inset:-2px; pointer-events:none; z-index:-1;
      background:
        repeating-linear-gradient(0deg, color-mix(in oklab, var(--ink) 3%, transparent) 0 1px, transparent 1px 38px),
        repeating-linear-gradient(90deg, color-mix(in oklab, var(--ink) 3%, transparent) 0 1px, transparent 1px 38px);
      opacity:0.06;
      mask:radial-gradient(120% 120% at 50% 50%, #000, transparent 70%);
      animation:v417-breathe 18s ease-in-out infinite alternate;
      transform-origin:center;
    }
    @keyframes v417-breathe{
      0%{transform:perspective(900px) rotateX(7deg) rotateY(-6deg) translateY(0);}
      100%{transform:perspective(900px) rotateX(-5deg) rotateY(5deg) translateY(-8px);}
    }

    /* Card */
    .vibe417 .card{
      max-width:min(1040px,94vw); margin:0 auto;
      background:var(--glass); border:1px solid var(--line); border-radius:22px;
      box-shadow:var(--shadow); padding:clamp(18px,4.8vw,34px);
      backdrop-filter:blur(16px) saturate(1.2); -webkit-backdrop-filter:blur(16px) saturate(1.2);
      position:relative; overflow:clip;
    }
    .vibe417 .card::before{
      content:""; position:absolute; inset:-1px; border-radius:inherit; padding:1px;
      background:linear-gradient(120deg, color-mix(in oklab, var(--accent-2) 65%, transparent), transparent 40%, color-mix(in oklab, var(--accent-3) 60%, transparent) 70%, transparent);
      -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite:xor; mask-composite:exclude; opacity:0.5; pointer-events:none;
    }

    /* Top bar */
    .vibe417 .top{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px;}
    .vibe417 .badge{
      display:inline-flex; align-items:center; gap:10px; padding:8px 12px;
      border-radius:999px; border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,0.14), rgba(255,255,255,0.06));
      color:var(--muted); font-size:12px; letter-spacing:0.26px; text-transform:uppercase;
    }
    .vibe417 .dot{ width:8px; height:8px; border-radius:50%;
      background:radial-gradient(circle at 40% 40%, var(--accent), var(--accent-2));
      box-shadow:0 0 0 6px color-mix(in oklab, var(--accent) 20%, transparent);
      animation:v417-pulse 2.2s ease-in-out infinite;
    }
    @keyframes v417-pulse{ 0%,100%{transform:scale(1); opacity:1;} 50%{transform:scale(0.82); opacity:0.75;} }

    .vibe417 .controls{ display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
    .vibe417 .ctrl{
      width:44px; height:44px; display:grid; place-items:center; border-radius:12px; cursor:pointer;
      border:1px solid var(--line); background:linear-gradient(180deg, rgba(255,255,255,0.16), rgba(255,255,255,0.05));
      color:var(--ink); box-shadow:0 8px 20px rgba(0,0,0,0.18);
      transition:transform 180ms ease, background 180ms ease; -webkit-tap-highlight-color:transparent;
    }
    .vibe417 .ctrl:hover{ transform:translateY(-2px);}
    .vibe417 .ctrl:focus-visible{ outline:2px solid color-mix(in oklab, var(--accent-2) 60%, transparent); outline-offset:3px;}

    .vibe417 .ico{ width:20px; height:20px; }
    .vibe417 .ico.sun{
      background:radial-gradient(circle at 40% 40%, #fff8, #fff0),
                 radial-gradient(circle at 50% 50%, color-mix(in oklab, var(--accent) 55%, #fff), color-mix(in oklab, var(--accent-2) 40%, #fff) 60%);
      border-radius:50%; box-shadow:0 0 0 2px rgba(255,255,255,0.35) inset;
    }
    .vibe417 .ico.moon{
      border-radius:50%;
      background:radial-gradient(circle at 62% 38%, rgba(0,0,0,0.78) 0 40%, transparent 44%),
                 radial-gradient(circle at 50% 50%, #e6e9ff, #cdd7ff 60%);
      box-shadow:0 0 0 2px rgba(0,0,0,0.15) inset;
    }
    .vibe417.is-light .ico.moon{ display:none; }
    .vibe417:not(.is-light) .ico.sun{ display:none; }

    /* Title */
    .vibe417 .title{
      margin:6px 0 4px; font-weight:850; letter-spacing:-0.02em;
      font-size:clamp(34px,6.4vw,72px); line-height:1.02;
      background:linear-gradient(90deg, var(--ink) 0 10%, color-mix(in oklab, var(--accent-2) 85%, #fff) 40%, color-mix(in oklab, var(--accent-3) 80%, #fff) 68%, var(--ink) 95%);
      background-size:180% 100%; -webkit-background-clip:text; background-clip:text; color:transparent;
      animation:v417-sheen 9s ease-in-out infinite;
    }
    @keyframes v417-sheen{ 0%,100%{background-position:0% 50%;} 50%{background-position:100% 50%;} }
    .vibe417 .subtitle{ color:var(--muted); margin:8px 0 16px; font-size:clamp(14px,2.2vw,18px);}

    /* Stage layout */
    .vibe417 .stage{ display:grid; grid-template-columns:1.2fr 1fr; gap:clamp(16px,4vw,32px); align-items:center; }
    @media (max-width:860px){ .vibe417 .stage{ grid-template-columns:1fr; } }

    /* LOOM */
    .vibe417 .loom-wrap{ position:relative; }
    .vibe417 .loom{
      --tx:0deg; --ty:0deg;
      width:min(560px,86vw); aspect-ratio:1.2/1; position:relative; margin:8px auto;
      transform:perspective(1100px) rotateX(var(--tx)) rotateY(var(--ty));
      transition:transform 240ms ease;
    }
    .vibe417 .glow{
      position:absolute; inset:6% 2%; border-radius:32px;
      background:radial-gradient(60% 42% at 50% 50%, color-mix(in oklab, var(--accent-2) 18%, transparent), transparent 70%),
                 radial-gradient(50% 54% at 50% 50%, color-mix(in oklab, var(--accent-3) 14%, transparent), transparent 70%);
      filter:blur(18px); opacity:0.9;
    }
    .vibe417 .thread{
      --ang:0deg; --off:0px; --thick:18; --alpha:1;
      position:absolute; left:50%; top:50%;
      width:140%; height:calc(var(--thick) * 1px); border-radius:999px;
      background:linear-gradient(90deg, color-mix(in oklab, var(--c1) 90%, #fff) 0%, color-mix(in oklab, var(--c2) 90%, #fff) 100%);
      filter:blur(10px) saturate(1.12);
      transform:translate(-50%,-50%) rotate(var(--ang)) translateY(var(--off));
      mix-blend-mode:screen; opacity:var(--alpha);
      transition:opacity 220ms ease;
    }
    .vibe417.is-light .thread{ mix-blend-mode:multiply; filter:blur(12px) saturate(1.06); }
    .vibe417 .lens{
      position:absolute; width:220px; height:220px; border-radius:50%; pointer-events:none;
      background:radial-gradient(closest-side, rgba(255,255,255,0.28), rgba(255,255,255,0.08) 55%, transparent 70%);
      mix-blend-mode:screen; transform:translate(-50%,-50%); opacity:0; transition:opacity 200ms ease;
    }
    .vibe417.is-light .lens{ mix-blend-mode:multiply; background:radial-gradient(closest-side, rgba(0,0,0,0.10), rgba(0,0,0,0.04) 55%, transparent 70%); }

    /* Copy and chips */
    .vibe417 .copy h2{ margin:0 0 8px; font-weight:780; letter-spacing:-0.01em; font-size:clamp(18px,2.2vw,22px); color:var(--ink);}
    .vibe417 .copy p{ color:var(--muted); margin:0 0 14px;}
    .vibe417 .chips{ display:flex; gap:8px; flex-wrap:wrap; margin:10px 0 16px;}
    .vibe417 .chip{
      padding:8px 12px; border-radius:999px; border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,0.14), rgba(255,255,255,0.06));
      font-size:12px; color:var(--ink); cursor:pointer; -webkit-tap-highlight-color:transparent;
      transition:transform 150ms ease, background 150ms ease, color 150ms ease, box-shadow 150ms ease;
      user-select:none;
    }
    .vibe417 .chip:hover{ transform:translateY(-2px); }
    .vibe417 .chip[aria-pressed="true"]{
      background:linear-gradient(135deg, var(--accent-2), var(--accent));
      color:#0d1222; font-weight:750; border-color:transparent;
      box-shadow:0 10px 22px color-mix(in oklab, var(--accent-2) 28%, transparent);
    }

    .vibe417 .actions{ display:flex; gap:12px; flex-wrap:wrap; }
    .vibe417 .btn{
      position:relative; display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding:12px 16px; border-radius:14px; font-weight:780; letter-spacing:0.2px; text-decoration:none; cursor:pointer;
      border:1px solid var(--line); -webkit-tap-highlight-color:transparent;
      transition:transform 180ms ease, box-shadow 220ms ease, background 180ms ease, color 180ms ease;
      color:var(--ink); background:linear-gradient(180deg, rgba(255,255,255,0.14), rgba(255,255,255,0.06));
    }
    .vibe417 .btn.primary{
      color:#0a1020; background:linear-gradient(135deg, var(--accent-2), var(--accent));
      box-shadow:0 12px 28px color-mix(in oklab, var(--accent-2) 30%, transparent);
    }
    .vibe417 .btn:hover{ transform:translateY(-2px); }
    .vibe417 .btn:focus-visible{ outline:2px solid color-mix(in oklab, var(--accent-2) 60%, transparent); outline-offset:3px; }

    /* Slider */
    .vibe417 .slider{ display:flex; align-items:center; gap:10px; padding:6px 10px; border-radius:12px; border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.05)); height:44px; }
    .vibe417 .slider label{ font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:0.22px; }
    .vibe417 input[type="range"]{
      -webkit-appearance:none; appearance:none; width:140px; height:28px; background:transparent; cursor:pointer;
    }
    .vibe417 input[type="range"]::-webkit-slider-runnable-track{
      height:6px; border-radius:999px; border:1px solid var(--line);
      background:linear-gradient(90deg, var(--accent), var(--accent-2), var(--accent-3));
      box-shadow:inset 0 0 0 3px rgba(0,0,0,0.08);
    }
    .vibe417 input[type="range"]::-moz-range-track{ height:6px; border-radius:999px; background:linear-gradient(90deg, var(--accent), var(--accent-2), var(--accent-3)); border:1px solid var(--line); }
    .vibe417 input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none; appearance:none; width:18px; height:18px; border-radius:50%; margin-top:-6px;
      background:radial-gradient(circle at 40% 40%, #fff8, #fff0),
                 radial-gradient(circle at 50% 50%, color-mix(in oklab, var(--accent) 55%, #fff), color-mix(in oklab, var(--accent-2) 40%, #fff) 60%);
      box-shadow:0 2px 10px rgba(0,0,0,0.25), inset 0 0 0 2px rgba(255,255,255,0.6);
      border:none;
    }
    .vibe417 input[type="range"]::-moz-range-thumb{
      width:18px; height:18px; border-radius:50%; border:none;
      background:radial-gradient(circle at 50% 50%, color-mix(in oklab, var(--accent) 55%, #fff), color-mix(in oklab, var(--accent-2) 40%, #fff) 60%);
      box-shadow:0 2px 10px rgba(0,0,0,0.25), inset 0 0 0 2px rgba(255,255,255,0.6);
    }

    /* Meta */
    .vibe417 .meta{ margin-top:18px; display:flex; gap:12px; align-items:center; flex-wrap:wrap; color:var(--muted); font-size:12px;}
    .vibe417 .timeline{ --p:38%;
      flex:1 1 200px; height:10px; border-radius:999px; overflow:hidden;
      border:1px solid var(--line); background:linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04)); position:relative;
    }
    .vibe417 .timeline span{ position:absolute; inset:0; width:var(--p);
      background:linear-gradient(90deg, var(--accent), var(--accent-2), var(--accent-3));
      filter:saturate(1.1); transform-origin:left center;
    }

    /* Flash for Snap */
    .vibe417 .flash::after{
      content:""; position:absolute; inset:-2px; border-radius:inherit;
      background:radial-gradient(120% 120% at 50% 50%, rgba(255,255,255,0.65), transparent 60%);
      animation:v417-flash 360ms ease-out both; pointer-events:none;
    }
    @keyframes v417-flash{ from{opacity:0;} 40%{opacity:1;} to{opacity:0;} }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      .vibe417 .orb, .vibe417 .grid, .vibe417 .title, .vibe417 .thread, .vibe417 .lens{ animation:none !important; transition:none !important;}
    }
  </style>

  <div class="field" aria-hidden="true"></div>
  <span class="orb o1" aria-hidden="true"></span>
  <span class="orb o2" aria-hidden="true"></span>
  <div class="grid" aria-hidden="true"></div>

  <section class="card" id="v417-card" aria-label="Hero">
    <div class="top">
      <div class="badge"><span class="dot" aria-hidden="true"></span> Vibe 417 — Aurora Loom</div>
      <div class="controls">
        <div class="slider" role="group" aria-label="Tempo">
          <label for="v417-tempo">Tempo</label>
          <input id="v417-tempo" type="range" min="0.4" max="2.0" step="0.01" value="1">
        </div>
        <button class="ctrl" id="v417-theme" aria-label="Toggle Light/Dark" aria-pressed="false">
          <span class="ico sun" aria-hidden="true"></span>
          <span class="ico moon" aria-hidden="true"></span>
        </button>
        <button class="ctrl" id="v417-pause" aria-label="Pause ribbons" aria-pressed="false">
          <svg class="ico" viewBox="0 0 24 24" aria-hidden="true">
            <rect x="5" y="4" width="5" height="16" rx="1.5" fill="currentColor"></rect>
            <rect x="14" y="4" width="5" height="16" rx="1.5" fill="currentColor"></rect>
          </svg>
        </button>
      </div>
    </div>

    <h1 class="title">Aurora Loom</h1>
    <p class="subtitle">Weave light, not noise. Tilt the frame with your pointer. Choose a mood; watch the ribbons listen.</p>

    <div class="stage">
      <div class="loom-wrap">
        <div class="loom" id="v417-loom" aria-label="Interactive luminous threads" role="img">
          <div class="glow" aria-hidden="true"></div>

          <div class="thread t1" style="--c1:#8af5ff; --c2:#5aa7ff;"></div>
          <div class="thread t2" style="--c1:#a2ffd9; --c2:#02c39a;"></div>
          <div class="thread t3" style="--c1:#ffc7ff; --c2:#b98bff;"></div>
          <div class="thread t4" style="--c1:#ffe28e; --c2:#ffad3b;"></div>
          <div class="thread t5" style="--c1:#a8b6ff; --c2:#6aa7ff;"></div>
          <div class="thread t6" style="--c1:#b2ffe9; --c2:#7afcc8;"></div>
          <div class="thread t7" style="--c1:#ffd0b3; --c2:#ff8f63;"></div>
          <div class="thread t8" style="--c1:#d2b3ff; --c2:#c89bff;"></div>

          <div class="lens" id="v417-lens" aria-hidden="true"></div>
        </div>
      </div>

      <div class="copy">
        <h2>Modes</h2>
        <div class="chips" aria-label="Animation modes">
          <button class="chip" data-mode="sway" aria-pressed="true">Sway</button>
          <button class="chip" data-mode="flow" aria-pressed="false">Flow</button>
          <button class="chip" data-mode="bloom" aria-pressed="false">Bloom</button>
        </div>
        <p>Each mode reshapes the weave. Sway is gentle, Flow ripples, Bloom blossoms into wide arcs. Snap a frame to pause the moment.</p>
        <div class="actions">
          <a class="btn primary" href="#" role="button" id="v417-snap">Snap Frame</a>
          <a class="btn" href="#" role="button">See Palette</a>
        </div>
      </div>
    </div>

    <div class="meta">
      <div class="timeline" aria-label="Cycle progress"><span></span></div>
      <span id="last-updated">Last updated: 2025-11-04 10:19:46 EST</span>
    </div>
  </section>

  <script>
    (function(){
      const root = document.currentScript.closest('.vibe417');
      const card = root.querySelector('#v417-card');
      const loom = root.querySelector('#v417-loom');
      const lens = root.querySelector('#v417-lens');
      const threads = Array.from(root.querySelectorAll('.thread'));
      const chips = Array.from(root.querySelectorAll('.chip'));
      const themeBtn = root.querySelector('#v417-theme');
      const pauseBtn = root.querySelector('#v417-pause');
      const tempo = root.querySelector('#v417-tempo');
      const snap = root.querySelector('#v417-snap');
      const timeline = root.querySelector('.timeline');
      const updatedEl = root.querySelector('#last-updated');

      // Last updated
      try{
        const fmt = new Intl.DateTimeFormat([], {year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false, timeZoneName:'short'});
        updatedEl.textContent = 'Last updated: ' + fmt.format(new Date());
      }catch{
        updatedEl.textContent = 'Last updated: ' + new Date().toLocaleString();
      }

      // Theme
      const hour = new Date().getHours();
      if(hour >= 8 && hour <= 18) root.classList.add('is-light');
      function syncThemePressed(){ themeBtn.setAttribute('aria-pressed', String(root.classList.contains('is-light'))); }
      themeBtn.addEventListener('click', ()=>{ root.classList.toggle('is-light'); syncThemePressed(); });
      syncThemePressed();

      // Modes
      function setMode(mode){
        root.dataset.mode = mode;
        chips.forEach(c=> c.setAttribute('aria-pressed', String(c.dataset.mode === mode)));
      }
      chips.forEach(c=> c.addEventListener('click', ()=> setMode(c.dataset.mode)));
      setMode('sway');

      // Pointer: tilt + lens
      let tiltX = 0, tiltY = 0, amp = 1;
      function onPointer(e){
        const r = loom.getBoundingClientRect();
        const cx = r.left + r.width/2, cy = r.top + r.height/2;
        const x = (e.clientX - cx) / (r.width/2);
        const y = (e.clientY - cy) / (r.height/2);
        tiltX = 10 * Math.max(-1, Math.min(1, -y));
        tiltY = 12 * Math.max(-1, Math.min(1, x));
        amp = 1 + Math.min(1.2, Math.hypot(x, y));
        loom.style.setProperty('--tx', tiltX.toFixed(2) + 'deg');
        loom.style.setProperty('--ty', tiltY.toFixed(2) + 'deg');

        lens.style.left = e.clientX + 'px';
        lens.style.top = e.clientY + 'px';
        lens.style.opacity = '1';
      }
      window.addEventListener('mousemove', onPointer, {passive:true});
      window.addEventListener('mouseleave', ()=> lens.style.opacity = '0', {passive:true});

      // Animation loop
      const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      let running = true;
      let t0 = performance.now();
      const base = threads.map((_,i)=> (i*11 - 40)); // base angles
      function loop(now = performance.now()){
        if (!running || prefersReduced) return;
        const dt = (now - t0) / 1000; t0 = now;

        // Timeline
        const cycle = (now / 1000 / 10) % 1;
        timeline.style.setProperty('--p', Math.round(cycle*100) + '%');

        const speed = parseFloat(tempo.value || '1');
        const mode = root.dataset.mode || 'sway';

        threads.forEach((th, i)=>{
          const p = i / (threads.length-1);
          const w = 0.7 + i*0.07; // base angular weight
          const tt = now/1000 * speed * (0.9 + i*0.055);
          let off, ang, thick, alpha;

          if(mode === 'sway'){
            off = Math.sin(tt * w) * (30 + 38*p) * amp;
            ang = base[i] + Math.sin(tt * 0.7) * (8 + 6*p);
            thick = 14 + 10*(1+Math.sin(tt*0.9 + i*0.6))/2;
          }else if(mode === 'flow'){
            off = Math.sin(tt + i*0.8) * (44 + 46*p) * (0.9 + 0.3*Math.cos(tt*0.6));
            ang = base[i] + Math.cos(tt*0.9 + i*0.4) * (14 + 10*p);
            thick = 12 + 14*(1+Math.cos(tt*1.1 + i*0.4))/2;
          }else{ // bloom
            off = Math.sin(tt*1.6 + i*0.7) * (62 + 58*p) * amp;
            ang = base[i] + Math.sin(tt*1.4) * (22 + 12*p);
            thick = 10 + 18*(1+Math.sin(tt*1.6 + i*0.2))/2;
          }

          alpha = 0.6 + 0.4*Math.sin(tt + i*0.3 + cycle*6);
          th.style.setProperty('--off', off.toFixed(2) + 'px');
          th.style.setProperty('--ang', ang.toFixed(2) + 'deg');
          th.style.setProperty('--thick', thick.toFixed(2));
          th.style.setProperty('--alpha', Math.max(0.35, Math.min(1, alpha)).toFixed(2));
        });

        requestAnimationFrame(loop);
      }
      if(!prefersReduced) requestAnimationFrame(loop);

      // Pause
      pauseBtn.addEventListener('click', ()=>{
        running = !running;
        pauseBtn.setAttribute('aria-pressed', String(!running));
        if(running) { t0 = performance.now(); requestAnimationFrame(loop); }
      });

      // Snap frame (quick flash + brief pause)
      snap.addEventListener('click', (e)=>{
        e.preventDefault();
        if (!running) return;
        card.classList.add('flash');
        setTimeout(()=> card.classList.remove('flash'), 420);
        running = false; pauseBtn.setAttribute('aria-pressed','true');
        setTimeout(()=>{ running = true; pauseBtn.setAttribute('aria-pressed','false'); t0 = performance.now(); requestAnimationFrame(loop); }, 680);
      });

      // Keyboard navigation for chips
      chips.forEach((c, idx)=> c.addEventListener('keydown', (e)=>{
        if(e.key === 'ArrowRight' || e.key === 'ArrowDown'){
          e.preventDefault(); const n = chips[(idx+1)%chips.length]; n.focus(); setMode(n.dataset.mode);
        }else if(e.key === 'ArrowLeft' || e.key === 'ArrowUp'){
          e.preventDefault(); const p = chips[(idx-1+chips.length)%chips.length]; p.focus(); setMode(p.dataset.mode);
        }else if(e.key === 'Enter' || e.key === ' '){
          e.preventDefault(); setMode(c.dataset.mode);
        }
      }));
    })();
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


