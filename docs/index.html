<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<style>
  .vibe1851 {
    --bg1: #070a11;
    --bg2: #0d1222;
    --ink: #eaf1ff;
    --muted: #b2c0e0;
    --line: rgba(255,255,255,0.14);
    --c1: hsl(210 92% 64%);
    --c2: hsl(280 80% 68%);
    --c3: hsl(18 88% 62%);
    --radius: 28px;
    --tilt-x: 0;
    --tilt-y: 0;
    --speed: 1.0;
    color: var(--ink);
    padding: clamp(16px, 3.2vw, 28px);
    border-radius: var(--radius);
    border: 1px solid var(--line);
    background:
      radial-gradient(1200px 800px at -20% -40%, color-mix(in oklab, var(--c3) 14%, transparent), transparent 60%),
      radial-gradient(1000px 700px at 120% 130%, color-mix(in oklab, var(--c2) 10%, transparent), transparent 60%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
    box-shadow: 0 30px 90px rgba(0,0,0,0.55);
    position: relative;
    overflow: clip;
    isolation: isolate;
    min-height: 560px;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
  }

  .vibe1851 .halo {
    content: "";
    position: absolute; inset: -20%;
    pointer-events: none;
    background:
      radial-gradient(40% 30% at calc(50% + var(--tilt-x)*20%) calc(20% + var(--tilt-y)*20%),
        color-mix(in oklab, var(--c1) 12%, transparent), transparent 55%);
    mix-blend-mode: screen;
    opacity: .85;
    transition: opacity .35s ease, transform .35s ease;
  }
  .vibe1851:hover .halo { transform: scale(1.02); opacity: 1; }

  .vibe1851 .chrome {
    display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 12px;
    margin-bottom: 14px;
  }
  .vibe1851 .pill {
    display: inline-flex; align-items: center; gap: 10px;
    padding: 8px 12px; border-radius: 999px;
    border: 1px solid var(--line);
    background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.03));
    color: var(--muted);
    text-transform: uppercase; letter-spacing: .32px; font-size: 12px;
  }
  .vibe1851 .pill::before {
    content: ""; width: 9px; height: 9px; border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, var(--c1), var(--c3));
    box-shadow: 0 0 12px color-mix(in oklab, var(--c1) 45%, transparent);
  }
  .vibe1851 .actions { display: inline-flex; gap: 8px; flex-wrap: wrap; }
  .vibe1851 .btn {
    border: 1px solid var(--line);
    background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04));
    color: var(--ink);
    border-radius: 12px;
    padding: 8px 12px;
    font-size: 13px; cursor: pointer;
    transition: transform .15s ease, box-shadow .25s ease, border-color .25s ease, background .25s ease;
    box-shadow: 0 10px 26px rgba(0,0,0,0.28);
  }
  .vibe1851 .btn:hover { transform: translateY(-1px); border-color: rgba(255,255,255,0.24); }
  .vibe1851 .btn[aria-pressed="true"] {
    background: linear-gradient(90deg, color-mix(in oklab, var(--c1) 28%, transparent), color-mix(in oklab, var(--c3) 28%, transparent));
    border-color: transparent;
    box-shadow: 0 12px 30px color-mix(in oklab, var(--c1) 32%, transparent);
  }

  .vibe1851 .grid {
    display: grid;
    grid-template-columns: 1.02fr .98fr;
    gap: clamp(18px, 4.6vw, 34px);
    align-items: center;
  }
  @media (max-width: 880px) { .vibe1851 .grid { grid-template-columns: 1fr; } }

  .vibe1851 h1 {
    font-weight: 900;
    font-size: clamp(36px, 7.2vw, 84px);
    line-height: .9; margin: 6px 0 10px 0;
    letter-spacing: -0.6px;
    background: linear-gradient(96deg, #fff, color-mix(in oklab, var(--c1) 76%, #fff) 42%, color-mix(in oklab, var(--c3) 72%, #fff));
    -webkit-background-clip: text; background-clip: text; color: transparent;
  }
  .vibe1851 .lede {
    color: var(--muted);
    font-size: clamp(15px, 2.2vw, 20px);
    margin: 0 0 18px 0;
    text-wrap: pretty;
  }
  .vibe1851 .hints { display: flex; flex-wrap: wrap; gap: 8px; }
  .vibe1851 .hint {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 6px 10px; border-radius: 999px; font-size: 12px;
    border: 1px dashed rgba(255,255,255,0.24);
    color: #d7e5ff;
    background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.03));
  }
  .vibe1851 .hint svg { opacity: .75; }

  .vibe1851 .stage {
    position: relative;
    border: 1px solid var(--line);
    border-radius: 18px;
    background: radial-gradient(120% 140% at 50% 15%, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
    box-shadow: 0 22px 70px rgba(0,0,0,0.40);
    overflow: hidden;
    transform-style: preserve-3d;
    perspective: 1000px;
  }

  .vibe1851 .celestial {
    position: relative;
    width: min(560px, 88vw);
    aspect-ratio: 4/3;
    margin: 0 auto;
  }
  .vibe1851 canvas { position: absolute; inset: 0; display: block; width: 100%; height: 100%; }

  .vibe1851 .dust {
    position: absolute; inset: -2px; pointer-events: none;
    background: repeating-conic-gradient(from 0deg, rgba(255,255,255,0.02) 0 4deg, transparent 4deg 8deg);
    mix-blend-mode: overlay; opacity: .22; filter: blur(.6px);
    animation: v1851-dust 12s linear infinite;
  }
  @keyframes v1851-dust { to { transform: rotate(1turn); } }

  .vibe1851 .dock {
    display: grid; grid-template-columns: 1fr auto; align-items: center;
    gap: 12px; margin-top: 14px; padding-top: 12px;
    border-top: 1px dashed rgba(255,255,255,0.18);
    color: var(--muted); font-size: 12px;
  }
  .vibe1851 .controls { display: inline-flex; gap: 8px; flex-wrap: wrap; align-items: center; }
  .vibe1851 .range {
    display: inline-flex; align-items: center; gap: 10px;
    padding: 8px 10px; border-radius: 12px;
    border: 1px solid var(--line);
    background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
  }
  .vibe1851 .range input[type="range"] { width: 160px; accent-color: var(--c1); }
  .vibe1851 .palette { display: inline-flex; gap: 6px; align-items: center; }
  .vibe1851 .swatch {
    width: 14px; height: 14px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.22);
    box-shadow: 0 1px 6px rgba(0,0,0,0.25);
  }

  .vibe1851 .meta { opacity: .9; }
  .vibe1851 .meter {
    position: relative; width: 100px; height: 6px; border-radius: 999px; overflow: hidden;
    background: rgba(255,255,255,0.10); border: 1px solid var(--line);
  }
  .vibe1851 .meter > span {
    position: absolute; inset: 0; width: 40%;
    background: linear-gradient(90deg, var(--c1), var(--c3));
    border-radius: inherit; transform-origin: left center;
    transform: scaleX(var(--speed));
    transition: transform .2s ease;
  }

  /* Day theme */
  .vibe1851.day {
    --bg1: #f6f9ff;
    --bg2: #eaf2ff;
    --ink: #0f172a;
    --muted: #4b5a7c;
    --line: rgba(10,20,40,0.12);
    box-shadow: 0 18px 56px rgba(10,20,40,0.12);
  }
  .vibe1851.day .btn { color: var(--ink); background: linear-gradient(180deg, rgba(10,20,40,0.06), rgba(10,20,40,0.02)); box-shadow: 0 8px 22px rgba(10,20,40,0.08); }
  .vibe1851.day .hint { color: #2f3a56; border-color: rgba(10,20,40,0.2); background: linear-gradient(180deg, rgba(10,20,40,0.04), rgba(10,20,40,0.02)); }
  .vibe1851.day .stage { background: radial-gradient(120% 140% at 50% 15%, rgba(10,20,40,0.04), rgba(10,20,40,0.01)); box-shadow: 0 18px 60px rgba(10,20,40,0.14); }
  .vibe1851.day .dock { border-top-color: rgba(10,20,40,0.16); }

  /* Pause / Reduced motion */
  .vibe1851.paused .dust { animation-play-state: paused; }
  @media (prefers-reduced-motion: reduce) {
    .vibe1851 .dust { animation: none !important; }
    .vibe1851 .halo { display: none; }
  }
</style>

<div class="vibe1851" id="vibe1851-root" aria-live="polite" aria-label="Aster Dials — interactive orrery">
  <div class="halo" aria-hidden="true"></div>

  <div class="chrome">
    <span class="pill">Iteration 1851 — Aster Dials</span>
    <div class="actions">
      <button class="btn" data-action="mode" aria-pressed="false" title="Toggle day/night">Day</button>
      <button class="btn" data-action="shuffle" aria-pressed="false" title="Shuffle colors">Shuffle</button>
      <button class="btn" data-action="pause" aria-pressed="false" title="Pause/Play">Pause</button>
    </div>
  </div>

  <div class="grid">
    <section class="left">
      <h1>Design your own orrery.</h1>
      <p class="lede">Orbiting lights, time you can sculpt. Tilt the sky with your cursor, cast a comet, and let the rings hum.</p>
      <div class="hints" aria-label="Hints">
        <span class="hint">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 12h16" stroke="currentColor" stroke-width="1.4" opacity=".7"/></svg>
          Drag to tilt
        </span>
        <span class="hint">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="12" r="6.5" stroke="currentColor" stroke-width="1.4" opacity=".7"/></svg>
          Click to launch comet
        </span>
        <span class="hint">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M5 5l14 14M19 5L5 19" stroke="currentColor" stroke-width="1.4" opacity=".7"/></svg>
          Day / Night
        </span>
      </div>
    </section>

    <section class="right stage" aria-label="Orrery stage">
      <div class="celestial" id="celestial">
        <canvas id="stars" aria-hidden="true"></canvas>
        <canvas id="orrery" aria-label="Animated orbits"></canvas>
        <div class="dust" aria-hidden="true"></div>
      </div>

      <div class="dock">
        <div class="controls">
          <div class="range" title="Time flow">
            <span style="opacity:.85;">Time</span>
            <input id="time1851" type="range" min="0.2" max="3.0" step="0.1" value="1.0" aria-label="Time speed">
            <span id="time1851v" style="min-width:34px; text-align:right;">1.0x</span>
          </div>
          <div class="range" title="Orbit count">
            <span style="opacity:.85;">Orbits</span>
            <input id="orbits1851" type="range" min="3" max="9" step="1" value="5" aria-label="Orbit count">
            <span id="orbits1851v" style="min-width:20px; text-align:right;">5</span>
          </div>
          <div class="palette" aria-label="Active palette">
            <span class="swatch" id="w1" style="background: var(--c1)"></span>
            <span class="swatch" id="w2" style="background: var(--c2)"></span>
            <span class="swatch" id="w3" style="background: var(--c3)"></span>
          </div>
          <div class="meter" title="Time meter"><span></span></div>
        </div>
        <div class="meta">
          <span id="last-updated">Last updated: 2026-01-09 15:22:14 EST</span>
        </div>
      </div>
    </section>
  </div>
</div>

<script>
(function initV1851(){
  const root = document.getElementById('vibe1851-root');
  const celestial = document.getElementById('celestial');
  const stars = document.getElementById('stars');
  const orrery = document.getElementById('orrery');
  const modeBtn = root.querySelector('[data-action="mode"]');
  const shuffleBtn = root.querySelector('[data-action="shuffle"]');
  const pauseBtn = root.querySelector('[data-action="pause"]');
  const timeRange = document.getElementById('time1851');
  const timeVal = document.getElementById('time1851v');
  const orbitsRange = document.getElementById('orbits1851');
  const orbitsVal = document.getElementById('orbits1851v');
  const meter = root.querySelector('.meter > span');
  const ts = root.querySelector('#last-updated');

  // Timestamp
  try {
    const now = new Date();
    ts.textContent = 'Last updated: ' + now.toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'short' });
  } catch (e) {
    ts.textContent = 'Last updated: ' + (new Date()).toISOString();
  }

  // Palettes
  const hue = (h,s=82,l=62)=>`hsl(${(h+360)%360} ${s}% ${l}%)`;
  function setPalette(base) {
    root.style.setProperty('--c1', hue(base+0, 90, 64));
    root.style.setProperty('--c2', hue(base+120, 80, 66));
    root.style.setProperty('--c3', hue(base+210, 88, 62));
    // flash feedback
    shuffleBtn.setAttribute('aria-pressed','true');
    setTimeout(()=>shuffleBtn.setAttribute('aria-pressed','false'),360);
    // swatches
    const cs = getComputedStyle(root);
    root.querySelector('#w1').style.background = cs.getPropertyValue('--c1').trim();
    root.querySelector('#w2').style.background = cs.getPropertyValue('--c2').trim();
    root.querySelector('#w3').style.background = cs.getPropertyValue('--c3').trim();
  }

  // Ranges
  function applyTime() {
    const v = parseFloat(timeRange.value);
    timeVal.textContent = v.toFixed(1) + 'x';
    root.style.setProperty('--speed', v.toFixed(2));
    meter.style.transform = `scaleX(${Math.max(0.15, Math.min(1, v/3))})`;
  }
  function applyOrbits() {
    orbitCount = parseInt(orbitsRange.value,10);
    orbitsVal.textContent = orbitCount;
    initPlanets();
  }
  timeRange.addEventListener('input', applyTime, { passive: true });
  orbitsRange.addEventListener('input', applyOrbits, { passive: true });
  applyTime();

  // Pointer tilt
  function setTilt(clientX, clientY) {
    const r = root.getBoundingClientRect();
    const x = (clientX - r.left) / r.width - 0.5;
    const y = (clientY - r.top) / r.height - 0.5;
    root.style.setProperty('--tilt-x', x.toFixed(3));
    root.style.setProperty('--tilt-y', y.toFixed(3));
    tilt.x = x; tilt.y = y;
  }
  let tilt = {x:0, y:0};
  root.addEventListener('mousemove', (e)=>setTilt(e.clientX, e.clientY), { passive: true });
  root.addEventListener('touchmove', (e)=>{ const t=e.touches[0]; if (!t) return; setTilt(t.clientX, t.clientY); }, { passive: true });

  // Canvases setup
  const sctx = stars.getContext('2d');
  const octx = orrery.getContext('2d');
  let w=0,h=0,dpr=1;
  function resize() {
    const r = celestial.getBoundingClientRect();
    dpr = Math.min(window.devicePixelRatio||1, 2);
    w = Math.max(1, Math.floor(r.width * dpr));
    h = Math.max(1, Math.floor(r.height * dpr));
    [stars, orrery].forEach(c=>{ c.width=w; c.height=h; });
    drawStars(true);
  }
  window.addEventListener('resize', resize);
  resize();

  // Starfield
  let starField = [];
  function drawStars(seed=false) {
    if (seed || starField.length===0) {
      starField = [];
      const count = Math.floor((w*h) / 12000);
      for (let i=0;i<count;i++){
        starField.push({
          x: Math.random()*w,
          y: Math.random()*h,
          r: Math.random()*1.5 + 0.2,
          tw: Math.random()*Math.PI*2,
          s: Math.random()*0.8 + 0.2
        });
      }
    }
    sctx.clearRect(0,0,w,h);
    sctx.save();
    sctx.globalCompositeOperation = 'screen';
    for (let i=0;i<starField.length;i++){
      const st = starField[i];
      const a = 0.4 + Math.sin(st.tw)*0.3;
      sctx.beginPath();
      sctx.fillStyle = `rgba(255,255,255,${a.toFixed(3)})`;
      sctx.arc(st.x, st.y, st.r*dpr, 0, Math.PI*2);
      sctx.fill();
      st.tw += 0.02*st.s;
    }
    sctx.restore();
  }

  // Orrery simulation
  let running = true;
  let orbitCount = parseInt(orbitsRange.value,10);
  let planets = [];
  function initPlanets() {
    planets = [];
    const baseR = Math.min(w,h)*0.10;
    const gap = Math.min(w,h)*0.06;
    for (let i=0;i<orbitCount;i++){
      planets.push({
        r: baseR + i*gap,
        speed: 0.2 + i*0.06,
        phase: Math.random()*Math.PI*2,
        hueBias: i/orbitCount
      });
    }
  }
  initPlanets();

  // Comets
  const comets = [];
  celestial.addEventListener('pointerdown', (e) => {
    const r = celestial.getBoundingClientRect();
    const x = (e.clientX - r.left) * dpr;
    const y = (e.clientY - r.top) * dpr;
    const ang = Math.atan2(y - h/2, x - w/2);
    const spd = 3 + Math.random()*2;
    comets.push({
      x, y,
      vx: Math.cos(ang)*spd,
      vy: Math.sin(ang)*spd,
      life: 1.0,
      trail: []
    });
  });

  // Draw loop
  let start = performance.now();
  function loop(now){
    if (!running) return;
    const t = (now - start)/1000;
    const speed = parseFloat(getComputedStyle(root).getPropertyValue('--speed')) || 1;
    const cs = getComputedStyle(root);
    const c1 = cs.getPropertyValue('--c1').trim();
    const c2 = cs.getPropertyValue('--c2').trim();
    const c3 = cs.getPropertyValue('--c3').trim();

    // Update stars
    drawStars(false);

    // Draw orbits + planets
    octx.clearRect(0,0,w,h);
    octx.save();
    octx.translate(w/2, h/2);

    // tilt & faux perspective
    const sx = 1.0 - Math.abs(tilt.x)*0.05;
    const sy = 0.65 + tilt.y*0.25;
    const rot = tilt.x * 0.2;
    octx.rotate(rot);

    // central star glow
    const g = octx.createRadialGradient(0,0,0, 0,0, Math.min(w,h)*0.18);
    g.addColorStop(0, 'rgba(255,255,255,0.9)');
    g.addColorStop(0.3, c1);
    g.addColorStop(1, 'rgba(255,255,255,0)');
    octx.fillStyle = g;
    octx.beginPath();
    octx.arc(0,0, Math.min(w,h)*0.18, 0, Math.PI*2);
    octx.fill();

    // orbits
    octx.globalCompositeOperation = 'lighter';
    for (let i=0;i<planets.length;i++){
      const p = planets[i];
      // Orbit ring
      octx.strokeStyle = i%2? c2 : c3;
      octx.globalAlpha = 0.22;
      octx.lineWidth = (i===planets.length-1? 2.2:1.2)*dpr;
      octx.beginPath();
      octx.ellipse(0,0, p.r*sx, p.r*sy, 0, 0, Math.PI*2);
      octx.stroke();

      // Planet
      const ang = p.phase + t*(p.speed*0.8 + i*0.03)*speed;
      const x = Math.cos(ang) * p.r*sx;
      const y = Math.sin(ang) * p.r*sy;
      const grad = octx.createRadialGradient(x,y,0, x,y, Math.max(8, 18 - i*1.2)*dpr);
      grad.addColorStop(0, 'rgba(255,255,255,0.95)');
      grad.addColorStop(0.4, i%2? c2 : c3);
      grad.addColorStop(1, 'rgba(255,255,255,0)');
      octx.globalAlpha = 1;
      octx.fillStyle = grad;
      octx.beginPath();
      octx.arc(x,y, Math.max(3, 6 + (planets.length-i)), 0, Math.PI*2);
      octx.fill();

      // Constellation pulses
      if (i>0) {
        const prev = planets[i-1];
        const ang2 = prev.phase + t*(prev.speed*0.8 + (i-1)*0.03)*speed;
        const x2 = Math.cos(ang2) * prev.r*sx;
        const y2 = Math.sin(ang2) * prev.r*sy;
        octx.globalAlpha = 0.18 + 0.12*Math.sin(t*2 + i);
        octx.strokeStyle = c1;
        octx.lineWidth = 1.2*dpr;
        octx.beginPath();
        octx.moveTo(x,y);
        octx.lineTo(x2,y2);
        octx.stroke();
      }
    }

    // Comets
    for (let i=comets.length-1; i>=0; i--){
      const c = comets[i];
      c.trail.unshift({x:c.x, y:c.y, a:c.life});
      if (c.trail.length > 80) c.trail.pop();
      c.x += c.vx*speed;
      c.y += c.vy*speed;
      // gravity-ish pull
      const dx = -c.x, dy = -c.y;
      const dist = Math.max(80, Math.hypot(dx,dy));
      const pull = 0.05 / dist;
      c.vx += dx * pull;
      c.vy += dy * pull;
      c.life *= 0.995;

      // draw trail
      octx.globalAlpha = 0.6;
      octx.lineWidth = 2*dpr;
      const tailGrad = octx.createLinearGradient(c.x, c.y, c.x - c.vx*6, c.y - c.vy*6);
      tailGrad.addColorStop(0, c1);
      tailGrad.addColorStop(1, 'rgba(255,255,255,0)');
      octx.strokeStyle = tailGrad;
      octx.beginPath();
      for (let j=0;j<c.trail.length;j++){
        const tp = c.trail[j];
        if (j===0) octx.moveTo(tp.x, tp.y);
        else octx.lineTo(tp.x, tp.y);
      }
      octx.stroke();

      // head
      octx.globalAlpha = 0.9;
      const hg = octx.createRadialGradient(c.x,c.y,0, c.x,c.y, 10*dpr);
      hg.addColorStop(0,'#fff');
      hg.addColorStop(1, 'rgba(255,255,255,0)');
      octx.fillStyle = hg;
      octx.beginPath();
      octx.arc(c.x,c.y, 6*dpr, 0, Math.PI*2);
      octx.fill();

      // remove off-screen
      if (c.life < 0.2 || Math.abs(c.x) > w || Math.abs(c.y) > h) {
        comets.splice(i,1);
      }
    }

    octx.restore();
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  // Mode toggle
  modeBtn.addEventListener('click', () => {
    const isDay = !root.classList.contains('day');
    root.classList.toggle('day', isDay);
    modeBtn.setAttribute('aria-pressed', String(isDay));
    modeBtn.textContent = isDay ? 'Night' : 'Day';
  });

  // Pause
  pauseBtn.addEventListener('click', () => {
    const paused = !root.classList.contains('paused');
    root.classList.toggle('paused', paused);
    pauseBtn.setAttribute('aria-pressed', String(paused));
    pauseBtn.textContent = paused ? 'Play' : 'Pause';
    if (paused) {
      running = false;
    } else {
      running = true;
      start = performance.now();
      requestAnimationFrame(loop);
    }
  });

  // Shuffle palette
  shuffleBtn.addEventListener('click', () => {
    const base = Math.floor(Math.random()*360);
    setPalette(base);
  });

  // Seed
  setPalette(Math.floor(Math.random()*360));

  // Center tilt
  const r = root.getBoundingClientRect();
  setTilt(r.left + r.width/2, r.top + r.height/2);
})();
</script>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


