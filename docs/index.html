<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="atelier-1343" aria-label="Halo Engine">
  <style>
    /* Scope everything to #atelier-1343 */
    #atelier-1343 {
      --h: 210;                 /* theme hue */
      --ink: 238, 242, 248;     /* text RGB on dark */
      --rx: 0;                  /* tilt X */
      --ry: 0;                  /* tilt Y */
      --ring: 24px;             /* card radius */
      --grid: rgba(255,255,255,0.04);
      --glass: rgba(255,255,255,0.06);
      --stroke: rgba(255,255,255,0.12);
      color: rgba(var(--ink), 0.92);
      font: 500 15px/1.6 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      min-height: 560px;
      padding: clamp(18px, 4.6vw, 56px);
      display: grid;
      place-items: center;
      position: relative;
      isolation: isolate;
      letter-spacing: .2px;
      overflow: hidden;
      background:
        radial-gradient(1200px 800px at 20% 10%, hsl(calc(var(--h) + 30) 70% 16% / 0.8), transparent 60%),
        radial-gradient(1200px 800px at 85% 90%, hsl(calc(var(--h) - 40) 70% 14% / 0.8), transparent 60%),
        linear-gradient(180deg, #0b0f17, #070a12);
    }

    /* Ambient sky */
    #atelier-1343 .sky {
      position: absolute; inset: -8vmax;
      z-index: -1;
      pointer-events: none;
    }
    #atelier-1343 .stars {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      opacity: 0.9;
    }
    #atelier-1343 .glow {
      position: absolute; inset: 0;
      background:
        radial-gradient(1000px 1000px at 50% -10%, hsl(var(--h) 90% 60% / 0.15), transparent 60%),
        radial-gradient(1200px 800px at 70% 110%, hsl(calc(var(--h) + 60) 80% 60% / 0.12), transparent 65%);
      mix-blend-mode: screen;
    }
    #atelier-1343 .grain {
      position: absolute; inset: 0;
      opacity: .08; mix-blend-mode: overlay;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="200" height="200" filter="url(%23n)" opacity="0.28"/></svg>');
      background-size: 280px 280px;
    }

    /* Layout shell */
    #atelier-1343 .shell {
      width: min(1100px, 96vw);
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: clamp(18px, 5vw, 42px);
      align-items: center;
    }
    @media (max-width: 900px) {
      #atelier-1343 .shell { grid-template-columns: 1fr; }
    }

    /* Head block */
    #atelier-1343 .tag {
      display: inline-flex; align-items: center; gap: 10px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      color: rgba(var(--ink), 0.82);
      font-size: 12px; letter-spacing: .3px;
      width: fit-content;
    }
    #atelier-1343 .tag::before {
      content: "";
      width: 9px; height: 9px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, hsl(var(--h) 90% 60%) 60%);
      box-shadow: 0 0 10px hsl(var(--h) 95% 70% / 0.7);
    }
    #atelier-1343 h1 {
      margin: 10px 0 8px;
      font-weight: 900;
      line-height: 0.98;
      font-size: clamp(34px, 7.2vw, 80px);
      letter-spacing: -0.7px;
      color: transparent;
      background: linear-gradient(100deg, hsl(var(--h) 85% 65%), hsl(calc(var(--h) + 44) 85% 70%));
      -webkit-background-clip: text; background-clip: text;
      text-wrap: balance;
    }
    #atelier-1343 .lede {
      font-size: clamp(14px, 2.3vw, 18px);
      color: rgba(var(--ink), 0.72);
      margin-bottom: 16px;
      text-wrap: pretty;
    }

    /* Palette */
    #atelier-1343 .palette {
      display: flex; align-items: center; gap: 10px; flex-wrap: wrap;
      margin: 8px 0 20px;
    }
    #atelier-1343 .chip {
      width: 30px; height: 30px; border-radius: 50%;
      border: 1px solid var(--stroke);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.4), 0 10px 26px -16px rgba(0,0,0,0.7);
      background:
        conic-gradient(from 120deg,
          hsl(var(--ch) 90% 60%),
          hsl(calc(var(--ch) + 60) 90% 60%),
          hsl(calc(var(--ch) + 120) 90% 60%),
          hsl(var(--ch) 90% 60%));
      cursor: pointer;
      transition: transform 160ms ease, box-shadow 200ms ease, border-color 200ms ease;
    }
    #atelier-1343 .chip:hover { transform: translateY(-1px); box-shadow: inset 0 1px 0 rgba(255,255,255,0.5), 0 16px 34px -16px rgba(0,0,0,0.8); }
    #atelier-1343 .chip[aria-pressed="true"] { outline: none; border-color: hsl(var(--h) 90% 60% / 0.6); }

    /* Orbital disc stage */
    #atelier-1343 .stage {
      display: grid; place-items: center;
      perspective: 1200px;
    }
    #atelier-1343 .disc {
      position: relative;
      width: min(78vmin, 620px);
      aspect-ratio: 1 / 1;
      border-radius: 50%;
      background:
        radial-gradient(60% 60% at 50% 50%, rgba(255,255,255,0.08), rgba(255,255,255,0.02) 70%, transparent 72%),
        linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06));
      border: 1px solid var(--stroke);
      box-shadow:
        0 50px 120px -40px rgba(0,0,0,0.7),
        inset 0 1px 0 rgba(255,255,255,0.4),
        inset 0 -120px 200px rgba(0,0,0,0.25);
      transform: rotateX(var(--rx)) rotateY(var(--ry));
      transform-style: preserve-3d;
      transition: transform 140ms ease, box-shadow 240ms ease;
      overflow: hidden;
    }
    #atelier-1343 .disc::before {
      content: "";
      position: absolute; inset: 10px;
      border-radius: 50%;
      border: 1px dashed rgba(255,255,255,0.08);
      background:
        conic-gradient(from var(--spin, 0deg), hsl(var(--h) 95% 65% / 0.2), transparent 14%, transparent 86%, hsl(calc(var(--h) + 60) 90% 65% / 0.18));
      mix-blend-mode: screen;
      animation: spin 18s linear infinite;
      pointer-events: none;
    }
    #atelier-1343 .disc::after {
      content: "";
      position: absolute; inset: 0; pointer-events: none;
      background:
        linear-gradient(120deg, transparent 40%, rgba(255,255,255,0.08) 50%, transparent 62%) 0/240% 100%;
      mix-blend-mode: screen;
      animation: sheen 7s ease-in-out infinite;
    }

    #atelier-1343 .orb {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
    }

    @keyframes sheen { 0%, 100% { background-position: -120% 0; } 50% { background-position: 120% 0; } }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Control panel */
    #atelier-1343 .panel {
      border-radius: var(--ring);
      padding: clamp(18px, 4.2vw, 26px);
      background:
        linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.045));
      border: 1px solid var(--stroke);
      box-shadow:
        0 30px 80px -40px rgba(0,0,0,0.6),
        inset 0 1px 0 rgba(255,255,255,0.4);
      backdrop-filter: blur(14px) saturate(120%);
      -webkit-backdrop-filter: blur(14px) saturate(120%);
    }
    #atelier-1343 .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 8px;
    }
    #atelier-1343 .ctrl { display: grid; gap: 8px; }
    #atelier-1343 .ctrl label {
      font-size: 12px; color: rgba(var(--ink), 0.75);
      display: flex; justify-content: space-between; align-items: center; gap: 8px;
    }
    #atelier-1343 .val { font-variant-numeric: tabular-nums; color: rgba(var(--ink), 0.92); }

    #atelier-1343 .cta-row {
      display: flex; gap: 10px; flex-wrap: wrap; margin-top: 6px;
    }
    #atelier-1343 .btn {
      padding: 10px 14px; border-radius: 12px;
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.04));
      color: rgba(var(--ink), 0.9);
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 200ms ease, background 180ms ease, border-color 200ms ease;
      box-shadow: 0 10px 28px -18px rgba(0,0,0,0.7);
      font-size: 13px;
    }
    #atelier-1343 .btn:hover { transform: translateY(-1px); box-shadow: 0 16px 34px -18px rgba(0,0,0,0.75); }
    #atelier-1343 .btn[aria-pressed="true"] {
      background: linear-gradient(180deg, hsl(var(--h) 100% 65% / 0.12), hsl(var(--h) 100% 60% / 0.08));
      border-color: hsl(var(--h) 90% 60% / 0.5);
    }
    @media (max-width: 720px) {
      #atelier-1343 .controls { grid-template-columns: 1fr; }
      #atelier-1343 .cta-row .btn { flex: 1 1 auto; }
    }

    /* Range inputs */
    #atelier-1343 input[type="range"] {
      -webkit-appearance: none; appearance: none;
      height: 32px; width: 100%;
      background: transparent; cursor: pointer;
    }
    #atelier-1343 input[type="range"]::-webkit-slider-runnable-track {
      height: 8px; border-radius: 999px;
      background: linear-gradient(90deg, hsl(var(--h) 85% 60%), hsl(calc(var(--h) + 44) 85% 60%));
      border: 1px solid var(--stroke);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
    }
    #atelier-1343 input[type="range"]::-moz-range-track {
      height: 8px; border-radius: 999px;
      background: linear-gradient(90deg, hsl(var(--h) 85% 60%), hsl(calc(var(--h) + 44) 85% 60%));
      border: 1px solid var(--stroke);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
    }
    #atelier-1343 input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 22px; height: 22px; border-radius: 50%;
      margin-top: -7px;
      background: radial-gradient(circle at 30% 30%, #fff, hsl(var(--h) 90% 58%) 60%);
      border: 2px solid #fff;
      box-shadow: 0 10px 24px -12px rgba(0,0,0,0.6), 0 0 0 8px hsl(var(--h) 90% 60% / 0.18);
    }
    #atelier-1343 input[type="range"]::-moz-range-thumb {
      width: 22px; height: 22px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, hsl(var(--h) 90% 58%) 60%);
      border: 2px solid #fff;
      box-shadow: 0 10px 24px -12px rgba(0,0,0,0.6), 0 0 0 8px hsl(var(--h) 90% 60% / 0.18);
    }

    /* Footer */
    #atelier-1343 .foot {
      margin-top: 16px;
      display: flex; gap: 12px; align-items: center; justify-content: space-between; flex-wrap: wrap;
      font-size: 12.5px; color: rgba(var(--ink), 0.72);
    }
    #atelier-1343 #last-updated {
      padding: 6px 10px;
      border-radius: 9px;
      background: var(--glass);
      border: 1px solid var(--stroke);
      color: rgba(var(--ink), 0.9);
      font-variant-numeric: tabular-nums;
      white-space: nowrap;
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      #atelier-1343 .disc::after, #atelier-1343 .disc::before { animation: none !important; }
      #atelier-1343 .disc { transition: none !important; }
    }
  </style>

  <div class="sky" aria-hidden="true">
    <canvas class="stars"></canvas>
    <div class="glow"></div>
    <div class="grain"></div>
  </div>

  <div class="shell">
    <section class="panel">
      <span class="tag">Iteration 1343 • HALO ENGINE</span>
      <h1>Conduct Orbits</h1>
      <p class="lede">Compose motion with gravity, color, and tempo. Tilt the halo, set the satellites, and let the sky write in light.</p>

      <div class="palette" aria-label="Color themes">
        <button class="chip" data-theme="azure" style="--ch: 210" aria-label="Azure theme" aria-pressed="true" title="Azure"></button>
        <button class="chip" data-theme="magma" style="--ch: 14" aria-label="Magma theme" aria-pressed="false" title="Magma"></button>
        <button class="chip" data-theme="citrus" style="--ch: 44" aria-label="Citrus theme" aria-pressed="false" title="Citrus"></button>
        <button class="chip" data-theme="jade" style="--ch: 150" aria-label="Jade theme" aria-pressed="false" title="Jade"></button>
        <button class="chip" data-theme="ultra" style="--ch: 270" aria-label="Ultraviolet theme" aria-pressed="false" title="Ultraviolet"></button>
      </div>

      <div class="controls" role="region" aria-label="Orbital controls">
        <div class="ctrl">
          <label for="satellites">Satellites <span class="val" id="sat-val">9</span></label>
          <input id="satellites" type="range" min="3" max="32" step="1" value="9" aria-label="Number of satellites">
        </div>
        <div class="ctrl">
          <label for="tempo">Tempo <span class="val" id="tempo-val">1.0×</span></label>
          <input id="tempo" type="range" min="0.4" max="2.0" step="0.1" value="1.0" aria-label="Orbital speed multiplier">
        </div>
        <div class="ctrl">
          <label for="bloom">Bloom <span class="val" id="bloom-val">60%</span></label>
          <input id="bloom" type="range" min="0" max="100" step="5" value="60" aria-label="Glow intensity">
        </div>
        <div class="ctrl">
          <label for="trail">Trail <span class="val" id="trail-val">0.85</span></label>
          <input id="trail" type="range" min="0.70" max="0.98" step="0.01" value="0.85" aria-label="Persistence of trails">
        </div>
      </div>

      <div class="cta-row">
        <button class="btn" id="auto" aria-pressed="true" aria-label="Toggle auto-pilot">Auto‑pilot</button>
        <button class="btn" id="pause" aria-pressed="false" aria-label="Pause or resume">Pause</button>
      </div>

      <div class="foot">
        <span class="hint">Tip: Hover to tilt the halo. Press Space to pause. Themes gently cycle when auto‑pilot is on.</span>
        <span id="last-updated">Last updated: 2025-12-17 05:22:33 EST</span>
      </div>
    </section>

    <div class="stage" aria-hidden="true">
      <div class="disc" id="halo">
        <canvas class="orb"></canvas>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const root = document.getElementById('atelier-1343');
      if (!root) return;

      // Timestamp
      const timeEl = root.querySelector('#last-updated');
      try {
        const fmt = new Intl.DateTimeFormat(navigator.language || 'en-US', { dateStyle: 'medium', timeStyle: 'short' });
        timeEl.textContent = 'Last updated: ' + fmt.format(new Date());
      } catch {
        timeEl.textContent = 'Last updated: ' + new Date().toLocaleString();
      }

      // THEME handling
      const hues = { azure: 210, magma: 14, citrus: 44, jade: 150, ultra: 270 };
      function setTheme(name) {
        const h = hues[name] ?? 210;
        root.style.setProperty('--h', h);
        root.querySelectorAll('.chip').forEach(c => c.setAttribute('aria-pressed', String(c.dataset.theme === name)));
      }
      root.querySelectorAll('.chip').forEach(c => c.addEventListener('click', () => setTheme(c.dataset.theme)));
      setTheme('azure');

      // STARFIELD
      const starCanvas = root.querySelector('.stars');
      const sctx = starCanvas.getContext('2d');
      let SW = 0, SH = 0, SDPR = Math.min(2, window.devicePixelRatio || 1);
      let stars = [];
      function resizeStars() {
        const r = starCanvas.getBoundingClientRect();
        SW = Math.max(800, Math.floor(r.width));
        SH = Math.max(500, Math.floor(r.height));
        starCanvas.width = Math.floor(SW * SDPR);
        starCanvas.height = Math.floor(SH * SDPR);
        starCanvas.style.width = SW + 'px';
        starCanvas.style.height = SH + 'px';
        sctx.setTransform(SDPR, 0, 0, SDPR, 0, 0);
        // seed
        const count = Math.floor((SW * SH) / 14000);
        stars = Array.from({ length: count }, () => ({
          x: Math.random() * SW,
          y: Math.random() * SH,
          r: Math.random() * 1.2 + 0.2,
          a0: Math.random() * Math.PI * 2,
          sp: 0.4 + Math.random() * 0.8
        }));
      }
      resizeStars();
      window.addEventListener('resize', resizeStars);

      let st = 0, motionOK = !window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      function drawStars(t) {
        if (!motionOK) return;
        requestAnimationFrame(drawStars);
        st += 0.016;
        sctx.clearRect(0, 0, SW, SH);
        for (let i = 0; i < stars.length; i++) {
          const s = stars[i];
          const alpha = 0.35 + 0.65 * (0.5 + 0.5 * Math.sin(s.a0 + st * s.sp));
          sctx.fillStyle = `rgba(255,255,255,${alpha.toFixed(3)})`;
          sctx.beginPath();
          sctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
          sctx.fill();
        }
      }
      requestAnimationFrame(drawStars);

      // HALO ORBITS
      const disc = root.querySelector('#halo');
      const orbCanvas = root.querySelector('.orb');
      const octx = orbCanvas.getContext('2d');

      let W = 0, H = 0, D = 0, DPR = Math.min(2, window.devicePixelRatio || 1);
      let paused = false, auto = true, hover = false, angle = 0;

      let tempo = 1.0;
      let satellites = 9;
      let bloom = 60;     // 0..100
      let trail = 0.85;   // 0.70..0.98 persistence

      function resizeOrb() {
        const r = orbCanvas.getBoundingClientRect();
        W = Math.max(300, Math.floor(r.width));
        H = Math.max(300, Math.floor(r.height));
        D = Math.min(W, H);
        orbCanvas.width = Math.floor(W * DPR);
        orbCanvas.height = Math.floor(H * DPR);
        orbCanvas.style.width = W + 'px';
        orbCanvas.style.height = H + 'px';
        octx.setTransform(DPR, 0, 0, DPR, 0, 0);
        seedSatellites();
        clearCanvas(true);
      }
      function clearCanvas(hard = false) {
        if (hard) {
          octx.clearRect(0, 0, W, H);
          octx.fillStyle = 'rgba(0,0,0,0.0)';
          octx.fillRect(0,0,W,H);
        } else {
          // fade for trails
          octx.fillStyle = `rgba(7,10,18,${(1 - trail).toFixed(3)})`;
          octx.fillRect(0, 0, W, H);
        }
      }
      window.addEventListener('resize', resizeOrb);
      resizeOrb();

      let sats = [];
      function seedSatellites() {
        const layers = satellites;
        const hue = +getComputedStyle(root).getPropertyValue('--h') || 210;
        sats = Array.from({ length: layers }, (_, i) => {
          const u = (i + 1) / (layers + 1); // 0..1
          return {
            r: (D * 0.36) * u + 18,
            w: (0.4 + u * 2.0) * (Math.random() > 0.5 ? 1 : -1),
            a: Math.random() * Math.PI * 2,
            size: 1.6 + u * 4.4,
            hueOff: (i / layers) * 120,
            eccentricity: (Math.random() * 0.06) * (Math.random() > 0.5 ? 1 : -1)
          };
        });
      }
      seedSatellites();

      function drawHalo() {
        if (paused) return;
        requestAnimationFrame(drawHalo);
        clearCanvas(false);

        const cx = W / 2, cy = H / 2;
        const hue = +getComputedStyle(root).getPropertyValue('--h') || 210;
        const glowAlpha = bloom / 400; // softer mapping

        // Core
        const grd = octx.createRadialGradient(cx, cy, 0, cx, cy, D * 0.18);
        grd.addColorStop(0, `hsla(${hue} 95% 70% / 0.45)`);
        grd.addColorStop(1, `hsla(${hue} 95% 50% / 0.0)`);
        octx.fillStyle = grd;
        octx.beginPath();
        octx.arc(cx, cy, D * 0.18, 0, Math.PI * 2);
        octx.fill();

        octx.save();
        octx.globalCompositeOperation = 'lighter';

        // Orbits + satellites
        sats.forEach((s, i) => {
          // orbit path (subtle)
          octx.strokeStyle = `hsla(${(hue + s.hueOff) % 360} 90% 60% / ${0.05 + glowAlpha})`;
          octx.lineWidth = Math.max(1, s.size * 0.24);
          octx.beginPath();
          const rr = s.r * (1 + s.eccentricity);
          octx.ellipse(cx, cy, rr, s.r, 0, 0, Math.PI * 2);
          octx.stroke();

          // satellite position
          s.a += 0.008 * s.w * tempo;
          const x = cx + Math.cos(s.a) * rr;
          const y = cy + Math.sin(s.a) * s.r;

          // glow trail dot
          const col = (hue + s.hueOff) % 360;
          for (let k = 3; k >= 1; k--) {
            octx.fillStyle = `hsla(${col} 95% 60% / ${0.08 * k * glowAlpha * 6})`;
            octx.beginPath();
            octx.arc(x, y, s.size * (1.6 + k * 0.6), 0, Math.PI * 2);
            octx.fill();
          }

          // bright core
          octx.fillStyle = `hsla(${col} 100% 65% / 0.9)`;
          octx.beginPath();
          octx.arc(x, y, Math.max(1.2, s.size * 0.8), 0, Math.PI * 2);
          octx.fill();
        });

        octx.restore();
      }
      requestAnimationFrame(drawHalo);

      // Tilt interactions
      function setTilt(rx, ry) {
        root.style.setProperty('--rx', rx.toFixed(2) + 'deg');
        root.style.setProperty('--ry', ry.toFixed(2) + 'deg');
      }
      disc.addEventListener('pointerenter', () => { hover = true; });
      disc.addEventListener('pointerleave', () => { hover = false; setTilt(0, 0); });
      disc.addEventListener('pointermove', (e) => {
        if (!hover) return;
        const r = disc.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width;
        const y = (e.clientY - r.top) / r.height;
        const ry = (x - 0.5) * 16;
        const rx = (0.5 - y) * 12;
        setTilt(rx, ry);
      }, { passive: true });

      function roam() {
        if (paused) return;
        requestAnimationFrame(roam);
        if (auto && !hover) {
          angle += 0.006;
          const rx = Math.sin(angle * 0.9) * 6;
          const ry = Math.cos(angle * 0.7) * 8;
          setTilt(rx, ry);
        }
      }
      requestAnimationFrame(roam);

      // Controls
      const satRange = root.querySelector('#satellites');
      const tempoRange = root.querySelector('#tempo');
      const bloomRange = root.querySelector('#bloom');
      const trailRange = root.querySelector('#trail');

      const satOut = root.querySelector('#sat-val');
      const tempoOut = root.querySelector('#tempo-val');
      const bloomOut = root.querySelector('#bloom-val');
      const trailOut = root.querySelector('#trail-val');

      function updateSat(v) {
        satellites = parseInt(v, 10);
        satOut.textContent = satellites;
        seedSatellites();
      }
      function updateTempo(v) {
        tempo = parseFloat(v);
        tempoOut.textContent = tempo.toFixed(1) + '×';
      }
      function updateBloom(v) {
        bloom = parseInt(v, 10);
        bloomOut.textContent = bloom + '%';
      }
      function updateTrail(v) {
        trail = parseFloat(v);
        trailOut.textContent = trail.toFixed(2);
      }

      satRange.addEventListener('input', e => updateSat(e.target.value));
      tempoRange.addEventListener('input', e => updateTempo(e.target.value));
      bloomRange.addEventListener('input', e => updateBloom(e.target.value));
      trailRange.addEventListener('input', e => updateTrail(e.target.value));

      updateSat(satRange.value);
      updateTempo(tempoRange.value);
      updateBloom(bloomRange.value);
      updateTrail(trailRange.value);

      // Buttons
      const autoBtn = root.querySelector('#auto');
      const pauseBtn = root.querySelector('#pause');

      autoBtn.addEventListener('click', () => {
        auto = !auto;
        autoBtn.setAttribute('aria-pressed', String(auto));
      });

      function setPaused(state) {
        paused = state;
        pauseBtn.setAttribute('aria-pressed', String(paused));
        pauseBtn.textContent = paused ? 'Resume' : 'Pause';
        if (!paused) { requestAnimationFrame(drawHalo); requestAnimationFrame(roam); if (motionOK) requestAnimationFrame(drawStars); }
      }
      pauseBtn.addEventListener('click', () => setPaused(!paused));

      // Spacebar pause
      root.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
          e.preventDefault();
          setPaused(!paused);
        }
      });

      // Gentle theme auto-cycle when auto-pilot is on
      let cycle;
      function startCycle() {
        clearInterval(cycle);
        if (!motionOK) return;
        const keys = Object.keys(hues);
        let i = keys.findIndex(k => Math.round(hues[k]) === Math.round(+getComputedStyle(root).getPropertyValue('--h')));
        if (i < 0) i = 0;
        cycle = setInterval(() => {
          if (!auto) return;
          i = (i + 1) % keys.length;
          setTheme(keys[i]);
          seedSatellites();
        }, 9000);
      }
      startCycle();
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) clearInterval(cycle);
        else startCycle();
      });

      // Keep canvas crisp after theme change
      const pal = root.querySelector('.palette');
      pal.addEventListener('click', () => { seedSatellites(); });

      // Initial hard clear
      clearCanvas(true);
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


