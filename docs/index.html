<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="vibe543" aria-label="Orbital Garden — Living Poster">
  <style>
    /* ORBITAL GARDEN — Iteration 543 (scoped) */
    #vibe543 {
      --ink: #0e1326;
      --muted: #5b678a;
      --ring: rgba(14,19,38,.18);

      --bg1: #f8fbff;
      --bg2: #eaf1ff;

      --p1: #7c6dff; /* primary accent */
      --p2: #18d6c2;
      --p3: #ffb24d;

      --glass: color-mix(in srgb, #ffffff 82%, transparent);

      position: relative;
      min-height: 94vh;
      display: grid;
      place-items: center;
      padding: clamp(20px, 4vw, 54px);
      color: var(--ink);
      font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      border-radius: 36px;
      overflow: hidden;
      isolation: isolate;
      background:
        radial-gradient(140% 120% at 80% -10%, var(--bg1) 0%, var(--bg2) 60%, #dfe9ff 100%);
      box-shadow: 0 120px 340px rgba(7, 11, 24, .16);
    }
    #vibe543[data-theme="night"] {
      --ink: #e7eeff;
      --muted: #9fb0d8;
      --ring: rgba(255,255,255,.22);
      --bg1: #050915;
      --bg2: #0a1432;
      --glass: color-mix(in srgb, #0b133a 56%, transparent);
      background:
        radial-gradient(200% 160% at 20% -10%, #081233 0%, #040a1a 55%, #03060f 100%);
      box-shadow: 0 120px 360px rgba(0,0,0,.78);
    }

    /* Ambient orbs */
    #vibe543::before,
    #vibe543::after {
      content:"";
      position:absolute; inset:-25% -10% -25% -10%;
      filter: blur(120px) saturate(130%);
      mix-blend-mode: soft-light;
      opacity:.65;
      pointer-events:none;
      z-index:0;
      transform: rotate(-8deg) scale(1.06);
    }
    #vibe543::before{
      background:
        radial-gradient(40% 50% at 20% 20%, color-mix(in srgb, var(--p2), transparent 84%), transparent),
        radial-gradient(50% 60% at 85% 35%, color-mix(in srgb, var(--p1), transparent 86%), transparent),
        radial-gradient(60% 70% at 50% 90%, color-mix(in srgb, var(--p3), transparent 86%), transparent);
      animation: v543-aurora 36s ease-in-out infinite alternate;
    }
    #vibe543::after{
      background:
        conic-gradient(from 210deg at 30% 70%, color-mix(in srgb, var(--p1), transparent 88%), transparent 35%),
        conic-gradient(from 30deg at 80% 30%, color-mix(in srgb, var(--p2), transparent 88%), transparent 35%);
      animation: v543-aurora 48s ease-in-out infinite alternate-reverse;
    }
    @keyframes v543-aurora {
      0%{ transform: rotate(-6deg) scale(1.05); opacity:.56;}
      50%{ transform: rotate(-1deg) scale(1.08); opacity:.78;}
      100%{ transform: rotate(-10deg) scale(1.06); opacity:.54;}
    }

    /* Shell */
    #vibe543 .frame {
      position: relative; z-index:1;
      width: min(1200px, 96vw);
      border-radius: 30px;
      padding: clamp(18px, 3.2vw, 36px);
      background:
        linear-gradient(180deg, color-mix(in srgb, #fff 88%, transparent), color-mix(in srgb, #fff 30%, transparent)) padding-box,
        linear-gradient(120deg, color-mix(in srgb, var(--p1), transparent 40%), color-mix(in srgb, var(--p2), transparent 45%), color-mix(in srgb, var(--p3), transparent 40%)) border-box;
      border: 1px solid transparent;
      backdrop-filter: blur(14px) saturate(125%);
      -webkit-backdrop-filter: blur(14px) saturate(125%);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.82),
        0 50px 140px rgba(2,6,23,.14);
    }
    #vibe543[data-theme="night"] .frame {
      background:
        linear-gradient(180deg, color-mix(in srgb, #ffffff 10%, transparent), color-mix(in srgb, #ffffff 6%, transparent)) padding-box,
        linear-gradient(120deg, color-mix(in srgb, var(--p1), transparent 30%), color-mix(in srgb, var(--p2), transparent 35%), color-mix(in srgb, var(--p3), transparent 30%)) border-box;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.08),
        0 70px 180px rgba(0,0,0,.6);
    }

    /* Header */
    #vibe543 .top {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 14px;
      margin-bottom: clamp(14px, 2.4vw, 26px);
    }
    #vibe543 .brand {
      display: inline-grid; grid-auto-flow: column; gap: 12px; align-items: center;
      font-weight: 900; font-size: 11px; letter-spacing: .18em; text-transform: uppercase;
      opacity:.88; user-select:none;
    }
    #vibe543 .sig {
      width: 24px; height: 24px; border-radius: 8px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.35)) padding-box,
        conic-gradient(from 0deg, var(--p1), var(--p2), var(--p3), var(--p1)) border-box;
      border: 2px solid transparent;
      box-shadow: 0 0 0 3px rgba(0,0,0,.04), 0 0 26px color-mix(in srgb, var(--p2), transparent 48%);
    }

    #vibe543 .tools { display:flex; flex-wrap:wrap; align-items:center; gap:10px; }
    #vibe543 .chip {
      appearance:none; -webkit-appearance:none; cursor:pointer;
      padding:10px 16px; border-radius:999px; font-weight:800; font-size:12px;
      color: var(--ink);
      border: 1px solid rgba(2,6,23,.10);
      background:
        linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.25)) padding-box,
        linear-gradient(90deg, var(--p1), var(--p2)) border-box;
      transition: transform .15s ease, box-shadow .15s ease, opacity .2s ease;
      box-shadow: 0 14px 30px rgba(2,6,23,.10);
    }
    #vibe543[data-theme="night"] .chip {
      background:
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05)) padding-box,
        linear-gradient(90deg, var(--p1), var(--p2)) border-box;
      box-shadow: 0 18px 38px rgba(0,0,0,.45);
      color:var(--ink);
    }
    #vibe543 .chip:hover { transform: translateY(-1px); }
    #vibe543 .chip:active { transform: translateY(0); }

    #vibe543 .swatches { display:inline-flex; gap:8px; align-items:center; }
    #vibe543 .sw { width:22px; height:22px; border-radius:6px; cursor:pointer; border:1px solid rgba(2,6,23,.10); box-shadow:0 8px 18px rgba(2,6,23,.12); transition: transform .15s ease; }
    #vibe543 .sw:hover { transform: translateY(-1px) scale(1.03); }
    #vibe543 .sw:focus-visible { outline:2px solid var(--ring); outline-offset:4px; }

    /* Layout */
    #vibe543 .grid {
      display:grid;
      grid-template-columns: 1.05fr 1fr;
      gap: clamp(18px, 4vw, 48px);
      align-items: center;
    }
    @media (max-width: 980px) { #vibe543 .grid { grid-template-columns: 1fr; } }

    /* Copy */
    #vibe543 h1 {
      margin: 0 0 10px 0;
      font-size: clamp(48px, 9vw, 128px);
      line-height: .86; letter-spacing: -.02em; text-wrap: balance;
      background: linear-gradient(100deg,
        color-mix(in srgb, var(--ink), var(--p1) 22%),
        color-mix(in srgb, var(--ink), var(--p2) 18%),
        color-mix(in srgb, var(--ink), var(--p3) 16%));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-shadow: 0 1px 0 rgba(255,255,255,.16);
    }
    #vibe543[data-theme="night"] h1 { text-shadow: 0 1px 0 rgba(255,255,255,.06); }
    #vibe543 .lead { margin: 8px 0 16px 0; color: var(--muted); font-size: clamp(14px, 2.2vw, 18px); max-width: 64ch; }
    #vibe543 .micro { color: var(--muted); font-size: 12px; }

    /* Stage */
    #vibe543 .stage {
      position: relative;
      width: min(760px, 90vw);
      aspect-ratio: 1 / 1;
      border-radius: 28px;
      overflow: hidden;
      border: 1px solid rgba(2,6,23,.10);
      background:
        radial-gradient(120% 120% at 50% 50%, rgba(255,255,255,.96), rgba(255,255,255,.24));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.80),
        0 34px 120px rgba(2,6,23,.18);
      transform-style: preserve-3d;
      transition: transform .2s ease, box-shadow .2s ease;
    }
    #vibe543[data-theme="night"] .stage {
      background:
        radial-gradient(120% 120% at 50% 50%, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border-color: rgba(255,255,255,.10);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.08),
        0 60px 160px rgba(0,0,0,.55);
    }
    #vibe543 .stage:hover {
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.85),
        0 60px 180px rgba(2,6,23,.22);
    }
    #vibe543 canvas { position:absolute; inset:0; display:block; width:100%; height:100%; }

    /* Dock */
    #vibe543 .dock {
      position: absolute; left: 50%; bottom: 12px; transform: translateX(-50%);
      display: flex; flex-wrap: wrap; align-items: center; gap: 10px;
      padding: 10px 12px; border-radius: 14px;
      border: 1px solid rgba(2,6,23,.08);
      background: rgba(255,255,255,.70);
      backdrop-filter: blur(10px) saturate(130%);
      -webkit-backdrop-filter: blur(10px) saturate(130%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.75), 0 14px 30px rgba(2,6,23,.12);
    }
    #vibe543[data-theme="night"] .dock {
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.10);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08), 0 26px 60px rgba(0,0,0,.45);
    }
    #vibe543 .dock label {
      font-size: 10px; letter-spacing: .14em; text-transform: uppercase; font-weight: 900; opacity: .7; margin-right: 8px;
    }
    #vibe543 input[type="range"] {
      -webkit-appearance: none; appearance: none;
      width: 150px; height: 26px; border-radius: 999px; padding: 0 10px;
      border: 1px solid rgba(2,6,23,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.25));
    }
    #vibe543[data-theme="night"] input[type="range"] {
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
      border-color: rgba(255,255,255,.10);
    }
    #vibe543 input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none; width: 18px; height: 18px; border-radius: 50%;
      background:
        linear-gradient(#fff, #fff) padding-box,
        conic-gradient(var(--p1), var(--p2), var(--p3), var(--p1)) border-box;
      border: 2px solid transparent; box-shadow: 0 8px 18px rgba(2,6,23,.18); cursor: pointer;
    }
    #vibe543 input[type="range"]::-moz-range-thumb {
      width: 18px; height: 18px; border: none; border-radius: 50%; background: #fff; cursor: pointer;
    }

    /* Footer */
    #vibe543 .foot {
      display: flex; align-items: center; justify-content: space-between; gap: 10px;
      margin-top: clamp(16px, 2.6vw, 24px); color: var(--muted); font-size: 12px;
    }
    #vibe543 .pulse {
      width: 10px; height: 10px; border-radius: 50%;
      background: radial-gradient(circle at 50% 50%, var(--p2), var(--p1));
      box-shadow: 0 0 0 0 rgba(71,255,209,.0);
      animation: v543-pulse 2.8s ease-in-out infinite;
    }
    @keyframes v543-pulse {
      0%{ box-shadow:0 0 0 0 rgba(71,255,209, .20); transform: scale(1);}
      70%{ box-shadow:0 0 0 14px rgba(71,255,209,0); transform: scale(1.06);}
      100%{ box-shadow:0 0 0 0 rgba(71,255,209,0); transform: scale(1);}
    }

    /* Focus glow */
    #vibe543 .frame:focus-within {
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.85),
        0 0 0 2px var(--ring),
        0 34px 110px rgba(0,0,0,.28);
    }

    /* Watermark iteration */
    #vibe543 .iter {
      position: absolute; inset: auto 16px 12px auto; z-index: 3;
      opacity: .35; font-size: 10px; letter-spacing: .1em; text-transform: uppercase; user-select: none;
    }

    /* Huge backdrop numeral */
    #vibe543 .num {
      position:absolute; inset: -10% auto auto -2%;
      font-size: clamp(160px, 36vw, 520px);
      line-height:.8; font-weight: 900; letter-spacing:-.04em; opacity:.06;
      background: linear-gradient(120deg, var(--p1), var(--p2), var(--p3));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      pointer-events:none; user-select:none; z-index:0;
      transform: translateY(6%);
    }

    @media (prefers-reduced-motion: reduce) {
      #vibe543::before, #vibe543::after, #vibe543 .pulse { animation: none !important; }
      #vibe543 .stage { transition: none !important; }
    }
  </style>

  <div class="frame" role="region" aria-label="Orbital canvas and controls">
    <div class="num" aria-hidden="true">543</div>

    <div class="top">
      <div class="brand"><span class="sig" aria-hidden="true"></span> Solstice Studio · Iteration 543</div>
      <div class="tools">
        <button class="chip" id="t543" type="button" aria-label="Toggle theme" aria-pressed="false">Theme</button>
        <div class="swatches" role="group" aria-label="Seasons">
          <button class="sw" data-palette="dawn" aria-label="Palette: Dawn" style="background: radial-gradient(circle at 30% 30%, #ff8ba7, #ffd166);"></button>
          <button class="sw" data-palette="noon" aria-label="Palette: Noon" style="background: radial-gradient(circle at 30% 30%, #22d3ee, #22c55e);"></button>
          <button class="sw" data-palette="dusk" aria-label="Palette: Dusk" style="background: radial-gradient(circle at 30% 30%, #8b5cf6, #f97316);"></button>
          <button class="sw" data-palette="midnight" aria-label="Palette: Midnight" style="background: radial-gradient(circle at 30% 30%, #06b6d4, #60a5fa);"></button>
        </div>
        <button class="chip" id="auto543" type="button" aria-label="Auto compose">Auto</button>
        <button class="chip" id="trail543" type="button" aria-pressed="true" aria-label="Toggle trails">Trails</button>
        <button class="chip" id="pause543" type="button" aria-pressed="false" aria-label="Pause animation">Pause</button>
      </div>
    </div>

    <div class="grid">
      <div class="copy">
        <h1>Orbital Garden</h1>
        <p class="lead">A circular field of light where particles drift, gather, and bloom. Pull the tide with your cursor, tune the gravity, change the season.</p>
        <p class="micro">No libraries—just Canvas and care. Day or night, the glow stays gentle.</p>
      </div>

      <figure class="stage" role="img" aria-label="An animated garden of glowing orbits that respond to your touch">
        <canvas id="orb543"></canvas>

        <div class="dock" aria-label="Canvas controls">
          <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
            <label for="grav543">Gravity</label>
            <input id="grav543" type="range" min="2" max="120" value="46" />
          </div>
          <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
            <label for="pop543">Population</label>
            <input id="pop543" type="range" min="30" max="280" value="160" />
          </div>
        </div>
      </figure>
    </div>

    <div class="foot">
      <div style="display:flex; align-items:center; gap:10px;">
        <span class="pulse" aria-hidden="true"></span>
        <span>System humming</span>
      </div>
      <span id="last-updated">Last updated: 2025-11-10 06:15:42 EST</span>
    </div>
  </div>

  <span class="iter" aria-hidden="true">Iteration 543</span>

  <script>
    (function () {
      const root = document.getElementById('vibe543');
      const canvas = root.querySelector('#orb543');
      const ctx = canvas.getContext('2d');

      const rGrav = root.querySelector('#grav543');
      const rPop  = root.querySelector('#pop543');

      const btnTheme = root.querySelector('#t543');
      const btnTrail = root.querySelector('#trail543');
      const btnPause = root.querySelector('#pause543');
      const btnAuto  = root.querySelector('#auto543');
      const swatches = Array.from(root.querySelectorAll('.sw'));

      const stamp = root.querySelector('#last-updated');

      // Timestamp
      try {
        const now = new Date();
        const parts = new Intl.DateTimeFormat(undefined, {
          year: 'numeric', month: 'short', day: '2-digit',
          hour: '2-digit', minute: '2-digit', second: '2-digit',
          timeZoneName: 'short'
        }).format(now);
        stamp.textContent = 'Last updated: ' + parts;
      } catch {
        stamp.textContent = 'Last updated just now';
      }

      // Theme
      const hour = (new Date()).getHours();
      const timeTheme = (hour >= 7 && hour < 19) ? 'day' : 'night';
      const savedTheme = localStorage.getItem('v543-theme');
      const startTheme = savedTheme || (timeTheme === 'night' ? 'night' : 'day');
      root.dataset.theme = startTheme;
      btnTheme.setAttribute('aria-pressed', String(startTheme === 'night'));
      btnTheme.addEventListener('click', () => {
        const next = root.dataset.theme === 'night' ? 'day' : 'night';
        root.dataset.theme = next;
        localStorage.setItem('v543-theme', next);
        btnTheme.setAttribute('aria-pressed', String(next === 'night'));
        draw(true);
      });

      // Palettes
      const palettes = {
        dawn:     ['#ff8ba7','#ffd166','#ffdede'],
        noon:     ['#22d3ee','#22c55e','#a7f3d0'],
        dusk:     ['#8b5cf6','#f97316','#fde68a'],
        midnight: ['#06b6d4','#60a5fa','#c084fc']
      };
      function setPalette(name){
        const [a,b,c] = palettes[name] || palettes.noon;
        root.style.setProperty('--p1', a);
        root.style.setProperty('--p2', b);
        root.style.setProperty('--p3', c);
        try { localStorage.setItem('v543-palette', name); } catch {}
        draw(true);
      }
      const savedPalette = localStorage.getItem('v543-palette');
      setPalette(savedPalette || (startTheme==='night' ? 'midnight' : 'noon'));
      swatches.forEach(b => b.addEventListener('click', ()=> setPalette(b.dataset.palette)));

      // Trails toggle
      function setTrails(on){
        btnTrail.setAttribute('aria-pressed', String(on));
        btnTrail.textContent = on ? 'Trails' : 'Trails Off';
      }
      setTrails(true);
      btnTrail.addEventListener('click', ()=> setTrails(btnTrail.getAttribute('aria-pressed')!=='true'));

      // Pause toggle
      const state = { paused:false, t0: performance.now() };
      btnPause.addEventListener('click', () => {
        const pressed = btnPause.getAttribute('aria-pressed') === 'true';
        const next = !pressed;
        btnPause.setAttribute('aria-pressed', String(next));
        btnPause.textContent = next ? 'Play' : 'Pause';
        state.paused = next;
        if (!next && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
          state.t0 = performance.now();
          loop(state.t0);
        }
      });

      // Auto compose
      btnAuto.addEventListener('click', () => {
        const keys = Object.keys(palettes);
        const pick = keys[Math.floor(Math.random()*keys.length)];
        setPalette(pick);
        const trailsOn = Math.random() > .4;
        setTrails(trailsOn);
        rGrav.value = String(20 + Math.floor(Math.random()*90));
        rPop.value = String(60 + Math.floor(Math.random()*200));
        rebuild();
        // little bounce
        const stage = canvas.parentElement;
        if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
          stage.style.transform = 'perspective(1100px) rotateX(2deg) rotateY(-3deg) scale(1.03)';
          setTimeout(()=> stage.style.transform='', 220);
        }
      });

      // Pointer parallax + attractor
      const pointer = { x: .5, y: .5 };
      const stage = canvas.parentElement;
      function applyTilt() {
        const rx = (0.5 - pointer.y) * 8;
        const ry = (pointer.x - 0.5) * 12;
        if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
          stage.style.transform = `perspective(1100px) rotateX(${rx}deg) rotateY(${ry}deg)`;
        }
      }
      stage.addEventListener('pointermove', (e) => {
        const r = stage.getBoundingClientRect();
        pointer.x = (e.clientX - r.left) / r.width;
        pointer.y = (e.clientY - r.top) / r.height;
        applyTilt();
      });
      stage.addEventListener('pointerleave', () => { pointer.x = .5; pointer.y = .5; stage.style.transform=''; });

      // Canvas sizing
      const DPR = Math.min(2, window.devicePixelRatio || 1);
      function size() {
        const rect = canvas.getBoundingClientRect();
        canvas.width = Math.floor(rect.width * DPR);
        canvas.height = Math.floor(rect.height * DPR);
        ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      }
      size();
      addEventListener('resize', () => { size(); draw(true); }, { passive: true });

      // Orbiters
      let particles = [];
      function rebuild(){
        const target = Number(rPop.value);
        const diff = target - particles.length;
        if (diff > 0) {
          for (let i=0;i<diff;i++){
            particles.push(spawn());
          }
        } else if (diff < 0) {
          particles.splice(target);
        }
      }
      function spawn(){
        const radius = 40 + Math.random() * (Math.min(canvas.width, canvas.height)/2 - 60);
        return {
          r: radius,
          a: Math.random() * Math.PI * 2,
          s: (Math.random() * 0.6 + 0.2) * 0.002, // angular speed factor
          jitter: Math.random() * 1000,
          hue: pickHue(Math.random()),
          size: 2.3 + Math.random()*2.6
        };
      }
      function pickHue(t){
        // Interpolate between p1, p2, p3 based on t
        const get = (v) => getComputedStyle(root).getPropertyValue(v).trim();
        const c1 = hexToRgb(get('--p1'));
        const c2 = hexToRgb(get('--p2'));
        const c3 = hexToRgb(get('--p3'));
        const m = t < .5
          ? mix(c1, c2, t/.5)
          : mix(c2, c3, (t-.5)/.5);
        return `rgba(${m.r},${m.g},${m.b},1)`;
      }
      function mix(a,b,t){ return { r:Math.round(a.r+(b.r-a.r)*t), g:Math.round(a.g+(b.g-a.g)*t), b:Math.round(a.b+(b.b-a.b)*t) }; }
      function hexToRgb(hex){
        const h = hex.replace('#','').trim();
        const v = h.length===3
          ? h.split('').map(x=>x+x).join('')
          : h;
        const n = parseInt(v,16);
        return { r:(n>>16)&255, g:(n>>8)&255, b:n&255 };
      }

      rebuild();

      [rGrav, rPop].forEach(r => r.addEventListener('input', () => {
        if (r === rPop) rebuild();
        draw(true);
      }));

      // Clear helpers
      function clear(hard=false){
        const { width: W, height: H } = canvas;
        if (hard || btnTrail.getAttribute('aria-pressed') !== 'true') {
          ctx.clearRect(0,0,W,H);
          const theme = root.dataset.theme;
          const g = ctx.createLinearGradient(0,0,0,H);
          if (theme === 'night') { g.addColorStop(0, '#0a122d'); g.addColorStop(1, '#040916'); }
          else { g.addColorStop(0, '#ffffff'); g.addColorStop(1, '#f7fbff'); }
          ctx.fillStyle = g; ctx.fillRect(0,0,W,H);
        } else {
          // subtle fade for trails
          ctx.fillStyle = root.dataset.theme === 'night' ? 'rgba(3,6,14,0.08)' : 'rgba(255,255,255,0.08)';
          ctx.fillRect(0,0,W,H);
        }
      }

      // Draw
      function draw(skipMotion=false, now=performance.now()){
        const rect = canvas.getBoundingClientRect();
        const W = rect.width, H = rect.height;
        clear(false);

        const cx = W/2 + (pointer.x-.5) * 26;
        const cy = H/2 + (pointer.y-.5) * 26;

        ctx.globalCompositeOperation = 'lighter';

        const grav = Number(rGrav.value) * 0.0006;

        for (let i=0;i<particles.length;i++){
          const p = particles[i];
          const t = skipMotion ? 0 : now;
          // orbit angle update with gentle noise
          const noise = Math.sin((p.jitter + t*0.0007) + p.r*0.01) * 0.0008;
          p.a += (p.s + noise + grav * (p.r/500));

          // radial breathing
          const breathe = Math.sin((t*0.001 + p.jitter)*0.7) * 4;
          const rr = p.r + breathe;

          const x = cx + Math.cos(p.a) * rr;
          const y = cy + Math.sin(p.a) * rr;

          const radgrad = ctx.createRadialGradient(x, y, 0, x, y, p.size*6);
          radgrad.addColorStop(0, p.hue);
          radgrad.addColorStop(1, 'rgba(0,0,0,0)');

          ctx.shadowColor = p.hue;
          ctx.shadowBlur = 12;

          ctx.fillStyle = radgrad;
          ctx.beginPath();
          ctx.arc(x, y, p.size, 0, Math.PI*2);
          ctx.fill();

          // connective filaments
          if (i % 12 === 0) {
            const j = (i + Math.floor(10 + Math.random()*40)) % particles.length;
            const q = particles[j];
            const x2 = cx + Math.cos(q.a) * (q.r + Math.sin(t*0.001 + q.jitter)*4);
            const y2 = cy + Math.sin(q.a) * (q.r + Math.cos(t*0.001 + q.jitter)*4);
            ctx.shadowBlur = 0;
            ctx.globalAlpha = 0.18;
            ctx.strokeStyle = p.hue;
            ctx.lineWidth = 1.2;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x2, y2);
            ctx.stroke();
            ctx.globalAlpha = 1;
          }
        }

        // vignette
        const g = ctx.createRadialGradient(W/2, H/2, Math.min(W,H)*0.3, W/2, H/2, Math.max(W,H)*0.7);
        if (root.dataset.theme === 'night') { g.addColorStop(0, 'rgba(0,0,0,0)'); g.addColorStop(1, 'rgba(0,0,0,0.24)'); }
        else { g.addColorStop(0, 'rgba(255,255,255,0)'); g.addColorStop(1, 'rgba(0,0,0,0.06)'); }
        ctx.globalCompositeOperation = 'multiply';
        ctx.fillStyle = g;
        ctx.fillRect(0,0,W,H);
        ctx.globalCompositeOperation = 'source-over';
      }

      function loop(now) {
        if (state.paused || window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
        draw(false, now);
        requestAnimationFrame(loop);
      }

      // Initial paint
      draw(true);
      if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        state.t0 = performance.now();
        loop(state.t0);
      }
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


