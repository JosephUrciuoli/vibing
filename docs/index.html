<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<style>
  .vibe-1714{
    --surface: #0b0f1a;
    --ink: #eaf0ff;
    --muted: #a3b3cc;
    --line: rgba(255,255,255,.14);
    --veil: rgba(255,255,255,.06);
    --a: #77ffe1;
    --b: #7c8bff;
    --c: #ffb36a;
    --r: 28px;
    position: relative;
    min-height: 920px;
    color: var(--ink);
    border-radius: var(--r);
    overflow: hidden;
    isolation: isolate;
    font: 600 13px/1.7 ui-sans-serif, -apple-system, system-ui, Inter, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
    background:
      radial-gradient(1200px 900px at calc(var(--mx,55%)) calc(var(--my,35%)), color-mix(in hsl, var(--b), transparent 70%), transparent 60%),
      radial-gradient(900px 700px at 10% 110%, color-mix(in hsl, var(--c), transparent 75%), transparent 60%),
      linear-gradient(180deg, #070a12, var(--surface));
    box-shadow: 0 44px 160px -60px rgba(0,0,0,.75), inset 0 1px 0 rgba(255,255,255,.08);
  }
  .vibe-1714[data-theme="dawn"]{
    --surface: #f7f9ff;
    --ink: #091022;
    --muted: #596a86;
    --line: rgba(10,14,26,.14);
    --veil: rgba(255,255,255,.7);
    box-shadow: 0 44px 120px -60px rgba(10,14,26,.28), inset 0 1px 0 rgba(255,255,255,.85);
    background:
      radial-gradient(1200px 900px at calc(var(--mx,50%)) calc(var(--my,30%)), color-mix(in hsl, var(--a), transparent 80%), transparent 60%),
      radial-gradient(900px 700px at 100% 100%, color-mix(in hsl, var(--b), transparent 80%), transparent 60%),
      linear-gradient(180deg, #ffffff, var(--surface));
  }
  .vibe-1714[data-motion="off"] *{ animation: none !important; transition: none !important; }

  /* Aurora veils */
  .vibe-1714::before,
  .vibe-1714::after{
    content:"";
    position:absolute; inset:-25% -15%;
    filter: blur(70px);
    pointer-events:none;
    mix-blend-mode: screen;
    opacity:.5;
    background: conic-gradient(from 0deg at 50% 50%, var(--a), var(--b), var(--c), var(--a));
    animation: drift-1714 50s linear infinite;
  }
  .vibe-1714::after{
    mix-blend-mode: overlay;
    opacity:.35;
    background: radial-gradient(60% 80% at 40% 50%, color-mix(in hsl, var(--a), transparent 40%), transparent),
                radial-gradient(80% 60% at 70% 60%, color-mix(in hsl, var(--b), transparent 40%), transparent);
    animation-duration: 38s;
    animation-direction: reverse;
  }
  @keyframes drift-1714 { to { transform: rotate(360deg); } }

  /* Layout chrome */
  .chrome-1714{ position: relative; z-index: 2; display:grid; grid-template-rows: auto 1fr auto; gap: clamp(20px,4vw,44px); padding: clamp(20px,4vw,44px); }

  /* Top nav */
  .nav-1714{ display:flex; align-items:center; justify-content:space-between; gap:16px; }
  .brand-1714{ display:flex; align-items:center; gap:12px; }
  .seal-1714{ width:50px; height:50px; border-radius:14px; background: var(--veil); border:1px solid var(--line); position:relative; overflow:hidden; backdrop-filter: blur(8px); box-shadow: inset 0 0 0 1px rgba(255,255,255,.18); }
  .seal-1714::before{
    content:""; position:absolute; inset:8px; border-radius:10px;
    background:
      radial-gradient(circle at 30% 30%, #fff, var(--a) 60%),
      conic-gradient(from 90deg, var(--a), var(--b), var(--c), var(--a));
    mix-blend-mode: plus-lighter;
    animation: swirl-1714 10s linear infinite;
  }
  @keyframes swirl-1714 { to { transform: rotate(360deg); } }
  .word-1714{ font-weight:1000; letter-spacing:.2px; font-size:18px; }
  .controls-1714{ display:flex; gap:8px; flex-wrap:wrap; }
  .btn-1714{
    appearance:none; border:1px solid var(--line); background: var(--veil); color: currentColor;
    padding:10px 14px; border-radius:999px; cursor:pointer; font-weight:900;
    backdrop-filter: blur(10px);
    transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
  }
  .btn-1714:hover{ transform: translateY(-1px); box-shadow: 0 16px 30px -16px rgba(0,0,0,.45); }
  .btn-1714.primary{ background: linear-gradient(90deg, var(--b), var(--a)); color: #0b1224; border-color: transparent; }

  /* Hero */
  .hero-1714{ display:grid; grid-template-columns: 1.15fr 1.1fr; gap: clamp(18px,4.6vw,56px); align-items:center; }
  @media (max-width: 980px){ .hero-1714{ grid-template-columns: 1fr; } }
  .copy-1714 .eyebrow{ letter-spacing:.28em; text-transform:uppercase; font-size:12px; color: var(--muted); }
  .copy-1714 h1{
    margin: 10px 0 8px; line-height:.86; font-weight:1000; letter-spacing:-0.02em;
    font-size: clamp(54px, 9.6vw, 118px);
    text-wrap: balance;
    background: linear-gradient(120deg, var(--a), var(--b), var(--c));
    -webkit-background-clip: text; background-clip: text; color: transparent;
    text-shadow: 0 40px 90px color-mix(in srgb, var(--b) 22%, transparent);
  }
  .copy-1714 p{ max-width: 62ch; color: var(--muted); font-size: clamp(14px, 2.1vw, 18px); }
  .cta-row-1714{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 16px; }
  .cta-1714{ text-decoration:none; display:inline-flex; align-items:center; gap:10px; padding:12px 16px; border-radius:14px; font-weight:900; border:1px solid var(--line); }
  .cta-1714.ghost{ background: var(--veil); color: var(--ink); }
  .cta-1714.primary{ background: linear-gradient(90deg, var(--b), var(--c)); color: #0b1224; border-color: transparent; }

  /* Stage */
  .stage-1714{
    position: relative; border-radius: 30px; overflow: hidden; min-height: clamp(460px, 58vw, 760px);
    background:
      radial-gradient(100% 100% at 50% 0%, rgba(255,255,255,.06), transparent 60%),
      linear-gradient(180deg, color-mix(in hsl, var(--surface), transparent 0%), color-mix(in hsl, var(--surface), transparent 6%));
    border: 1px solid var(--line);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.15), 0 26px 68px -32px rgba(0,0,0,.55);
  }
  .glowhalo-1714{
    position:absolute; inset:0; pointer-events:none; z-index:1; opacity:.6; mix-blend-mode: screen;
    background:
      radial-gradient(40% 30% at 35% 35%, color-mix(in hsl, var(--a), transparent 40%), transparent),
      radial-gradient(40% 30% at 65% 65%, color-mix(in hsl, var(--b), transparent 40%), transparent),
      radial-gradient(50% 40% at 50% 75%, color-mix(in hsl, var(--c), transparent 50%), transparent);
    animation: float-1714 16s ease-in-out infinite;
  }
  @keyframes float-1714 {
    0%,100%{ transform: translate3d(0,0,0) scale(1); }
    50%{ transform: translate3d(0,-1.5%,0) scale(1.02); }
  }

  canvas.sky-1714{ display:block; width:100%; height:100%; position:relative; z-index:2; }

  .hud-1714{
    position:absolute; inset:14px auto auto 14px; z-index:3;
    display:flex; align-items:center; gap:10px; padding:8px 12px;
    border-radius: 12px; border:1px solid var(--line); background: var(--veil);
    color: var(--muted); font-weight:900; backdrop-filter: blur(8px);
  }
  .hud-1714 .dot{ width:10px; height:10px; border-radius:50%; background: radial-gradient(circle at 30% 30%, #fff, var(--a)); box-shadow: 0 0 0 2px rgba(255,255,255,.2) inset; }

  /* Floating dock */
  .dock-1714{
    position: sticky; bottom: 16px; z-index: 3; display:flex; justify-content: space-between; align-items:center; gap:10px; flex-wrap:wrap;
    padding: 8px; border-radius: 16px; border:1px solid var(--line); background: var(--veil); backdrop-filter: blur(10px);
  }
  .pill-1714{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid var(--line); background: color-mix(in srgb, var(--veil) 100%, transparent); color: currentColor; font-weight:900; }
  .icon-btn-1714{
    appearance:none; display:inline-flex; align-items:center; justify-content:center; gap:8px;
    min-width:40px; height:40px; padding:0 12px; border-radius:999px;
    border:1px solid var(--line); background: var(--veil); color: currentColor; cursor:pointer; font-weight:900;
    transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
  }
  .icon-btn-1714:hover{ transform: translateY(-1px); box-shadow: 0 16px 30px -16px rgba(0,0,0,.5); }
  .icon-btn-1714.primary{ background: linear-gradient(90deg, var(--b), var(--a)); color:#0b1224; border-color: transparent; }
  .icon-1714{ width:18px; height:18px; }

  /* Meta row */
  .meta-1714{ display:flex; align-items:center; justify-content: space-between; gap:8px; flex-wrap:wrap; color: var(--muted); }
  .ticker-1714{
    margin-top:10px; height:38px; border-radius:999px; overflow:hidden; position:relative;
    border:1px solid var(--line); background: var(--veil); color: var(--muted);
  }
  .ticker-1714 .line{ position:absolute; inset:0; display:flex; align-items:center; gap:28px; padding: 0 16px; white-space: nowrap; animation: slide-1714 24s linear infinite; }
  @keyframes slide-1714 { to { transform: translateX(-50%); } }

  /* SR only */
  .sr{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
</style>

<div class="vibe-1714" data-theme="midnight" data-motion="on" aria-label="Nocturne — Constellation Loom">
  <div class="chrome-1714">
    <div class="nav-1714">
      <div class="brand-1714">
        <div class="seal-1714" aria-hidden="true"></div>
        <div class="word-1714">Nocturne</div>
      </div>
      <div class="controls-1714">
        <button class="btn-1714 theme" aria-pressed="true" aria-label="Toggle theme">Theme</button>
        <button class="btn-1714 motion" aria-pressed="false" aria-label="Toggle motion">Motion</button>
        <button class="btn-1714 palette" aria-label="Shuffle palette">Palette</button>
      </div>
    </div>

    <section class="hero-1714">
      <div class="copy-1714">
        <div class="eyebrow">Iteration 1714 • Constellation Loom</div>
        <h1>Thread the night.</h1>
        <p>Plant stars, draw their threads, and watch the sky learn your hand. Every gesture spins a new atlas.</p>
        <div class="cta-row-1714">
          <a href="#" class="cta-1714 primary auto">Auto</a>
          <a href="#" class="cta-1714 ghost clear">Clear</a>
        </div>
      </div>

      <figure class="stage-1714" aria-label="Interactive constellation composer">
        <div class="glowhalo-1714" aria-hidden="true"></div>
        <canvas class="sky-1714" role="img" aria-label="Stars drifting with connective filaments"></canvas>
        <div class="hud-1714" aria-hidden="true">
          <span class="dot"></span>
          <span>Sky weaving</span>
        </div>
      </figure>
    </section>

    <div class="ticker-1714" aria-hidden="true">
      <div class="line">
        <span>Silence is a canvas. Motion is ink.</span>
        <span>Chart feelings, not coordinates.</span>
        <span>Maps for places that don’t exist—yet.</span>
        <span>Silence is a canvas. Motion is ink.</span>
        <span>Chart feelings, not coordinates.</span>
        <span>Maps for places that don’t exist—yet.</span>
      </div>
    </div>

    <div class="dock-1714" aria-label="Controls">
      <div class="pill-1714">
        <svg class="icon-1714" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-opacity=".6" stroke-width="1.4"/>
          <path d="M12 7v5l4 2" stroke="currentColor" stroke-opacity=".85" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
        <span id="last-updated">Last updated: 2026-01-03 10:17:44 EST</span>
      </div>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <button class="icon-btn-1714 weave primary" aria-pressed="true" aria-label="Toggle weave">
          <svg class="icon-1714" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M4 7c6 0 10 10 16 10M4 17c6 0 10-10 16-10" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
          Weave
        </button>
        <button class="icon-btn-1714 glow" aria-pressed="true" aria-label="Toggle glow">
          <svg class="icon-1714" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <circle cx="12" cy="12" r="3" fill="currentColor"/>
            <path d="M12 2v3m0 14v3M2 12h3m14 0h3M5 5l2 2m10 10 2 2M19 5l-2 2M5 19l2-2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
          Glow
        </button>
        <button class="icon-btn-1714 gravity" aria-pressed="false" aria-label="Toggle gravity">
          <svg class="icon-1714" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <circle cx="12" cy="12" r="2.4" fill="currentColor"/>
            <path d="M12 4v2m0 12v2M4 12h2m12 0h2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
          Gravity
        </button>
        <button class="icon-btn-1714 capture" aria-label="Save image">
          <svg class="icon-1714" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M5 7h3l1-2h6l1 2h3v12H5V7z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
            <circle cx="12" cy="13" r="3.2" stroke="currentColor" stroke-width="1.6"/>
          </svg>
          Capture
        </button>
      </div>
    </div>

    <div class="meta-1714" aria-hidden="true">
      <span>Midnight mode • Click to add stars • Drag to steer</span>
      <span>Palette responds to theme</span>
    </div>
  </div>
</div>

<script>
(function(){
  const root = document.currentScript.previousElementSibling;
  const last = root.querySelector('#last-updated');

  // Timestamp
  try {
    const now = new Date();
    last.textContent = now.toLocaleString(undefined, {
      year:'numeric', month:'2-digit', day:'2-digit',
      hour:'2-digit', minute:'2-digit', second:'2-digit',
      hour12:false, timeZoneName:'short'
    });
  } catch(e){ last.textContent = 'just now'; }

  // Elements
  const themeBtn = root.querySelector('.btn-1714.theme');
  const motionBtn = root.querySelector('.btn-1714.motion');
  const paletteBtn = root.querySelector('.btn-1714.palette');
  const autoBtn = root.querySelector('.auto');
  const clearBtn = root.querySelector('.clear');

  const weaveBtn = root.querySelector('.icon-btn-1714.weave');
  const glowBtn = root.querySelector('.icon-btn-1714.glow');
  const gravityBtn = root.querySelector('.icon-btn-1714.gravity');
  const captureBtn = root.querySelector('.icon-btn-1714.capture');

  // Theme persistence
  const KEY_THEME = 'v1714-theme';
  const savedTheme = localStorage.getItem(KEY_THEME);
  if (savedTheme) root.setAttribute('data-theme', savedTheme);
  const syncThemeAria = () => themeBtn.setAttribute('aria-pressed', String(root.getAttribute('data-theme') !== 'dawn'));
  syncThemeAria();
  themeBtn.addEventListener('click', ()=>{
    const next = root.getAttribute('data-theme') === 'dawn' ? 'midnight' : 'dawn';
    root.setAttribute('data-theme', next);
    localStorage.setItem(KEY_THEME, next);
    syncThemeAria();
  });

  // Motion + reduced-motion
  const KEY_MOTION = 'v1714-motion';
  const mediaReduce = matchMedia('(prefers-reduced-motion: reduce)');
  const savedMotion = localStorage.getItem(KEY_MOTION);
  function setMotion(on){
    root.setAttribute('data-motion', on ? 'on' : 'off');
    motionBtn.setAttribute('aria-pressed', String(!on));
    if (!on) cancelAnimationFrame(loopId); else loop();
  }
  if (savedMotion) setMotion(savedMotion === 'on');
  else if (mediaReduce.matches) setMotion(false);
  motionBtn.addEventListener('click', ()=>{
    const on = root.getAttribute('data-motion') === 'off';
    setMotion(on);
    localStorage.setItem(KEY_MOTION, on ? 'on' : 'off');
  });
  mediaReduce.addEventListener && mediaReduce.addEventListener('change', e => setMotion(!e.matches));

  // Pointer light for background
  let rafGlow;
  function moveLight(e){
    if (root.getAttribute('data-motion') === 'off') return;
    const r = root.getBoundingClientRect();
    const x = ('touches' in e) ? e.touches[0].clientX : e.clientX;
    const y = ('touches' in e) ? e.touches[0].clientY : e.clientY;
    const px = ((x - r.left) / r.width) * 100;
    const py = ((y - r.top) / r.height) * 100;
    if (rafGlow) cancelAnimationFrame(rafGlow);
    rafGlow = requestAnimationFrame(()=>{
      root.style.setProperty('--mx', px + '%');
      root.style.setProperty('--my', py + '%');
    });
  }
  root.addEventListener('pointermove', moveLight, { passive:true });

  // Canvas setup
  const stage = root.querySelector('.stage-1714');
  const canvas = root.querySelector('.sky-1714');
  const ctx = canvas.getContext('2d');
  const state = {
    stars: [],
    weave: true,
    glow: false,
    gravity: false,
    auto: false,
    pointer: { x: 0, y: 0, down: false },
    t: 0
  };

  function dpr(){ return Math.max(1, Math.min(2, window.devicePixelRatio || 1)); }
  function sizeCanvas(){
    const r = stage.getBoundingClientRect();
    const ratio = dpr();
    canvas.width = Math.floor(r.width * ratio);
    canvas.height = Math.floor(r.height * ratio);
    canvas.style.width = r.width + 'px';
    canvas.style.height = r.height + 'px';
    ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
  }
  function bgColor(){
    return root.getAttribute('data-theme')==='dawn' ? '#f7f9ff' : '#070a12';
  }
  function palette(){
    const s = getComputedStyle(root);
    return [s.getPropertyValue('--a').trim(), s.getPropertyValue('--b').trim(), s.getPropertyValue('--c').trim()];
  }

  function addStar(x, y, vx = (Math.random()-.5)*0.4, vy = (Math.random()-.5)*0.4){
    const r = stage.getBoundingClientRect();
    state.stars.push({
      x: Math.max(0, Math.min(r.width, x)),
      y: Math.max(0, Math.min(r.height, y)),
      vx, vy,
      life: 1,
      mass: 1 + Math.random()*1.5
    });
  }

  // Seed a few
  function seed(n=24){
    const r = stage.getBoundingClientRect();
    for(let i=0;i<n;i++) addStar(Math.random()*r.width, Math.random()*r.height);
  }

  // UI wiring
  const setPressed = (el, on) => el.setAttribute('aria-pressed', String(on));
  const toggleBtn = (btn, key) => {
    state[key] = !state[key];
    setPressed(btn, state[key]);
    if (btn.classList.contains('primary')) btn.classList.toggle('primary', state[key]);
  };

  weaveBtn.addEventListener('click', ()=>{ toggleBtn(weaveBtn, 'weave'); });
  glowBtn.addEventListener('click', ()=>{ state.glow = !state.glow; setPressed(glowBtn, state.glow); glowBtn.classList.toggle('primary', state.glow); });
  gravityBtn.addEventListener('click', ()=>{ state.gravity = !state.gravity; setPressed(gravityBtn, state.gravity); gravityBtn.classList.toggle('primary', state.gravity); });

  autoBtn.addEventListener('click', (e)=>{ e.preventDefault(); state.auto = !state.auto; autoBtn.classList.toggle('primary', state.auto); });
  clearBtn.addEventListener('click', (e)=>{ e.preventDefault(); state.stars = []; });

  paletteBtn.addEventListener('click', ()=>{
    const hues = [Math.random()*360, Math.random()*360, Math.random()*360];
    const hsl = (h, s, l) => `hsl(${Math.round(h)}, ${s}%, ${l}%)`;
    const dawn = root.getAttribute('data-theme')==='dawn';
    root.style.setProperty('--a', hsl(hues[0], 86, dawn?46:64));
    root.style.setProperty('--b', hsl(hues[1], 84, dawn?52:60));
    root.style.setProperty('--c', hsl(hues[2], 80, dawn?54:62));
  });

  captureBtn.addEventListener('click', ()=>{
    try{
      const r = stage.getBoundingClientRect();
      const temp = document.createElement('canvas');
      const ratio = dpr();
      temp.width = Math.floor(r.width * ratio);
      temp.height = Math.floor(r.height * ratio);
      const tctx = temp.getContext('2d');
      tctx.fillStyle = bgColor();
      tctx.fillRect(0,0,temp.width,temp.height);
      tctx.drawImage(canvas, 0, 0);
      const a = document.createElement('a');
      a.download = 'loom-1714.png';
      a.href = temp.toDataURL('image/png');
      a.click();
    }catch(e){}
  });

  // Pointer interactions
  function pointerTo(e){
    const rect = stage.getBoundingClientRect();
    const px = ('touches' in e) ? e.touches[0].clientX - rect.left : e.clientX - rect.left;
    const py = ('touches' in e) ? e.touches[0].clientY - rect.top : e.clientY - rect.top;
    state.pointer.x = px; state.pointer.y = py;
    if (state.pointer.down){
      addStar(px, py, (Math.random()-.5)*0.2, (Math.random()-.5)*0.2);
    }
  }
  stage.addEventListener('pointermove', (e)=>{ pointerTo(e); }, { passive:true });
  stage.addEventListener('pointerdown', (e)=>{ state.pointer.down = true; pointerTo(e); }, { passive:true });
  stage.addEventListener('pointerup', ()=>{ state.pointer.down = false; }, { passive:true });
  stage.addEventListener('pointerleave', ()=>{ state.pointer.down = false; }, { passive:true });
  stage.addEventListener('touchstart', (e)=>{ state.pointer.down = true; pointerTo(e); }, { passive:true });

  window.addEventListener('resize', ()=>{ sizeCanvas(); }, { passive:true });

  // Physics + drawing
  function step(dt){
    const r = stage.getBoundingClientRect();
    const [c1,c2,c3] = palette();
    const cols = [c1,c2,c3];

    // Fill background
    ctx.fillStyle = bgColor();
    ctx.fillRect(0,0,r.width,r.height);

    // Auto: occasionally add stars
    if (state.auto && Math.random() < 0.08) addStar(Math.random()*r.width, Math.random()*r.height, (Math.random()-.5)*0.3, (Math.random()-.5)*0.3);

    // Update stars
    for (let s of state.stars){
      if (state.gravity){
        const dx = state.pointer.x - s.x;
        const dy = state.pointer.y - s.y;
        const dist2 = Math.max(24, dx*dx + dy*dy);
        const force = 40 / dist2;
        s.vx += force * dx * dt * 0.0006;
        s.vy += force * dy * dt * 0.0006;
      }
      s.x += s.vx * (dt*0.06);
      s.y += s.vy * (dt*0.06);

      // soft bounds
      if (s.x < -20 || s.x > r.width+20) s.vx *= -1, s.x = Math.max(0, Math.min(r.width, s.x));
      if (s.y < -20 || s.y > r.height+20) s.vy *= -1, s.y = Math.max(0, Math.min(r.height, s.y));
    }

    // Draw links (weave)
    if (state.weave){
      // index into spatial buckets (simple grid)
      const gridSize = 80;
      const colsCount = Math.ceil(r.width / gridSize);
      const rowsCount = Math.ceil(r.height / gridSize);
      const grid = new Array(colsCount * rowsCount).fill(0).map(()=>[]);
      function cellIndex(x,y){
        const cx = Math.max(0, Math.min(colsCount-1, Math.floor(x / gridSize)));
        const cy = Math.max(0, Math.min(rowsCount-1, Math.floor(y / gridSize)));
        return cy * colsCount + cx;
      }
      for(let i=0;i<state.stars.length;i++){
        const s = state.stars[i];
        grid[cellIndex(s.x,s.y)].push(i);
      }
      const neigh = (x,y)=>{
        const cx = Math.max(0, Math.min(colsCount-1, Math.floor(x / gridSize)));
        const cy = Math.max(0, Math.min(rowsCount-1, Math.floor(y / gridSize)));
        const ids=[];
        for(let yy=-1; yy<=1; yy++){
          for(let xx=-1; xx<=1; xx++){
            const nx = cx+xx, ny = cy+yy;
            if (nx>=0 && ny>=0 && nx<colsCount && ny<rowsCount) ids.push(...grid[ny*colsCount+nx]);
          }
        }
        return ids;
      };

      for(let i=0;i<state.stars.length;i++){
        const a = state.stars[i];
        const near = neigh(a.x,a.y);
        let links = 0;
        for (let j=0;j<near.length && links<3;j++){
          const b = state.stars[near[j]];
          if (b===a) continue;
          const dx = a.x - b.x, dy = a.y - b.y;
          const d = Math.hypot(dx,dy);
          if (d < 140){
            const t = d/140;
            const col = cols[(i+j)%cols.length];
            ctx.globalCompositeOperation = state.glow ? 'lighter' : 'source-over';
            ctx.strokeStyle = col;
            ctx.globalAlpha = 0.22*(1-t) + 0.08;
            ctx.lineWidth = 1.2*(1-t) + 0.2;
            if (state.glow){
              ctx.shadowColor = col;
              ctx.shadowBlur = 12*(1-t)+4;
            } else {
              ctx.shadowBlur = 0;
            }
            ctx.beginPath();
            ctx.moveTo(a.x, a.y);
            // soft curve control
            const mx = (a.x + b.x)/2;
            const my = (a.y + b.y)/2;
            ctx.quadraticCurveTo(mx + (dy*0.12), my - (dx*0.12), b.x, b.y);
            ctx.stroke();
            links++;
          }
        }
      }
      ctx.globalAlpha = 1;
      ctx.shadowBlur = 0;
    }

    // Draw stars
    for (let i=0;i<state.stars.length;i++){
      const s = state.stars[i];
      const col = cols[i%cols.length];
      ctx.globalCompositeOperation = state.glow ? 'lighter' : 'source-over';
      ctx.fillStyle = col;
      ctx.globalAlpha = 1;
      if (state.glow){
        ctx.shadowColor = col;
        ctx.shadowBlur = 12;
      } else {
        ctx.shadowBlur = 0;
      }
      ctx.beginPath();
      ctx.arc(s.x, s.y, 1.4 + Math.sin((state.t*0.001 + i)*1.3)*0.6, 0, Math.PI*2);
      ctx.fill();
    }
  }

  // Loop
  let loopId = 0, then = 0;
  function loop(now=0){
    if (root.getAttribute('data-motion') === 'off') return;
    if (!then) then = now;
    const dt = Math.min(50, now - then);
    then = now;
    state.t += dt;
    step(dt);
    loopId = requestAnimationFrame(loop);
  }

  // Init
  sizeCanvas();
  seed(30);
  loop();

  // Extra polish: theme repaint consistency
  themeBtn.dispatchEvent(new Event('click'));
  themeBtn.dispatchEvent(new Event('click'));
})();
</script>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


