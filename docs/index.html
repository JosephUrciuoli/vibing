<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="vibe1803" aria-label="Aether Orrery · Vibe 1803">
  <style>
    /* AETHER ORRERY — all styles scoped to #vibe1803 */
    #vibe1803{
      --space-1:#0a0f1d; --space-2:#121a2e; --panel:#0e1527;
      --ink:#eaf2ff; --muted:#9aa6c2;
      --a1:#7bc7ff; --a2:#ff7ac2; --a3:#9effa0;
      --ring:#2a3550;
      color-scheme: dark;
      position: relative; isolation: isolate;
      padding: clamp(16px, 4.5vw, 48px);
      border-radius: 28px;
      background:
        radial-gradient(120% 160% at 15% 0%, color-mix(in oklab, var(--a2) 12%, transparent) 0%, transparent 60%),
        radial-gradient(120% 160% at 100% 100%, color-mix(in oklab, var(--a1) 12%, transparent) 0%, transparent 60%),
        linear-gradient(180deg, var(--space-1), var(--space-2));
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.06),
        0 48px 160px rgba(0,0,0,0.55);
      overflow: clip;
    }
    /* Iridescent rim */
    #vibe1803::after{
      content:""; position:absolute; inset:0; border-radius:28px; pointer-events:none;
      padding: 2px; mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude;
      background: linear-gradient(135deg, color-mix(in oklab,var(--a1)65%,#fff), color-mix(in oklab,var(--a2)65%,#fff), color-mix(in oklab,var(--a3)65%,#fff));
      opacity: 0.45; filter: saturate(115%);
    }

    /* Top Nav */
    #vibe1803 .nav{
      display:grid; grid-template-columns: 1fr auto; align-items:center; gap:12px;
    }
    #vibe1803 .brand{
      display:inline-grid; grid-auto-flow:column; gap:12px; align-items:center;
      padding: 10px 14px; border-radius:999px;
      background: linear-gradient(180deg, rgba(18,24,38,0.78), rgba(18,24,38,0.45));
      border: 1px solid rgba(255,255,255,0.10);
      box-shadow: 0 10px 28px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.08);
      color: var(--muted);
      font: 900 10px/1.1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      letter-spacing: 0.16em; text-transform: uppercase; white-space:nowrap;
    }
    #vibe1803 .gem{
      width:12px; height:12px; border-radius:3px;
      background: conic-gradient(from 0deg, var(--a1), var(--a2), var(--a3), var(--a1));
      box-shadow: 0 0 0 1px rgba(0,0,0,0.2) inset, 0 0 10px color-mix(in oklab, var(--a1) 30%, transparent);
      animation: v1803_spin 9s linear infinite;
    }
    @keyframes v1803_spin{ to{ transform: rotate(360deg);} }

    #vibe1803 .ctrls{ display:flex; gap:8px; justify-self:end; flex-wrap:wrap; }
    #vibe1803 .chip{
      appearance:none; border:1px solid rgba(255,255,255,0.12); border-radius:12px; cursor:pointer; user-select:none;
      padding: 10px 14px;
      background: linear-gradient(180deg, rgba(18,24,38,0.85), rgba(18,24,38,0.55));
      color: var(--ink);
      font: 800 11px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      letter-spacing: 0.14em; text-transform: uppercase;
      transition: transform 140ms ease, box-shadow 220ms ease, border-color 200ms ease, background 200ms ease, color 200ms ease, filter 200ms ease;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.08);
    }
    #vibe1803 .chip:hover{ transform: translateY(-1px); box-shadow: 0 16px 44px rgba(0,0,0,0.42); }
    #vibe1803 .chip[aria-pressed="true"]{
      border-color: color-mix(in oklab, var(--a2) 60%, #ffffff);
      color: color-mix(in oklab, var(--a2) 80%, var(--ink));
      filter: saturate(115%);
    }

    /* Sky panel */
    #vibe1803 .sky{
      position: relative; margin-top: clamp(14px, 3.2vw, 26px);
      border-radius: 24px; overflow:hidden; border:1px solid rgba(255,255,255,0.10);
      background:
        radial-gradient(160% 120% at 50% 0%, rgba(255,255,255,0.05), rgba(255,255,255,0.01) 60%, transparent 80%),
        linear-gradient(180deg, rgba(14,21,39,0.95), rgba(14,21,39,0.70));
      min-height: clamp(480px, 62vh, 900px);
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.06),
        0 30px 100px rgba(0,0,0,0.45);
      transform-style: preserve-3d;
    }
    #vibe1803 canvas.cosmos{ position:absolute; inset:0; width:100%; height:100%; display:block; z-index:1; }
    #vibe1803 .grain{
      position:absolute; inset:0; z-index:2; pointer-events:none; opacity:0.07;
      background-image: radial-gradient(circle at 10% 10%, rgba(255,255,255,0.6), transparent 40%),
                        radial-gradient(circle at 90% 30%, rgba(255,255,255,0.3), transparent 40%),
                        radial-gradient(circle at 30% 80%, rgba(255,255,255,0.3), transparent 40%);
      mix-blend-mode: overlay;
      animation: v1803_shift 16s ease-in-out infinite alternate;
    }
    @keyframes v1803_shift{ 0%{ transform: translate3d(0,0,0);} 100%{ transform: translate3d(2%, -2%, 0);} }

    /* Copy panel */
    #vibe1803 .copy{
      position:absolute; z-index:3; top: clamp(16px, 3.4vw, 28px); left: clamp(16px, 3.4vw, 28px);
      max-width: min(680px, 78%); display:grid; gap:10px;
      padding: 16px 18px; border-radius: 16px;
      background: linear-gradient(180deg, rgba(18,24,38,0.70), rgba(18,24,38,0.45));
      border: 1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(8px);
    }
    #vibe1803 h1{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      font-weight: 1000;
      font-size: clamp(44px, 9.2vw, 110px);
      line-height: 0.85; letter-spacing: -0.02em;
      text-transform: lowercase;
      background: linear-gradient(90deg, var(--ink), color-mix(in oklab, var(--a1) 55%, var(--ink)), color-mix(in oklab, var(--a2) 55%, var(--ink)), color-mix(in oklab, var(--a3) 55%, var(--ink)), var(--ink));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      background-size: 220% 100%; animation: v1803_gloss 14s ease-in-out infinite;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,0.45));
    }
    @keyframes v1803_gloss{ 0%,100%{ background-position: 0% 50%; } 50%{ background-position: 100% 50%; } }
    #vibe1803 .lede{
      margin:0; color: var(--muted); font-size: clamp(14px, 2.1vw, 18px);
      text-wrap: balance;
    }
    #vibe1803 .readouts{
      display:flex; gap:10px; flex-wrap:wrap;
    }
    #vibe1803 .stat{
      display:inline-grid; grid-auto-flow:row; gap:3px; padding:8px 10px; border-radius:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border:1px dashed rgba(255,255,255,0.12);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
    }
    #vibe1803 .stat .k{ font: 800 10px/1 ui-sans-serif, system-ui; letter-spacing:0.12em; text-transform:uppercase; color: var(--muted);}
    #vibe1803 .stat .v{ font: 700 14px/1.2 ui-sans-serif, system-ui; color: var(--ink); }

    /* Dial / slider */
    #vibe1803 .dial{
      position:absolute; right: clamp(14px, 3.2vw, 22px); bottom: clamp(14px, 3.2vw, 22px); z-index:3;
      display:grid; gap:8px; align-items:center; justify-items:end;
      background: linear-gradient(180deg, rgba(18,24,38,0.70), rgba(18,24,38,0.45));
      border:1px solid rgba(255,255,255,0.10);
      border-radius:12px; padding:10px 12px; backdrop-filter: blur(8px);
    }
    #vibe1803 .dial label{
      font: 800 10px/1 ui-sans-serif, system-ui;
      letter-spacing:0.14em; text-transform:uppercase; color: var(--muted);
    }
    #vibe1803 input[type="range"]{
      -webkit-appearance:none; appearance:none; width:min(38vw, 280px); height: 28px; background: transparent; cursor:pointer;
    }
    #vibe1803 input[type="range"]::-webkit-slider-runnable-track{
      height: 6px; border-radius: 999px;
      background: linear-gradient(90deg, color-mix(in oklab, var(--a1) 60%, #fff), color-mix(in oklab, var(--a2) 60%, #fff), color-mix(in oklab, var(--a3) 60%, #fff));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.20), 0 8px 18px rgba(0,0,0,0.35);
    }
    #vibe1803 input[type="range"]::-moz-range-track{
      height: 6px; border-radius: 999px;
      background: linear-gradient(90deg, color-mix(in oklab, var(--a1) 60%, #fff), color-mix(in oklab, var(--a2) 60%, #fff), color-mix(in oklab, var(--a3) 60%, #fff));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.20), 0 8px 18px rgba(0,0,0,0.35);
    }
    #vibe1803 input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none; appearance:none; width:20px; height:20px; margin-top:-7px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, #dbe8ff 45%, #a6bfff 70%);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow: 0 6px 12px rgba(0,0,0,0.45), inset 0 -2px 6px rgba(0,0,0,0.25);
    }
    #vibe1803 input[type="range"]::-moz-range-thumb{
      width:20px; height:20px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, #dbe8ff 45%, #a6bfff 70%);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow: 0 6px 12px rgba(0,0,0,0.45), inset 0 -2px 6px rgba(0,0,0,0.25);
    }

    /* Footer */
    #vibe1803 .foot{
      position:relative; z-index:4;
      display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;
      margin-top: clamp(16px, 3vw, 26px); padding-top: 14px;
      border-top: 1px dashed rgba(255,255,255,0.14);
      color: var(--muted); font-size: 12px;
    }

    /* Light theme */
    #vibe1803[data-theme="light"]{
      --space-1:#fbfcff; --space-2:#f4f7ff; --panel:#ffffff;
      --ink:#1a2433; --muted:#6b7486;
      box-shadow:
        inset 0 0 0 1px rgba(30,40,60,0.08),
        0 48px 160px rgba(62, 88, 155, 0.24);
      background:
        radial-gradient(120% 160% at 15% 0%, color-mix(in oklab, var(--a2) 16%, transparent) 0%, transparent 60%),
        radial-gradient(120% 160% at 100% 100%, color-mix(in oklab, var(--a1) 16%, transparent) 0%, transparent 60%),
        linear-gradient(180deg, var(--space-1), var(--space-2));
      color-scheme: light;
    }
    #vibe1803[data-theme="light"] .brand,
    #vibe1803[data-theme="light"] .chip,
    #vibe1803[data-theme="light"] .copy,
    #vibe1803[data-theme="light"] .dial{
      background: linear-gradient(180deg, rgba(255,255,255,0.82), rgba(255,255,255,0.55));
      border-color: rgba(70,80,120,0.18);
      box-shadow: 0 8px 26px rgba(120,140,180,0.22), inset 0 1px 0 rgba(255,255,255,0.9);
    }
    #vibe1803[data-theme="light"] .stat{ border-color: rgba(70,80,120,0.24); background: linear-gradient(180deg, rgba(255,255,255,0.65), rgba(255,255,255,0.35)); }
    #vibe1803[data-theme="light"] .sky{
      background: linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.70));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.75), 0 30px 100px rgba(100,120,160,0.22);
    }

    /* Motion accessibility */
    @media (prefers-reduced-motion: reduce){
      #vibe1803 .gem{ animation: none; }
      #vibe1803 h1{ animation: none; }
      #vibe1803 .grain{ animation: none; }
    }
  </style>

  <div class="nav" role="group" aria-label="Header">
    <div class="brand"><span class="gem" aria-hidden="true"></span> Aether Orrery · No. 1803</div>
    <div class="ctrls" role="group" aria-label="Controls">
      <button class="chip" data-act="run" aria-pressed="false" title="Play/Pause">Pause</button>
      <button class="chip" data-act="theme" aria-pressed="true" title="Theme">Dark</button>
      <button class="chip" data-act="mode" aria-pressed="true" title="Render mode">Orbits</button>
    </div>
  </div>

  <div class="sky" role="img" aria-label="Generative orbital map">
    <canvas class="cosmos" aria-hidden="true"></canvas>
    <div class="grain" aria-hidden="true"></div>

    <div class="copy" aria-label="Headline">
      <h1>aether orrery</h1>
      <p class="lede">A kinetic study of time and gravity. Drag to tilt the plane; nudge the warp to hasten the heavens.</p>
      <div class="readouts">
        <div class="stat"><span class="k">Local</span><span class="v" data-clock>—</span></div>
        <div class="stat"><span class="k">Warp</span><span class="v" data-warp>1.0×</span></div>
        <div class="stat"><span class="k">Mode</span><span class="v" data-mode>Orbits</span></div>
      </div>
    </div>

    <div class="dial" role="group" aria-label="Time warp">
      <label for="v1803-warp">Time Warp</label>
      <input id="v1803-warp" type="range" min="0" max="5" step="0.01" value="1">
    </div>
  </div>

  <div class="foot">
    <span>Chart the quiet motions.</span>
    <span id="last-updated">Last updated: 2026-01-07 12:24:27 EST</span>
  </div>

  <script>
    (function(){
      const root = document.getElementById('vibe1803');
      const canvas = root.querySelector('canvas.cosmos');
      const ctx = canvas.getContext('2d', { alpha: true });

      const btnRun = root.querySelector('.chip[data-act="run"]');
      const btnTheme = root.querySelector('.chip[data-act="theme"]');
      const btnMode = root.querySelector('.chip[data-act="mode"]');
      const warpSlider = root.querySelector('#v1803-warp');
      const clockEl = root.querySelector('[data-clock]');
      const warpEl = root.querySelector('[data-warp]');
      const modeEl = root.querySelector('[data-mode]');

      // Timestamp
      try{
        const stamp = new Date().toLocaleString(undefined, {
          year:'numeric', month:'short', day:'2-digit',
          hour:'2-digit', minute:'2-digit', second:'2-digit'
        });
        root.querySelector('#last-updated').textContent = 'Last updated: ' + stamp;
      }catch(e){}

      // Theme handling
      let theme = 'dark';
      function applyTheme(next){
        theme = next;
        if(theme === 'light'){ root.setAttribute('data-theme','light'); btnTheme.textContent = 'Light'; btnTheme.setAttribute('aria-pressed','false'); }
        else { root.removeAttribute('data-theme'); btnTheme.textContent = 'Dark'; btnTheme.setAttribute('aria-pressed','true'); }
        root.animate([{filter:'saturate(140%) blur(1px)'},{filter:'none'}], {duration:360, easing:'ease-out'});
      }
      applyTheme('dark');

      // State
      const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      let running = !prefersReduced;
      btnRun.textContent = running ? 'Pause' : 'Play';
      btnRun.setAttribute('aria-pressed', running ? 'false' : 'true');

      let modeOrbits = true;
      btnMode.setAttribute('aria-pressed', modeOrbits ? 'true' : 'false');
      btnMode.textContent = modeOrbits ? 'Orbits' : 'Constellations';
      modeEl.textContent = modeOrbits ? 'Orbits' : 'Constellations';

      // Mood palettes
      const MOODS = [
        { name:'Nebula', a1:'#7bc7ff', a2:'#ff7ac2', a3:'#9effa0' },
        { name:'Auric',  a1:'#ffd68a', a2:'#ff9aa2', a3:'#7fd1ff' },
        { name:'Viridian', a1:'#4fe3c1', a2:'#86b9ff', a3:'#ffe29a' },
        { name:'Ultraviolet', a1:'#8a7cff', a2:'#ff6ee7', a3:'#5af0d0' },
        { name:'Sakura', a1:'#ff8fb2', a2:'#8aa7ff', a3:'#4be0c8' }
      ];
      let moodIndex = 0;
      function setMood(i){
        moodIndex = (i + MOODS.length) % MOODS.length;
        const m = MOODS[moodIndex];
        root.style.setProperty('--a1', m.a1);
        root.style.setProperty('--a2', m.a2);
        root.style.setProperty('--a3', m.a3);
        root.animate([{filter:'brightness(1.15)'},{filter:'none'}], {duration:340, easing:'ease-out'});
      }
      setMood(0);

      // Canvas sizing
      let W=0, H=0, DPR=1;
      function resize(){
        const r = canvas.getBoundingClientRect();
        DPR = Math.min(2, window.devicePixelRatio || 1);
        W = Math.max(320, Math.floor(r.width));
        H = Math.max(320, Math.floor(r.height));
        canvas.width = Math.floor(W * DPR);
        canvas.height = Math.floor(H * DPR);
        ctx.setTransform(DPR,0,0,DPR,0,0);
      }
      new ResizeObserver(resize).observe(canvas.parentElement);
      resize();

      // Utilities
      function cssVar(name){ return getComputedStyle(root).getPropertyValue(name).trim(); }
      function hexToRgb(hex){
        const c = hex.replace('#','').trim();
        const n = c.length===3 ? c.split('').map(x=>x+x).join('') : c;
        return { r:parseInt(n.slice(0,2),16), g:parseInt(n.slice(2,4),16), b:parseInt(n.slice(4,6),16) };
      }
      function rgba(rgb,a){
        const v = typeof rgb==='string' ? hexToRgb(rgb) : rgb;
        return `rgba(${v.r},${v.g},${v.b},${a})`;
      }
      function mix(a,b,t){ return { r:Math.round(a.r+(b.r-a.r)*t), g:Math.round(a.g+(b.g-a.g)*t), b:Math.round(a.b+(b.b-a.b)*t)}; }

      // Colors live getters
      const c1 = ()=>hexToRgb(cssVar('--a1'));
      const c2 = ()=>hexToRgb(cssVar('--a2'));
      const c3 = ()=>hexToRgb(cssVar('--a3'));
      const ink = ()=>hexToRgb(cssVar('--ink'));

      // Clock
      function tickClock(){
        try{
          clockEl.textContent = new Date().toLocaleString(undefined, { hour:'2-digit', minute:'2-digit', second:'2-digit' });
        }catch(e){}
      }
      tickClock();
      setInterval(tickClock, 1000);

      // Orientation (drag to tilt)
      let yaw = 0.0, pitch = 0.25;
      let dragging = false, lastX=0, lastY=0;
      function onDown(e){ dragging=true; lastX=e.clientX; lastY=e.clientY; }
      function onMove(e){
        if(!dragging) return;
        const dx = e.clientX - lastX;
        const dy = e.clientY - lastY;
        yaw += dx * 0.005;
        pitch = Math.min(1.0, Math.max(0.02, pitch + dy * 0.003));
        lastX = e.clientX; lastY = e.clientY;
        panelTransform();
      }
      function onUp(){ dragging=false; }
      root.addEventListener('pointerdown', onDown);
      root.addEventListener('pointermove', onMove);
      root.addEventListener('pointerup', onUp);
      root.addEventListener('pointerleave', onUp);

      function panelTransform(){
        const panel = root.querySelector('.sky');
        const rx = (pitch-0.5)*-10;
        const ry = (yaw% (Math.PI*2)) / (Math.PI*2) * 12 - 6;
        panel.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
      }
      panelTransform();

      // Time warp
      let warp = parseFloat(warpSlider.value || '1');
      warpEl.textContent = warp.toFixed(1) + '×';
      warpSlider.addEventListener('input', ()=>{
        warp = parseFloat(warpSlider.value);
        warpEl.textContent = warp.toFixed(1) + '×';
      });

      // Universe setup
      const STARCOUNT = 280;
      const stars = new Array(STARCOUNT).fill(0).map((_,i)=>({
        r: Math.random()*0.48 + 0.12, // relative radius
        a: Math.random()*Math.PI*2,   // angle
        spin: (Math.random()*0.6 + 0.2) * (Math.random()<0.5?-1:1),
        size: Math.random()*1.2 + 0.3,
        twinkle: Math.random()*Math.PI*2
      }));

      const planets = [
        { r:0.12, size:3.2, speed:0.9,  hue:()=>mix(c1(), c2(), 0.2) },
        { r:0.20, size:4.0, speed:0.7,  hue:()=>mix(c2(), c1(), 0.35) },
        { r:0.28, size:3.0, speed:1.2,  hue:()=>mix(c1(), c3(), 0.5) },
        { r:0.36, size:5.0, speed:0.45, hue:()=>mix(c2(), c3(), 0.45) },
        { r:0.44, size:3.6, speed:1.5,  hue:()=>mix(c3(), c1(), 0.25) },
        { r:0.52, size:6.5, speed:0.25, hue:()=>mix(c2(), c1(), 0.65), ring:true }
      ].map((p,i)=>({ ...p, phase: Math.random()*Math.PI*2*(i+1) }));

      // Projection helpers
      function rotate(x,y,ang){
        const cs = Math.cos(ang), sn = Math.sin(ang);
        return { x: x*cs - y*sn, y: x*sn + y*cs };
      }

      // Render
      let raf=null, t0=performance.now();
      function draw(now){
        const dt = Math.min(32, now - t0);
        t0 = now;
        if(!running && !prefersReduced){ raf = null; return; }
        const t = now*0.001*warp;

        // fade background
        const light = root.getAttribute('data-theme')==='light';
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = light ? 'rgba(255,255,255,0.10)' : 'rgba(10,15,28,0.10)';
        ctx.fillRect(0,0,W,H);

        const cx = W/2, cy = H/2;
        const scale = Math.min(W, H);
        const ellipse = (p)=> p * (0.35 + 0.55*(1-pitch)); // flatten with pitch

        // idle yaw drift
        if(!dragging){ yaw += 0.0008 * (1 + warp*0.15); panelTransform(); }

        // Stars
        ctx.save();
        ctx.translate(cx, cy);
        ctx.globalCompositeOperation = 'lighter';
        for(let i=0;i<STARCOUNT;i++){
          const s = stars[i];
          const a = s.a + t * s.spin * 0.1;
          let x = Math.cos(a) * s.r * scale;
          let y = Math.sin(a) * s.r * scale * ellipse(s.r);
          const r2 = rotate(x,y, yaw);
          const tw = 0.6 + 0.4*Math.sin(t*1.7 + s.twinkle);
          const col = mix(ink(), mix(c1(), c2(), (i%100)/100), 0.08 + 0.22*tw);
          ctx.fillStyle = rgba(col, light ? 0.5 : 0.9);
          ctx.fillRect(r2.x|0, r2.y|0, s.size, s.size);
          if(!modeOrbits && i%12===0){
            // faint line to a neighbor for constellation mode
            const j = (i+7) % STARCOUNT;
            const s2 = stars[j];
            const a2 = s2.a + t * s2.spin * 0.1;
            let x2 = Math.cos(a2) * s2.r * scale;
            let y2 = Math.sin(a2) * s2.r * scale * ellipse(s2.r);
            const r22 = rotate(x2,y2,yaw);
            ctx.strokeStyle = rgba(col, light ? 0.10 : 0.18);
            ctx.lineWidth = 0.7;
            ctx.beginPath(); ctx.moveTo(r2.x, r2.y); ctx.lineTo(r22.x, r22.y); ctx.stroke();
          }
        }

        // Orbits
        if(modeOrbits){
          const ringCol = rgba(ink(), light ? 0.14 : 0.12);
          ctx.strokeStyle = ringCol;
          ctx.lineWidth = 1.0;
          for(const p of planets){
            ctx.save();
            ctx.rotate(yaw);
            ctx.beginPath();
            // draw ellipse via scaled circle
            ctx.scale(1, ellipse(p.r));
            ctx.arc(0,0, p.r*scale, 0, Math.PI*2);
            ctx.restore();
            ctx.stroke();
          }
        }

        // Planets
        for(const p of planets){
          const ang = p.phase + t * p.speed * (p.r<0.2?1.2:1);
          let x = Math.cos(ang) * p.r * scale;
          let y = Math.sin(ang) * p.r * scale * ellipse(p.r);
          const r2 = rotate(x,y,yaw);
          const col = p.hue();
          // glow
          const grd = ctx.createRadialGradient(r2.x, r2.y, 0, r2.x, r2.y, p.size*6);
          grd.addColorStop(0, rgba(col, light ? 0.55 : 0.85));
          grd.addColorStop(1, rgba(col, 0));
          ctx.fillStyle = grd;
          ctx.beginPath(); ctx.arc(r2.x, r2.y, p.size*6, 0, Math.PI*2); ctx.fill();

          // body
          ctx.fillStyle = rgba(col, 1);
          ctx.beginPath(); ctx.arc(r2.x, r2.y, p.size, 0, Math.PI*2); ctx.fill();

          // ringed planet
          if(p.ring){
            ctx.save();
            ctx.translate(r2.x, r2.y);
            ctx.rotate(yaw);
            ctx.scale(1, 0.45 + 0.35*(1-pitch));
            ctx.strokeStyle = rgba(col, light ? 0.35 : 0.45);
            ctx.lineWidth = 1.2;
            ctx.beginPath(); ctx.ellipse(0,0, p.size*2.2, p.size*1.1, 0, 0, Math.PI*2); ctx.stroke();
            ctx.restore();
          }
        }

        ctx.restore();
        raf = running ? requestAnimationFrame(draw) : null;
      }

      function start(){ if(!raf){ t0=performance.now(); raf = requestAnimationFrame(draw); } }
      function stop(){ if(raf){ cancelAnimationFrame(raf); raf = null; } }
      if(running) start();

      // Controls
      btnRun.addEventListener('click', ()=>{
        running = !running;
        btnRun.textContent = running ? 'Pause' : 'Play';
        btnRun.setAttribute('aria-pressed', running ? 'false' : 'true');
        running ? start() : stop();
      });
      btnTheme.addEventListener('click', ()=>{
        applyTheme(theme==='light' ? 'dark' : 'light');
      });
      btnMode.addEventListener('click', ()=>{
        modeOrbits = !modeOrbits;
        btnMode.setAttribute('aria-pressed', modeOrbits ? 'true' : 'false');
        btnMode.textContent = modeOrbits ? 'Orbits' : 'Constellations';
        modeEl.textContent = modeOrbits ? 'Orbits' : 'Constellations';
      });

      // Click to change mood (palette)
      canvas.addEventListener('click', ()=> setMood(moodIndex+1));

      // Scroll to change warp
      root.addEventListener('wheel', (e)=>{
        if(!e.ctrlKey && !e.metaKey){
          e.preventDefault();
          const step = Math.sign(e.deltaY) * 0.1;
          const next = Math.min(5, Math.max(0, parseFloat(warpSlider.value) - step));
          warpSlider.value = String(next);
          warp = next;
          warpEl.textContent = warp.toFixed(1) + '×';
        }
      }, { passive:false });
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


