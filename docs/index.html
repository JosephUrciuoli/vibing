<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="vibe621" class="loom" data-theme="dawn">
  <style>
    /* Scoped to #vibe621 only */
    #vibe621 {
      --tempo: 1;
      --glow: 18;
      --ink: #0e1222;
      --ink-soft: rgba(14,18,34,.72);
      --bg-1: #fff6ef;
      --bg-2: #eef6ff;
      --accent: #ff7a59;
      --accent-2: #ffd166;
      --glass: rgba(255,255,255,.55);
      position: relative;
      display: grid;
      grid-template-rows: auto 1fr auto auto;
      gap: 18px;
      min-height: 680px;
      padding: clamp(18px, 4vw, 36px);
      border-radius: 28px;
      color: var(--ink);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(255,255,255,.8), transparent 70%),
        linear-gradient(160deg, var(--bg-1), var(--bg-2));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.55), 0 36px 120px rgba(10,20,40,.22);
      overflow: hidden;
      isolation: isolate;
    }

    /* Themes */
    #vibe621[data-theme="dawn"]    { --bg-1:#fff6ef; --bg-2:#ecf6ff; --accent:#ff7a59; --accent-2:#ffd166; --ink:#0e1222; --ink-soft:rgba(14,18,34,.72); }
    #vibe621[data-theme="dusk"]    { --bg-1:#0b0f23; --bg-2:#161234; --accent:#8b5cf6; --accent-2:#22d3ee; --ink:#eef3ff; --ink-soft:rgba(238,243,255,.82); --glass: rgba(255,255,255,.22); }
    #vibe621[data-theme="forest"]  { --bg-1:#0e1a16; --bg-2:#10241f; --accent:#34d399; --accent-2:#7dd3fc; --ink:#eafff6; --ink-soft:rgba(234,255,246,.8); --glass: rgba(255,255,255,.26); }
    #vibe621[data-theme="midnight"]{ --bg-1:#070a14; --bg-2:#0c1224; --accent:#60a5fa; --accent-2:#f472b6; --ink:#eaf2ff; --ink-soft:rgba(234,242,255,.82); --glass: rgba(255,255,255,.2); }
    #vibe621[data-theme="candy"]   { --bg-1:#fff1f7; --bg-2:#fff3e6; --accent:#ff5fa2; --accent-2:#7cf3ff; --ink:#1a1222; --ink-soft:rgba(26,18,34,.72); }

    /* Ambient orbs */
    #vibe621 .orb {
      position: absolute; inset: -10% -20% auto auto; width: 60vmax; height: 60vmax; border-radius: 50%;
      background: radial-gradient(45% 45% at 50% 50%, var(--accent), transparent 60%);
      filter: blur(60px) saturate(120%);
      mix-blend-mode: plus-lighter; opacity: .35; z-index: 0;
      animation: v621-drift 52s ease-in-out infinite;
      transform: translate3d(0,0,0);
    }
    #vibe621 .orb.o2 { inset: auto auto -25% -25%; width: 70vmax; height: 70vmax; background: radial-gradient(45% 45% at 40% 60%, var(--accent-2), transparent 60%); animation-duration: 64s; animation-delay: -14s; }
    @keyframes v621-drift { 0%,100% { transform: translate3d(0,0,0) scale(1); } 50% { transform: translate3d(3%, -2%, 0) scale(1.06); } }
    #vibe621.calm .orb { animation-play-state: paused; }

    /* Header */
    #vibe621 .hero {
      z-index: 2;
      display: grid; gap: 10px;
      backdrop-filter: blur(10px) saturate(110%);
      -webkit-backdrop-filter: blur(10px) saturate(110%);
      background: linear-gradient(180deg, var(--glass), color-mix(in oklab, var(--glass) 60%, transparent));
      border: 1px solid rgba(255,255,255,.45);
      border-radius: 18px;
      padding: clamp(12px, 2.4vw, 18px);
      box-shadow: 0 18px 44px rgba(10,20,50,.16);
    }
    #vibe621 .eyebrow {
      display:inline-flex; align-items:center; gap:8px;
      color: var(--ink-soft);
      font: 800 12px/1 system-ui, -apple-system, "Segoe UI", Inter, Roboto, Arial; letter-spacing:.08em; text-transform:uppercase;
    }
    #vibe621 .eyebrow::before {
      content:""; width:8px; height:8px; border-radius:50%;
      background: radial-gradient(circle at 40% 40%, var(--accent), var(--accent-2));
      box-shadow: 0 0 12px var(--accent);
      flex:0 0 auto;
    }
    #vibe621 .title {
      margin:0;
      font: 900 clamp(28px, 7vw, 72px)/1.02 ui-sans-serif, system-ui, -apple-system, Inter, "Segoe UI", Roboto, Arial;
      letter-spacing:-.02em;
      background: linear-gradient(180deg, var(--ink), color-mix(in oklab, var(--ink) 70%, transparent));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    #vibe621 .lead {
      margin: 2px 0 0 0; max-width: 60ch;
      color: var(--ink-soft);
      font: 600 clamp(14px, 2.5vw, 18px)/1.6 system-ui, -apple-system, Inter, "Segoe UI", Roboto, Arial;
    }

    /* Canvas Stage */
    #vibe621 .canvas {
      position: relative; z-index: 1;
      display: grid; place-items: center;
      min-height: 420px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.45);
      background: linear-gradient(180deg, rgba(255,255,255,.20), rgba(255,255,255,.06));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.25), 0 28px 80px rgba(10,20,40,.20);
      overflow: hidden;
      perspective: 1200px;
    }
    #vibe621 canvas {
      width: 100%;
      height: 100%;
      aspect-ratio: 16 / 9;
      display: block;
      transform: translateZ(0);
    }
    #vibe621 .canvas::after {
      content:"";
      position:absolute; inset:-20%;
      background: radial-gradient(50% 30% at 50% 0%, rgba(255,255,255,.28), transparent 60%);
      mix-blend-mode: soft-light; pointer-events:none;
    }
    #vibe621 .hint {
      position:absolute; bottom: 14px; left: 14px;
      color: var(--ink-soft);
      font: 700 12px/1 system-ui, -apple-system, Inter, "Segoe UI", Roboto, Arial;
      background: linear-gradient(180deg, rgba(255,255,255,.7), rgba(255,255,255,.28));
      border: 1px solid rgba(255,255,255,.45);
      border-radius: 999px;
      padding: 8px 12px;
      box-shadow: 0 10px 24px rgba(0,0,0,.12);
      transition: opacity .3s ease, transform .3s ease;
    }
    #vibe621 .hint.hide { opacity: 0; transform: translateY(6px); pointer-events:none; }

    /* Controls */
    #vibe621 .panel {
      z-index: 3; display:grid; gap: 12px;
      grid-template-columns: 1fr auto;
      align-items: center;
      padding: clamp(10px, 2vw, 14px);
      background: linear-gradient(180deg, var(--glass), color-mix(in oklab, var(--glass) 70%, transparent));
      border: 1px solid rgba(255,255,255,.45);
      border-radius: 16px;
      box-shadow: 0 12px 36px rgba(10,20,50,.16);
    }
    @media (max-width: 860px) { #vibe621 .panel { grid-template-columns: 1fr; } }

    #vibe621 .pills { display:flex; flex-wrap:wrap; gap:8px; }
    #vibe621 .pill {
      border: 1px solid rgba(14,18,32,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.4));
      color: var(--ink);
      border-radius: 12px;
      padding: 10px 14px;
      font: 800 12px/1 system-ui, -apple-system, Inter, "Segoe UI", Roboto, Arial;
      letter-spacing:.06em; text-transform:uppercase;
      cursor: pointer; user-select:none;
      transition: transform .16s ease, box-shadow .16s ease, background .16s ease, outline-color .16s ease;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.8), 0 8px 24px rgba(0,0,0,.08);
    }
    #vibe621 .pill:hover { transform: translateY(-1px); box-shadow: 0 16px 36px rgba(0,0,0,.14); }
    #vibe621 .pill.selected { outline: 2px solid color-mix(in oklab, var(--accent) 55%, transparent); }
    #vibe621 .pill.still {
      background: linear-gradient(180deg, color-mix(in oklab, var(--accent) 18%, #fff), color-mix(in oklab, var(--accent) 6%, #fff));
    }

    #vibe621 .sliders { display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:flex-end; }
    #vibe621 label.sld {
      display:grid; gap:6px; min-width: 220px;
      color: var(--ink-soft);
      font: 800 12px/1 system-ui, -apple-system, Inter, "Segoe UI", Roboto, Arial; letter-spacing:.08em; text-transform:uppercase;
    }
    #vibe621 input[type="range"] {
      -webkit-appearance: none; appearance: none; width: 100%; height: 12px; border-radius:999px;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      border: 1px solid rgba(14,18,32,.12);
      outline: none;
    }
    #vibe621 input[type="range"]::-webkit-slider-thumb,
    #vibe621 input[type="range"]::-moz-range-thumb {
      -webkit-appearance: none; appearance: none;
      width: 22px; height: 22px; border-radius:50%;
      background: radial-gradient(circle at 40% 40%, var(--accent), var(--accent-2));
      border: 2px solid #fff; box-shadow: 0 4px 14px rgba(0,0,0,.2);
      cursor: pointer;
    }

    /* Footer/meta */
    #vibe621 .meta {
      display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content: space-between;
      color: var(--ink-soft);
      font: 600 12px/1.2 system-ui, -apple-system, Inter, "Segoe UI", Roboto, Arial;
      z-index:2;
    }
    #vibe621 .badge {
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px;
      border-radius:999px; border:1px solid rgba(255,255,255,.42);
      background: linear-gradient(180deg, rgba(255,255,255,.7), rgba(255,255,255,.28));
    }
    #vibe621 .badge::before {
      content:""; width:8px; height:8px; border-radius:50%;
      background: radial-gradient(circle at 40% 40%, var(--accent), var(--accent-2));
      box-shadow: 0 0 10px var(--accent);
      flex:0 0 auto;
    }

    @media (prefers-reduced-motion: reduce) {
      #vibe621 .orb { animation: none !important; }
      #vibe621 .hint { display:none !important; }
    }
  </style>

  <!-- Ambient color orbs -->
  <div class="orb o1" aria-hidden="true"></div>
  <div class="orb o2" aria-hidden="true"></div>

  <!-- Header -->
  <div class="hero" role="region" aria-label="Luminous Loom">
    <span class="eyebrow">Edition 621 Â· Luminous Loom</span>
    <h1 class="title">Loom</h1>
    <p class="lead">A living textile of light, woven in real time. Stir the fabric. Change the dye. Find a rhythm.</p>
  </div>

  <!-- Generative Canvas -->
  <div class="canvas" role="img" aria-label="Generative woven animation">
    <canvas id="loom-canvas"></canvas>
    <div class="hint" id="v621-hint">Drag to stir</div>
  </div>

  <!-- Controls -->
  <div class="panel" role="group" aria-label="Appearance controls">
    <div class="pills" role="radiogroup" aria-label="Theme">
      <button class="pill selected" data-theme="dawn" aria-pressed="true">Dawn</button>
      <button class="pill" data-theme="dusk" aria-pressed="false">Dusk</button>
      <button class="pill" data-theme="forest" aria-pressed="false">Forest</button>
      <button class="pill" data-theme="midnight" aria-pressed="false">Midnight</button>
      <button class="pill" data-theme="candy" aria-pressed="false">Candy</button>
      <button class="pill still" id="v621-still" aria-pressed="false" title="Pause animation">Still</button>
    </div>
    <div class="sliders">
      <label for="v621-tempo" class="sld">Tempo
        <input id="v621-tempo" type="range" min="0.5" max="2.5" step="0.1" value="1" />
      </label>
      <label for="v621-glow" class="sld">Glow
        <input id="v621-glow" type="range" min="0" max="36" step="1" value="18" />
      </label>
    </div>
  </div>

  <!-- Meta -->
  <div class="meta">
    <span class="badge">Generative, responsive, and remarkably calm</span>
    <span>Last crafted <span id="last-updated">Last updated: 2025-11-13 20:22:33 EST</span></span>
  </div>

  <script>
    (function () {
      const root = document.getElementById('vibe621');
      const canvas = document.getElementById('loom-canvas');
      const hint = document.getElementById('v621-hint');
      const ctx = canvas.getContext('2d', { alpha: true });
      const pills = root.querySelectorAll('.pill[data-theme]');
      const stillBtn = document.getElementById('v621-still');
      const tempo = document.getElementById('v621-tempo');
      const glow = document.getElementById('v621-glow');
      const last = root.querySelector('#last-updated');

      // Timestamp
      try {
        const fmt = new Intl.DateTimeFormat(undefined, {
          year: 'numeric', month: 'short', day: '2-digit',
          hour: '2-digit', minute: '2-digit', second: '2-digit'
        });
        last.textContent = fmt.format(new Date());
      } catch (_) {
        last.textContent = new Date().toLocaleString();
      }

      // Themes palette map
      const themes = {
        dawn:    { a: '#ff7a59', b: '#ffd166', bg1:'#fff6ef', bg2:'#ecf6ff', ink:'#0e1222', soft:'rgba(14,18,34,.72)' },
        dusk:    { a: '#8b5cf6', b: '#22d3ee', bg1:'#0b0f23', bg2:'#161234', ink:'#eef3ff', soft:'rgba(238,243,255,.82)' },
        forest:  { a: '#34d399', b: '#7dd3fc', bg1:'#0e1a16', bg2:'#10241f', ink:'#eafff6', soft:'rgba(234,255,246,.8)' },
        midnight:{ a: '#60a5fa', b: '#f472b6', bg1:'#070a14', bg2:'#0c1224', ink:'#eaf2ff', soft:'rgba(234,242,255,.82)' },
        candy:   { a: '#ff5fa2', b: '#7cf3ff', bg1:'#fff1f7', bg2:'#fff3e6', ink:'#1a1222', soft:'rgba(26,18,34,.72)' }
      };

      // State
      let running = true;
      let t = 0, raf = null;
      let w = 0, h = 0, dpr = Math.max(1, window.devicePixelRatio || 1);
      let pointer = { x: 0.5, y: 0.5, vx: 0, vy: 0, active: false };

      // Restore saved state
      const savedTheme = localStorage.getItem('v621-theme') || '';
      const savedTempo = parseFloat(localStorage.getItem('v621-tempo') || '1');
      const savedGlow = parseFloat(localStorage.getItem('v621-glow') || '18');
      const savedStill = localStorage.getItem('v621-still') === '1';

      if (savedTheme) {
        root.dataset.theme = savedTheme;
        pills.forEach(b => {
          const on = b.dataset.theme === savedTheme;
          b.classList.toggle('selected', on);
          b.setAttribute('aria-pressed', String(on));
        });
      }
      tempo.value = isNaN(savedTempo) ? '1' : String(savedTempo);
      glow.value = isNaN(savedGlow) ? '18' : String(savedGlow);
      root.style.setProperty('--tempo', tempo.value);
      root.style.setProperty('--glow', glow.value);

      if (savedStill) {
        running = false;
        stillBtn.setAttribute('aria-pressed', 'true');
        root.classList.add('calm');
      }

      // Auto theme by time if none saved
      if (!savedTheme) {
        const hr = new Date().getHours();
        const guess = hr < 6 ? 'midnight' : hr < 12 ? 'dawn' : hr < 18 ? 'forest' : 'dusk';
        root.dataset.theme = guess;
        pills.forEach(b => {
          const on = b.dataset.theme === guess;
          b.classList.toggle('selected', on);
          b.setAttribute('aria-pressed', String(on));
        });
      }

      // Helpers
      const hex = c => {
        const s = c.replace('#','');
        return {
          r: parseInt(s.length===3? s[0]+s[0] : s.slice(0,2),16),
          g: parseInt(s.length===3? s[1]+s[1] : s.slice(2,4),16),
          b: parseInt(s.length===3? s[2]+s[2] : s.slice(4,6),16)
        };
      };
      const lerp = (a,b,f) => a + (b - a) * f;
      const mix = (c1, c2, f, a=1) => {
        const A = hex(c1), B = hex(c2);
        const r = Math.round(lerp(A.r, B.r, f));
        const g = Math.round(lerp(A.g, B.g, f));
        const b = Math.round(lerp(A.b, B.b, f));
        return `rgba(${r},${g},${b},${a})`;
      };

      // Resize canvas
      function resize() {
        const rect = canvas.getBoundingClientRect();
        w = Math.max(1, Math.floor(rect.width * dpr));
        h = Math.max(1, Math.floor(rect.height * dpr));
        canvas.width = w;
        canvas.height = h;
      }
      resize();
      window.addEventListener('resize', () => { dpr = Math.max(1, window.devicePixelRatio || 1); resize(); });

      // Draw
      function draw(ts) {
        const theme = themes[root.dataset.theme] || themes.dawn;
        const tempoMul = parseFloat(tempo.value || '1');
        const glowAmt = parseFloat(glow.value || '18');

        // Background gradient
        const rg = ctx.createLinearGradient(0, 0, 0, h);
        rg.addColorStop(0, theme.bg1);
        rg.addColorStop(1, theme.bg2);
        ctx.fillStyle = rg;
        ctx.fillRect(0, 0, w, h);

        // Soft vignette
        const vg = ctx.createRadialGradient(w*0.5, h*0.45, Math.min(w,h)*0.2, w*0.5, h*0.5, Math.max(w,h)*0.8);
        vg.addColorStop(0, 'rgba(255,255,255,.06)');
        vg.addColorStop(1, 'rgba(0,0,0,.08)');
        ctx.fillStyle = vg;
        ctx.fillRect(0, 0, w, h);

        // Woven ribbons
        const N = 18;
        const baseAmp = Math.min(w,h) * 0.065;
        const ampMod = (pointer.active ? 1.0 : 0.7) + (pointer.y - 0.5) * 0.5;
        const ax = baseAmp * ampMod;
        const k = 0.006 + (pointer.x - 0.5) * 0.004;
        const speed = 0.8 * tempoMul;

        ctx.lineCap = 'round';
        for (let i = 0; i < N; i++) {
          const f = i / (N - 1);
          const phase = f * Math.PI * 2;
          const width = (12 + Math.sin(phase + t * 0.9) * 6) * dpr;
          const amp = ax * (0.8 + 0.4 * Math.sin(phase + t * 0.6));
          ctx.lineWidth = width;
          const color = mix(theme.a, theme.b, (Math.sin(phase + t * 0.5) * 0.5 + 0.5) * 0.75 + 0.12, 0.9);
          ctx.shadowBlur = glowAmt * dpr;
          ctx.shadowColor = color;
          ctx.strokeStyle = color;

          ctx.beginPath();
          const y0 = h * (0.35 + 0.3 * Math.sin(phase + t * 0.3));
          for (let x = -50 * dpr; x <= w + 50 * dpr; x += 9 * dpr) {
            const y = y0
              + Math.sin(x * k + t * speed + phase) * amp
              + Math.cos(x * (k * 0.6) + t * (speed * 0.7) + phase * 1.7) * (amp * 0.5)
              + (pointer.active ? (pointer.vy * 120) : 0);
            if (x === -50 * dpr) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
          }
          ctx.stroke();
        }

        // Subtle texture lines
        ctx.shadowBlur = 0;
        ctx.globalAlpha = 0.12;
        ctx.strokeStyle = mix(theme.a, theme.b, 0.5, 0.8);
        ctx.lineWidth = 1 * dpr;
        for (let y = h * 0.18; y < h * 0.82; y += 24 * dpr) {
          ctx.beginPath(); ctx.moveTo(0, y + Math.sin(y * 0.01 + t) * 6 * dpr); ctx.lineTo(w, y + Math.cos(y * 0.01 + t) * 6 * dpr); ctx.stroke();
        }
        ctx.globalAlpha = 1;
      }

      // Animation loop
      function loop(ts) {
        if (running) {
          t += 0.006 * parseFloat(tempo.value || '1');
          draw(ts);
          raf = requestAnimationFrame(loop);
        } else {
          raf = null;
          draw(ts); // draw one frame in still mode for crispness
        }
      }

      // Pointer interaction
      function posFromEvent(e) {
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) / rect.width;
        const y = (e.clientY - rect.top) / rect.height;
        return { x: Math.max(0, Math.min(1, x)), y: Math.max(0, Math.min(1, y)) };
      }
      function onMove(e) {
        const p = posFromEvent(e);
        pointer.vx += (p.x - pointer.x) * 0.2;
        pointer.vy += (p.y - pointer.y) * 0.2;
        pointer.x += pointer.vx; pointer.y += pointer.vy;
        pointer.vx *= 0.6; pointer.vy *= 0.6;
        pointer.active = true;
        hint.classList.add('hide');
        if (!raf && running) raf = requestAnimationFrame(loop);
      }
      function onLeave() { pointer.active = false; }

      canvas.addEventListener('pointermove', onMove);
      canvas.addEventListener('pointerdown', onMove);
      canvas.addEventListener('pointerleave', onLeave);

      // Controls
      pills.forEach(btn => {
        btn.addEventListener('click', () => {
          const th = btn.dataset.theme;
          root.dataset.theme = th;
          localStorage.setItem('v621-theme', th);
          pills.forEach(b => {
            const on = b === btn;
            b.classList.toggle('selected', on);
            b.setAttribute('aria-pressed', String(on));
          });
          // immediate redraw to reflect bg
          if (!raf) draw();
        });
      });

      stillBtn.addEventListener('click', () => {
        running = !running;
        stillBtn.setAttribute('aria-pressed', String(!running));
        root.classList.toggle('calm', !running);
        localStorage.setItem('v621-still', running ? '0' : '1');
        if (running && !raf) raf = requestAnimationFrame(loop);
        else if (!running && raf) { cancelAnimationFrame(raf); raf = null; draw(); }
      });

      tempo.addEventListener('input', () => {
        root.style.setProperty('--tempo', tempo.value);
        if (!raf && running) raf = requestAnimationFrame(loop);
      });
      tempo.addEventListener('change', () => localStorage.setItem('v621-tempo', tempo.value));
      glow.addEventListener('input', () => {
        root.style.setProperty('--glow', glow.value);
        if (!raf) draw();
      });
      glow.addEventListener('change', () => localStorage.setItem('v621-glow', glow.value));

      // Motion preferences
      const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (prefersReduced) {
        running = false;
        stillBtn.setAttribute('aria-pressed', 'true');
        root.classList.add('calm');
        draw();
      } else {
        raf = requestAnimationFrame(loop);
      }

      // Visibility safety
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          if (raf) cancelAnimationFrame(raf);
          raf = null;
        } else if (running && !raf) {
          raf = requestAnimationFrame(loop);
        }
      });
    })();
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


