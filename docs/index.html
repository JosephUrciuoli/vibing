<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="echo1655" aria-label="ECHO — Edition 1655 · neon ribbon field">
  <style>
    /* ECHO — Edition 1655 */
    #echo1655{
      --mx: 0; --my: 0;
      --pad: clamp(14px, 3.8vw, 48px);
      --radius: 26px;

      /* Lumen (light) */
      --bg-0: #f8fbff;
      --bg-1: #eef2f9;
      --bg-2: #e7ecf7;
      --ink: #0e1020;
      --muted: #6a768e;
      --ring: rgba(10,20,40,.10);
      --glass: rgba(255,255,255,.7);

      /* Accent */
      --accent1: 220;
      --accent2: 312;

      position: relative;
      min-height: 92svh;
      display: grid;
      grid-template-rows: auto 1fr auto;
      color: var(--ink);
      background:
        radial-gradient(140% 120% at 10% -20%, rgba(255,180,120,.20), transparent 60%),
        radial-gradient(150% 130% at 110% 120%, rgba(140,190,255,.18), transparent 60%),
        linear-gradient(180deg, var(--bg-0), var(--bg-1) 55%, var(--bg-2));
      border-radius: 30px;
      overflow: clip;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.8), 0 80px 180px rgba(20,30,50,.15);
      isolation: isolate;
    }
    #echo1655::before{
      /* soft film + micro grid */
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(60% 80% at 80% 20%, rgba(255,255,255,.5), transparent 60%),
        repeating-linear-gradient(90deg, rgba(255,255,255,.06) 0 1px, transparent 1px 20px);
      mix-blend-mode: overlay;
      pointer-events: none;
      opacity: .5;
    }
    #echo1655[data-theme="noir"]{
      --bg-0:#06060a;
      --bg-1:#0a0c14;
      --bg-2:#070912;
      --ink:#eaf1ff;
      --muted:#98a7c6;
      --ring:rgba(255,255,255,.10);
      --glass: rgba(255,255,255,.08);
      --accent1: 202; /* cyan */
      --accent2: 28;  /* tangerine */
      background:
        radial-gradient(140% 120% at 10% -20%, rgba(120,170,255,.14), transparent 60%),
        radial-gradient(150% 130% at 110% 120%, rgba(255,140,200,.12), transparent 60%),
        linear-gradient(180deg, var(--bg-0), var(--bg-1) 55%, var(--bg-2));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08), 0 120px 260px rgba(0,0,0,.7);
    }

    /* Header */
    #echo1655 .mast{
      margin: var(--pad);
      padding: 16px clamp(14px,2.4vw,28px);
      display:flex; align-items:center; justify-content:space-between; gap:18px; flex-wrap:wrap;
      border-radius: 20px;
      border: 1px solid var(--ring);
      background: linear-gradient(180deg, var(--glass), color-mix(in oklab, var(--glass) 40%, transparent));
      backdrop-filter: blur(10px) saturate(160%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9), 0 18px 50px rgba(20,30,50,.16);
      position: relative; z-index: 3;
    }
    #echo1655[data-theme="noir"] .mast{
      box-shadow: inset 0 1px 0 rgba(255,255,255,.16), 0 18px 70px rgba(0,0,0,.55);
    }
    #echo1655 .brand{ display:flex; align-items:center; gap:14px; }
    #echo1655 .sig{
      --s: clamp(34px,4.4vw,58px);
      width: var(--s); height: var(--s); border-radius: 16px;
      background:
        conic-gradient(from 120deg, hsl(var(--accent1) 90% 60%), hsl(var(--accent2) 90% 60%), hsl(var(--accent1) 90% 60%));
      -webkit-mask: radial-gradient(78% 78% at 60% 40%, #000 62%, transparent 64%);
              mask: radial-gradient(78% 78% at 60% 40%, #000 62%, transparent 64%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6), 0 10px 28px rgba(20,30,50,.2), 0 0 0 8px rgba(255,255,255,.24);
      animation: spin1655 24s linear infinite;
    }
    #echo1655[data-theme="noir"] .sig{
      box-shadow: inset 0 1px 0 rgba(255,255,255,.35), 0 12px 36px rgba(0,0,0,.6), 0 0 0 8px rgba(255,255,255,.08);
    }
    @keyframes spin1655 { to{ transform: rotate(360deg) } }
    #echo1655 .title{
      display:flex; flex-direction:column; gap:4px;
    }
    #echo1655 .word{
      font: 900 clamp(28px,6vw,64px)/.9 ui-sans-serif, system-ui, "SF Pro";
      letter-spacing: .02em;
      background:
        linear-gradient(90deg, hsl(var(--accent1) 90% 45%), hsl(var(--accent2) 90% 55%));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      filter: drop-shadow(0 10px 30px rgba(120,160,255,.25));
      position: relative;
    }
    #echo1655 .kicker{
      font: 800 11px/1 ui-sans-serif, system-ui;
      letter-spacing: .28em; text-transform: uppercase; color: var(--muted);
    }

    #echo1655 .nav{ display:flex; gap:10px; flex-wrap:wrap; }
    #echo1655 .pill{
      height: 38px; padding: 0 14px;
      border-radius: 999px; border: 1px solid var(--ring);
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.5));
      color: var(--ink); font: 800 12px/1 ui-sans-serif; letter-spacing:.2px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9), 0 10px 24px rgba(20,30,50,.12);
      cursor: pointer; transition: transform .14s ease, box-shadow .2s ease, background .2s ease;
    }
    #echo1655 .pill:hover{ transform: translateY(-1px); box-shadow: 0 16px 36px rgba(20,30,50,.18); }
    #echo1655[data-theme="noir"] .pill{
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      color: var(--ink);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.2), 0 10px 28px rgba(0,0,0,.45);
    }

    /* Layout */
    #echo1655 .wrap{
      display: grid;
      grid-template-columns: 1.1fr 1.6fr;
      gap: clamp(14px, 3vw, 30px);
      padding: 0 var(--pad) var(--pad);
    }
    @media (max-width: 960px){
      #echo1655 .wrap{ grid-template-columns: 1fr; }
    }

    /* Panel (copy) */
    #echo1655 .panel{
      display:flex; flex-direction:column; gap:18px;
      border-radius: var(--radius);
      border: 1px dashed var(--ring);
      padding: clamp(16px,2.4vw,24px);
      background: linear-gradient(180deg, rgba(255,255,255,.6), rgba(255,255,255,.3));
      backdrop-filter: blur(6px) saturate(160%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9), 0 16px 40px rgba(20,30,50,.1);
    }
    #echo1655[data-theme="noir"] .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.18), 0 16px 50px rgba(0,0,0,.55);
    }
    #echo1655 .hero{
      font: 900 clamp(32px,8.5vw,100px)/.88 ui-sans-serif, system-ui;
      letter-spacing: .015em;
      background:
        conic-gradient(from 180deg at 50% 50%, hsl(var(--accent1) 90% 52%), hsl(var(--accent2) 90% 58%), hsl(var(--accent1) 90% 52%));
      -webkit-background-clip:text; background-clip:text; color: transparent;
      filter: drop-shadow(0 12px 34px color-mix(in oklab, hsl(var(--accent1) 90% 60%) 40%, transparent));
      position: relative;
    }
    #echo1655 .hero::after{
      /* glint sweep */
      content:"";
      position:absolute; inset: 0;
      background: linear-gradient(100deg, transparent 40%, rgba(255,255,255,.6), transparent 60%);
      mix-blend-mode: overlay; opacity:.35;
      transform: translateX(calc(var(--mx) * -20%));
      transition: transform .2s ease;
      pointer-events: none;
    }
    #echo1655 .lede{
      font: 600 clamp(14px,2.4vw,18px)/1.55 ui-sans-serif, system-ui;
      color: var(--muted);
    }
    #echo1655 .badge{
      display:inline-flex; align-items:center; gap:8px;
      font: 800 11px/1 ui-sans-serif; letter-spacing:.22em; text-transform:uppercase; color: var(--muted);
    }
    #echo1655 .dot{
      width:8px; height:8px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, hsl(var(--accent1) 90% 60%));
      box-shadow: 0 0 14px color-mix(in oklab, hsl(var(--accent1) 90% 60%) 70%, transparent);
      animation: ping1655 3s ease-in-out infinite;
      display:inline-block;
    }
    @keyframes ping1655{ 0%,100%{ transform: scale(1); opacity:.9 } 50%{ transform: scale(1.22); opacity:1 } }

    /* Viz (canvas) */
    #echo1655 .viz{
      position: relative;
      border-radius: var(--radius);
      border: 1px solid var(--ring);
      overflow: hidden;
      background:
        radial-gradient(120% 100% at 10% 0%, rgba(255,255,255,.6), transparent 60%),
        linear-gradient(180deg, color-mix(in oklab, var(--bg-0) 90%, transparent), var(--bg-1));
      box-shadow: 0 90px 180px rgba(20,30,50,.18), inset 0 1px 0 rgba(255,255,255,.5);
      transform:
        rotateX(calc(var(--my)*-7deg))
        rotateY(calc(var(--mx)* 7deg))
        translate3d(calc(var(--mx)*12px), calc(var(--my)*-12px), 0);
      transition: transform .15s ease;
      isolation:isolate;
      aspect-ratio: 16/10;
    }
    #echo1655[data-theme="noir"] .viz{
      box-shadow: 0 100px 220px rgba(0,0,0,.65), inset 0 1px 0 rgba(255,255,255,.14);
    }
    #echo1655 canvas#ribbons{ position:absolute; inset:0; width:100%; height:100%; display:block; }

    /* HUD */
    #echo1655 .hud{
      position: relative;
      margin: clamp(10px,2vw,16px) 0 0;
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
      background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.5));
      border: 1px solid var(--ring); border-radius: 16px; padding: 10px 12px;
      box-shadow: 0 18px 50px rgba(20,30,50,.16), inset 0 1px 0 rgba(255,255,255,.8);
    }
    #echo1655[data-theme="noir"] .hud{
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      box-shadow: 0 18px 50px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.25);
    }
    #echo1655 .chip{
      display:inline-flex; align-items:center; gap:10px;
      padding:8px 10px; border-radius:12px; border:1px solid var(--ring);
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.55));
      color:var(--ink); font:800 12px/1 ui-sans-serif, system-ui;
    }
    #echo1655[data-theme="noir"] .chip{
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.07));
    }
    #echo1655 .chip output{ min-width:3ch; text-align:right; }
    #echo1655 input[type="range"]{ -webkit-appearance:none; appearance:none; height:22px; width:160px; background:transparent; cursor:pointer; }
    #echo1655 input[type="range"]::-webkit-slider-runnable-track,
    #echo1655 input[type="range"]::-moz-range-track{
      height:6px; border-radius:999px;
      background: linear-gradient(90deg, hsl(var(--accent1) 90% 60%), hsl(var(--accent2) 90% 60%));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.45);
    }
    #echo1655 input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none; appearance:none; margin-top:-6px; width:18px; height:18px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.6));
      border:1px solid rgba(10,19,36,.15);
      box-shadow: 0 6px 18px rgba(20,30,50,.2);
    }
    #echo1655 input[type="range"]::-moz-range-thumb{
      width:18px; height:18px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.6));
      border:1px solid rgba(10,19,36,.15);
      box-shadow: 0 6px 18px rgba(20,30,50,.2);
    }
    #echo1655 .hint{
      font: 700 11px/1.1 ui-sans-serif, system-ui; letter-spacing:.28em; text-transform:uppercase;
      color: var(--muted); text-align:center;
      margin-top: 6px;
    }

    /* Foot */
    #echo1655 .foot{
      display:flex; justify-content:space-between; align-items:center; gap:16px;
      margin: 0 var(--pad) var(--pad);
      padding-top: 12px; border-top: 1px dashed var(--ring);
      color: var(--muted); font: 400 12px/1.6 ui-sans-serif, system-ui;
      position: relative; z-index: 2;
    }

    /* Motion safety */
    #echo1655.paused, #echo1655.paused * { animation-play-state: paused !important; }
    @media (prefers-reduced-motion: reduce){
      #echo1655 .sig, #echo1655 .hero::after { animation: none !important; }
    }
  </style>

  <div class="mast" role="toolbar" aria-label="ECHO controls">
    <div class="brand">
      <div class="sig" aria-hidden="true"></div>
      <div class="title">
        <div class="word">ECHO</div>
        <div class="kicker">Edition 1655 · neon ribbon field</div>
      </div>
    </div>
    <div class="nav">
      <button class="pill" id="theme" aria-pressed="false" title="Toggle Lumen/Noir">Noir</button>
      <button class="pill" id="pause" aria-pressed="false" title="Pause/Play">Pause</button>
      <button class="pill" id="save" title="Save image">Export</button>
    </div>
  </div>

  <div class="wrap">
    <section class="panel" aria-label="Introduction">
      <div class="badge"><span class="dot" aria-hidden="true"></span>Live Generative Canvas</div>
      <h1 class="hero">Neon ribbons that breathe when you do.</h1>
      <p class="lede">
        Move to tilt the field. Click inside the canvas to send a ripple. Tune the bloom using the controls.
        ECHO favors clarity: soft edges, gentle gradients, and rhythm you can feel.
      </p>
      <div class="hud" role="group" aria-label="Ribbon settings">
        <label class="chip" for="flow">Flow <output id="flowOut">50</output><input id="flow" type="range" value="50" min="0" max="100" step="1" /></label>
        <label class="chip" for="dens">Density <output id="densOut">12</output><input id="dens" type="range" value="12" min="4" max="40" step="1" /></label>
        <label class="chip" for="tint">Hue <output id="tintOut">200</output><input id="tint" type="range" value="200" min="0" max="360" step="1" /></label>
      </div>
      <div class="hint" id="hint">space pause · T theme · S save · +/- flow</div>
    </section>

    <section class="viz" id="viz" aria-label="Neon ribbons">
      <canvas id="ribbons" role="img" aria-label="Flowing neon ribbons responding to your pointer and controls"></canvas>
    </section>
  </div>

  <div class="foot">
    <div>Designed to be calm yet alive—like holding a seashell to the ear and hearing color.</div>
    <span id="last-updated">Last updated: 2025-12-31 17:19:11 EST</span>
  </div>

  <script>
    (function(){
      const root = document.getElementById('echo1655');
      const canvas = document.getElementById('ribbons');
      const ctx = canvas.getContext('2d', {alpha:true});
      const viz = document.getElementById('viz');

      const themeBtn = document.getElementById('theme');
      const pauseBtn = document.getElementById('pause');
      const saveBtn = document.getElementById('save');

      const flow = document.getElementById('flow');
      const dens = document.getElementById('dens');
      const tint = document.getElementById('tint');
      const flowOut = document.getElementById('flowOut');
      const densOut = document.getElementById('densOut');
      const tintOut = document.getElementById('tintOut');

      const lastUpdated = document.getElementById('last-updated');
      try{
        const fmt = new Intl.DateTimeFormat([], { dateStyle:'medium', timeStyle:'short' });
        lastUpdated.textContent = 'Last updated: ' + fmt.format(new Date());
      }catch(e){
        lastUpdated.textContent = 'Last updated: ' + new Date().toLocaleString();
      }

      // Outputs
      const syncFlow = ()=> flowOut.textContent = flow.value;
      const syncDens = ()=> densOut.textContent = dens.value;
      const syncTint = ()=> tintOut.textContent = tint.value;
      flow.addEventListener('input', syncFlow); syncFlow();
      dens.addEventListener('input', ()=>{ syncDens(); build(); }); syncDens();
      tint.addEventListener('input', syncTint); syncTint();

      // Theme
      let noir = false;
      function setTheme(isNoir){
        noir = !!isNoir;
        root.dataset.theme = noir ? 'noir' : '';
        themeBtn.textContent = noir ? 'Lumen' : 'Noir';
        themeBtn.setAttribute('aria-pressed', String(noir));
        clear(true);
      }
      themeBtn.addEventListener('click', ()=> setTheme(!noir));

      // Pause
      let paused = false;
      function setPaused(p){
        paused = !!p;
        root.classList.toggle('paused', paused);
        pauseBtn.textContent = paused ? 'Play' : 'Pause';
        pauseBtn.setAttribute('aria-pressed', String(paused));
      }
      pauseBtn.addEventListener('click', ()=> setPaused(!paused));

      // Save
      saveBtn.addEventListener('click', ()=>{
        try{
          const exportCanvas = document.createElement('canvas');
          exportCanvas.width = canvas.width;
          exportCanvas.height = canvas.height;
          const ex = exportCanvas.getContext('2d');
          // Fill with theme base for a clean export
          ex.fillStyle = noir ? '#06060a' : '#f8fbff';
          ex.fillRect(0,0,exportCanvas.width, exportCanvas.height);
          ex.drawImage(canvas, 0, 0);
          const link = document.createElement('a');
          link.download = 'echo-' + Date.now() + '.png';
          link.href = exportCanvas.toDataURL('image/png');
          link.click();
        }catch(e){}
      });

      // Sizing
      let DPR = Math.min(2, window.devicePixelRatio||1), W=0, H=0;
      function fit(){
        const r = viz.getBoundingClientRect();
        W = Math.max(1, Math.floor(r.width));
        H = Math.max(1, Math.floor(r.height));
        canvas.width = Math.floor(W*DPR);
        canvas.height = Math.floor(H*DPR);
        ctx.setTransform(DPR,0,0,DPR,0,0);
        clear(true);
        build();
      }
      const ro = new ResizeObserver(fit);
      ro.observe(viz);
      window.addEventListener('orientationchange', fit);

      // Pointer & tilt
      const pointer = { x: null, y: null, inside:false };
      root.addEventListener('pointermove', (e)=>{
        const rr = root.getBoundingClientRect();
        pointer.inside = true;
        const mx = (e.clientX - rr.left)/rr.width - .5;
        const my = (e.clientY - rr.top)/rr.height - .5;
        root.style.setProperty('--mx', mx.toFixed(3));
        root.style.setProperty('--my', my.toFixed(3));
        const cr = viz.getBoundingClientRect();
        pointer.x = (e.clientX - cr.left);
        pointer.y = (e.clientY - cr.top);
      }, {passive:true});
      root.addEventListener('pointerleave', ()=>{
        pointer.inside = false; pointer.x = pointer.y = null;
        root.style.setProperty('--mx', 0); root.style.setProperty('--my', 0);
      });
      let ripple = 0;
      viz.addEventListener('click', ()=> { ripple = 1.0; });

      // Model
      let lines = [];
      function build(){
        const n = +dens.value;
        lines = [];
        for(let i=0;i<n;i++){
          const t = (i+0.5)/n;
          lines.push({
            amp: 24 + t*120,
            amp2: 8 + t*36,
            freq: 0.002 + t*0.006,
            freq2: 0.004 + (1-t)*0.005,
            speed: 0.4 + t*1.4,
            width: 1.2 + t*2.6,
            hueOff: t*140,
            phase: Math.random()*Math.PI*2,
            phase2: Math.random()*Math.PI*2
          });
        }
      }

      // Clear
      function clear(full){
        if(full){
          ctx.clearRect(0,0,W,H);
          ctx.fillStyle = noir ? '#06060a' : '#f8fbff';
          ctx.fillRect(0,0,W,H);
        }else{
          const veil = noir ? 0.06 : 0.08;
          ctx.fillStyle = noir ? `rgba(6,6,10,${veil})` : `rgba(248,251,255,${veil})`;
          ctx.fillRect(0,0,W,H);
        }
      }

      // Draw
      let last = performance.now();
      function loop(now){
        const dt = Math.min(2.5, (now - last)*0.06);
        last = now;

        if(!paused){
          clear(false);

          const FLOW = (+flow.value)/50; // ~1 at mid
          const BASE_HUE = +tint.value;
          const time = now * 0.001 * FLOW;

          ripple *= 0.92;

          ctx.save();
          ctx.globalCompositeOperation = 'lighter';

          for(let i=0;i<lines.length;i++){
            const L = lines[i];
            const hue = (BASE_HUE + L.hueOff) % 360;
            const sat = noir ? 92 : 70;
            const lum = noir ? 66 : 44;
            const alpha = 0.16 + (i/lines.length)*0.22;

            ctx.lineWidth = L.width * (1 + ripple*0.8);
            ctx.strokeStyle = `hsla(${hue}, ${sat}%, ${lum}%, ${alpha})`;
            ctx.shadowColor = `hsl(${hue}, 90%, ${noir?72:60}%)`;
            ctx.shadowBlur = noir ? 28 : 18;

            const segs = 180;
            const step = W / segs;
            const yBase = H*0.5 + (pointer.y==null?0: (pointer.y - H*0.5)*0.06);

            ctx.beginPath();
            for(let s=0;s<=segs;s++){
              const x = s*step;
              const wobble = Math.sin(x*L.freq + time*L.speed + L.phase) * (L.amp + ripple*60);
              const wobble2 = Math.sin(x*L.freq2 + time*L.speed*0.6 + L.phase2) * (L.amp2 + ripple*30);
              const y = yBase + wobble + wobble2;
              if(s===0) ctx.moveTo(x, y);
              else ctx.lineTo(x, y);
            }
            ctx.stroke();
          }

          ctx.restore();
        }

        requestAnimationFrame(loop);
      }

      // Keyboard
      root.tabIndex = 0;
      root.addEventListener('keydown', (e)=>{
        const k = e.key.toLowerCase();
        if(k===' '){ e.preventDefault(); setPaused(!paused); }
        if(k==='t'){ themeBtn.click(); }
        if(k==='s'){ saveBtn.click(); }
        if(k==='+'||k==='='){ flow.stepUp(); flow.dispatchEvent(new Event('input')); }
        if(k==='-'||k==='_'){ flow.stepDown(); flow.dispatchEvent(new Event('input')); }
      });

      // Reduced motion default pause
      if(window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches){
        setPaused(true);
      }

      // Boot
      setTheme(false);
      fit();
      build();
      requestAnimationFrame(loop);
    }());
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


