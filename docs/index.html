<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="vibe2407" data-mode="light" aria-label="Orbital Atelier">
  <style>
    /* Scope all styles to #vibe2407 */
    #vibe2407 {
      --r: 30px;

      /* Light */
      --bg: hsl(210 40% 98%);
      --bg2: hsl(190 70% 97%);
      --fg: hsl(228 26% 12%);
      --muted: hsl(228 10% 38%);
      --line: hsl(220 20% 20% / 0.12);

      --a1: hsl(196 90% 46%);
      --a2: hsl(264 88% 60%);
      --a3: hsl(24 92% 56%);

      position: relative;
      isolation: isolate;
      color: var(--fg);
      background:
        radial-gradient(1200px 800px at 110% -10%, color-mix(in oklab, var(--a2) 18%, transparent), transparent 60%),
        radial-gradient(1000px 900px at -10% 120%, color-mix(in oklab, var(--a1) 20%, transparent), transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg));
      border-radius: var(--r);
      border: 1px solid var(--line);
      box-shadow: 0 40px 120px hsl(0 0% 0% / 0.16), inset 0 0 0 1px hsl(0 0% 100% / 0.75);
      min-height: 78vh;
      padding: clamp(18px, 4vw, 48px);
      font: 420 15px/1.55 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      overflow: hidden;
      container-type: inline-size;
    }

    /* Dusk */
    #vibe2407[data-mode="dusk"] {
      --bg: hsl(20 85% 96%);
      --bg2: hsl(46 100% 96%);
      --fg: hsl(22 30% 12%);
      --muted: hsl(22 20% 34%);
      --line: hsl(22 40% 20% / 0.14);
      --a1: hsl(10 88% 60%);
      --a2: hsl(340 82% 62%);
      --a3: hsl(48 92% 56%);
      background:
        radial-gradient(1200px 800px at 110% -10%, color-mix(in oklab, var(--a2) 22%, transparent), transparent 60%),
        radial-gradient(1000px 900px at -10% 120%, color-mix(in oklab, var(--a3) 26%, transparent), transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg));
    }

    /* Midnight */
    #vibe2407[data-mode="midnight"] {
      --bg: hsl(235 45% 7%);
      --bg2: hsl(245 42% 11%);
      --fg: hsl(0 0% 98%);
      --muted: hsl(0 0% 82%);
      --line: hsl(0 0% 100% / 0.14);
      --a1: hsl(192 90% 62%);
      --a2: hsl(268 86% 64%);
      --a3: hsl(20 92% 60%);
      background:
        radial-gradient(1200px 800px at 110% -10%, color-mix(in oklab, var(--a2) 34%, transparent), transparent 60%),
        radial-gradient(1000px 900px at -10% 120%, color-mix(in oklab, var(--a1) 28%, transparent), transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg));
      box-shadow: 0 40px 120px hsl(0 0% 0% / 0.6), inset 0 0 0 1px hsl(0 0% 100% / 0.06);
    }

    /* Ambient veils */
    #vibe2407::before, #vibe2407::after {
      content: "";
      position: absolute; inset: -20%;
      filter: blur(60px) saturate(130%);
      mix-blend-mode: screen;
      opacity: 0.45;
      pointer-events: none;
      z-index: 0;
    }
    #vibe2407::before {
      background:
        conic-gradient(from 20deg at 30% 60%, var(--a1), transparent 65%),
        conic-gradient(from -30deg at 70% 40%, var(--a2), transparent 65%);
      animation: v2407-wash-a 24s ease-in-out infinite alternate;
    }
    #vibe2407::after {
      background: conic-gradient(from 120deg at 50% 45%, var(--a3), transparent 70%);
      animation: v2407-wash-b 36s ease-in-out infinite alternate-reverse;
    }

    /* Grain and subtle grid */
    #vibe2407 .grain {
      position: absolute; inset: 0; z-index: 1; pointer-events: none;
      background:
        radial-gradient(140% 80% at 50% 0%, hsl(0 0% 100% / 0.5), transparent 60%) top center / 100% 100% no-repeat,
        repeating-linear-gradient(0deg, hsl(0 0% 100% / 0.02) 0 1px, transparent 1px 34px),
        repeating-linear-gradient(90deg, hsl(0 0% 0% / 0.03) 0 1px, transparent 1px 34px);
      mask: radial-gradient(120% 100% at 50% 20%, black, transparent);
    }

    /* Top bar */
    #vibe2407 .top {
      position: relative; z-index: 3;
      display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 12px;
      margin-bottom: clamp(14px, 3.6vw, 28px);
    }
    #vibe2407 .brand {
      display: inline-grid; grid-auto-flow: column; place-items: center; gap: 12px;
      padding: 10px 14px; border-radius: 16px; border: 1px solid var(--line);
      background: hsl(0 0% 100% / 0.75);
      backdrop-filter: blur(10px) saturate(160%);
      color: var(--fg); font-weight: 900; letter-spacing: 0.08em; text-transform: uppercase; font-size: 12px;
    }
    #vibe2407[data-mode="midnight"] .brand { background: hsl(0 0% 100% / 0.06); }

    #vibe2407 .sigil {
      width: 24px; height: 24px; position: relative; display: inline-block;
      filter: drop-shadow(0 1px 0 hsl(0 0% 0% / 0.15));
    }
    #vibe2407 .sigil::before, #vibe2407 .sigil::after {
      content:""; position:absolute; inset:0; border-radius:50%;
      background:
        radial-gradient(circle at 50% 50%, var(--a1), transparent 60%),
        conic-gradient(from 0deg, var(--a1), var(--a2), var(--a3), var(--a1));
      mask: radial-gradient(circle, #000 46%, transparent 47%), radial-gradient(circle, transparent 60%, #000 61%);
      animation: v2407-spin 9s linear infinite;
    }
    #vibe2407 .sigil::after{
      filter: blur(2px) saturate(120%); opacity:0.7; animation-direction: reverse; animation-duration: 18s;
    }

    /* Controls */
    #vibe2407 .ctrls { display: inline-flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    #vibe2407 .seg {
      display: inline-flex; gap: 2px; padding: 4px; border-radius: 999px;
      border: 1px solid var(--line);
      background: hsl(0 0% 100% / 0.7);
      backdrop-filter: blur(8px) saturate(160%);
    }
    #vibe2407[data-mode="midnight"] .seg { background: hsl(0 0% 100% / 0.08); }
    #vibe2407 .seg button {
      appearance: none; border: 0; background: transparent; color: var(--fg);
      padding: 8px 12px; border-radius: 999px; font-weight: 800; font-size: 12px; cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;
    }
    #vibe2407 .seg button[aria-pressed="true"] {
      color: white;
      background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3));
      text-shadow: 0 1px 0 hsl(0 0% 0% / 0.25);
    }

    #vibe2407 .knob {
      display: inline-grid; grid-template-columns: auto 1fr; align-items: center; gap: 8px;
      padding: 8px 10px; border: 1px solid var(--line); border-radius: 12px;
      background: hsl(0 0% 100% / 0.7); font-size: 12px; color: var(--muted);
      backdrop-filter: blur(8px) saturate(160%);
    }
    #vibe2407[data-mode="midnight"] .knob { background: hsl(0 0% 100% / 0.08); color: var(--fg); }

    #vibe2407 input[type="range"] {
      -webkit-appearance: none; appearance: none;
      width: 140px; height: 10px; border-radius: 999px;
      background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3));
      border: 1px solid hsl(0 0% 100% / 0.35);
      box-shadow: inset 0 1px 0 hsl(0 0% 100% / 0.45), 0 2px 9px hsl(0 0% 0% / 0.2);
      outline: none; cursor: pointer;
    }
    #vibe2407 input[type="range"]::-webkit-slider-thumb,
    #vibe2407 input[type="range"]::-moz-range-thumb {
      -webkit-appearance: none; appearance: none;
      width: 18px; height: 18px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, hsl(0 0% 100%), hsl(0 0% 92%));
      border: 1px solid hsl(0 0% 100% / 0.65);
      box-shadow: 0 2px 8px hsl(0 0% 0% / 0.35), 0 0 0 6px color-mix(in oklab, var(--a2) 30%, transparent);
    }
    #vibe2407 .pulse {
      appearance: none; border: 0; cursor: pointer;
      padding: 9px 12px; border-radius: 12px; font-weight: 900; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase;
      color: white; background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3));
      box-shadow: 0 6px 18px color-mix(in oklab, var(--a2) 36%, transparent);
      transition: transform .15s ease, box-shadow .2s ease;
    }
    #vibe2407 .pulse:active { transform: translateY(1px) scale(0.99); box-shadow: 0 2px 10px color-mix(in oklab, var(--a2) 30%, transparent); }

    /* Layout */
    #vibe2407 .wrap {
      position: relative; z-index: 2;
      display: grid; grid-template-columns: 1.15fr 0.85fr; gap: clamp(16px, 4.2vw, 42px);
      align-items: center;
    }
    @container (max-width: 900px) {
      #vibe2407 .wrap { grid-template-columns: 1fr; }
    }

    /* Portal (hero) */
    #vibe2407 .portal {
      position: relative;
      border-radius: 28px;
      border: 1px solid var(--line);
      background: linear-gradient(180deg, hsl(0 0% 100% / 0.8), hsl(0 0% 100% / 0.6));
      backdrop-filter: blur(12px) saturate(160%);
      box-shadow: 0 34px 96px hsl(0 0% 0% / 0.2), inset 0 0 0 1px hsl(0 0% 100% / 0.6);
      aspect-ratio: 1 / 1;
      overflow: hidden;
    }
    #vibe2407[data-mode="midnight"] .portal {
      background: linear-gradient(180deg, hsl(0 0% 100% / 0.06), hsl(0 0% 100% / 0.03));
      box-shadow: 0 34px 96px hsl(0 0% 0% / 0.5), inset 0 0 0 1px hsl(0 0% 100% / 0.08);
    }

    #vibe2407 .portal::before {
      content: "";
      position: absolute; inset: -20%;
      background:
        radial-gradient(60% 60% at 50% 50%, color-mix(in oklab, var(--a2) 18%, transparent), transparent 70%),
        conic-gradient(from 0deg at 50% 50%, color-mix(in oklab, var(--a1) 12%, transparent), transparent 60%);
      filter: blur(40px) saturate(160%);
      opacity: 0.7;
      mix-blend-mode: screen;
      animation: v2407-aurora 18s ease-in-out infinite alternate;
      pointer-events: none;
    }

    #vibe2407 .sky {
      position: absolute; inset: 0; z-index: 1; pointer-events: none; opacity: 0.18;
      background:
        radial-gradient(circle at 50% 50%, transparent 0 6%, hsl(0 0% 0% / 0.04) 6.2% 6.6%, transparent 6.8% 12%),
        radial-gradient(circle at 50% 50%, transparent 0 12%, hsl(0 0% 0% / 0.04) 12.2% 12.6%, transparent 12.8% 18%),
        radial-gradient(circle at 50% 50%, transparent 0 18%, hsl(0 0% 0% / 0.04) 18.2% 18.6%, transparent 18.8% 24%);
      mask: radial-gradient(90% 90% at 50% 50%, black 60%, transparent);
    }
    #vibe2407[data-mode="midnight"] .sky { opacity: 0.32; background:
      radial-gradient(circle at 50% 50%, transparent 0 6%, hsl(0 0% 100% / 0.05) 6.2% 6.6%, transparent 6.8% 12%),
      radial-gradient(circle at 50% 50%, transparent 0 12%, hsl(0 0% 100% / 0.05) 12.2% 12.6%, transparent 12.8% 18%),
      radial-gradient(circle at 50% 50%, transparent 0 18%, hsl(0 0% 100% / 0.05) 18.2% 18.6%, transparent 18.8% 24%);
    }

    #vibe2407 .orb-canvas { position: absolute; inset: 0; width: 100%; height: 100%; display: block; z-index: 2; mix-blend-mode: multiply; }
    #vibe2407[data-mode="midnight"] .orb-canvas { mix-blend-mode: screen; }

    /* Copy block */
    #vibe2407 .copy { display: grid; gap: 14px; }
    #vibe2407 .k {
      margin: 0;
      font-family: ui-serif, Georgia, "Times New Roman", serif;
      font-size: clamp(34px, 9cqi, 108px);
      line-height: 0.9; letter-spacing: -0.02em; font-weight: 900;
      background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-shadow: 0 1px 0 hsl(0 0% 0% / 0.18);
      animation: v2407-sheen 9s ease-in-out infinite;
    }
    #vibe2407[data-mode="midnight"] .k { text-shadow: 0 1px 0 hsl(0 0% 100% / 0.18); }

    #vibe2407 .s { margin: 0; font-size: clamp(13px, 2.6cqi, 22px); color: var(--muted); text-wrap: pretty; }
    #vibe2407 .chips { display: flex; flex-wrap: wrap; gap: 8px; }
    #vibe2407 .chip {
      display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px;
      border-radius: 999px; border: 1px solid var(--line);
      background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3));
      color: white; text-shadow: 0 1px 0 hsl(0 0% 0% / 0.25);
      font-weight: 800; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase;
    }
    #vibe2407 .dot { width: 8px; height: 8px; border-radius: 50%; background: white; }

    /* Scrolling ticker */
    #vibe2407 .ribbon {
      position: relative; z-index: 2;
      width: 100%; overflow: hidden;
      border-radius: 14px; border: 1px solid var(--line);
      background: hsl(0 0% 100% / 0.7);
      backdrop-filter: blur(8px) saturate(160%);
      margin-top: clamp(14px, 3.2vw, 26px);
    }
    #vibe2407[data-mode="midnight"] .ribbon { background: hsl(0 0% 100% / 0.08); }
    #vibe2407 .ribbon .row {
      display: flex; gap: 20px; align-items: center; white-space: nowrap;
      padding: 10px 12px; font-weight: 800; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; color: var(--fg);
      animation: v2407-slide 26s linear infinite;
    }

    /* Footer */
    #vibe2407 .foot {
      position: relative; z-index: 2; display: grid; place-items: center; text-align: center;
      margin-top: clamp(18px, 4vw, 36px); gap: 10px; color: var(--muted);
    }
    #vibe2407 .foot small {
      font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase;
      border: 1px solid var(--line); padding: 8px 12px; border-radius: 10px; background: hsl(0 0% 100% / 0.75);
    }
    #vibe2407[data-mode="midnight"] .foot small { background: hsl(0 0% 100% / 0.08); color: var(--fg); }

    /* Keyframes */
    @keyframes v2407-wash-a {
      0% { transform: translate3d(-2%, -3%, 0) rotate(0deg) scale(1); }
      50% { transform: translate3d(2%, 2%, 0) rotate(18deg) scale(1.06); }
      100% { transform: translate3d(-2%, 3%, 0) rotate(26deg) scale(1.02); }
    }
    @keyframes v2407-wash-b {
      0% { transform: translate3d(2%, 1%, 0) rotate(0deg) scale(1.02); }
      50% { transform: translate3d(-2%, -1%, 0) rotate(-12deg) scale(1.09); }
      100% { transform: translate3d(1%, -2%, 0) rotate(-26deg) scale(1.02); }
    }
    @keyframes v2407-sheen {
      0%, 100% { filter: drop-shadow(0 2px 0 hsl(0 0% 0% / 0.12)); }
      50% { filter: drop-shadow(0 6px 12px color-mix(in oklab, var(--a2) 35%, transparent)); }
    }
    @keyframes v2407-slide {
      from { transform: translateX(0); }
      to { transform: translateX(-50%); }
    }
    @keyframes v2407-aurora {
      0% { transform: translate(-2%, -1%) rotate(0deg) scale(1.02); }
      50% { transform: translate(1%, 2%) rotate(10deg) scale(1.08); }
      100% { transform: translate(-1%, 2%) rotate(-8deg) scale(1.03); }
    }
    @keyframes v2407-spin {
      to { transform: rotate(360deg); }
    }

    /* Reduced motion */
    #vibe2407.reduce-motion::before,
    #vibe2407.reduce-motion::after { animation: none !important; }
    #vibe2407.reduce-motion .k { animation: none !important; }
    #vibe2407.reduce-motion .ribbon .row { animation-duration: 0s !important; }
    #vibe2407.reduce-motion .sigil::before, 
    #vibe2407.reduce-motion .sigil::after { animation: none !important; }
  </style>

  <div class="grain" aria-hidden="true"></div>

  <div class="top">
    <div class="brand" aria-label="Orbital Atelier">
      <i class="sigil" aria-hidden="true"></i>
      <span>Orbital Atelier</span>
    </div>

    <div class="ctrls" role="group" aria-label="Appearance and motion controls">
      <div class="seg" role="tablist" aria-label="Mode">
        <button class="mode" data-mode="light" aria-pressed="true" role="tab">Light</button>
        <button class="mode" data-mode="dusk" aria-pressed="false" role="tab">Dusk</button>
        <button class="mode" data-mode="midnight" aria-pressed="false" role="tab">Midnight</button>
      </div>

      <label class="knob" for="flux">
        Flux
        <input id="flux" type="range" min="0.2" max="2.6" step="0.1" value="1.0" aria-label="Adjust orbital speed">
      </label>

      <label class="knob" for="orbits">
        Orbits
        <input id="orbits" type="range" min="6" max="80" step="2" value="28" aria-label="Adjust orbit count">
      </label>

      <label class="knob" for="bloom">
        Bloom
        <input id="bloom" type="range" min="0" max="2.0" step="0.1" value="0.9" aria-label="Adjust glow bloom">
      </label>

      <button class="pulse" type="button" aria-label="Emit pulse">Pulse</button>
    </div>
  </div>

  <div class="wrap">
    <div class="portal" tabindex="0" aria-label="Interactive orbital canvas">
      <div class="sky" aria-hidden="true"></div>
      <canvas class="orb-canvas" aria-hidden="true"></canvas>
    </div>

    <div class="copy" aria-live="polite">
      <h1 class="k">Soft gravity for sharp ideas.</h1>
      <p class="s">Nudge the cosmos with your cursor. Tap Pulse to send a ripple across the rings.</p>
      <div class="chips" aria-hidden="true">
        <span class="chip"><i class="dot"></i> Tactile calm</span>
        <span class="chip"><i class="dot"></i> Kinetic clarity</span>
        <span class="chip"><i class="dot"></i> Playful rigor</span>
      </div>
    </div>
  </div>

  <div class="ribbon" aria-hidden="true">
    <div class="row">
      <span class="chip"><i class="dot"></i> Orbital</span>
      <span>Design with gravity</span>
      <span class="chip"><i class="dot"></i> Serene</span>
      <span>Interaction as ambience</span>
      <span class="chip"><i class="dot"></i> Precise</span>
      <span>Edge-to-edge craft</span>
      <span class="chip"><i class="dot"></i> Humane</span>
      <span>Accessible by default</span>
      <!-- loop -->
      <span class="chip"><i class="dot"></i> Orbital</span>
      <span>Design with gravity</span>
      <span class="chip"><i class="dot"></i> Serene</span>
      <span>Interaction as ambience</span>
      <span class="chip"><i class="dot"></i> Precise</span>
      <span>Edge-to-edge craft</span>
      <span class="chip"><i class="dot"></i> Humane</span>
      <span>Accessible by default</span>
    </div>
  </div>

  <div class="foot">
    <small>Crafted at the intersection of physics and poetry.</small>
    <span id="last-updated">Last updated: 2026-02-05 07:58:27 EST</span>
  </div>

  <script>
    (function () {
      const root = document.getElementById('vibe2407');
      const canvas = root.querySelector('.orb-canvas');
      const ctx = canvas.getContext('2d', { alpha: true });
      const portal = root.querySelector('.portal');
      const modes = Array.from(root.querySelectorAll('.mode'));
      const flux = root.querySelector('#flux');
      const orbits = root.querySelector('#orbits');
      const bloom = root.querySelector('#bloom');
      const pulseBtn = root.querySelector('.pulse');
      const stamp = root.querySelector('#last-updated');

      // Stamp
      try {
        const now = new Date();
        const fmt = new Intl.DateTimeFormat(undefined, { dateStyle: 'medium', timeStyle: 'medium' });
        stamp.textContent = 'Last updated: ' + fmt.format(now);
      } catch {
        stamp.textContent = 'Last updated: just now';
      }

      // Reduced motion
      const prefersReduce = window.matchMedia ? matchMedia('(prefers-reduced-motion: reduce)') : null;
      const applyReduce = on => root.classList.toggle('reduce-motion', !!on);
      if (prefersReduce) {
        applyReduce(prefersReduce.matches);
        prefersReduce.addEventListener('change', e => applyReduce(e.matches));
      }

      // Theme switching
      const applyMode = (m) => {
        root.setAttribute('data-mode', m);
        modes.forEach(b => b.setAttribute('aria-pressed', b.dataset.mode === m ? 'true' : 'false'));
        readPalette();
        resize();
        seed();
        start();
      };
      modes.forEach(btn => btn.addEventListener('click', () => applyMode(btn.dataset.mode)));

      // Palette
      const palette = { a1: '#fff', a2: '#fff', a3: '#fff', fg: '#000', mode: 'light', dark: false };
      const readPalette = () => {
        const s = getComputedStyle(root);
        palette.a1 = s.getPropertyValue('--a1').trim();
        palette.a2 = s.getPropertyValue('--a2').trim();
        palette.a3 = s.getPropertyValue('--a3').trim();
        palette.fg = s.getPropertyValue('--fg').trim();
        palette.mode = root.getAttribute('data-mode');
        palette.dark = palette.mode === 'midnight';
      };

      // Canvas setup
      const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      let raf, W = 0, H = 0, CX = 0, CY = 0, R = 0, T0 = 0, lastT = 0;

      const state = {
        speed: parseFloat(flux.value),
        count: parseInt(orbits.value, 10),
        bloom: parseFloat(bloom.value),
        t: 0
      };

      const resize = () => {
        const r = portal.getBoundingClientRect();
        W = Math.floor(r.width);
        H = Math.floor(r.height);
        CX = W * 0.5;
        CY = H * 0.5;
        R = Math.min(W, H) * 0.45;
        canvas.width = Math.floor(W * DPR);
        canvas.height = Math.floor(H * DPR);
        canvas.style.width = W + 'px';
        canvas.style.height = H + 'px';
        ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      };

      // Orbits + nodes
      let rings = [];
      const rand = (min, max) => min + Math.random() * (max - min);

      const gradient = () => {
        const g = ctx.createLinearGradient(0, 0, W, 0);
        g.addColorStop(0, palette.a1);
        g.addColorStop(0.5, palette.a2);
        g.addColorStop(1, palette.a3);
        return g;
      };

      const seed = () => {
        rings = [];
        for (let i = 0; i < state.count; i++) {
          const k = i / Math.max(1, state.count - 1);
          const ease = Math.pow(k, 0.9);
          rings.push({
            r: 12 + ease * (R - 20),
            phase: rand(0, Math.PI * 2),
            vel: rand(0.05, 0.22) * (0.4 + ease * 1.2),
            jitter: rand(0.6, 1.6),
            w: 0.6 + 1.4 * (1 - Math.abs(0.5 - k) * 2)
          });
        }
        ctx.clearRect(0, 0, W, H);
      };

      // Pointer
      const pointer = { x: CX, y: CY, inside: false };
      portal.addEventListener('pointerenter', () => pointer.inside = true);
      portal.addEventListener('pointerleave', () => { pointer.inside = false; pointer.x = CX; pointer.y = CY; });
      portal.addEventListener('pointermove', (e) => {
        const r = portal.getBoundingClientRect();
        pointer.x = e.clientX - r.left;
        pointer.y = e.clientY - r.top;
      });

      // Pulses
      let pulses = [];
      const emitPulse = (x = CX, y = CY) => {
        const dx = x - CX, dy = y - CY;
        pulses.push({
          t: 0,
          o: Math.atan2(dy, dx),
          c: Math.hypot(dx, dy) * 0.2 + R * 0.15,
          life: 1
        });
      };
      pulseBtn.addEventListener('click', () => emitPulse(pointer.x, pointer.y));
      portal.addEventListener('pointerdown', (e) => {
        const r = portal.getBoundingClientRect();
        emitPulse(e.clientX - r.left, e.clientY - r.top);
      });
      portal.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          emitPulse(CX, CY);
        }
      });

      // Draw
      const step = (tms) => {
        if (root.classList.contains('reduce-motion')) {
          drawStatic();
          return;
        }

        if (!T0) T0 = tms, lastT = tms;
        const t = (tms - T0) * 0.001;
        let dt = Math.min(0.05, (tms - lastT) * 0.001);
        lastT = tms;
        state.t = t;

        // Fade background
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = palette.dark ? 'rgba(0,0,0,0.12)' : 'rgba(255,255,255,0.12)';
        ctx.fillRect(0, 0, W, H);

        // Center sway toward pointer
        const dx = pointer.x - CX;
        const dy = pointer.y - CY;
        const pull = pointer.inside ? 0.06 : 0.02;
        const swayX = dx * pull;
        const swayY = dy * pull;

        // Shadow/glow
        ctx.shadowColor = palette.a2;
        ctx.shadowBlur = 8 * state.bloom;

        // Ring strokes
        const g = gradient();
        ctx.strokeStyle = g;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        // Update pulses
        for (let i = pulses.length - 1; i >= 0; i--) {
          const p = pulses[i];
          p.t += dt * 1.6;
          p.life = Math.max(0, 1 - p.t);
          if (p.life <= 0) pulses.splice(i, 1);
        }

        // Precompute pulse influence
        const pulseInfluence = (angle, rad) => {
          let bump = 0;
          for (let i = 0; i < pulses.length; i++) {
            const p = pulses[i];
            const waveR = p.t * (R * 1.6);
            const d = Math.abs(rad - (p.c + waveR));
            bump += 22 * Math.exp(-d * 0.02) * p.life;
          }
          return bump;
        };

        // Draw orbits and nodes
        const nodes = [];
        for (let i = 0; i < rings.length; i++) {
          const ring = rings[i];
          ring.phase += dt * ring.vel * state.speed * ring.jitter;

          const baseR = ring.r + pulseInfluence(ring.phase, ring.r);
          const osc = Math.sin(t * (0.8 + ring.jitter) + ring.phase) * 2.2;
          const rr = baseR + osc + (pointer.inside ? Math.sin(i * 0.14 + t * 1.1) * 1.8 : 0);

          const x = CX + swayX + Math.cos(ring.phase) * rr;
          const y = CY + swayY + Math.sin(ring.phase) * rr;
          nodes.push({ x, y, w: ring.w });

          // Subtle orbit arc
          ctx.globalAlpha = 0.22 + 0.35 * (1 - Math.abs(0.5 - (i / rings.length)) * 2);
          ctx.lineWidth = 0.6 + 1.0 * Math.sin((i * 0.1) + t * 0.8);
          ctx.beginPath();
          const steps = 64;
          for (let a = 0; a <= steps; a++) {
            const ang = (a / steps) * Math.PI * 2;
            const pr = ring.r + Math.sin(ang * 6 + t * 0.7) * 1.2;
            const px = CX + swayX + Math.cos(ang) * pr;
            const py = CY + swayY + Math.sin(ang) * pr;
            if (a === 0) ctx.moveTo(px, py); else ctx.lineTo(px, py);
          }
          ctx.closePath();
          ctx.stroke();

          // Node dot
          ctx.globalAlpha = 0.9;
          ctx.fillStyle = g;
          ctx.beginPath();
          ctx.arc(x, y, 1.6 + 0.8 * Math.sin(t * 2 + i), 0, Math.PI * 2);
          ctx.fill();
        }

        // Connect nodes
        ctx.globalAlpha = 0.6;
        ctx.lineWidth = 1.2;
        for (let i = 1; i < nodes.length; i++) {
          const a = nodes[i - 1], b = nodes[i];
          ctx.beginPath();
          ctx.moveTo(a.x, a.y);
          ctx.lineTo(b.x, b.y);
          ctx.stroke();
        }

        // Pulse rings visual
        for (let i = 0; i < pulses.length; i++) {
          const p = pulses[i];
          const rr = p.t * (R * 1.5) + 8;
          ctx.globalAlpha = 0.35 * p.life;
          ctx.lineWidth = 2 + 4 * (1 - p.life);
          ctx.beginPath();
          ctx.arc(CX + swayX, CY + swayY, rr, 0, Math.PI * 2);
          ctx.stroke();
        }

        raf = requestAnimationFrame(step);
      };

      const drawStatic = () => {
        ctx.clearRect(0, 0, W, H);
        ctx.shadowColor = palette.a2;
        ctx.shadowBlur = 6 * state.bloom;
        const g = gradient();
        ctx.strokeStyle = g;
        ctx.globalAlpha = 0.85;
        ctx.lineWidth = 1;

        // Draw a tidy set of rings without animation
        const samples = Math.min(24, rings.length);
        for (let i = 0; i < samples; i++) {
          const ring = rings[Math.floor(i * (rings.length - 1) / Math.max(1, samples - 1))];
          ctx.beginPath();
          ctx.arc(CX, CY, ring.r, 0, Math.PI * 2);
          ctx.stroke();
        }
      };

      const start = () => {
        cancelAnimationFrame(raf);
        raf = requestAnimationFrame(step);
      };

      // Controls
      flux.addEventListener('input', e => { state.speed = parseFloat(e.target.value); });
      orbits.addEventListener('input', e => { state.count = parseInt(e.target.value, 10); seed(); });
      bloom.addEventListener('input', e => { state.bloom = parseFloat(e.target.value); });

      // Resize observer
      const ro = new ResizeObserver(() => { resize(); seed(); start(); });
      ro.observe(portal);

      // Init
      readPalette();
      resize();
      seed();
      start();

      // Cleanup if removed
      root.addEventListener('DOMNodeRemoved', () => { cancelAnimationFrame(raf); ro.disconnect(); });
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


