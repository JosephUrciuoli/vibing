<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="nova672" data-theme="moon" data-motion="on" role="region" aria-label="Nova 672 — Aether Loom">
  <style>
    .nova672 {
      --r: 28px;
      --fg: 236,242,248;
      --muted: 160,170,185;
      --bg1:#0b0f18; --bg2:#0a1022; --bg3:#0a0a0a;
      --a1:#60a5fa; --a2:#22d3ee; --a3:#a78bfa; --a4:#34d399; --a5:#f472b6;
      --glass: rgba(255,255,255,.08);
      --border: rgba(255,255,255,.12);
      --glow: 0 30px 100px rgba(0,0,0,.6), inset 0 1px 0 rgba(255,255,255,.08);
      position: relative;
      border-radius: var(--r);
      padding: clamp(16px, 4.5vmin, 56px);
      color: rgb(var(--fg));
      font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Display", Inter, "Segoe UI", Roboto, Helvetica, Arial;
      background:
        radial-gradient(120% 160% at 20% -10%, color-mix(in srgb, var(--a2), transparent 80%), transparent 60%),
        radial-gradient(180% 160% at 100% 100%, color-mix(in srgb, var(--a3), transparent 85%), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2) 40%, var(--bg3));
      box-shadow: var(--glow);
      overflow: clip;
      isolation: isolate;
      transform: perspective(1000px) rotateX(calc(var(--tiltY, 0) * 2deg)) rotateY(calc(var(--tiltX, 0) * -3deg));
      transition: transform .25s cubic-bezier(.2,.8,.2,1), background .45s ease;
    }
    .nova672::after {
      content:"";
      position:absolute; inset:-25%;
      background:
        conic-gradient(from 180deg at 60% 40%, rgba(255,255,255,.05), transparent 28% 32%, rgba(255,255,255,.04), transparent 68% 72%, rgba(255,255,255,.06)),
        radial-gradient(100% 100% at 50% 50%, rgba(255,255,255,.08), transparent 60%);
      mix-blend-mode: soft-light;
      animation: nova672-sheen 28s linear infinite;
      pointer-events:none;
      opacity:.5;
    }
    @keyframes nova672-sheen { 0% { transform: rotate(0deg) translate3d(0,0,0);} 50% { transform: rotate(.6deg) translate3d(1%, -1%, 0);} 100% { transform: rotate(0deg) translate3d(0,0,0);} }

    /* Themes */
    .nova672[data-theme="moon"] { --bg1:#0b0f18; --bg2:#0a1022; --bg3:#06070a; --a1:#60a5fa; --a2:#22d3ee; --a3:#a78bfa; --a4:#34d399; --a5:#f472b6; --fg:236,242,248; --muted:160,170,185; --glass: rgba(255,255,255,.08); --border: rgba(255,255,255,.12); }
    .nova672[data-theme="sol"]  { --bg1:#fff9ed; --bg2:#fff4e6; --bg3:#fff1e0; --a1:#f59e0b; --a2:#fb7185; --a3:#f97316; --a4:#84cc16; --a5:#06b6d4; --fg:20,28,40; --muted:90,100,120; --glass: rgba(255,255,255,.65); --border: rgba(16,24,40,.12); }
    .nova672[data-theme="prism"]{ --bg1:#0a0b10; --bg2:#0b1022; --bg3:#0a0612; --a1:#e879f9; --a2:#22d3ee; --a3:#fde047; --a4:#34d399; --a5:#60a5fa; --fg:240,245,255; --muted:160,170,185; --glass: rgba(255,255,255,.1); --border: rgba(255,255,255,.14); }

    .nova672 .mast {
      position: relative; z-index: 3;
      display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: end;
      margin-bottom: clamp(14px, 3.8vmin, 30px);
    }
    .nova672 .brand {
      display: grid; gap: 8px;
    }
    .nova672 .sig {
      display: inline-grid; grid-auto-flow: column; gap: 10px; align-items: center; width: max-content;
      padding: 8px 12px; border-radius: 999px;
      background: var(--glass);
      border: 1px solid var(--border);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.22), 0 12px 28px rgba(0,0,0,.35);
      backdrop-filter: blur(10px) saturate(140%);
      color: rgba(var(--muted), .95);
      font-weight: 700; letter-spacing: .08em; font-size: 11px; text-transform: uppercase;
    }
    .nova672 .dot {
      width: 10px; height: 10px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, var(--a2), color-mix(in srgb, var(--a1), #000 22%));
      box-shadow: 0 0 0 0 color-mix(in srgb, var(--a2), transparent 40%);
      animation: nova672-pulse 2.4s ease-in-out infinite;
    }
    @keyframes nova672-pulse { 0%{box-shadow:0 0 0 0 color-mix(in srgb, var(--a2), transparent 50%)} 70%{box-shadow:0 0 0 12px transparent} 100%{box-shadow:0 0 0 0 transparent} }

    .nova672 h1 {
      margin: 0; line-height: .86;
      font-family: ui-serif, "SF Pro Display", Georgia, "Times New Roman", serif;
      font-weight: 900;
      font-size: clamp(44px, 11vw, 128px);
      letter-spacing: -0.035em;
      background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3), var(--a5));
      background-size: 240% 100%;
      -webkit-background-clip: text; background-clip: text; color: transparent;
      filter: drop-shadow(0 14px 40px rgba(0,0,0,.35));
      will-change: background-position;
    }
    .nova672 .tag {
      margin: 0; font-size: clamp(12px, 2.1vmin, 16px); letter-spacing: .01em;
      color: rgba(var(--muted), .95);
    }

    .nova672 .hud {
      display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: flex-end;
    }
    .nova672 .btn {
      appearance: none; cursor: pointer; user-select: none; border: 1px solid var(--border);
      border-radius: 999px; font-weight: 800; letter-spacing: .06em; text-transform: uppercase;
      font-size: 11px; padding: 10px 14px;
      color: rgb(var(--fg));
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.28), 0 14px 36px rgba(0,0,0,.45);
      backdrop-filter: blur(8px) saturate(160%);
      transition: transform .18s cubic-bezier(.2,.7,.2,1), box-shadow .18s cubic-bezier(.2,.7,.2,1);
    }
    .nova672[data-theme="sol"] .btn {
      background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.6));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9), 0 14px 30px rgba(16,24,40,.12);
      color: rgb(20,28,40);
    }
    .nova672 .btn:hover { transform: translateY(-2px); }
    .nova672 .btn.primary {
      background: linear-gradient(180deg, color-mix(in srgb, var(--a2), #fff 20%), color-mix(in srgb, var(--a1), #000 10%));
      border-color: color-mix(in srgb, var(--a2), #000 60%);
      color: #06121c;
      text-shadow: 0 1px 0 rgba(255,255,255,.45);
    }
    .nova672[data-theme="moon"] .btn.primary,
    .nova672[data-theme="prism"] .btn.primary {
      color: #09121c;
    }

    .nova672 .stage {
      position: relative; z-index: 1;
      height: clamp(460px, 62vmin, 860px);
      border-radius: 24px;
      border: 1px solid var(--border);
      background:
        radial-gradient(100% 120% at 50% 0%, rgba(255,255,255,.10), rgba(255,255,255,.02));
      box-shadow: 0 50px 140px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.12);
      overflow: hidden;
      transform: translateZ(0);
    }
    .nova672 canvas#field {
      position: absolute; inset: 0; width: 100%; height: 100%;
      filter: saturate(var(--sat, 135%)) contrast(110%) brightness(105%) blur(var(--blur, 2px));
    }
    .nova672 .grain {
      pointer-events: none; position: absolute; inset: -2rem; opacity: .12; mix-blend-mode: soft-light; filter: contrast(130%) saturate(120%);
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>');
      background-size: 280px 280px;
      animation: nova672-grain 22s linear infinite;
    }
    @keyframes nova672-grain { from{transform:translate3d(0,0,0)} to{transform:translate3d(-280px,-280px,0)} }

    .nova672 .panel {
      position: absolute; inset: auto 12px 12px 12px;
      display: grid; gap: 10px;
      background: var(--glass); border: 1px solid var(--border);
      border-radius: 16px; padding: 10px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.25), 0 18px 48px rgba(0,0,0,.4);
      backdrop-filter: blur(12px) saturate(160%);
    }
    .nova672 .row { display: flex; flex-wrap: wrap; align-items: center; gap: 10px; }
    .nova672 .chip {
      padding: 8px 12px; border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid var(--border);
      color: rgb(var(--fg));
      font-weight: 800; letter-spacing: .035em; font-size: 12px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.24);
    }
    .nova672[data-theme="sol"] .chip {
      background: rgba(255,255,255,.7);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9);
      color: #111827;
    }
    .nova672 label.range {
      display: inline-flex; align-items: center; gap: 10px;
      padding: 8px 10px; border-radius: 12px; border: 1px solid var(--border);
      background: rgba(255,255,255,.08);
      color: rgb(var(--fg)); font-weight: 800; letter-spacing: .02em; font-size: 12px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.24);
    }
    .nova672[data-theme="sol"] label.range {
      background: rgba(255,255,255,.75);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.9);
      color: #111827;
    }
    .nova672 input[type="range"] { appearance: none; width: 160px; height: 28px; background: transparent; }
    .nova672 input[type="range"]::-webkit-slider-runnable-track { height: 6px; border-radius: 999px; background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3), var(--a4), var(--a5)); }
    .nova672 input[type="range"]::-webkit-slider-thumb {
      appearance: none; width: 18px; height: 18px; border-radius: 50%; margin-top: -6px;
      background: #fff; border: 1px solid rgba(0,0,0,.14); box-shadow: 0 10px 24px rgba(0,0,0,.35);
    }
    .nova672 input[type="range"]::-moz-range-track { height: 6px; border-radius: 999px; background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3), var(--a4), var(--a5)); }
    .nova672 input[type="range"]::-moz-range-thumb {
      width: 18px; height: 18px; border-radius: 50%; border: 1px solid rgba(0,0,0,.14);
      background: #fff; box-shadow: 0 10px 24px rgba(0,0,0,.35);
    }

    .nova672 .footer {
      margin-top: 14px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px;
      color: rgba(var(--muted), .95); font-size: 12px;
    }

    @media (prefers-reduced-motion: reduce) {
      .nova672, .nova672 * { animation: none !important; transition: none !important; }
      .nova672 { --tiltX: 0; --tiltY: 0; }
    }
    @media (max-width: 840px) {
      .nova672 .stage { height: clamp(380px, 70vmin, 760px); }
      .nova672 .hud { justify-content: flex-start; }
      .nova672 label.range { width: 100%; justify-content: space-between; }
    }
  </style>

  <div class="mast">
    <div class="brand">
      <span class="sig"><span class="dot" aria-hidden="true"></span>NOVA • 672</span>
      <h1 aria-live="polite">AETHER LOOM</h1>
      <p class="tag">An orrery of light that listens to your cursor.</p>
    </div>
    <div class="hud" role="toolbar" aria-label="Controls">
      <button class="btn primary" data-action="motion" aria-pressed="true" title="Toggle motion">Pause</button>
      <button class="btn" data-action="theme" title="Cycle theme">Theme</button>
      <button class="btn" data-action="snap" title="Export image">Export</button>
    </div>
  </div>

  <div class="stage" aria-label="Orbit field canvas">
    <canvas id="field" aria-hidden="true"></canvas>
    <div class="grain" aria-hidden="true"></div>

    <div class="panel" role="group" aria-label="Live status and tuning">
      <div class="row">
        <span class="chip" data-chip="theme">Theme: moon</span>
        <span class="chip">Flow: live</span>
        <span class="chip"><span id="last-updated">Last updated: 2025-11-16 05:17:30 EST</span></span>
      </div>
      <div class="row">
        <label class="range" for="density">Density
          <input id="density" type="range" min="48" max="200" step="1" value="120" aria-label="Node count">
        </label>
        <label class="range" for="trail">Trail
          <input id="trail" type="range" min="2" max="20" step="1" value="8" aria-label="Trail intensity">
        </label>
        <label class="range" for="speed">Tempo
          <input id="speed" type="range" min="0.2" max="2.5" step="0.05" value="1.0" aria-label="Motion tempo">
        </label>
      </div>
    </div>
  </div>

  <div class="footer">
    <span>Tip: Drag to warp the orbits • T theme • Space pause • S export</span>
    <span>Hold click for light rings</span>
  </div>

  <script>
    (function(){
      const root = document.currentScript.closest('.nova672');
      const stage = root.querySelector('.stage');
      const canvas = root.querySelector('#field');
      const ctx = canvas.getContext('2d', { alpha: false });

      const btnMotion = root.querySelector('[data-action="motion"]');
      const btnTheme  = root.querySelector('[data-action="theme"]');
      const btnSnap   = root.querySelector('[data-action="snap"]');
      const chipTheme = root.querySelector('[data-chip="theme"]');
      const h1 = root.querySelector('h1');

      // Inputs
      const rDensity = root.querySelector('#density');
      const rTrail   = root.querySelector('#trail');
      const rSpeed   = root.querySelector('#speed');

      // Last updated
      const lu = root.querySelector('#last-updated');
      const now = new Date();
      try { lu.textContent = 'Updated ' + now.toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'short' }); }
      catch { lu.textContent = 'Updated ' + now.toString(); }

      // DPI + size
      let dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      function fit(){
        const rect = stage.getBoundingClientRect();
        const w = Math.max(1, Math.floor(rect.width));
        const h = Math.max(1, Math.floor(rect.height));
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        canvas.style.width = w + 'px';
        canvas.style.height = h + 'px';
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }
      new ResizeObserver(fit).observe(stage);
      fit();

      // Themes
      const THEMES = {
        moon:  ['#60a5fa','#22d3ee','#a78bfa','#34d399','#f472b6','#e879f9'],
        sol:   ['#f59e0b','#fb7185','#f97316','#84cc16','#06b6d4','#f43f5e'],
        prism: ['#e879f9','#22d3ee','#fde047','#34d399','#60a5fa','#fb7185']
      };
      const order = ['moon','sol','prism'];
      let theme = root.dataset.theme || 'moon';
      let palette = THEMES[theme].slice();

      function applyTheme(name){
        theme = name;
        palette = THEMES[name].slice();
        root.dataset.theme = name;
        chipTheme.textContent = 'Theme: ' + name;
        h1.animate([{letterSpacing:'-0.035em'},{letterSpacing:'-0.01em'},{letterSpacing:'-0.035em'}], {duration:420, easing:'cubic-bezier(.2,.8,.2,1)'});
        root.style.setProperty('--sat', theme === 'sol' ? '120%' : theme === 'prism' ? '150%' : '135%');
      }
      btnTheme.addEventListener('click', () => {
        const idx = (order.indexOf(theme)+1) % order.length;
        applyTheme(order[idx]);
        recolor();
      });

      // Motion control
      function setMotion(on){
        root.dataset.motion = on ? 'on' : 'off';
        btnMotion.setAttribute('aria-pressed', String(on));
        btnMotion.textContent = on ? 'Pause' : 'Resume';
      }
      btnMotion.addEventListener('click', () => setMotion(root.dataset.motion !== 'on'));
      if (matchMedia && matchMedia('(prefers-reduced-motion: reduce)').matches) setMotion(false);

      // Controls
      let COUNT = parseInt(rDensity.value, 10);
      let tempo = parseFloat(rSpeed.value);
      let trail = parseInt(rTrail.value, 10);
      rDensity.addEventListener('input', () => { COUNT = parseInt(rDensity.value,10); seed(true); });
      rSpeed.addEventListener('input', () => { tempo = parseFloat(rSpeed.value); });
      rTrail.addEventListener('input', () => { trail = parseInt(rTrail.value,10); });

      // Parallax tilt
      function onPointer(e){
        const r = root.getBoundingClientRect();
        const x = ((e.clientX - r.left)/r.width - .5) * 2;
        const y = ((e.clientY - r.top)/r.height - .5) * 2;
        root.style.setProperty('--tiltX', (x*3).toFixed(2));
        root.style.setProperty('--tiltY', (y*2).toFixed(2));
      }
      root.addEventListener('mousemove', onPointer, { passive:true });
      root.addEventListener('mouseleave', () => { root.style.removeProperty('--tiltX'); root.style.removeProperty('--tiltY'); });

      // Model
      const TWO = Math.PI*2;
      let t = 0;
      let last = performance.now();
      const state = { cx: 0, cy: 0, baseR: 0, spin: 0 };
      let nodes = [];
      let pulses = [];

      function rand(a,b){ return a + Math.random()*(b-a); }
      function choice(arr){ return arr[(Math.random()*arr.length)|0]; }

      function seed(recount=false){
        const w = stage.clientWidth, h = stage.clientHeight;
        state.cx = w/2; state.cy = h/2;
        state.baseR = Math.min(w,h) * 0.32;
        if (recount) {
          nodes = [];
          for (let i=0;i<COUNT;i++){
            nodes.push({
              idx:i,
              hue: choice(palette),
              off: Math.random()*1000,
              amp: rand(8, 52),
              weight: rand(0.5, 1.8),
              skip: 3 + ((i%7)|0),
            });
          }
        } else if (nodes.length === 0) {
          for (let i=0;i<COUNT;i++){
            nodes.push({
              idx:i,
              hue: choice(palette),
              off: Math.random()*1000,
              amp: rand(8, 52),
              weight: rand(0.5, 1.8),
              skip: 3 + ((i%7)|0),
            });
          }
        }
      }
      function recolor(){
        for (let i=0;i<nodes.length;i++){
          nodes[i].hue = choice(palette);
        }
      }
      seed(true);

      let pointer = { x: state.cx, y: state.cy, down:false };
      let target  = { x: pointer.x, y: pointer.y };

      // Pointer interactions
      stage.addEventListener('pointerdown', (e) => {
        const r = stage.getBoundingClientRect();
        target.x = e.clientX - r.left;
        target.y = e.clientY - r.top;
        pointer.down = true;
        pulses.push({ x: target.x, y: target.y, r: 10, grow: rand(100,220), life: 1, color: choice(palette) });
        if (pulses.length>12) pulses.splice(0, pulses.length-12);
        stage.setPointerCapture && stage.setPointerCapture(e.pointerId);
      });
      stage.addEventListener('pointermove', (e) => {
        const r = stage.getBoundingClientRect();
        target.x = e.clientX - r.left;
        target.y = e.clientY - r.top;
        if (pointer.down) {
          pulses.push({ x: target.x, y: target.y, r: 8, grow: rand(120,240), life: 1, color: choice(palette) });
          if (pulses.length>14) pulses.splice(0, pulses.length-14);
        }
      });
      addEventListener('pointerup', () => { pointer.down = false; });

      // Export
      btnSnap.addEventListener('click', () => {
        try {
          const a = document.createElement('a');
          a.href = canvas.toDataURL('image/png');
          a.download = 'nova-672.png';
          a.click();
        } catch(e){}
      });

      // Position helper
      function nodePos(i, time){
        const a = (i/Math.max(1, COUNT)) * TWO + state.spin;
        const wob = Math.sin(a*3 + time*0.0012 + nodes[i].off*0.002) * nodes[i].amp;
        const push = 1 - Math.min(1, Math.hypot(pointer.x - state.cx, pointer.y - state.cy) / (Math.min(stage.clientWidth, stage.clientHeight)*0.5));
        const rr = state.baseR + wob + push*28;
        return {
          x: state.cx + rr * Math.cos(a),
          y: state.cy + rr * Math.sin(a)
        };
      }

      function drawChord(i, j, time){
        const pi = nodePos(i, time);
        const pj = nodePos(j, time);
        const mx = (pi.x+pj.x)/2, my = (pi.y+pj.y)/2;
        const dx = pj.x - pi.x, dy = pj.y - pi.y;
        const dist = Math.hypot(dx,dy);
        const bend = Math.min(60, 2600/(dist+1));
        const nx = -dy/dist, ny = dx/dist;
        const cx = mx + nx * bend * Math.sin(time*0.0007 + i*0.2);
        const cy = my + ny * bend * Math.cos(time*0.0009 + j*0.2);

        ctx.lineWidth = nodes[i].weight * (1.0 + 6/dist);
        const c = nodes[i].hue;
        ctx.strokeStyle = c + 'cc';
        ctx.beginPath();
        ctx.moveTo(pi.x, pi.y);
        ctx.quadraticCurveTo(cx, cy, pj.x, pj.y);
        ctx.stroke();
      }

      function drawPulse(p){
        const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r);
        grad.addColorStop(0, p.color + 'cc');
        grad.addColorStop(.5, p.color + '33');
        grad.addColorStop(1, '#00000000');
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, TWO);
        ctx.fill();
      }

      // Animation
      function tick(ts){
        const dt = Math.max(0.016, Math.min(0.06, (ts - last)/1000));
        last = ts;
        t += dt * 1000 * tempo;

        // Fit if resized
        const w = stage.clientWidth, h = stage.clientHeight;
        if (canvas.width !== Math.floor(w*dpr) || canvas.height !== Math.floor(h*dpr)) fit();

        // ease pointer
        pointer.x += (target.x - pointer.x) * 0.1;
        pointer.y += (target.y - pointer.y) * 0.1;

        // backdrop trails
        ctx.globalCompositeOperation = 'source-over';
        const fade = Math.max(0.02, Math.min(0.4, trail/100));
        const bg = theme === 'sol' ? `rgba(255,255,255,${fade*1.2})` : `rgba(0,0,0,${fade*1.6})`;
        ctx.fillStyle = bg;
        ctx.fillRect(0,0,w,h);

        // orbits
        state.spin += dt * 0.12 * tempo;
        ctx.globalCompositeOperation = theme === 'sol' ? 'multiply' : 'screen';
        for (let i=0;i<COUNT;i++){
          const skip = nodes[i].skip;
          let j = (i + skip) % COUNT;
          drawChord(i, j, t);
          if (i % 5 === 0) {
            j = (i + skip*2) % COUNT;
            drawChord(i, j, t);
          }
        }

        // pulses
        ctx.globalCompositeOperation = 'screen';
        for (let k=pulses.length-1;k>=0;k--){
          const p = pulses[k];
          p.r += dt * p.grow * (0.6 + 0.4*Math.sin((t*0.001 + k)*0.8));
          p.life -= dt * 0.5;
          ctx.globalAlpha = Math.max(0, Math.min(1, p.life));
          drawPulse(p);
          if (p.life <= 0) pulses.splice(k,1);
        }
        ctx.globalAlpha = 1;

        // title shimmer
        h1.style.backgroundPosition = `${(ts * 0.04) % 240}% 0%`;

        if (root.dataset.motion === 'on') requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);

      // visibility
      document.addEventListener('visibilitychange', () => { if (document.hidden) setMotion(false); });

      // keyboard
      addEventListener('keydown', (e) => {
        const k = e.key.toLowerCase();
        if (k === 't') { e.preventDefault(); btnTheme.click(); }
        if (e.code === 'Space') { e.preventDefault(); btnMotion.click(); }
        if (k === 's') { e.preventDefault(); btnSnap.click(); }
        if (k === '+' || k === '=') { e.preventDefault(); rDensity.value = Math.min(200, parseInt(rDensity.value,10)+1); COUNT = parseInt(rDensity.value,10); seed(true); }
        if (k === '-' || k === '_') { e.preventDefault(); rDensity.value = Math.max(48, parseInt(rDensity.value,10)-1); COUNT = parseInt(rDensity.value,10); seed(true); }
      });

      // Init theme and gentle center
      applyTheme(theme);
      const rect = stage.getBoundingClientRect();
      target.x = rect.width * 0.55; target.y = rect.height * 0.48;
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


