<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="studio1617" role="region" aria-label="Orbit Studio">
  <style>
    /* Scope: #studio1617 */
    #studio1617 {
      --r: 24px;
      --bg0: #0b111a;
      --bg1: #0e1724;
      --ink: #eaf2ff;
      --muted: color-mix(in srgb, var(--ink) 72%, #0000);
      --stroke: color-mix(in srgb, #fff 10%, #0000);
      --a1: #5cf1ff;
      --a2: #7e8bff;
      --a3: #ff79c6;

      position: relative;
      border-radius: var(--r);
      color: var(--ink);
      background:
        radial-gradient(140% 120% at 20% -10%, #162233, transparent 62%),
        radial-gradient(120% 120% at 120% 120%, #0a0f17, var(--bg1) 40%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      box-shadow:
        0 0 0 1px color-mix(in srgb, var(--ink) 6%, transparent) inset,
        0 40px 120px rgba(7,12,22,0.5);
      overflow: clip;
      isolation: isolate;
      user-select: none;
      color-scheme: dark;
    }

    /* Themes */
    #studio1617.theme-aurora {
      --bg0: #061219;
      --bg1: #0c1e2b;
      --ink: #eaf6ff;
      --muted: color-mix(in srgb, var(--ink) 68%, #0000);
      --stroke: color-mix(in srgb, #fff 12%, #0000);
      --a1: #6df7d6;
      --a2: #6ab0ff;
      --a3: #c08cff;
    }
    #studio1617.theme-noir {
      --bg0: #0a0a0b;
      --bg1: #0e0f12;
      --ink: #f6f7fb;
      --muted: color-mix(in srgb, var(--ink) 64%, #0000);
      --stroke: color-mix(in srgb, #fff 12%, #0000);
      --a1: #74ff8c;
      --a2: #7bd1ff;
      --a3: #ff8aa6;
    }
    #studio1617.theme-sunset {
      --bg0: #1a0c08;
      --bg1: #1f1322;
      --ink: #fff9f3;
      --muted: color-mix(in srgb, var(--ink) 66%, #0000);
      --stroke: color-mix(in srgb, #000 18%, #fff 0%);
      --a1: #ffb06b;
      --a2: #ff7fa1;
      --a3: #8ddcff;
      color-scheme: dark;
    }

    /* Ambient layers */
    #studio1617 .halo {
      position: absolute; inset: -20% -6% -6% -6%;
      background:
        radial-gradient(360px 200px at 16% 14%, color-mix(in srgb, var(--a1) 28%, transparent), transparent 60%),
        radial-gradient(420px 260px at 86% 10%, color-mix(in srgb, var(--a2) 24%, transparent), transparent 65%),
        radial-gradient(540px 280px at 74% 86%, color-mix(in srgb, var(--a3) 18%, transparent), transparent 60%);
      filter: blur(14px) saturate(115%);
      opacity: 0.7;
      pointer-events: none;
      z-index: 0;
    }
    #studio1617 .noise {
      position: absolute; inset: 0; z-index: 0; pointer-events: none;
      background-image:
        radial-gradient(circle at 50% 50%, rgba(255,255,255,0.03), rgba(255,255,255,0) 60%),
        radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,0.06), transparent 60%),
        radial-gradient(1px 1px at 60% 70%, rgba(255,255,255,0.05), transparent 60%);
      mix-blend-mode: soft-light;
      animation: grain1617 18s linear infinite;
      opacity: 0.3;
    }
    @keyframes grain1617 { to { transform: translate3d(-5%, -3%, 0); } }

    /* Canvas */
    #studio1617 .canvas {
      position: absolute; inset: 0; z-index: 1;
      filter: drop-shadow(0 24px 70px rgba(0,0,0,0.5));
    }

    /* Frame */
    #studio1617 .sheet {
      position: relative; z-index: 2;
      max-width: 1080px; margin: clamp(12px,4.8vw,44px) auto;
      padding: clamp(14px,5.6vw,44px);
      border-radius: calc(var(--r) + 6px);
      border: 1px solid var(--stroke);
      background:
        linear-gradient(180deg,
          color-mix(in srgb, #ffffff 8%, transparent),
          color-mix(in srgb, #ffffff 2%, transparent));
      backdrop-filter: blur(12px) saturate(115%);
      box-shadow:
        0 10px 30px rgba(0,0,0,0.18),
        0 40px 120px rgba(0,0,0,0.24);
    }

    /* Header */
    #studio1617 .head {
      display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 12px;
    }
    #studio1617 .ed {
      display: inline-grid; grid-auto-flow: column; align-items: center; gap: 10px;
      padding: 9px 12px; border-radius: 999px; border: 1px solid var(--stroke);
      font: 900 12px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; letter-spacing: 0.4px;
      color: var(--muted);
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.02));
    }
    #studio1617 .spark {
      width: 9px; height: 9px; border-radius: 50%;
      background: conic-gradient(from 0deg, var(--a1), var(--a2), var(--a3), var(--a1));
      box-shadow: 0 0 10px color-mix(in srgb, var(--a2) 40%, var(--a3) 40%);
    }
    #studio1617 .themes { display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-end; }
    #studio1617 .chip {
      appearance: none; border: 1px solid var(--stroke); border-radius: 999px; padding: 10px 14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
      font: 900 12px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; letter-spacing: 0.4px;
      color: var(--ink); cursor: pointer;
      transition: transform 120ms ease, box-shadow 200ms ease, background 300ms ease, border-color 300ms ease;
      box-shadow: 0 8px 24px rgba(0,0,0,0.18);
    }
    #studio1617 .chip:hover { transform: translateY(-1px); border-color: color-mix(in srgb, var(--a1), var(--a3)); }
    #studio1617 .chip.active {
      background: linear-gradient(180deg, color-mix(in srgb, var(--a1) 24%, transparent), color-mix(in srgb, var(--a3) 18%, transparent));
      box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--a1) 40%, var(--a3) 40%), 0 10px 28px rgba(0,0,0,0.24);
    }

    /* Hero */
    #studio1617 .hero { margin-top: clamp(12px, 4vw, 24px); display: grid; gap: 12px; }
    #studio1617 h1 {
      margin: 0;
      font: 1000 clamp(36px, 8.4vw, 92px)/0.95 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      letter-spacing: -0.02em;
      background: linear-gradient(100deg, var(--a1), var(--a2) 55%, var(--a3) 98%);
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-wrap: balance;
    }
    #studio1617 .lead {
      margin: 0;
      color: var(--muted);
      font: 500 clamp(14px, 2.4vw, 18px)/1.7 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      text-wrap: pretty;
    }

    /* Infobar */
    #studio1617 .infobar { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; margin-top: 6px; }
    #studio1617 .pill {
      display: inline-flex; align-items: baseline; gap: 10px;
      padding: 12px 16px; border-radius: 14px; border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02));
      box-shadow: 0 10px 26px rgba(0,0,0,0.22);
      font: 800 12px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; color: var(--muted);
    }
    #studio1617 .time { color: var(--ink); font: 900 clamp(20px, 5vw, 40px)/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    #studio1617 .ampm { font: 800 11px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; letter-spacing: 0.16em; text-transform: uppercase; }

    /* Controls */
    #studio1617 .controls { margin-top: clamp(14px, 4vw, 24px); display: grid; grid-template-columns: 1fr auto auto auto; gap: 12px; align-items: center; }
    @media (max-width: 720px) { #studio1617 .controls { grid-template-columns: 1fr; } }
    #studio1617 .slider { display: grid; grid-template-columns: auto 1fr; gap: 12px; align-items: center; }
    #studio1617 .slider label { color: var(--muted); font: 900 12px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; letter-spacing: 0.35px; white-space: nowrap; }
    #studio1617 .bval { margin-left: 6px; color: var(--ink); }
    #studio1617 input[type="range"] { width: 100%; height: 30px; background: transparent; -webkit-appearance: none; }
    #studio1617 input[type="range"]::-webkit-slider-runnable-track,
    #studio1617 input[type="range"]::-moz-range-track {
      height: 8px; border-radius: 999px; border: 1px solid var(--stroke);
      background: linear-gradient(90deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
    }
    #studio1617 input[type="range"]::-webkit-slider-thumb,
    #studio1617 input[type="range"]::-moz-range-thumb {
      -webkit-appearance: none;
      width: 18px; height: 18px; border-radius: 50%;
      background: radial-gradient(circle at 35% 35%, #fff, color-mix(in srgb, var(--a1) 33%, var(--a3)));
      border: 1px solid rgba(255,255,255,0.6);
      margin-top: -5px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.35), 0 0 0 4px color-mix(in srgb, var(--a1) 16%, var(--a3) 16%, transparent);
      cursor: grab;
    }

    #studio1617 .btn, #studio1617 .toggle {
      appearance: none; border: 1px solid var(--stroke); border-radius: 14px; padding: 12px 16px;
      font: 900 12px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; letter-spacing: 0.5px; cursor: pointer; color: var(--ink);
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02));
      box-shadow: 0 10px 26px rgba(0,0,0,0.22);
      transition: transform 120ms ease, box-shadow 200ms ease, background 300ms ease, border-color 300ms ease;
      position: relative; overflow: hidden;
    }
    #studio1617 .btn:hover, #studio1617 .toggle:hover { transform: translateY(-1px); border-color: color-mix(in srgb, var(--a1), var(--a3)); }
    #studio1617 .rip { position: absolute; inset: 0; pointer-events: none; background: radial-gradient(140px 140px at var(--rx) var(--ry), rgba(255,255,255,0.25), transparent 60%); opacity: 0; animation: rip1617 600ms ease; }
    @keyframes rip1617 { 0%{opacity:0} 18%{opacity:1} 100%{opacity:0} }

    /* Footer */
    #studio1617 footer {
      margin-top: 16px; display: flex; align-items: center; justify-content: space-between; gap: 12px;
      color: var(--muted); font: 500 12px/1.4 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    #studio1617 #last-updated { white-space: nowrap; opacity: 0.9; }

    /* Pause indicator */
    #studio1617[data-paused="true"] .sheet { box-shadow: 0 10px 30px rgba(0,0,0,0.18), 0 40px 120px rgba(0,0,0,0.18), inset 0 0 0 1px color-mix(in srgb, var(--a2) 10%, transparent); }
    #studio1617[data-paused="true"] .title-mark::after {
      content: 'paused'; display: inline-block; margin-left: 10px;
      padding: 4px 8px; border-radius: 999px; border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02));
      font: 900 10px/1 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted);
    }
  </style>

  <!-- Ambient -->
  <div class="halo" aria-hidden="true"></div>
  <div class="noise" aria-hidden="true"></div>
  <canvas id="sky1617" class="canvas" aria-hidden="true"></canvas>

  <!-- Frame -->
  <section class="sheet" aria-label="Orbital canvas">
    <div class="head">
      <span class="ed" aria-hidden="true"><span class="spark"></span> Edition 1617 • Orbit Studio</span>
      <div class="themes" role="group" aria-label="Theme">
        <button type="button" class="chip active" data-theme="aurora" aria-pressed="true">Aurora</button>
        <button type="button" class="chip" data-theme="noir" aria-pressed="false">Noir</button>
        <button type="button" class="chip" data-theme="sunset" aria-pressed="false">Sunset</button>
      </div>
    </div>

    <div class="hero">
      <div class="title">
        <h1 class="title-mark">Orbital Poem</h1>
        <p class="lead">Touch the sky to pull the moons. Trails tell time; gravity writes the verse.</p>
      </div>
      <div class="infobar" aria-live="polite">
        <div class="pill"><span>Local Time</span><span class="time">--:--:--</span><span class="ampm">—</span></div>
        <div class="pill"><span>Moons</span><strong class="count">—</strong></div>
        <div class="pill"><span>Tip</span> space toggles motion</div>
      </div>
    </div>

    <div class="controls" aria-label="Controls">
      <div class="slider">
        <label for="count1617">Count <span class="bval n1">64</span></label>
        <input id="count1617" type="range" min="12" max="220" step="1" value="64" aria-label="Count">
      </div>
      <div class="slider">
        <label for="grav1617">Gravity <span class="bval n2">1.00</span></label>
        <input id="grav1617" type="range" min="0.2" max="2.0" step="0.01" value="1.00" aria-label="Gravity">
      </div>
      <button type="button" class="toggle" id="trail1617" aria-pressed="true">Trails On</button>
      <button type="button" class="btn" id="pause1617" aria-pressed="false" aria-label="Toggle motion">Pause</button>
    </div>

    <footer>
      <small>“Design is the silent rhythm.”</small>
      <span id="last-updated">Last updated: 2025-12-30 01:30:46 EST</span>
    </footer>
  </section>

  <script>
    (function(){
      const root = document.getElementById('studio1617');
      const canvas = root.querySelector('#sky1617');
      const ctx = canvas.getContext('2d', { alpha: true });
      const chips = Array.from(root.querySelectorAll('.chip'));
      const countR = root.querySelector('#count1617');
      const gravR  = root.querySelector('#grav1617');
      const n1 = root.querySelector('.bval.n1');
      const n2 = root.querySelector('.bval.n2');
      const trailsBtn = root.querySelector('#trail1617');
      const pauseBtn = root.querySelector('#pause1617');
      const countEl = root.querySelector('.count');
      const timeEl = root.querySelector('.time');
      const ampmEl = root.querySelector('.ampm');
      const updated = root.querySelector('#last-updated');

      // Theme
      function setTheme(name) {
        root.classList.remove('theme-aurora','theme-noir','theme-sunset');
        if (name === 'noir') root.classList.add('theme-noir');
        else if (name === 'sunset') root.classList.add('theme-sunset');
        else root.classList.add('theme-aurora');
        chips.forEach(c => {
          const on = c.dataset.theme === name;
          c.classList.toggle('active', on);
          c.setAttribute('aria-pressed', String(on));
        });
        pullPalette();
      }
      const hour = new Date().getHours();
      const auto = hour < 8 ? 'aurora' : (hour < 18 ? 'sunset' : 'noir');
      setTheme(auto);
      chips.forEach(c => c.addEventListener('click', () => setTheme(c.dataset.theme)));

      // Ripple
      function rippleAt(btn, e) {
        const r = btn.getBoundingClientRect();
        btn.style.setProperty('--rx', ((e?.clientX ?? r.left + r.width/2) - r.left) + 'px');
        btn.style.setProperty('--ry', ((e?.clientY ?? r.top + r.height/2) - r.top) + 'px');
        const el = document.createElement('span');
        el.className = 'rip';
        el.addEventListener('animationend', () => el.remove());
        btn.appendChild(el);
      }

      // Size
      let dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      function fit() {
        const rect = root.getBoundingClientRect();
        canvas.width = Math.floor(rect.width * dpr);
        canvas.height = Math.floor(rect.height * dpr);
        canvas.style.width = rect.width + 'px';
        canvas.style.height = rect.height + 'px';
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      }
      const ro = new ResizeObserver(fit); ro.observe(root);

      // Palette
      let A1='#6df7d6', A2='#6ab0ff', A3='#c08cff';
      function pullPalette(){
        const cs = getComputedStyle(root);
        A1 = cs.getPropertyValue('--a1').trim() || A1;
        A2 = cs.getPropertyValue('--a2').trim() || A2;
        A3 = cs.getPropertyValue('--a3').trim() || A3;
      }
      pullPalette();

      // System
      const RNG = (seed => () => (seed = (seed * 1664525 + 1013904223) >>> 0) / 4294967296)(Date.now() ^ 0x9e3779b9);
      let moons = [];
      let trails = true;
      let paused = false;
      let gravity = parseFloat(gravR.value);
      let target = null;

      function huePick(i){
        return [A1,A2,A3][i % 3];
      }

      function spawn(n){
        moons.length = 0;
        const W = canvas.clientWidth, H = canvas.clientHeight;
        const base = Math.min(W,H) * 0.42;
        for(let i=0;i<n;i++){
          const r = base * (0.15 + i/n * 0.9) * (0.85 + RNG()*0.25);
          const ang = RNG() * Math.PI*2;
          const speed = (0.0008 + RNG()*0.0018) * (0.6 + (i/n)) * gravity * (i%2?1:-1);
          moons.push({
            r, ang, speed,
            ecc: 0.04 + RNG()*0.14,
            tilt: RNG()*Math.PI,
            hue: huePick(i),
            size: 1.8 + RNG()*2.4,
          });
        }
        countEl.textContent = String(moons.length);
      }

      function updateParams(){
        n1.textContent = countR.value;
        n2.textContent = parseFloat(gravR.value).toFixed(2);
      }
      countR.addEventListener('input', () => { updateParams(); spawn(+countR.value); });
      gravR.addEventListener('input', () => { gravity = parseFloat(gravR.value); updateParams(); moons.forEach(m => m.speed *= (gravity/Math.max(0.0001, gravity))); });

      // Draw
      function draw(){
        const W = canvas.clientWidth, H = canvas.clientHeight;
        const CX = W/2, CY = H/2;

        if (!trails) {
          ctx.clearRect(0,0,W,H);
        } else {
          // faint fade for trails
          ctx.fillStyle = 'rgba(0,0,0,0.08)';
          ctx.fillRect(0,0,W,H);
        }

        // star
        const g = ctx.createRadialGradient(CX, CY, 0, CX, CY, Math.min(W,H)/2);
        g.addColorStop(0, 'rgba(255,255,255,0.25)');
        g.addColorStop(1, 'rgba(255,255,255,0.0)');
        ctx.fillStyle = g;
        ctx.beginPath(); ctx.arc(CX, CY, Math.min(W,H)/5.2, 0, Math.PI*2); ctx.fill();

        ctx.globalCompositeOperation = 'lighter';

        for (let i=0;i<moons.length;i++){
          const m = moons[i];

          // advance
          m.ang += m.speed;

          // ellipse params
          const ex = Math.cos(m.tilt) * m.ecc * m.r;
          const ey = Math.sin(m.tilt) * m.ecc * m.r;

          // pointer pull
          let pullx = 0, pully = 0;
          if (target){
            const dx = target.x - CX;
            const dy = target.y - CY;
            pullx = dx * 0.06 * gravity;
            pully = dy * 0.06 * gravity;
          }

          const x = CX + Math.cos(m.ang) * (m.r + pullx*0.02) + ex;
          const y = CY + Math.sin(m.ang) * (m.r + pully*0.02) + ey;

          // orbit ring (subtle)
          if (i % Math.round(Math.max(1, moons.length/12)) === 0) {
            ctx.strokeStyle = 'rgba(255,255,255,0.06)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.ellipse(CX, CY, m.r + Math.abs(ex), m.r + Math.abs(ey), m.tilt, 0, Math.PI*2);
            ctx.stroke();
          }

          // glow trail
          const grad = ctx.createRadialGradient(x, y, 0.2, x, y, m.size*4);
          grad.addColorStop(0, m.hue);
          grad.addColorStop(1, 'rgba(0,0,0,0)');
          ctx.fillStyle = grad;
          ctx.beginPath(); ctx.arc(x, y, m.size, 0, Math.PI*2); ctx.fill();
        }

        ctx.globalCompositeOperation = 'source-over';
      }

      // Loop
      let raf = 0;
      function loop(){
        if (paused) return;
        draw();
        raf = requestAnimationFrame(loop);
      }
      function play(){
        if (!paused) return;
        paused = false;
        root.removeAttribute('data-paused');
        pauseBtn.textContent = 'Pause';
        pauseBtn.setAttribute('aria-pressed','false');
        cancelAnimationFrame(raf);
        raf = requestAnimationFrame(loop);
      }
      function pause(){
        paused = true;
        root.setAttribute('data-paused','true');
        pauseBtn.textContent = 'Play';
        pauseBtn.setAttribute('aria-pressed','true');
        cancelAnimationFrame(raf);
      }

      // Interactions
      function setTarget(e){
        const r = canvas.getBoundingClientRect();
        const x = (e.touches?.[0]?.clientX ?? e.clientX) - r.left;
        const y = (e.touches?.[0]?.clientY ?? e.clientY) - r.top;
        target = { x, y };
      }
      function clearTarget(){ target = null; }

      root.addEventListener('pointermove', setTarget, { passive: true });
      root.addEventListener('touchmove', setTarget, { passive: true });
      root.addEventListener('pointerleave', clearTarget, { passive: true });

      // Buttons
      trailsBtn.addEventListener('click', (e) => {
        rippleAt(trailsBtn, e);
        trails = !trails;
        trailsBtn.textContent = trails ? 'Trails On' : 'Trails Off';
        trailsBtn.setAttribute('aria-pressed', String(trails));
      });
      pauseBtn.addEventListener('click', (e) => {
        rippleAt(pauseBtn, e);
        paused ? play() : pause();
      });

      // Keyboard
      root.tabIndex = 0;
      root.addEventListener('keydown', (e) => {
        if (e.code === 'Space') { e.preventDefault(); paused ? play() : pause(); }
      });

      // Time + updated
      function fmt(t){
        try {
          return new Intl.DateTimeFormat(undefined, { hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false }).format(t);
        } catch(e){ return t.toLocaleTimeString(); }
      }
      function tickClock(){
        const now = new Date();
        timeEl.textContent = fmt(now);
        ampmEl.textContent = now.getHours() < 12 ? 'AM' : 'PM';
      }
      setInterval(tickClock, 250); tickClock();

      function stamp(d){
        try {
          return new Intl.DateTimeFormat(undefined, {
            weekday: 'short', month: 'short', day: '2-digit', year: 'numeric',
            hour: '2-digit', minute: '2-digit', second: '2-digit',
            hour12: false, timeZoneName: 'short'
          }).format(d);
        } catch(e){ return d.toLocaleString(); }
      }
      updated.textContent = 'Last updated: ' + stamp(new Date()));

      // Reduced motion
      const mq = window.matchMedia?.('(prefers-reduced-motion: reduce)');
      function handleRM(){
        const reduce = !!(mq && mq.matches);
        trails = !reduce;
        trailsBtn.textContent = trails ? 'Trails On' : 'Trails Off';
        trailsBtn.setAttribute('aria-pressed', String(trails));
        if (reduce) pause(); else play();
      }
      if (mq) mq.addEventListener('change', handleRM);

      // Init
      fit();
      updateParams();
      spawn(+countR.value);
      handleRM();
      if (!mq || !mq.matches) play();

      // Resize sync
      window.addEventListener('resize', () => { dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1)); fit(); spawn(moons.length); });

    })();
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


