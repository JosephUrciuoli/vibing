<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="vibe206" data-theme="dark" aria-label="Orbital Garden">
  <style>
    .vibe206 {
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Inter, Roboto, "Helvetica Neue", Arial, sans-serif;
      --bg-0: #070a10;
      --bg-1: #0e1523;
      --ink: #e8f0ff;
      --muted: #a0b1c9;
      --line: rgba(255,255,255,0.12);
      --c1: #7fb7ff;
      --c2: #8ef4d4;
      --c3: #ffb28a;
      --glow: 0 30px 120px rgba(140,200,255,0.18);
      position: relative;
      display: grid;
      place-items: center;
      min-height: 560px;
      padding: clamp(16px, 3vw, 28px);
      border-radius: 28px;
      border: 1px solid var(--line);
      color: var(--ink);
      font-family: var(--font);
      overflow: hidden;
      background:
        radial-gradient(60% 100% at 10% 0%, rgba(120,200,255,0.12), transparent 70%),
        radial-gradient(80% 120% at 90% 100%, rgba(142,244,212,0.10), transparent 70%),
        linear-gradient(180deg, var(--bg-0), var(--bg-1));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.08);
      isolation: isolate;
    }

    .vibe206::before {
      content: "";
      position: absolute;
      inset: -2px;
      pointer-events: none;
      background:
        conic-gradient(from 220deg at 80% 20%, rgba(255,255,255,0.06), transparent 30% 70%, rgba(255,255,255,0.05)),
        repeating-linear-gradient(90deg, rgba(255,255,255,0.04) 0 1px, transparent 1px 9px);
      mix-blend-mode: soft-light;
      z-index: 0;
    }

    .vibe206 .surface {
      position: relative;
      z-index: 2;
      width: min(1160px, 100%);
      border-radius: 22px;
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(14,21,35,0.78), rgba(10,16,27,0.64));
      backdrop-filter: blur(10px) saturate(1.15);
      box-shadow: var(--glow), inset 0 1px 0 rgba(255,255,255,0.10);
      overflow: clip;
    }

    .vibe206 .top {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 14px;
      padding: clamp(14px, 3vw, 22px);
      border-bottom: 1px solid var(--line);
    }

    .vibe206 .badge {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06));
      color: var(--muted);
      font-size: 12px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }
    .vibe206 .badge .dot {
      width: 10px; height: 10px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, var(--c1), transparent 70%);
      box-shadow: 0 0 14px rgba(127,183,255,0.6);
      flex: 0 0 auto;
    }

    .vibe206 .controls {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .vibe206 .btn {
      appearance: none;
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
      color: var(--ink);
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      transition: transform 120ms ease, box-shadow 120ms ease, background 120ms ease;
      box-shadow: 0 8px 22px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.10);
    }
    .vibe206 .btn:hover { transform: translateY(-1px); box-shadow: 0 12px 30px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.14); }
    .vibe206 .btn:active { transform: translateY(0); }

    .vibe206 .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 8px 10px;
      color: var(--muted);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.05));
    }

    .vibe206 .slider {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.05));
      color: var(--muted);
      font-size: 12px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }
    .vibe206 input[type="range"] {
      appearance: none;
      width: 160px;
      height: 10px;
      background: linear-gradient(90deg, var(--c1), var(--c2));
      border-radius: 999px;
      outline: none;
    }
    .vibe206 input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 18px; height: 18px; border-radius: 50%;
      background: #0b1220;
      border: 2px solid var(--c1);
      box-shadow: 0 0 0 4px rgba(127,183,255,0.20);
      cursor: grab;
    }
    .vibe206 input[type="range"]::-moz-range-thumb {
      width: 18px; height: 18px; border-radius: 50%;
      background: #0b1220;
      border: 2px solid var(--c1);
      box-shadow: 0 0 0 4px rgba(127,183,255,0.20);
      cursor: grab;
    }

    .vibe206 .wrap {
      display: grid;
      grid-template-columns: 1.15fr 1fr;
      gap: clamp(12px, 3vw, 28px);
      align-items: stretch;
      padding: clamp(16px, 3vw, 28px);
    }
    @media (max-width: 920px) {
      .vibe206 .wrap {
        grid-template-columns: 1fr;
      }
    }

    /* Scene */
    .vibe206 .scene {
      position: relative;
      border: 1px solid var(--line);
      border-radius: 18px;
      overflow: hidden;
      background: radial-gradient(120% 100% at 50% 100%, rgba(127,183,255,0.10), transparent 60%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.06);
      min-height: 340px;
    }
    .vibe206 .scene canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
      z-index: 0;
      filter: saturate(1.15) contrast(1.05);
    }
    .vibe206 .scene .overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(50% 50% at 30% 20%, rgba(255,255,255,0.06), transparent 60%),
        radial-gradient(40% 60% at 80% 80%, rgba(142,244,212,0.06), transparent 70%);
      mix-blend-mode: screen;
      z-index: 1;
    }
    .vibe206 .scene .ring {
      position: absolute;
      inset: 10%;
      border-radius: 50%;
      border: 1px dashed rgba(255,255,255,0.16);
      z-index: 1;
    }
    .vibe206 .scene .now {
      position: absolute;
      left: 14px; bottom: 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 12px;
      color: var(--muted);
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      z-index: 2;
    }
    .vibe206 .scene .pulse {
      width: 8px; height: 8px; border-radius: 50%;
      background: radial-gradient(circle at 40% 40%, var(--c2), transparent 70%);
      box-shadow: 0 0 12px rgba(142,244,212,0.6);
      animation: vibe206-pulse 2s ease-in-out infinite;
    }
    @keyframes vibe206-pulse {
      0%, 100% { transform: scale(1); opacity: 0.9; }
      50% { transform: scale(1.4); opacity: 0.5; }
    }

    /* Copy */
    .vibe206 .copy {
      display: grid;
      align-content: center;
      gap: 10px;
      min-height: 340px;
    }
    .vibe206 h1 {
      margin: 0;
      font-weight: 900;
      letter-spacing: -0.02em;
      font-size: clamp(28px, 4.6vw, 56px);
      line-height: 1.02;
      background: linear-gradient(90deg, var(--ink) 0%, var(--c1) 50%, var(--c3) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      filter: drop-shadow(0 10px 30px rgba(0,0,0,0.45));
    }
    .vibe206 h1 em {
      font-style: normal;
      background: linear-gradient(90deg, var(--c2), var(--c1));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .vibe206 .lede {
      margin: 0;
      color: var(--muted);
      font-size: clamp(14px, 1.6vw, 18px);
      text-wrap: pretty;
    }
    .vibe206 .points {
      display: grid;
      gap: 8px;
      margin-top: 6px;
    }
    .vibe206 .p {
      display: grid;
      grid-template-columns: 18px 1fr;
      gap: 10px;
      align-items: center;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px dashed var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      color: var(--muted);
      font-size: 14px;
    }
    .vibe206 .swatch {
      width: 10px; height: 10px; border-radius: 50%;
      background: radial-gradient(circle, var(--c1), transparent 70%);
      box-shadow: 0 0 10px rgba(127,183,255,0.4);
      margin-left: 4px;
    }

    .vibe206 .meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 16px;
      border-top: 1px solid var(--line);
      color: var(--muted);
      font-size: 12px;
    }
    .vibe206 .meta .right {
      display: inline-flex;
      align-items: center;
      gap: 12px;
    }

    /* Light theme */
    .vibe206[data-theme="light"] {
      --bg-0: #f6f8fe;
      --bg-1: #eef3fd;
      --ink: #0b1b2b;
      --muted: #4e647e;
      --line: rgba(12,45,95,0.14);
      --glow: 0 30px 120px rgba(63,118,255,0.16);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.9);
    }
    .vibe206[data-theme="light"] .surface {
      background: linear-gradient(180deg, rgba(255,255,255,0.84), rgba(255,255,255,0.64));
      box-shadow: var(--glow), inset 0 1px 0 rgba(255,255,255,0.75);
    }
    .vibe206[data-theme="light"] .scene { background: radial-gradient(120% 100% at 50% 100%, rgba(63,118,255,0.08), transparent 60%); }

    /* Motion-safe */
    @media (prefers-reduced-motion: reduce) {
      .vibe206 .btn { transition: none !important; }
      .vibe206 .scene canvas { filter: none !important; }
      .vibe206 .scene .pulse { animation: none !important; }
    }
  </style>

  <div class="surface" id="surface206">
    <div class="top">
      <div class="badge"><span class="dot" aria-hidden="true"></span> Edition 206 · Orbital Garden</div>
      <div class="controls" role="group" aria-label="Controls">
        <button class="btn" id="theme206" aria-pressed="true" title="Toggle theme">Night/Day</button>
        <button class="btn" id="motion206" aria-pressed="true" title="Pause animation">Pause</button>
        <button class="btn" id="palette206" title="Cycle palette">Palette</button>
        <label class="slider" for="energy206">
          <input type="range" id="energy206" min="0" max="100" value="58" aria-label="Energy">
          Energy
        </label>
      </div>
    </div>

    <div class="wrap">
      <div class="scene" id="scene206">
        <canvas id="field206" aria-hidden="true"></canvas>
        <div class="overlay" aria-hidden="true"></div>
        <div class="ring" aria-hidden="true"></div>
        <div class="now"><span class="pulse" aria-hidden="true"></span><span id="now206">—:—:—</span></div>
      </div>

      <div class="copy">
        <h1>Plant <em>motion</em>. Grow <em>light</em>.</h1>
        <p class="lede">A living poster where particles orbit in layered constellations. Pull them with your cursor, tune the energy, and drift between palettes.</p>
        <div class="points">
          <div class="p"><span class="swatch" aria-hidden="true"></span><span>Drag anywhere to warp orbits. Near edges, the garden leans.</span></div>
          <div class="p"><span class="swatch" aria-hidden="true" style="background: radial-gradient(circle, var(--c2), transparent 70%); box-shadow: 0 0 10px rgba(142,244,212,0.4);"></span><span>Tap Palette to stroll through dawn, dusk, and neon nights.</span></div>
          <div class="p"><span class="swatch" aria-hidden="true" style="background: radial-gradient(circle, var(--c3), transparent 70%); box-shadow: 0 0 10px rgba(255,178,138,0.4);"></span><span>Energy governs speed, weave, and glow density.</span></div>
        </div>
      </div>
    </div>

    <div class="meta">
      <div>Tip: Hold mouse down to magnetize the nearest ring.</div>
      <div class="right">
        <span class="chip">Orbit count: <strong id="count206">—</strong></span>
        <span id="last-updated">Last updated: 2025-10-26 00:19:26 EST</span>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const root = document.currentScript.closest('.vibe206');
      const surface = root.querySelector('#surface206');
      const canvas = root.querySelector('#field206');
      const ctx = canvas.getContext('2d');
      const btnTheme = root.querySelector('#theme206');
      const btnMotion = root.querySelector('#motion206');
      const btnPalette = root.querySelector('#palette206');
      const slider = root.querySelector('#energy206');
      const nowEl = root.querySelector('#now206');
      const countEl = root.querySelector('#count206');
      const last = root.querySelector('#last-updated');

      // Retina
      let dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      let W = 0, H = 0, CX = 0, CY = 0;

      // Motion
      const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
      let running = !prefersReduced;

      // Palette cycles
      const palettes = [
        ['#7fb7ff', '#8ef4d4', '#ffb28a'], // Aurora
        ['#ff7ab6', '#ffd26f', '#7afcff'], // Dusk Pop
        ['#b9ff66', '#66e0ff', '#ffd4a3'], // Fresh Meadow
        ['#b19cff', '#6ee7ff', '#ff9e7b'], // Neon Drift
      ];
      let paletteIndex = 0;
      function applyPalette(i) {
        const [c1,c2,c3] = palettes[i % palettes.length];
        root.style.setProperty('--c1', c1);
        root.style.setProperty('--c2', c2);
        root.style.setProperty('--c3', c3);
      }
      applyPalette(paletteIndex);

      // Orbits
      const rings = [];
      const config = {
        ringCount: 5,
        nodesPerRing: 36,
        crossLinks: 22,
        baseSpeed: 0.0006,
        energy: Number(slider.value)/100,
      };

      const pointer = { x: null, y: null, down: false, nx: 0, ny: 0 };

      function resize() {
        const rect = surface.getBoundingClientRect();
        W = Math.max(640, Math.floor(rect.width - 32));
        H = Math.max(340, Math.floor(rect.height - 140));
        CX = W / 2; CY = H / 2;
        canvas.width = Math.floor(W * dpr);
        canvas.height = Math.floor(H * dpr);
        canvas.style.width = W + 'px';
        canvas.style.height = H + 'px';
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        rebuild();
      }

      function rebuild() {
        rings.length = 0;
        const rMin = Math.min(W, H) * 0.18;
        const rMax = Math.min(W, H) * 0.46;
        for (let i = 0; i < config.ringCount; i++) {
          const t = i / (config.ringCount - 1 || 1);
          const radius = rMin + (rMax - rMin) * t;
          const nodes = [];
          const n = Math.max(14, Math.round(config.nodesPerRing * (0.7 + t * 0.6)));
          const dir = i % 2 === 0 ? 1 : -1;
          const speed = config.baseSpeed * (1 + t * 2.2) * dir;
          for (let j = 0; j < n; j++) {
            nodes.push({
              a: (Math.PI * 2) * (j / n) + Math.random() * 0.05,
              r: radius + Math.sin(j * 0.4 + i) * 6,
              speed: speed * (0.8 + Math.random() * 0.4),
              hue: j / n
            });
          }
          rings.push({ radius, nodes, dir });
        }
        countEl.textContent = rings.reduce((acc, r) => acc + r.nodes.length, 0);
      }

      function lerp(a,b,t){ return a + (b - a) * t; }
      function mix(a,b,t){ return a*(1-t)+b*t; }

      function strokeGradient(x0,y0,x1,y1,alpha=0.85) {
        const g = ctx.createLinearGradient(x0,y0,x1,y1);
        const c1 = getComputedStyle(root).getPropertyValue('--c1').trim();
        const c2 = getComputedStyle(root).getPropertyValue('--c2').trim();
        const c3 = getComputedStyle(root).getPropertyValue('--c3').trim();
        function hexA(hex,a){const h=hex.replace('#',''); const r=parseInt(h.slice(0,2),16); const g2=parseInt(h.slice(2,4),16); const b=parseInt(h.slice(4,6),16); return `rgba(${r},${g2},${b},${a})`; }
        g.addColorStop(0.0, hexA(c1, alpha*0.9));
        g.addColorStop(0.5, hexA(c2, alpha));
        g.addColorStop(1.0, hexA(c3, alpha*0.9));
        return g;
      }

      function draw() {
        ctx.clearRect(0,0,W,H);

        // Subtle star fog
        ctx.globalCompositeOperation = 'source-over';
        const fog = ctx.createRadialGradient(CX, CY, Math.min(W,H)*0.05, CX, CY, Math.max(W,H)*0.8);
        fog.addColorStop(0, 'rgba(255,255,255,0.015)');
        fog.addColorStop(1, 'rgba(0,0,0,0.0)');
        ctx.fillStyle = fog;
        ctx.fillRect(0,0,W,H);

        const energy = config.energy;
        const wobble = energy * 0.8;

        // Update + draw rings
        ctx.globalCompositeOperation = 'lighter';
        for (let i = 0; i < rings.length; i++) {
          const ring = rings[i];
          const nodes = ring.nodes;
          const n = nodes.length;
          for (let j = 0; j < n; j++) {
            const node = nodes[j];

            // Pointer influence (magnet)
            let attract = 0;
            if (pointer.x != null && pointer.y != null) {
              const px = pointer.x - CX;
              const py = pointer.y - CY;
              const pr = Math.hypot(px, py);
              const angleToP = Math.atan2(py, px);
              const dAngle = Math.atan2(Math.sin(angleToP - node.a), Math.cos(angleToP - node.a));
              const near = Math.exp(-(Math.abs(pr - node.r) ** 2) / (2 * Math.pow(90 + energy*180, 2)));
              attract = (pointer.down ? 0.06 : 0.02) * near * (dAngle > 0 ? 1 : -1);
            }

            node.a += (node.speed * (1 + energy * 3.5)) + attract;
            node.r += Math.sin(node.a * (1.6 + i*0.08)) * wobble * 0.6;

            nodes[j] = node;
          }

          // Draw connections on this ring
          for (let j = 0; j < n; j++) {
            const k = (j + 1) % n;
            const a = nodes[j], b = nodes[k];
            const ax = CX + Math.cos(a.a) * a.r;
            const ay = CY + Math.sin(a.a) * a.r;
            const bx = CX + Math.cos(b.a) * b.r;
            const by = CY + Math.sin(b.a) * b.r;

            ctx.beginPath();
            ctx.moveTo(ax, ay);
            // Bezier to curve inward a bit
            const mx = (ax + bx) / 2;
            const my = (ay + by) / 2;
            const nx = lerp(mx, CX, 0.08 + energy * 0.14);
            const ny = lerp(my, CY, 0.08 + energy * 0.14);
            ctx.quadraticCurveTo(nx, ny, bx, by);
            ctx.strokeStyle = strokeGradient(ax, ay, bx, by, 0.5 + energy*0.45);
            ctx.lineWidth = 1.2 + i * 0.12 + energy * 0.8;
            ctx.shadowColor = getComputedStyle(root).getPropertyValue('--c1').trim();
            ctx.shadowBlur = 6 + energy * 18;
            ctx.stroke();
          }
        }

        // Cross-ring links
        ctx.shadowBlur = 10 + energy*22;
        for (let c = 0; c < config.crossLinks; c++) {
          const i1 = (c * 2) % rings.length;
          const i2 = (c * 3 + 1) % rings.length;
          const r1 = rings[i1], r2 = rings[i2];
          const n1 = r1.nodes.length, n2 = r2.nodes.length;
          const a = r1.nodes[(c * 5) % n1];
          const b = r2.nodes[(c * 7 + 3) % n2];
          const ax = CX + Math.cos(a.a) * a.r;
          const ay = CY + Math.sin(a.a) * a.r;
          const bx = CX + Math.cos(b.a) * b.r;
          const by = CY + Math.sin(b.a) * b.r;

          ctx.beginPath();
          ctx.moveTo(ax, ay);
          // arcing through center
          const cx1 = lerp(ax, CX, 0.3);
          const cy1 = lerp(ay, CY, 0.3);
          const cx2 = lerp(bx, CX, 0.3);
          const cy2 = lerp(by, CY, 0.3);
          ctx.bezierCurveTo(cx1, cy1, cx2, cy2, bx, by);
          ctx.strokeStyle = strokeGradient(ax, ay, bx, by, 0.25 + energy*0.35);
          ctx.lineWidth = 0.8 + energy * 0.8;
          ctx.stroke();
        }
      }

      function loop() {
        draw();
        if (running) requestAnimationFrame(loop);
      }

      // Interactions
      let cardRect = null;
      function onPointerMove(e) {
        if (!cardRect) cardRect = surface.getBoundingClientRect();
        const x = (e.clientX ?? (e.touches && e.touches[0].clientX)) - cardRect.left - 16;
        const y = (e.clientY ?? (e.touches && e.touches[0].clientY)) - (root.querySelector('.top').getBoundingClientRect().height + 16);
        pointer.x = x; pointer.y = y;
        pointer.nx = (x / (W || 1)) - 0.5;
        pointer.ny = (y / (H || 1)) - 0.5;
        // Lean the poster
        surface.style.transform = `perspective(1000px) rotateX(${pointer.ny * -6}deg) rotateY(${pointer.nx * 6}deg)`;
      }
      function onPointerLeave() {
        surface.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg)';
        pointer.x = pointer.y = null;
      }
      surface.addEventListener('pointermove', onPointerMove, { passive: true });
      surface.addEventListener('pointerleave', onPointerLeave);
      surface.addEventListener('pointerdown', () => { pointer.down = true; });
      window.addEventListener('pointerup', () => { pointer.down = false; });

      // Controls
      btnTheme.addEventListener('click', () => {
        const isDark = root.getAttribute('data-theme') === 'dark';
        root.setAttribute('data-theme', isDark ? 'light' : 'dark');
        btnTheme.setAttribute('aria-pressed', String(isDark));
      });

      btnMotion.addEventListener('click', () => {
        running = !running;
        btnMotion.textContent = running ? 'Pause' : 'Play';
        btnMotion.setAttribute('aria-pressed', String(running));
        if (running) loop();
      });

      btnPalette.addEventListener('click', () => {
        paletteIndex = (paletteIndex + 1) % palettes.length;
        applyPalette(paletteIndex);
      });

      slider.addEventListener('input', () => {
        config.energy = Number(slider.value) / 100;
      });

      // Time + last updated
      function updateNow() {
        const now = new Date();
        try {
          nowEl.textContent = now.toLocaleTimeString([], { hour:'2-digit', minute:'2-digit', second:'2-digit' });
          last.textContent = 'Last updated: ' + now.toLocaleString([], { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit', second:'2-digit' });
        } catch (_) {
          nowEl.textContent = now.toTimeString().split(' ')[0];
          last.textContent = 'Last updated: ' + now.toString();
        }
      }

      // Init
      resize();
      updateNow();
      const timer = setInterval(updateNow, 1000);
      window.addEventListener('resize', () => { cardRect = null; resize(); });

      if (running) loop();

      // Safety: pause timers if page hidden once
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          clearInterval(timer);
        }
      }, { once: true });
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


