<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="v1351-orrery" data-theme="linen" data-paused="false" aria-label="The Quiet Orrery">
  <style>
    .v1351-orrery {
      --paper-0: #f6f4ef;
      --paper-1: #e9f3ff;
      --ink: #0b1220;
      --muted: rgba(11,18,32,0.66);
      --accent-1: #0ea5e9; /* azure */
      --accent-2: #f97316; /* amber */
      --accent-3: #a855f7; /* violet */
      --ring: rgba(11,18,32,0.08);
      --glass: rgba(255,255,255,0.7);
      --glass-brd: rgba(11,18,32,0.12);

      position: relative;
      border-radius: 36px;
      padding: clamp(22px, 4vw, 54px);
      color: var(--ink);
      background:
        radial-gradient(140% 160% at 100% 0%, var(--paper-1), var(--paper-0));
      box-shadow:
        0 40px 90px rgba(10,18,30,0.14),
        inset 0 0 0 1px rgba(10,18,30,0.06);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      overflow: hidden;
      isolation: isolate;
    }
    .v1351-orrery[data-theme="carbon"]{
      --paper-0: #0a0d14;
      --paper-1: #141a24;
      --ink: #f7f9ff;
      --muted: rgba(247,249,255,0.72);
      --accent-1: #7dd3fc; /* soft azure */
      --accent-2: #fda769; /* soft amber */
      --accent-3: #c3a1ff; /* soft violet */
      --ring: rgba(255,255,255,0.09);
      --glass: rgba(255,255,255,0.08);
      --glass-brd: rgba(255,255,255,0.16);
      background:
        radial-gradient(140% 160% at 0% 0%, var(--paper-1), var(--paper-0));
      box-shadow:
        0 40px 110px rgba(0,0,0,0.65),
        inset 0 0 0 1px rgba(255,255,255,0.06);
    }

    /* living edge halo + texture */
    .v1351-orrery::before{
      content:"";
      position:absolute; inset: -2px;
      border-radius: 36px;
      padding: 2px;
      background:
        conic-gradient(from 0turn,
          color-mix(in oklab, var(--accent-1), transparent 40%) 0%,
          color-mix(in oklab, var(--accent-2), transparent 40%) 25%,
          transparent 40% 60%,
          color-mix(in oklab, var(--accent-3), transparent 40%) 75%,
          color-mix(in oklab, var(--accent-1), transparent 40%) 100%);
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
              mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
              mask-composite: exclude;
      opacity: 0.9;
      animation: v1351-orbit 30s linear infinite;
      pointer-events:none;
      z-index: -1;
    }
    .v1351-orrery::after{
      content:"";
      position:absolute; inset:-10%;
      background:
        repeating-conic-gradient(from 0deg, rgba(0,0,0,0.02) 0 8deg, transparent 8deg 16deg);
      mix-blend-mode: soft-light;
      opacity: 0.35;
      transform: rotate(12deg) scale(1.1);
      pointer-events:none;
      z-index:-2;
    }
    @keyframes v1351-orbit { to { transform: rotate(360deg); } }

    /* mast */
    .v1351-orrery .mast{
      display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:14px;
    }
    .v1351-orrery .glyph{
      width: 52px; height: 52px; border-radius: 16px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0.6));
      display:grid; place-items:center; position:relative; overflow:hidden;
      box-shadow:
        inset 0 0 0 1px var(--glass-brd),
        0 16px 30px rgba(0,0,0,0.18);
    }
    .v1351-orrery[data-theme="carbon"] .glyph{
      background:
        linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
      box-shadow:
        inset 0 0 0 1px var(--glass-brd),
        0 16px 38px rgba(0,0,0,0.45);
    }
    .v1351-orrery .glyph::before, .v1351-orrery .glyph::after{
      content:""; position:absolute; border-radius:50%;
    }
    .v1351-orrery .glyph::before{
      width: 70%; height:70%;
      border: 2px solid color-mix(in oklab, var(--accent-1), var(--accent-3) 40%);
      box-shadow: 0 0 0 6px rgba(255,255,255,0.08);
      animation: v1351-orbit 12s linear infinite;
    }
    .v1351-orrery .glyph::after{
      width: 12px; height:12px; background: radial-gradient(circle at 30% 30%, var(--accent-2), var(--accent-3));
      transform: translate(12px, 12px);
      border: 1px solid var(--glass-brd);
      border-radius:50%;
      box-shadow: 0 8px 18px color-mix(in oklab, var(--accent-2), transparent 70%);
    }

    .v1351-orrery .brand h2{
      margin:0; font-weight:900; letter-spacing:-0.02em;
      font-size: clamp(16px, 2vw, 20px);
    }
    .v1351-orrery .brand .tag{ margin-top:2px; font-size:12px; letter-spacing:0.22em; text-transform:uppercase; color: var(--muted); }

    .v1351-orrery .chip{
      display:inline-flex; align-items:center; gap:10px;
      padding:8px 12px; border-radius:999px;
      background: var(--glass);
      border: 1px solid var(--glass-brd);
      color: var(--muted);
      backdrop-filter: blur(8px);
      white-space: nowrap;
    }
    .v1351-orrery .led{
      width: 9px; height:9px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, var(--accent-1), var(--accent-3));
      box-shadow: 0 0 0 2px rgba(255,255,255,0.18), 0 0 16px var(--accent-1);
    }
    .v1351-orrery[data-paused="true"] .led{ filter: grayscale(80%) brightness(0.85); box-shadow: 0 0 0 2px rgba(255,255,255,0.12); }

    /* hero */
    .v1351-orrery .hero{ margin-top: clamp(12px, 2.2vw, 24px); }
    .v1351-orrery h1{
      margin:0;
      font-size: clamp(40px, 7.5vw, 96px);
      line-height: 1.02; letter-spacing:-0.02em;
      background: linear-gradient(90deg, var(--ink), color-mix(in oklab, var(--accent-1), var(--ink) 55%), var(--ink));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-wrap: balance;
    }
    .v1351-orrery .lede{
      margin:10px 0 0 0; color: var(--muted);
      font-size: clamp(14px, 1.9vw, 18px); max-width: 78ch;
    }

    /* stage */
    .v1351-orrery .stage{
      position: relative; margin-top: clamp(18px, 2.8vw, 34px);
      border-radius: 26px; overflow: hidden; aspect-ratio: 21 / 9; min-height: 260px;
      background:
        radial-gradient(60% 80% at 50% 50%, rgba(255,255,255,0.5), transparent 60%),
        radial-gradient(100% 100% at 50% 120%, var(--ring), transparent 70%);
      box-shadow:
        inset 0 0 0 1px var(--glass-brd),
        0 26px 70px rgba(0,0,0,0.22);
    }
    .v1351-orrery[data-theme="carbon"] .stage{
      background:
        radial-gradient(50% 60% at 50% 50%, rgba(255,255,255,0.08), transparent 60%),
        radial-gradient(100% 100% at 50% 120%, rgba(0,0,0,0.35), transparent 70%);
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.06),
        0 26px 90px rgba(0,0,0,0.55);
    }
    .v1351-orrery canvas{ position:absolute; inset:0; width:100%; height:100%; display:block; filter: saturate(112%) contrast(106%); }

    /* overlay grid rings */
    .v1351-orrery .rings{
      position:absolute; inset:0; pointer-events:none; opacity:0.5; mix-blend-mode:overlay;
      background:
        radial-gradient(circle at 50% 50%, transparent 18%, var(--ring) 18.25%, transparent 18.7%),
        radial-gradient(circle at 50% 50%, transparent 32%, var(--ring) 32.25%, transparent 33%),
        radial-gradient(circle at 50% 50%, transparent 48%, var(--ring) 48.25%, transparent 49%);
      animation: v1351-breathe 12s ease-in-out infinite alternate;
    }
    @keyframes v1351-breathe {
      0% { opacity: 0.35; transform: scale(1); }
      100% { opacity: 0.65; transform: scale(1.02); }
    }

    /* controls */
    .v1351-orrery .controls{
      position:absolute; left:12px; right:12px; bottom:12px; z-index:3;
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .v1351-orrery .pill{
      padding:8px 12px; border-radius:999px; border:1px dashed var(--glass-brd);
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.6));
      color: var(--muted); font-size:12px; display:inline-flex; align-items:center; gap:8px; backdrop-filter: blur(6px);
    }
    .v1351-orrery[data-theme="carbon"] .pill{
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06)); color: var(--muted);
    }
    .v1351-orrery .btn{
      appearance:none; border:1px solid var(--glass-brd); border-radius:999px;
      padding:10px 14px; font-weight:800; font-size:13px; letter-spacing:0.02em;
      background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.7));
      color: var(--ink); cursor:pointer;
      transition: transform 160ms ease, box-shadow 220ms ease, background 240ms ease;
      box-shadow: 0 14px 28px rgba(0,0,0,0.18);
    }
    .v1351-orrery .btn:hover{ transform: translateY(-1px); box-shadow: 0 18px 34px rgba(0,0,0,0.25); }
    .v1351-orrery[data-theme="carbon"] .btn{
      background: linear-gradient(180deg, rgba(255,255,255,0.18), rgba(255,255,255,0.08));
      color: var(--ink);
      box-shadow: 0 14px 28px rgba(0,0,0,0.45);
      color: var(--muted);
    }

    .v1351-orrery .slider{
      -webkit-appearance: none; appearance: none;
      height: 10px; border-radius: 999px; outline: none; width: min(260px, 40vw);
      background: linear-gradient(90deg, var(--accent-1), var(--accent-3));
      border: 1px solid var(--glass-brd);
      box-shadow: inset 0 0 0 3px rgba(255,255,255,0.5);
    }
    .v1351-orrery[data-theme="carbon"] .slider{
      box-shadow: inset 0 0 0 2px rgba(255,255,255,0.1);
    }
    .v1351-orrery .slider::-webkit-slider-thumb{
      -webkit-appearance: none; appearance: none;
      width: 22px; height: 22px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, #ddd);
      border: 1px solid var(--glass-brd);
      box-shadow: 0 6px 14px rgba(0,0,0,0.2);
      cursor: grab;
    }
    .v1351-orrery[data-theme="carbon"] .slider::-webkit-slider-thumb{
      background: radial-gradient(circle at 30% 30%, #f8fbff, #cfd8e3);
    }
    .v1351-orrery .slider::-moz-range-thumb{
      width: 22px; height: 22px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #fff, #ddd);
      border: 1px solid var(--glass-brd);
      box-shadow: 0 6px 14px rgba(0,0,0,0.2);
      cursor: grab;
    }

    /* reduced motion */
    @media (prefers-reduced-motion: reduce){
      .v1351-orrery::before, .v1351-orrery .rings { animation: none !important; }
      .v1351-orrery .btn { transition: none; }
    }
    @media (max-width: 760px){
      .v1351-orrery .controls{ left:10px; right:10px; bottom:10px; gap:8px; }
    }
  </style>

  <div class="mast">
    <div class="glyph" aria-hidden="true"></div>
    <div class="brand">
      <h2>Orrery</h2>
      <div class="tag">A kinetic poster</div>
    </div>
    <div class="chip" aria-live="polite">
      <span class="led" aria-hidden="true"></span>
      <span id="last-updated">Last updated: 2025-12-17 13:30:00 EST</span>
    </div>
  </div>

  <div class="hero">
    <h1>The Quiet Orrery</h1>
    <p class="lede">A contemplative clockwork of light. Tilt the plane, stir the sky, and let the orbits find their harmony.</p>
  </div>

  <div class="stage" aria-label="Generative Orrery Canvas">
    <canvas id="orrery"></canvas>
    <div class="rings" aria-hidden="true"></div>

    <div class="controls">
      <div class="pill">State <strong id="state" style="font-variant-numeric: tabular-nums;">Running</strong></div>
      <button class="btn" id="pause" aria-pressed="false">Pause</button>
      <button class="btn" id="theme" aria-pressed="false">Carbon</button>
      <button class="btn" id="shuffle" aria-pressed="false">Randomize</button>
      <label class="pill" for="speed" style="gap:12px;">
        Speed
        <input id="speed" class="slider" type="range" min="0" max="200" value="100" aria-label="Speed control">
        <strong id="speed-label" style="font-variant-numeric: tabular-nums;">1.00×</strong>
      </label>
    </div>
  </div>

  <script>
    (function(){
      const root = document.currentScript.closest('.v1351-orrery');
      const canvas = root.querySelector('#orrery');
      const ctx = canvas.getContext('2d');
      const pauseBtn = root.querySelector('#pause');
      const themeBtn = root.querySelector('#theme');
      const shuffleBtn = root.querySelector('#shuffle');
      const speedEl = root.querySelector('#speed');
      const speedLabel = root.querySelector('#speed-label');
      const stateEl = root.querySelector('#state');
      const updated = root.querySelector('#last-updated');

      // timestamp
      try {
        const now = new Date();
        updated.textContent = now.toLocaleString(undefined, {
          year: 'numeric', month: 'short', day: '2-digit',
          hour: '2-digit', minute: '2-digit', second: '2-digit',
          timeZoneName: 'short'
        });
      } catch { updated.textContent = new Date().toString(); }

      // sizing / DPI
      let w=0,h=0,dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      function resize(){
        const r = canvas.getBoundingClientRect();
        w = Math.max(1, Math.floor(r.width));
        h = Math.max(1, Math.floor(r.height));
        canvas.width = Math.floor(w * dpr);
        canvas.height = Math.floor(h * dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }
      resize();
      window.addEventListener('resize', resize, {passive:true});

      // palette
      function themeKey(){ return root.getAttribute('data-theme') === 'carbon' ? 'carbon' : 'linen'; }
      const PAL = {
        linen: [
          {h:198, s:86, l:52},
          {h:270, s:72, l:56},
          {h:22,  s:92, l:56},
          {h:160, s:58, l:44}
        ],
        carbon: [
          {h:198, s:100, l:64},
          {h:270, s:86,  l:66},
          {h:22,  s:98,  l:64},
          {h:160, s:72,  l:58}
        ]
      };
      function hsla(h,s,l,a){ return `hsla(${h},${s}%,${l}%,${a})`; }

      // system
      const tau = Math.PI*2;
      let raf = null;
      const reduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      // orbits
      let cx = 0, cy = 0, tiltX = 0, tiltY = 0;
      let speedMul = 1;
      const pointer = {x: 0, y:0, active:false};

      let stars = [];
      let bodies = [];

      function seedStars(){
        const n = Math.floor(140 + (w*h)/12000);
        stars = [];
        for (let i=0;i<n;i++){
          stars.push({
            x: Math.random()*w,
            y: Math.random()*h,
            r: Math.random()*1.1 + 0.2,
            a: Math.random()*0.5 + 0.2
          });
        }
      }

      function randomBodies(){
        const count = 5 + ((Math.random()*5)|0); // 5..9
        const baseR = Math.min(w,h)*0.12;
        bodies = [];
        let R = baseR;
        for (let i=0;i<count;i++){
          R += Math.min(w,h) * (0.06 + Math.random()*0.08);
          const pal = PAL[themeKey()];
          const tone = pal[i % pal.length];
          bodies.push({
            radius: R,
            size: Math.max(2.5, Math.random()*5 + (i*0.6)),
            hue: tone.h + (Math.random()*20 - 10),
            sat: tone.s,
            lit: tone.l,
            phase: Math.random()*tau,
            speed: (0.00008 + Math.random()*0.00025) * (Math.random()<0.3 ? -1 : 1),
          });
        }
      }

      function drawStars(){
        ctx.globalCompositeOperation = 'source-over';
        for (let s of stars){
          ctx.fillStyle = themeKey()==='carbon'
            ? `rgba(255,255,255,${0.35 + s.a*0.4})`
            : `rgba(0,0,0,${0.06 + s.a*0.12})`;
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.r, 0, tau);
          ctx.fill();
        }
      }

      function fade(){
        ctx.globalCompositeOperation = 'source-over';
        if (themeKey()==='carbon'){
          ctx.fillStyle = 'rgba(0,0,0,0.18)';
        } else {
          ctx.fillStyle = 'rgba(255,255,255,0.18)';
        }
        ctx.fillRect(0,0,w,h);
      }

      function drawSun(){
        const r = Math.min(w,h)*0.06 + Math.abs(tiltX+tiltY)*16;
        const g = ctx.createRadialGradient(cx - r*0.2, cy - r*0.2, r*0.1, cx, cy, r);
        const p = PAL[themeKey()][2];
        g.addColorStop(0, hsla(p.h, p.s, Math.min(96, p.l+18), 0.95));
        g.addColorStop(0.5, hsla(p.h, p.s, p.l, 0.55));
        g.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.globalCompositeOperation = 'lighter';
        ctx.fillStyle = g;
        ctx.beginPath(); ctx.arc(cx, cy, r, 0, tau); ctx.fill();
      }

      function drawOrbits(time){
        ctx.lineCap = 'round';
        for (let i=0;i<bodies.length;i++){
          const b = bodies[i];

          // orbit path (ellipse via tilt)
          const aR = b.radius;
          const bR = b.radius * (0.64 + (tiltY*0.18));
          const hue = b.hue + Math.sin(time*0.0003 + i)*8;

          // subtle orbit line
          ctx.globalCompositeOperation = 'source-over';
          ctx.strokeStyle = hsla(hue, b.sat, Math.min(92, b.lit+14), themeKey()==='carbon' ? 0.12 : 0.2);
          ctx.lineWidth = 1;
          ctx.beginPath();
          for (let t=0;t<=1;t+=0.02){
            const ang = t * tau;
            const x = cx + aR*Math.cos(ang + 0.001*time);
            const y = cy + bR*Math.sin(ang + 0.001*time);
            if (t===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
          }
          ctx.stroke();

          // body
          const theta = b.phase + time * b.speed * speedMul;
          const bx = cx + aR*Math.cos(theta + tiltX*0.6);
          const by = cy + bR*Math.sin(theta + tiltY*0.6);

          // parallax shimmer
          const px = bx + tiltX * (i+1) * 4;
          const py = by + tiltY * (i+1) * 4;

          const size = b.size * (1 + (Math.sin(theta)*0.12)) + (i*0.1);
          ctx.globalCompositeOperation = 'lighter';
          ctx.fillStyle = hsla(hue, b.sat, b.lit, themeKey()==='carbon' ? 0.6 : 0.5);
          ctx.beginPath(); ctx.arc(px, py, size, 0, tau); ctx.fill();

          // glow
          const gg = ctx.createRadialGradient(px, py, 0, px, py, size*4);
          gg.addColorStop(0, hsla(hue, b.sat, Math.min(96,b.lit+20), 0.6));
          gg.addColorStop(1, 'rgba(0,0,0,0)');
          ctx.fillStyle = gg;
          ctx.beginPath(); ctx.arc(px, py, size*3.2, 0, tau); ctx.fill();

          // tiny trailing streak
          ctx.globalCompositeOperation = 'lighter';
          ctx.strokeStyle = hsla(hue, b.sat, Math.min(95,b.lit+10), themeKey()==='carbon' ? 0.22 : 0.18);
          ctx.lineWidth = Math.max(0.5, size*0.22);
          ctx.beginPath();
          ctx.moveTo(px - Math.cos(theta)*size*4, py - Math.sin(theta)*size*4);
          ctx.lineTo(px, py);
          ctx.stroke();
        }
      }

      function drawComet(time){
        if (Math.random() < 0.01){ // occasional
          const fromLeft = Math.random() < 0.5;
          const y = Math.random()*h*0.7 + h*0.15;
          const hue = PAL[themeKey()][0].h + (Math.random()*30 - 15);
          const tail = 180;
          ctx.globalCompositeOperation = 'lighter';
          ctx.strokeStyle = hsla(hue, PAL[themeKey()][0].s, PAL[themeKey()][0].l, themeKey()==='carbon' ? 0.22 : 0.18);
          ctx.lineWidth = 1.8;
          ctx.beginPath();
          if (fromLeft){
            ctx.moveTo(-40, y);
            ctx.lineTo(tail, y + tiltY*8);
          } else {
            ctx.moveTo(w+40, y);
            ctx.lineTo(w-tail, y + tiltY*8);
          }
          ctx.stroke();
        }
      }

      function renderFrame(time){
        fade();
        drawStars();
        cx = w*0.5 + (pointer.active ? (pointer.x - w*0.5)*0.02 : tiltX*12);
        cy = h*0.5 + (pointer.active ? (pointer.y - h*0.5)*0.02 : tiltY*12);
        drawSun();
        drawOrbits(time);
        drawComet(time);
      }

      // loop
      let t0 = 0;
      function loop(ts){
        if (!t0) t0 = ts;
        const dt = ts - t0; t0 = ts;
        renderFrame(ts);
        raf = requestAnimationFrame(loop);
      }

      // interactions
      function setSpeed(v){
        speedMul = Math.max(0, Math.min(2, v/100*2)); // 0..2
        speedLabel.textContent = (speedMul).toFixed(2)+'×';
      }
      setSpeed(Number(speedEl.value));

      root.addEventListener('pointermove', (e)=>{
        const r = canvas.getBoundingClientRect();
        pointer.x = e.clientX - r.left;
        pointer.y = e.clientY - r.top;
        pointer.active = true;
        const nx = (pointer.x / Math.max(1,r.width))*2 - 1;
        const ny = (pointer.y / Math.max(1,r.height))*2 - 1;
        tiltX = nx * 0.6;
        tiltY = ny * 0.6;
      }, {passive:true});
      root.addEventListener('pointerleave', ()=>{ pointer.active=false; });

      speedEl.addEventListener('input', (e)=> setSpeed(Number(e.target.value)));

      pauseBtn.addEventListener('click', ()=>{
        const paused = root.getAttribute('data-paused')==='true';
        if (paused){
          root.setAttribute('data-paused','false');
          pauseBtn.textContent = 'Pause';
          pauseBtn.setAttribute('aria-pressed','false');
          stateEl.textContent = 'Running';
          if (!raf && !reduced) raf = requestAnimationFrame(loop);
        } else {
          root.setAttribute('data-paused','true');
          pauseBtn.textContent = 'Resume';
          pauseBtn.setAttribute('aria-pressed','true');
          stateEl.textContent = 'Paused';
          if (raf){ cancelAnimationFrame(raf); raf=null; }
        }
      });

      themeBtn.addEventListener('click', ()=>{
        const isCarbon = themeKey()==='carbon';
        root.setAttribute('data-theme', isCarbon ? 'linen' : 'carbon');
        themeBtn.textContent = isCarbon ? 'Carbon' : 'Linen';
        themeBtn.setAttribute('aria-pressed', String(!isCarbon));
        // re-seed tones to harmonize with theme
        bodies.forEach((b,i)=>{
          const p = PAL[themeKey()][i % PAL[themeKey()].length];
          b.hue = p.h + (Math.random()*20 - 10);
          b.sat = p.s;
          b.lit = p.l;
        });
      });

      shuffleBtn.addEventListener('click', ()=>{
        randomBodies();
        // gentle impulse
        bodies.forEach(b=> b.phase += Math.random()*tau);
        // visual feedback pulse
        shuffleBtn.style.transform = 'translateY(-2px) scale(1.03)';
        setTimeout(()=> shuffleBtn.style.transform = '', 140);
      });

      // keyboard
      root.tabIndex = 0;
      root.addEventListener('keydown', (e)=>{
        const k = e.key.toLowerCase();
        if (k===' ') { e.preventDefault(); pauseBtn.click(); }
        if (k==='t') themeBtn.click();
        if (k==='r') shuffleBtn.click();
        if (k==='['){ speedEl.value = Math.max(0, Number(speedEl.value)-10); speedEl.dispatchEvent(new Event('input')); }
        if (k===']'){ speedEl.value = Math.min(200, Number(speedEl.value)+10); speedEl.dispatchEvent(new Event('input')); }
      });

      // init
      seedStars();
      randomBodies();
      // prime backdrop
      ctx.fillStyle = themeKey()==='carbon' ? 'rgba(0,0,0,0.8)' : 'rgba(255,255,255,0.85)';
      ctx.fillRect(0,0,w,h);

      if (!reduced){
        raf = requestAnimationFrame(loop);
      } else {
        root.setAttribute('data-paused','true');
        pauseBtn.textContent = 'Resume';
        pauseBtn.setAttribute('aria-pressed','true');
        stateEl.textContent = 'Paused';
        // draw one static frame
        renderFrame(performance.now());
      }

      window.addEventListener('resize', ()=>{
        const prevW = w, prevH = h;
        resize(); seedStars();
        // nothing else needed; orbits use cx/cy recomputed
      }, {passive:true});

      document.addEventListener('visibilitychange', ()=>{
        if (document.hidden){
          if (raf){ cancelAnimationFrame(raf); raf=null; }
        } else if (root.getAttribute('data-paused')!=='true'){
          if (!reduced && !raf) raf = requestAnimationFrame(loop);
        }
      });
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


