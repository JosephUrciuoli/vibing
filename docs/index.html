<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<style>
  .vibe-1718{
    --bg-top: #fbfdff;
    --bg-base: #eef3f9;
    --fg: #0c1220;
    --muted: #5b6a80;
    --line: rgba(12,20,32,.15);
    --veil: rgba(255,255,255,.6);
    --h: 220;
    --r: 30px;
    position: relative;
    min-height: 960px;
    color: var(--fg);
    border-radius: var(--r);
    overflow: hidden;
    isolation: isolate;
    font: 800 13px/1.6 ui-sans-serif, -apple-system, system-ui, Inter, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
    background:
      radial-gradient(1200px 900px at calc(var(--mx,50%)) calc(var(--my,50%)), hsl(var(--h) 90% 60% / .18), transparent 55%),
      radial-gradient(900px 700px at 20% 20%, hsl(calc(var(--h) + 70) 86% 62% / .14), transparent 60%),
      radial-gradient(900px 700px at 80% 80%, hsl(calc(var(--h) + 200) 86% 58% / .12), transparent 60%),
      linear-gradient(180deg, var(--bg-top), var(--bg-base));
    box-shadow: 0 60px 160px -80px rgba(0,10,30,.35), inset 0 1px 0 rgba(255,255,255,.8);
  }
  .vibe-1718[data-theme="eclipse"]{
    --bg-top: #06090f;
    --bg-base: #0a0f17;
    --fg: #eef4ff;
    --muted: #9db0c7;
    --line: rgba(255,255,255,.12);
    --veil: rgba(255,255,255,.07);
    background:
      radial-gradient(1200px 900px at calc(var(--mx,50%)) calc(var(--my,52%)), hsl(calc(var(--h) + 30) 86% 60% / .20), transparent 55%),
      radial-gradient(900px 700px at 0% 100%, hsl(calc(var(--h) + 170) 80% 55% / .12), transparent 60%),
      linear-gradient(180deg, var(--bg-top), var(--bg-base));
    box-shadow: 0 60px 200px -80px rgba(0,0,0,.85), inset 0 1px 0 rgba(255,255,255,.08);
  }
  .vibe-1718[data-motion="off"] *{ animation: none !important; transition: none !important; }

  .vibe-1718::before{
    content:""; position:absolute; inset:-2px; pointer-events:none; mix-blend-mode: overlay; opacity:.14;
    background:
      radial-gradient(160px 120px at 25% 35%, #0002, transparent 60%) repeat,
      radial-gradient(160px 120px at 70% 65%, #0002, transparent 60%) repeat;
    background-size: 320px 240px, 320px 240px;
    filter: contrast(115%) saturate(108%) blur(.35px);
  }

  .chrome-1718{ position:relative; z-index:2; display:grid; grid-template-rows:auto 1fr auto; gap: clamp(18px, 4vw, 44px); padding: clamp(18px, 4vw, 44px); }

  /* Top bar */
  .nav-1718{ display:flex; align-items:center; justify-content:space-between; gap:14px; }
  .brand-1718{ display:flex; align-items:center; gap:12px; }
  .glyph-1718{
    width:58px; height:58px; border-radius:18px; position:relative; overflow:hidden; border:1px solid var(--line);
    background: var(--veil); backdrop-filter: blur(8px);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.18);
  }
  .glyph-1718::before, .glyph-1718::after{ content:""; position:absolute; inset:8px; border-radius:14px; }
  .glyph-1718::before{
    background: conic-gradient(from 0deg, hsl(var(--h) 90% 60%), hsl(calc(var(--h)+90) 90% 60%), hsl(calc(var(--h)+200) 80% 58%), hsl(var(--h) 90% 60%));
    animation: spin-1718 12s linear infinite;
  }
  .glyph-1718::after{
    background: radial-gradient(36px 36px at 60% 40%, #fff, transparent 60%);
    mix-blend-mode: plus-lighter; opacity:.85;
    -webkit-mask: radial-gradient(18px 18px at 60% 40%, transparent 55%, #000 56%);
            mask: radial-gradient(18px 18px at 60% 40%, transparent 55%, #000 56%);
  }
  @keyframes spin-1718 { to { transform: rotate(360deg); } }
  .word-1718{ font-weight:1000; letter-spacing:.2px; font-size:18px; }

  .controls-1718{ display:flex; gap:8px; flex-wrap:wrap; }
  .btn-1718{
    appearance:none; border:1px solid var(--line); background: var(--veil); color: currentColor;
    padding:10px 14px; border-radius:999px; cursor:pointer; font-weight:1000;
    backdrop-filter: blur(10px);
    transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
  }
  .btn-1718:hover{ transform: translateY(-1px); box-shadow: 0 16px 30px -16px rgba(0,0,0,.45); }
  .btn-1718.primary{ background: linear-gradient(90deg, hsl(calc(var(--h)+90) 90% 60%), hsl(var(--h) 90% 60%)); color:#0b1224; border-color: transparent; }

  /* Layout */
  .grid-1718{ display:grid; grid-template-columns: 1.1fr 1fr; gap: clamp(18px, 4.6vw, 60px); align-items: stretch; }
  @media (max-width: 980px){ .grid-1718{ grid-template-columns: 1fr; } }

  /* Stage */
  .stage-1718{
    border-radius: 36px; overflow: hidden; min-height: clamp(560px, 60vw, 860px);
    border: 1px solid var(--line);
    background:
      radial-gradient(100% 90% at 50% 0%, rgba(255,255,255,.50), transparent 52%),
      linear-gradient(180deg, color-mix(in hsl, var(--bg-base), transparent 0%), color-mix(in hsl, var(--bg-base), transparent 12%));
    box-shadow: inset 0 1px 0 rgba(255,255,255,.15), 0 28px 84px -36px rgba(0,0,0,.55);
    position: relative; display:grid; place-items:center;
  }
  .field-wrap-1718{ position:relative; width:100%; height:100%; }
  canvas.field-1718{ display:block; width:100%; height:100%; }
  .ring-1718{
    position:absolute; inset:10%; border-radius:999px; pointer-events:none;
    border: 1px dashed color-mix(in srgb, currentColor 36%, transparent);
    opacity:.35; animation: breathe-1718 6s ease-in-out infinite;
  }
  @keyframes breathe-1718{ 50%{ transform: scale(1.02); opacity:.55; } }

  /* Copy */
  .copy-1718{
    position:relative; border-radius: 26px; border:1px solid var(--line); background: var(--veil);
    padding: clamp(16px, 3.6vw, 28px); backdrop-filter: blur(8px);
    align-self: center;
  }
  .copy-1718 .eyebrow{ letter-spacing:.28em; text-transform:uppercase; font-size:12px; color: var(--muted); }
  .copy-1718 h1{
    margin: 12px 0 10px; line-height:.9; font-weight:1000; letter-spacing:-0.02em;
    font-size: clamp(54px, 9.6vw, 116px);
    text-wrap: balance;
    background: linear-gradient(120deg, hsl(var(--h) 90% 60%), hsl(calc(var(--h)+100) 88% 60%), hsl(calc(var(--h)+210) 86% 58%));
    -webkit-background-clip: text; background-clip: text; color: transparent;
    text-shadow: 0 30px 80px color-mix(in srgb, hsl(calc(var(--h)+100) 90% 60%) 22%, transparent);
  }
  .copy-1718 p{ max-width: 62ch; color: var(--muted); font-size: clamp(14px, 2.1vw, 18px); }
  .panel-1718{ display:flex; flex-wrap:wrap; gap:10px; margin-top: 14px; }
  .chip-1718, .range-1718{
    display:flex; align-items:center; gap:10px; padding:10px 14px; border-radius:14px; font-weight:900; border:1px solid var(--line);
    background: var(--veil); color: currentColor; backdrop-filter: blur(10px);
  }
  .range-1718 input{
    appearance:none; width:fit-content; min-width: 220px; height:6px; border-radius:999px; outline: none;
    background: linear-gradient(90deg, hsl(calc(var(--h)+210) 90% 60%), hsl(calc(var(--h)+90) 90% 60%));
  }
  .range-1718 input::-webkit-slider-thumb{
    appearance:none; width:18px; height:18px; border-radius:50%;
    background: linear-gradient(90deg, hsl(calc(var(--h)+90) 90% 60%), hsl(var(--h) 90% 60%));
    border:2px solid #fff6; box-shadow: 0 2px 10px -2px rgba(0,0,0,.4); cursor:pointer;
  }

  .quote-1718{
    margin-top:12px; border-radius:16px; padding:10px 14px;
    border:1px solid var(--line); background: var(--veil); color: var(--muted); font-weight:900;
  }

  /* Dock */
  .dock-1718{
    position: sticky; bottom: 16px; z-index: 3; display:flex; justify-content: space-between; align-items:center; gap:10px; flex-wrap:wrap;
    padding: 8px; border-radius: 16px; border:1px solid var(--line); background: var(--veil); backdrop-filter: blur(10px);
  }
  .pill-1718{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid var(--line); background: color-mix(in srgb, var(--veil) 100%, transparent); color: currentColor; font-weight:900; }
  .icon-btn-1718{
    appearance:none; display:inline-flex; align-items:center; justify-content:center; gap:8px;
    min-width:40px; height:40px; padding:0 12px; border-radius:999px;
    border:1px solid var(--line); background: var(--veil); color: currentColor; cursor:pointer; font-weight:900;
    transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
  }
  .icon-btn-1718:hover{ transform: translateY(-1px); box-shadow: 0 16px 30px -16px rgba(0,0,0,.5); }
  .icon-btn-1718.primary{ background: linear-gradient(90deg, hsl(calc(var(--h)+100) 90% 60%), hsl(var(--h) 90% 60%)); color:#0b1224; border-color: transparent; }
  .icon-1718{ width:18px; height:18px; }

  .meta-1718{ display:flex; align-items:center; justify-content: space-between; gap:8px; flex-wrap:wrap; color: var(--muted); }
  .sr{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
</style>

<div class="vibe-1718" data-theme="dawn" data-motion="on" aria-label="Lumen Atlas — Constellation canvas">
  <div class="chrome-1718">
    <div class="nav-1718">
      <div class="brand-1718" aria-label="Lumen Atlas">
        <div class="glyph-1718" aria-hidden="true"></div>
        <div class="word-1718">Lumen Atlas</div>
      </div>
      <div class="controls-1718">
        <button class="btn-1718 theme" aria-pressed="false" aria-label="Toggle theme">Theme</button>
        <button class="btn-1718 motion" aria-pressed="false" aria-label="Toggle motion">Motion</button>
        <button class="btn-1718 shuffle" aria-label="Shift spectrum">Spectrum</button>
      </div>
    </div>

    <section class="grid-1718">
      <figure class="stage-1718" aria-label="Interactive constellation field">
        <div class="field-wrap-1718">
          <canvas class="field-1718" role="img" aria-label="Luminous nodes, connective filaments, and pulsing rings"></canvas>
          <div class="ring-1718" aria-hidden="true"></div>
        </div>
      </figure>

      <div class="copy-1718">
        <div class="eyebrow">Iteration 1718 • Luminous Cartography</div>
        <h1>Shape the light.</h1>
        <p>Sketch constellations with your presence. Nodes drift, filaments weave, pulses echo. The field remembers your touch.</p>

        <div class="panel-1718">
          <div class="range-1718" title="Density">
            <span>Density</span>
            <input class="density-1718" type="range" min="30" max="260" step="10" value="140" aria-label="Node density">
          </div>
          <div class="range-1718" title="Hue">
            <span>Hue</span>
            <input class="hue-1718" type="range" min="0" max="359" step="1" value="220" aria-label="Spectrum hue">
          </div>
          <button class="chip-1718 trails-ctl" aria-pressed="true" title="Trails">Trails: On</button>
          <button class="chip-1718 lines-ctl" aria-pressed="true" title="Filaments">Filaments: On</button>
          <button class="chip-1718 pulse-ctl" aria-pressed="true" title="Pulses">Pulses: On</button>
        </div>

        <div class="quote-1718" aria-hidden="true">“Points become paths, and paths become places.”</div>
      </div>
    </section>

    <div class="dock-1718" aria-label="Controls">
      <div class="pill-1718">
        <svg class="icon-1718" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M3 12a9 9 0 1 0 18 0A9 9 0 0 0 3 12Zm9-6v6l4 2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
        <span id="last-updated">Last updated: 2026-01-03 14:13:46 EST</span>
      </div>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <button class="icon-btn-1718 focus" aria-label="Recenter field">
          <svg class="icon-1718" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 5v2m0 10v2M5 12h2m10 0h2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <circle cx="12" cy="12" r="4.5" stroke="currentColor" stroke-width="1.4"/>
          </svg>
          Focus
        </button>
        <button class="icon-btn-1718 snapshot primary" aria-label="Save image">
          <svg class="icon-1718" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M5 7h3l1-2h6l1 2h3v12H5V7z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
            <circle cx="12" cy="13" r="3.2" stroke="currentColor" stroke-width="1.6"/>
          </svg>
          Save
        </button>
        <button class="icon-btn-1718 reseed" aria-label="Reseed nodes">
          <svg class="icon-1718" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M4 12a8 8 0 1 0 8-8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M4 4v6h6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
          Reseed
        </button>
      </div>
    </div>

    <div class="meta-1718" aria-hidden="true">
      <span>Drag to nudge nodes • Density changes complexity • Hue shifts atmosphere</span>
      <span>Theme-aware luminance</span>
    </div>
  </div>
</div>

<script>
(function(){
  const root = document.currentScript.previousElementSibling;
  const last = root.querySelector('#last-updated');

  // Timestamp
  try {
    const now = new Date();
    last.textContent = 'Last updated: ' + now.toLocaleString(undefined, {
      year:'numeric', month:'2-digit', day:'2-digit',
      hour:'2-digit', minute:'2-digit', second:'2-digit',
      hour12:false, timeZoneName:'short'
    });
  } catch(e){ last.textContent = 'Last updated: just now'; }

  // Elements
  const themeBtn = root.querySelector('.btn-1718.theme');
  const motionBtn = root.querySelector('.btn-1718.motion');
  const shuffleBtn = root.querySelector('.btn-1718.shuffle');
  const trailsBtn = root.querySelector('.trails-ctl');
  const linesBtn = root.querySelector('.lines-ctl');
  const pulseBtn = root.querySelector('.pulse-ctl');
  const densityInput = root.querySelector('.density-1718');
  const hueInput = root.querySelector('.hue-1718');

  const focusBtn = root.querySelector('.icon-btn-1718.focus');
  const saveBtn = root.querySelector('.icon-btn-1718.snapshot');
  const reseedBtn = root.querySelector('.icon-btn-1718.reseed');

  const stage = root.querySelector('.stage-1718');
  const wrap = root.querySelector('.field-wrap-1718');
  const canvas = root.querySelector('.field-1718');
  const ctx = canvas.getContext('2d');

  // Theme persistence
  const KEY_THEME = 'v1718-theme';
  const savedTheme = localStorage.getItem(KEY_THEME);
  if (savedTheme) root.setAttribute('data-theme', savedTheme);
  const syncThemeAria = () => themeBtn.setAttribute('aria-pressed', String(root.getAttribute('data-theme') === 'eclipse'));
  syncThemeAria();
  themeBtn.addEventListener('click', ()=>{
    const next = root.getAttribute('data-theme') === 'eclipse' ? 'dawn' : 'eclipse';
    root.setAttribute('data-theme', next);
    localStorage.setItem(KEY_THEME, next);
    syncThemeAria();
  });

  // Motion + reduced-motion
  const KEY_MOTION = 'v1718-motion';
  const mediaReduce = matchMedia('(prefers-reduced-motion: reduce)');
  const savedMotion = localStorage.getItem(KEY_MOTION);

  function setMotion(on){
    root.setAttribute('data-motion', on ? 'on' : 'off');
    motionBtn.setAttribute('aria-pressed', String(!on));
    if (!on) cancelAnimationFrame(loopId); else loop();
  }
  if (savedMotion) setMotion(savedMotion === 'on');
  else if (mediaReduce.matches) setMotion(false);
  motionBtn.addEventListener('click', ()=>{
    const on = root.getAttribute('data-motion') === 'off';
    setMotion(on);
    localStorage.setItem(KEY_MOTION, on ? 'on' : 'off');
  });
  mediaReduce.addEventListener && mediaReduce.addEventListener('change', e => setMotion(!e.matches));

  // Pointer-responsive background
  let rafGlow;
  function moveLight(e){
    if (root.getAttribute('data-motion') === 'off') return;
    const r = root.getBoundingClientRect();
    const x = ('touches' in e) ? e.touches[0].clientX : e.clientX;
    const y = ('touches' in e) ? e.touches[0].clientY : e.clientY;
    const px = ((x - r.left) / r.width) * 100;
    const py = ((y - r.top) / r.height) * 100;
    if (rafGlow) cancelAnimationFrame(rafGlow);
    rafGlow = requestAnimationFrame(()=>{
      root.style.setProperty('--mx', px + '%');
      root.style.setProperty('--my', py + '%');
    });
  }
  root.addEventListener('pointermove', moveLight, { passive:true });

  // Canvas sizing
  function dpr(){ return Math.max(1, Math.min(1.75, window.devicePixelRatio || 1)); }
  function sizeCanvas(){
    const r = wrap.getBoundingClientRect();
    const ratio = dpr();
    canvas.width = Math.floor(r.width * ratio);
    canvas.height = Math.floor(r.height * ratio);
    canvas.style.width = r.width + 'px';
    canvas.style.height = r.height + 'px';
    ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
  }
  window.addEventListener('resize', sizeCanvas, { passive:true });

  // State
  const state = {
    hue: +hueInput.value || 220,
    density: +densityInput.value || 140,
    trails: true,
    lines: true,
    pulses: true,
    nodes: [],
    pointer: { x: 0, y: 0, tx: 0, ty: 0, down: false },
    t: 0,
    pulseT: 0
  };

  // Palette application
  function applyHue(h){
    root.style.setProperty('--h', h);
  }
  applyHue(state.hue);

  // UI events
  densityInput.addEventListener('input', ()=>{ state.density = +densityInput.value; seedNodes(); });
  hueInput.addEventListener('input', ()=>{ state.hue = +hueInput.value; applyHue(state.hue); });

  trailsBtn.addEventListener('click', ()=>{
    state.trails = !state.trails;
    trailsBtn.setAttribute('aria-pressed', String(state.trails));
    trailsBtn.textContent = 'Trails: ' + (state.trails ? 'On' : 'Off');
  });
  linesBtn.addEventListener('click', ()=>{
    state.lines = !state.lines;
    linesBtn.setAttribute('aria-pressed', String(state.lines));
    linesBtn.textContent = 'Filaments: ' + (state.lines ? 'On' : 'Off');
  });
  pulseBtn.addEventListener('click', ()=>{
    state.pulses = !state.pulses;
    pulseBtn.setAttribute('aria-pressed', String(state.pulses));
    pulseBtn.textContent = 'Pulses: ' + (state.pulses ? 'On' : 'Off');
  });

  shuffleBtn.addEventListener('click', ()=>{
    const next = Math.floor(Math.random()*360);
    state.hue = next;
    hueInput.value = String(next);
    applyHue(next);
  });

  focusBtn.addEventListener('click', ()=>{
    const r = wrap.getBoundingClientRect();
    state.pointer.tx = r.width/2;
    state.pointer.ty = r.height/2;
  });

  saveBtn.addEventListener('click', ()=>{
    try{
      const r = wrap.getBoundingClientRect();
      const temp = document.createElement('canvas');
      const ratio = dpr();
      temp.width = Math.floor(r.width * ratio);
      temp.height = Math.floor(r.height * ratio);
      const tctx = temp.getContext('2d');
      tctx.setTransform(ratio, 0, 0, ratio, 0, 0);
      drawFrame(tctx, r.width, r.height, true);
      const a = document.createElement('a');
      a.download = 'lumen-atlas-1718.png';
      a.href = temp.toDataURL('image/png');
      a.click();
    }catch(e){}
  });

  reseedBtn.addEventListener('click', seedNodes);

  // Pointer interactions
  function pointerTo(e){
    const rect = wrap.getBoundingClientRect();
    const px = ('touches' in e) ? e.touches[0].clientX - rect.left : e.clientX - rect.left;
    const py = ('touches' in e) ? e.touches[0].clientY - rect.top : e.clientY - rect.top;
    state.pointer.tx = px; state.pointer.ty = py;
  }
  wrap.addEventListener('pointermove', (e)=>{ pointerTo(e); }, { passive:true });
  wrap.addEventListener('pointerdown', (e)=>{ state.pointer.down = true; pointerTo(e); }, { passive:true });
  wrap.addEventListener('pointerup', ()=>{ state.pointer.down = false; }, { passive:true });
  wrap.addEventListener('pointerleave', ()=>{ state.pointer.down = false; }, { passive:true });
  wrap.addEventListener('touchstart', (e)=>{ state.pointer.down = true; pointerTo(e); }, { passive:true });

  // Seeding
  function seedNodes(){
    const r = wrap.getBoundingClientRect();
    const count = state.density;
    state.nodes = Array.from({length: count}, (_,i)=>({
      x: Math.random()*r.width,
      y: Math.random()*r.height,
      vx: (Math.random()-0.5)*0.6,
      vy: (Math.random()-0.5)*0.6,
      w: 0.6 + Math.random()*1.8,
      life: Math.random()*1000
    }));
  }

  function bgColor(){
    return root.getAttribute('data-theme')==='eclipse' ? '#06090f' : '#ffffff';
  }

  // Draw helpers
  function drawFrame(targetCtx, w, h, exportMode=false){
    // Fade or clear
    if (state.trails && !exportMode){
      targetCtx.fillStyle = root.getAttribute('data-theme')==='eclipse' ? 'rgba(6,9,15,0.20)' : 'rgba(255,255,255,0.20)';
      targetCtx.fillRect(0,0,w,h);
    } else {
      targetCtx.fillStyle = bgColor();
      targetCtx.fillRect(0,0,w,h);
    }

    // Smooth pointer
    const speed = state.pointer.down ? 0.25 : 0.12;
    state.pointer.x += ((state.pointer.tx || w/2) - (state.pointer.x || w/2))*speed;
    state.pointer.y += ((state.pointer.ty || h/2) - (state.pointer.y || h/2))*speed;

    // Colors
    const C1 = `hsla(${state.hue}, 90%, ${root.getAttribute('data-theme')==='eclipse'?68:55}%, 0.9)`;
    const C2 = `hsla(${(state.hue+100)%360}, 90%, ${root.getAttribute('data-theme')==='eclipse'?70:58}%, 0.9)`;
    const C3 = `hsla(${(state.hue+210)%360}, 88%, ${root.getAttribute('data-theme')==='eclipse'?72:60}%, 0.9)`;
    const baseLine = root.getAttribute('data-theme')==='eclipse' ? 'rgba(255,255,255,0.06)' : 'rgba(0,0,0,0.06)';

    // Pulse rings
    if (state.pulses){
      const cx = w*0.5, cy = h*0.5;
      const r = Math.min(w,h)*0.36;
      const t = (state.pulseT % 2000) / 2000; // 0..1
      const ringR = r * (0.7 + t*0.35);
      targetCtx.save();
      targetCtx.beginPath();
      targetCtx.arc(cx, cy, ringR, 0, Math.PI*2);
      targetCtx.strokeStyle = baseLine;
      targetCtx.lineWidth = Math.max(1, Math.min(w,h)*0.004);
      targetCtx.globalAlpha = 0.5 * (1-t);
      targetCtx.stroke();
      targetCtx.restore();
    }

    // Nodes
    targetCtx.save();
    targetCtx.globalCompositeOperation = 'screen';
    for (let i=0;i<state.nodes.length;i++){
      const n = state.nodes[i];

      // Forces: gentle drift + pointer gravity/repel
      const dx = state.pointer.x - n.x;
      const dy = state.pointer.y - n.y;
      const dist = Math.hypot(dx, dy) + 0.001;
      const attract = state.pointer.down ? 0.0009 : 0.0003;
      const repel = state.pointer.down ? -0.002 : -0.0002;
      const force = dist < 120 ? repel : attract;

      n.vx += dx * force;
      n.vy += dy * force;

      // Soft bounds
      n.vx += (Math.random()-0.5)*0.002;
      n.vy += (Math.random()-0.5)*0.002;
      n.vx *= 0.995;
      n.vy *= 0.995;

      n.x += n.vx;
      n.y += n.vy;

      // Wrap
      if (n.x < -20) n.x = w+20; if (n.x > w+20) n.x = -20;
      if (n.y < -20) n.y = h+20; if (n.y > h+20) n.y = -20;

      // Node glow
      const col = i%3===0 ? C1 : (i%3===1 ? C2 : C3);
      const g = targetCtx.createRadialGradient(n.x, n.y, 0, n.x, n.y, 12);
      g.addColorStop(0, col.replace('hsla','hsla').replace(')', '') + ')');
      g.addColorStop(1, 'transparent');
      targetCtx.fillStyle = g;
      targetCtx.beginPath();
      const sz = 1.2 + n.w;
      targetCtx.arc(n.x, n.y, sz, 0, Math.PI*2);
      targetCtx.fill();

      n.life += 0.8;
    }
    targetCtx.restore();

    // Filaments (connections)
    if (state.lines){
      targetCtx.save();
      targetCtx.globalCompositeOperation = 'lighten';
      for (let i=0;i<state.nodes.length;i++){
        const a = state.nodes[i];
        for (let j=i+1;j<state.nodes.length;j++){
          const b = state.nodes[j];
          const dx = a.x - b.x, dy = a.y - b.y;
          const d = Math.hypot(dx,dy);
          if (d < 110){
            const t = (110 - d)/110;
            const col = (i%3===0 ? C1 : (i%3===1 ? C2 : C3)).replace('0.9', (0.25 + t*0.55).toFixed(2));
            targetCtx.strokeStyle = col;
            targetCtx.lineWidth = 0.4 + t*1.6;
            targetCtx.beginPath();
            targetCtx.moveTo(a.x, a.y);
            targetCtx.lineTo(b.x, b.y);
            targetCtx.stroke();
          }
        }
      }
      targetCtx.restore();
    }

    // Center label (time)
    const now = new Date();
    const timeStr = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    targetCtx.save();
    targetCtx.font = `1000 ${Math.max(18, Math.min(w,h)*0.06)}px ui-sans-serif, Inter, system-ui`;
    targetCtx.textAlign = 'center';
    targetCtx.textBaseline = 'middle';
    targetCtx.fillStyle = root.getAttribute('data-theme')==='eclipse' ? 'rgba(255,255,255,0.9)' : 'rgba(10,16,28,0.9)';
    targetCtx.shadowColor = C2;
    targetCtx.shadowBlur = 10;
    targetCtx.fillText(timeStr, w*0.5, h*0.5);
    targetCtx.restore();
  }

  // Loop
  let loopId = 0, then = 0;
  function draw(){
    const r = wrap.getBoundingClientRect();
    drawFrame(ctx, r.width, r.height, false);
  }
  function loop(now=0){
    if (root.getAttribute('data-motion') === 'off') return;
    if (!then) then = now;
    const dt = Math.min(50, now - then);
    then = now;
    state.t += dt;
    state.pulseT += dt;
    draw();
    loopId = requestAnimationFrame(loop);
  }

  // Init
  sizeCanvas();
  const rc = wrap.getBoundingClientRect();
  state.pointer.x = state.pointer.tx = rc.width/2;
  state.pointer.y = state.pointer.ty = rc.height/2;
  seedNodes();
  loop();

  // Subtle repaint nudge to start CSS var transitions
  root.style.setProperty('--h', String(state.hue));
})();
</script>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


