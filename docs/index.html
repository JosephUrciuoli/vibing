<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<div id="vibe1991" data-theme="paper" data-mode="orbit" aria-label="Kinetic Bloom — a playable poster">
  <style>
    /* Kinetic Bloom — all styles scoped to #vibe1991 */
    #vibe1991 {
      --paper-0: #fcfcff;
      --paper-1: #eef3ff;
      --ink: #0a0f1f;
      --muted: #5e6a80;
      --panel: rgba(255,255,255,0.75);
      --stroke: rgba(10,15,31,0.08);
      --ring: rgba(10,15,31,0.06);

      --noct-0: #0a0f1f;
      --noct-1: #101a30;

      --a1: #6da4ff;
      --a2: #ff7ac3;
      --a3: #43f0c8;

      --glow: 26;
      --rx: 0deg;
      --ry: 0deg;

      position: relative;
      color: var(--ink);
      border-radius: 34px;
      padding: clamp(18px, 2.6vw, 42px);
      background:
        radial-gradient(1200px 800px at 110% -20%, var(--paper-1), var(--paper-0) 60%);
      box-shadow: 0 40px 120px rgba(2,8,23,0.16), inset 0 0 0 1px var(--stroke);
      overflow: hidden;
      isolation: isolate;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    #vibe1991[data-theme="nocturne"]{
      --ink: #e9f1ff;
      --muted: #9fb1cf;
      --panel: rgba(16,22,44,0.55);
      --stroke: rgba(255,255,255,0.08);
      --ring: rgba(120,170,255,0.16);
      background:
        radial-gradient(1200px 800px at -20% -10%, #16213f, var(--noct-0) 55%),
        radial-gradient(900px 700px at 120% 120%, var(--noct-1), #0b1430 70%);
      box-shadow: 0 50px 140px rgba(0,0,0,0.55), inset 0 0 0 1px var(--stroke);
    }

    /* Shell */
    #vibe1991 .grid {
      position: relative; z-index: 1;
      display: grid;
      grid-template-columns: 1.05fr 1.35fr;
      gap: clamp(16px, 3.2vw, 46px);
      align-items: stretch;
    }
    @media (max-width: 980px){ #vibe1991 .grid { grid-template-columns: 1fr; } }

    /* Copy */
    #vibe1991 .card {
      background: linear-gradient(180deg, var(--panel), rgba(255,255,255,0.04));
      border: 1px solid var(--stroke);
      border-radius: 24px;
      padding: clamp(16px, 2.1vw, 28px);
      box-shadow: 0 26px 70px rgba(0,0,0,0.22), 0 0 0 1px var(--ring) inset;
      backdrop-filter: blur(10px) saturate(1.05);
    }
    #vibe1991[data-theme="nocturne"] .card {
      box-shadow: 0 26px 70px rgba(0,0,0,0.38), 0 0 0 1px rgba(255,255,255,0.35) inset;
    }
    #vibe1991 .badge {
      display: inline-flex; align-items: center; gap: 8px;
      font-weight: 900; letter-spacing: 0.18em; text-transform: uppercase; font-size: 11px; color: var(--muted);
    }
    #vibe1991 .badge .dot {
      width: 9px; height: 9px; border-radius: 50%;
      background: radial-gradient(circle at 35% 35%, var(--a2), transparent 70%);
      box-shadow: 0 0 14px rgba(255,122,195,0.5);
    }
    #vibe1991 h1 {
      margin: 10px 0 8px 0;
      font-size: clamp(36px, 6.8vw, 92px);
      line-height: 0.98; letter-spacing: -0.028em;
      background: linear-gradient(112deg, var(--a1), var(--a2) 50%, var(--a3));
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    #vibe1991 .lead { color: var(--muted); font-size: clamp(14px, 1.6vw, 18px); line-height: 1.75; max-width: 62ch; }

    /* Controls */
    #vibe1991 .controls { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 14px; align-items: center; }
    #vibe1991 .btn {
      display: inline-flex; align-items: center; gap: 10px;
      padding: 11px 14px; border-radius: 14px;
      font-weight: 800; letter-spacing: 0.01em;
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.5));
      color: var(--ink);
      box-shadow: 0 12px 28px rgba(0,0,0,0.12), 0 0 0 1px rgba(255,255,255,0.65) inset;
      cursor: pointer; user-select: none;
      transition: transform 150ms ease, box-shadow 220ms ease, background 200ms ease;
    }
    #vibe1991 .btn:hover { transform: translateY(-2px); }
    #vibe1991 .btn.ghost {
      background: rgba(255,255,255,0.6);
      font-weight: 700;
    }
    #vibe1991[data-theme="nocturne"] .btn {
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
      box-shadow: 0 14px 38px rgba(0,0,0,0.38), 0 0 0 1px rgba(255,255,255,0.08) inset;
      color: var(--ink);
    }
    #vibe1991 label { font-weight: 800; letter-spacing: 0.02em; color: var(--muted); font-size: 12px; }
    #vibe1991 .slab { display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; margin-top: 12px; }
    #vibe1991 .range {
      -webkit-appearance: none; appearance: none; width: 100%; height: 12px; border-radius: 999px;
      background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3)); outline: none;
      border: 1px solid var(--stroke); cursor: pointer;
    }
    #vibe1991 .range::-webkit-slider-thumb,
    #vibe1991 .range::-moz-range-thumb {
      width: 22px; height: 22px; border-radius: 50%;
      background: #ffffff; border: 1px solid rgba(10,15,31,0.18);
      box-shadow: 0 8px 18px rgba(0,0,0,0.3);
    }
    #vibe1991[data-theme="nocturne"] .range::-webkit-slider-thumb,
    #vibe1991[data-theme="nocturne"] .range::-moz-range-thumb {
      background: #0d1429; border-color: rgba(255,255,255,0.22);
    }

    /* Poster Stage */
    #vibe1991 .poster {
      position: relative; border-radius: 28px;
      background: linear-gradient(180deg, var(--panel), rgba(255,255,255,0.04));
      border: 1px solid var(--stroke);
      box-shadow: 0 28px 90px rgba(0,0,0,0.18), 0 0 0 1px var(--ring) inset;
      overflow: hidden;
      transform-style: preserve-3d;
      transform: rotateX(var(--rx)) rotateY(var(--ry));
      transition: transform 180ms ease;
      min-height: 470px;
      aspect-ratio: 5 / 6;
    }
    #vibe1991[data-theme="nocturne"] .poster {
      box-shadow: 0 32px 110px rgba(0,0,0,0.48), 0 0 0 1px rgba(255,255,255,0.45) inset;
    }

    /* Kinetic rings (CSS only) */
    #vibe1991 .poster::before,
    #vibe1991 .poster::after {
      content: "";
      position: absolute; inset: -12%;
      pointer-events: none;
      filter: saturate(1.05);
      opacity: 0.9;
    }
    #vibe1991 .poster::before {
      background:
        radial-gradient(closest-side, rgba(255,255,255,0.18), transparent 65%) center/cover no-repeat,
        conic-gradient(from var(--spin, 0deg),
          color-mix(in oklab, var(--a1) 76%, transparent),
          color-mix(in oklab, var(--a2) 72%, transparent),
          color-mix(in oklab, var(--a3) 72%, transparent),
          transparent 66%);
      mix-blend-mode: screen;
      animation: vibe1991_spin 28s linear infinite;
      mask: radial-gradient(closest-side, transparent 32%, black 52%, transparent 76%);
    }
    #vibe1991 .poster::after {
      background:
        repeating-conic-gradient(from calc(var(--spin, 0deg) * -1),
          rgba(255,255,255,0.06) 0 6deg,
          transparent 6deg 12deg);
      mix-blend-mode: soft-light;
      animation: vibe1991_spin 60s linear infinite reverse;
      mask: radial-gradient(circle at 50% 50%, transparent 0 16%, black 17% 82%, transparent 83% 100%);
    }
    @keyframes vibe1991_spin { to { --spin: 360deg; } }

    /* Canvas */
    #vibe1991 canvas#bloom {
      position: absolute; inset: 0; width: 100%; height: 100%;
      display: block; filter: saturate(1.06) contrast(1.05);
    }

    /* Meta */
    #vibe1991 .meta { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; margin-top: 14px; color: var(--muted); font-size: 13px; }
    #vibe1991 .ping {
      width: 8px; height: 8px; border-radius: 50%;
      background: #34d399;
      box-shadow: 0 0 0 0 rgba(52,211,153,0.6);
      animation: vibe1991_ping 2.6s ease-out infinite;
    }
    @keyframes vibe1991_ping {
      0% { box-shadow: 0 0 0 0 rgba(52,211,153,0.6); }
      70% { box-shadow: 0 0 0 12px rgba(52,211,153,0); }
      100% { box-shadow: 0 0 0 0 rgba(52,211,153,0); }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      #vibe1991 * { animation: none !important; transition: none !important; }
      #vibe1991 .poster::before, #vibe1991 .poster::after { display: none !important; }
    }
  </style>

  <div class="grid">
    <section class="card" role="region" aria-label="Kinetic Bloom copy">
      <div class="badge"><span class="dot" aria-hidden="true"></span> Kinetic Bloom</div>
      <h1>Make a poster breathe.</h1>
      <p class="lead">A living print inspired by rose curves and whispering fields. Tilt to catch the light; move to pull the ink. Every palette becomes a new artifact.</p>

      <div class="controls" role="group" aria-label="Controls">
        <button class="btn" type="button" data-palette>Shuffle palette</button>
        <button class="btn ghost" type="button" aria-pressed="true" data-theme><span aria-hidden="true">☀</span> Paper</button>
        <button class="btn ghost" type="button" aria-pressed="false" data-mode>Mode: Orbit</button>
      </div>

      <div class="slab">
        <label for="density">Density</label>
        <input id="density" class="range" type="range" min="120" max="1200" value="520" aria-label="Adjust density">
      </div>
      <div class="slab">
        <label for="speed">Speed</label>
        <input id="speed" class="range" type="range" min="20" max="300" value="140" aria-label="Adjust speed">
      </div>

      <div class="meta" aria-live="polite">
        <span class="ping" aria-hidden="true"></span>
        <span>Playable poster. Tilt & drag.</span>
        <span aria-hidden="true">•</span>
        <span>Updated <span id="last-updated">Last updated: 2026-01-16 06:18:06 EST</span></span>
      </div>
    </section>

    <section class="poster" role="img" aria-label="Kinetic Bloom canvas">
      <canvas id="bloom" aria-hidden="true"></canvas>
    </section>
  </div>

  <script>
    (function(){
      const root = document.getElementById('vibe1991');
      const canvas = root.querySelector('#bloom');
      const ctx = canvas.getContext('2d');
      const stage = root.querySelector('.poster');

      // UI
      const btnPalette = root.querySelector('[data-palette]');
      const btnTheme   = root.querySelector('[data-theme]');
      const btnMode    = root.querySelector('[data-mode]');
      const densityEl  = root.querySelector('#density');
      const speedEl    = root.querySelector('#speed');
      const last       = root.querySelector('#last-updated');

      // Timestamp
      try {
        last.textContent = new Date().toLocaleString(undefined, { month:'short', day:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit', second:'2-digit' });
      } catch(e) { last.textContent = new Date().toISOString(); }

      // Palettes
      const palettes = [
        ['#6da4ff','#ff7ac3','#43f0c8'],
        ['#ffd479','#ff9ecd','#7ee0d3'],
        ['#a5b4fc','#f472b6','#34d399'],
        ['#7dd3fc','#c084fc','#22d3ee'],
        ['#fca5a5','#fdba74','#93c5fd'],
        ['#88ffd9','#64a2ff','#ffc0e9'],
        ['#8de5ff','#b8ffb9','#ffcfde']
      ];
      let pid = 0;
      function setPalette([c1,c2,c3]){
        root.style.setProperty('--a1', c1);
        root.style.setProperty('--a2', c2);
        root.style.setProperty('--a3', c3);
      }
      setPalette(palettes[pid]);

      // Theme
      function setTheme(next){
        root.setAttribute('data-theme', next);
        const isPaper = next === 'paper';
        btnTheme.setAttribute('aria-pressed', isPaper);
        btnTheme.innerHTML = isPaper ? '<span aria-hidden="true">☀</span> Paper' : '<span aria-hidden="true">☾</span> Nocturne';
      }
      btnTheme.addEventListener('click', () => {
        const next = root.getAttribute('data-theme') === 'paper' ? 'nocturne' : 'paper';
        setTheme(next);
      });

      // Mode toggle
      function setMode(m){
        root.setAttribute('data-mode', m);
        btnMode.setAttribute('aria-pressed', m === 'orbit');
        btnMode.textContent = 'Mode: ' + (m === 'orbit' ? 'Orbit' : 'Flow');
      }
      btnMode.addEventListener('click', () => {
        const next = root.getAttribute('data-mode') === 'orbit' ? 'flow' : 'orbit';
        setMode(next);
        burst(W*0.5, H*0.5, 120);
      });

      // Canvas sizing
      let W=0, H=0, DPR=1;
      function resize(){
        DPR = Math.min(2, window.devicePixelRatio || 1);
        const rect = stage.getBoundingClientRect();
        W = Math.max(320, Math.floor(rect.width));
        H = Math.max(300, Math.floor(rect.height));
        canvas.width = Math.floor(W * DPR);
        canvas.height = Math.floor(H * DPR);
        canvas.style.width = W + 'px';
        canvas.style.height = H + 'px';
        ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      }
      resize();
      let resizeRaf;
      new ResizeObserver(() => { cancelAnimationFrame(resizeRaf); resizeRaf = requestAnimationFrame(resize); }).observe(stage);

      // Field
      let particles = [];
      let targetCount = +densityEl.value;
      let timeScale = +speedEl.value;
      let running = true;

      function rand(a=0,b=1){ return a + Math.random()*(b-a); }
      function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

      function paletteAt(u){
        const c1 = getComputedStyle(root).getPropertyValue('--a1').trim();
        const c2 = getComputedStyle(root).getPropertyValue('--a2').trim();
        const c3 = getComputedStyle(root).getPropertyValue('--a3').trim();
        function lerpColor(a, b, t){
          const pa = parseInt(a.slice(1), 16);
          const pb = parseInt(b.slice(1), 16);
          const ar = (pa>>16)&255, ag = (pa>>8)&255, ab = pa&255;
          const br = (pb>>16)&255, bg = (pb>>8)&255, bb = pb&255;
          const r = Math.round(ar + (br-ar)*t);
          const g = Math.round(ag + (bg-ag)*t);
          const bl = Math.round(ab + (bb-ab)*t);
          return `rgb(${r},${g},${bl})`;
        }
        if (u < 0.5) return lerpColor(c1, c2, u*2);
        return lerpColor(c2, c3, (u-0.5)*2);
      }

      function makeParticle(){
        const u = Math.random();
        return {
          x: rand(0, W), y: rand(0, H),
          vx: 0, vy: 0,
          hueU: u,
          size: rand(0.6, 1.8),
          theta: rand(0, Math.PI*2),
          speed: rand(0.3, 1.1),
          life: rand(0.6, 1),
        };
      }

      function seed(n){
        particles.length = 0;
        for (let i=0; i<n; i++) particles.push(makeParticle());
      }

      // Interactions: lens, tilt, attractor
      let mx = W*0.5, my = H*0.5, hasPointer=false;
      function lens(x, y){
        const r = root.getBoundingClientRect();
        const px = ((x - r.left) / r.width) * 100;
        const py = ((y - r.top) / r.height) * 100;
        root.style.setProperty('--mx', px + '%');
        root.style.setProperty('--my', py + '%');
      }
      function tilt(x, y){
        const b = stage.getBoundingClientRect();
        const rx = ((y - b.top) / b.height - 0.5) * -6.5;
        const ry = ((x - b.left) / b.width - 0.5) * 8.5;
        root.style.setProperty('--rx', rx.toFixed(2) + 'deg');
        root.style.setProperty('--ry', ry.toFixed(2) + 'deg');
      }
      const follow = (ev) => {
        const x = ev.touches ? ev.touches[0].clientX : ev.clientX;
        const y = ev.touches ? ev.touches[0].clientY : ev.clientY;
        lens(x, y); tilt(x, y);
        const r = stage.getBoundingClientRect();
        mx = x - r.left; my = y - r.top;
        hasPointer = true;
      };
      root.addEventListener('mousemove', follow, { passive: true });
      root.addEventListener('touchmove', follow, { passive: true });
      root.addEventListener('mouseleave', () => { hasPointer=false; }, { passive: true });

      // Burst on click
      function burst(x, y, n=40){
        for (let i=0;i<n;i++){
          const p = makeParticle();
          p.x = x + Math.cos(i/n * Math.PI*2) * rand(0, 30);
          p.y = y + Math.sin(i/n * Math.PI*2) * rand(0, 30);
          const a = rand(0, Math.PI*2);
          const s = rand(1, 3);
          p.vx = Math.cos(a) * s;
          p.vy = Math.sin(a) * s;
          p.size = rand(1.0, 2.4);
          p.life = 1;
          particles.push(p);
        }
      }
      stage.addEventListener('click', (e) => {
        const r = stage.getBoundingClientRect();
        burst(e.clientX - r.left, e.clientY - r.top, 80);
      }, { passive: true });
      stage.addEventListener('touchstart', (e) => {
        const t = e.touches[0]; const r = stage.getBoundingClientRect();
        burst(t.clientX - r.left, t.clientY - r.top, 80);
      }, { passive: true });

      // Modes
      function fieldVec(x, y, t){
        // Smooth trigonometric flow field
        const s = 0.0026;
        const a = Math.sin((x * s) + t*0.0006) * Math.cos((y * s*1.2) - t*0.0004);
        const b = Math.cos((y * s*1.4) - t*0.0007) * Math.sin((x * s*1.1) + t*0.0005);
        return { x: a, y: b };
      }

      function orbitVec(p, t){
        // Rose curve centered in stage
        const cx = W*0.5, cy = H*0.5;
        const k = 5; // petals
        const base = Math.min(W, H)*0.35;
        p.theta += (0.0004 * timeScale) * (0.5 + p.speed);
        const r = base * (0.5 + 0.45 * Math.cos(k * p.theta));
        const tx = cx + r * Math.cos(p.theta);
        const ty = cy + r * Math.sin(p.theta);
        return { x: (tx - p.x)*0.02, y: (ty - p.y)*0.02 };
      }

      // Animation
      let t0 = performance.now();
      function draw(){
        if (!running) return;
        const now = performance.now();
        const dt = Math.min(32, now - t0);
        t0 = now;

        // Fade for trails
        ctx.globalCompositeOperation = 'source-over';
        const bg1 = getComputedStyle(root).getPropertyValue('--paper-0').trim() || '#ffffff';
        const bg2 = getComputedStyle(root).getPropertyValue('--paper-1').trim() || '#f2f6ff';
        const noct = root.getAttribute('data-theme') === 'nocturne';
        if (noct){
          ctx.globalAlpha = 0.14;
          const g = ctx.createLinearGradient(0,0,W,H);
          g.addColorStop(0, getComputedStyle(root).getPropertyValue('--noct-0').trim());
          g.addColorStop(1, getComputedStyle(root).getPropertyValue('--noct-1').trim());
          ctx.fillStyle = g;
        } else {
          ctx.globalAlpha = 0.08;
          const g = ctx.createLinearGradient(0,0,W,H);
          g.addColorStop(0, bg1);
          g.addColorStop(1, bg2);
          ctx.fillStyle = g;
        }
        ctx.fillRect(0,0,W,H);
        ctx.globalAlpha = 1;

        const mode = root.getAttribute('data-mode');

        // Add/remove to reach density
        if (particles.length < targetCount){
          for(let i=0;i<Math.min(24, targetCount - particles.length); i++) particles.push(makeParticle());
        } else if (particles.length > targetCount){
          particles.length = targetCount;
        }

        // Draw particles
        ctx.globalCompositeOperation = 'lighter';
        for (let i=0;i<particles.length; i++){
          const p = particles[i];
          let ax=0, ay=0;

          if (mode === 'orbit'){
            const v = orbitVec(p, now);
            ax += v.x; ay += v.y;
          } else {
            const v = fieldVec(p.x, p.y, now * (timeScale/140));
            ax += v.x * 2.2; ay += v.y * 2.2;
          }

          // Pointer attraction
          if (hasPointer){
            const dx = mx - p.x, dy = my - p.y;
            const d2 = dx*dx + dy*dy + 0.001;
            const pull = 120 / d2;
            ax += dx * pull; ay += dy * pull;
          }

          // Integrate
          p.vx = (p.vx + ax) * 0.96;
          p.vy = (p.vy + ay) * 0.96;
          p.x += p.vx * (dt * 0.06) * (timeScale / 140);
          p.y += p.vy * (dt * 0.06) * (timeScale / 140);

          // Wrap
          if (p.x < -10) p.x = W+10; if (p.x > W+10) p.x = -10;
          if (p.y < -10) p.y = H+10; if (p.y > H+10) p.y = -10;

          // Color + draw
          const col = paletteAt((Math.sin(p.hueU*6 + p.x*0.003 + p.y*0.003 + now*0.0004)+1)/2);
          ctx.fillStyle = col;
          ctx.shadowBlur = 40;
          ctx.shadowColor = col;
          ctx.globalAlpha = 0.6;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
          ctx.fill();
        }
        ctx.shadowBlur = 0;
        ctx.globalAlpha = 1;
        ctx.globalCompositeOperation = 'source-over';

        rafId = requestAnimationFrame(draw);
      }
      let rafId = null;
      function raf(){ cancelAnimationFrame(rafId); rafId = requestAnimationFrame(draw); }

      // Controls events
      btnPalette.addEventListener('click', () => {
        pid = (pid + 1) % palettes.length;
        setPalette(palettes[pid]);
        const cx = W*0.5, cy = H*0.5;
        burst(cx, cy, 120);
      });
      densityEl.addEventListener('input', e => { targetCount = +e.target.value || 520; });
      speedEl.addEventListener('input', e => { timeScale = +e.target.value || 140; });

      // Init
      setTheme('paper');
      setMode('orbit');
      seed(targetCount);

      // Tilt baseline
      const r = root.getBoundingClientRect();
      lens(r.left + r.width * 0.5, r.top + r.height * 0.4);

      // Start
      raf();

      // Keyboard
      root.addEventListener('keydown', (e) => {
        const k = e.key.toLowerCase();
        if (k === 't') btnTheme.click();
        if (k === 'm') btnMode.click();
        if (k === 'r') btnPalette.click();
        if (k === ' ') { e.preventDefault(); running = !running; if (running) raf(); }
      }, { passive: false });

      // Reduced motion: pause and draw a still
      try {
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
          running = false;
          cancelAnimationFrame(rafId);
          // paint a still
          ctx.clearRect(0,0,W,H);
          const g = ctx.createLinearGradient(0,0,W,H);
          const c1 = getComputedStyle(root).getPropertyValue('--a1').trim();
          const c2 = getComputedStyle(root).getPropertyValue('--a2').trim();
          const c3 = getComputedStyle(root).getPropertyValue('--a3').trim();
          g.addColorStop(0, c1); g.addColorStop(0.5, c2); g.addColorStop(1, c3);
          ctx.globalAlpha = 0.15; ctx.fillStyle = g; ctx.fillRect(0,0,W,H); ctx.globalAlpha = 1;
          for (let i=0;i<180;i++){
            const p = makeParticle();
            p.x = W*0.5 + Math.cos(i)*Math.min(W,H)*0.25;
            p.y = H*0.5 + Math.sin(i)*Math.min(W,H)*0.25;
            const col = paletteAt(Math.random());
            ctx.fillStyle = col; ctx.shadowBlur = 24; ctx.shadowColor = col;
            ctx.beginPath(); ctx.arc(p.x, p.y, p.size*1.6, 0, Math.PI*2); ctx.fill();
          }
          ctx.shadowBlur = 0;
        }
      } catch(e){/* noop */}
    })();
  </script>
</div>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


