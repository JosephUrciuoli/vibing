<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="vibe2406" data-theme="day" aria-label="Loom Lab">
  <style>
    /* Scoped to #vibe2406 */
    #vibe2406 {
      --r: 28px;

      /* Theme: Day (default) */
      --bg: hsl(210 35% 97%);
      --bg2: hsl(180 56% 96%);
      --fg: hsl(230 35% 14%);
      --muted: hsl(230 10% 36%);
      --line: hsl(230 30% 20% / 0.12);
      --p1: hsl(190 85% 45%);
      --p2: hsl(260 85% 56%);
      --p3: hsl(25 90% 55%);

      position: relative;
      isolation: isolate;
      color: var(--fg);
      background:
        radial-gradient(1200px 800px at 120% -10%, color-mix(in oklab, var(--p2) 18%, transparent), transparent 60%),
        radial-gradient(1000px 900px at -10% 120%, color-mix(in oklab, var(--p1) 20%, transparent), transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg));
      border-radius: var(--r);
      border: 1px solid var(--line);
      box-shadow: 0 40px 120px hsl(0 0% 0% / 0.16), inset 0 0 0 1px hsl(0 0% 100% / 0.75);
      min-height: 78vh;
      padding: clamp(18px, 4vw, 48px);
      font: 420 15px/1.55 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      overflow: hidden;
      container-type: inline-size;
    }

    /* Theme: Dawn */
    #vibe2406[data-theme="dawn"] {
      --bg: hsl(22 80% 96%);
      --bg2: hsl(48 90% 96%);
      --fg: hsl(24 40% 12%);
      --muted: hsl(24 20% 32%);
      --line: hsl(24 50% 20% / 0.14);
      --p1: hsl(12 90% 60%);
      --p2: hsl(340 80% 58%);
      --p3: hsl(46 90% 55%);
      background:
        radial-gradient(1200px 800px at 120% -10%, color-mix(in oklab, var(--p2) 18%, transparent), transparent 60%),
        radial-gradient(1000px 900px at -10% 120%, color-mix(in oklab, var(--p3) 22%, transparent), transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg));
    }

    /* Theme: Nocturne */
    #vibe2406[data-theme="night"] {
      --bg: hsl(230 45% 8%);
      --bg2: hsl(240 40% 12%);
      --fg: hsl(0 0% 98%);
      --muted: hsl(0 0% 85% / 0.8);
      --line: hsl(0 0% 100% / 0.16);
      --p1: hsl(192 90% 62%);
      --p2: hsl(268 86% 64%);
      --p3: hsl(20 92% 60%);
      background:
        radial-gradient(1200px 800px at 120% -10%, color-mix(in oklab, var(--p2) 30%, transparent), transparent 60%),
        radial-gradient(1000px 900px at -10% 120%, color-mix(in oklab, var(--p1) 28%, transparent), transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg));
      box-shadow: 0 40px 120px hsl(0 0% 0% / 0.6), inset 0 0 0 1px hsl(0 0% 100% / 0.06);
    }

    /* Ambient veils */
    #vibe2406::before, #vibe2406::after {
      content: "";
      position: absolute; inset: -20%;
      filter: blur(60px) saturate(130%);
      mix-blend-mode: screen;
      opacity: 0.45;
      pointer-events: none;
      z-index: 0;
    }
    #vibe2406::before {
      background:
        conic-gradient(from 10deg at 30% 60%, var(--p1), transparent 65%),
        conic-gradient(from -30deg at 70% 40%, var(--p2), transparent 65%);
      animation: v2406-wash-a 26s ease-in-out infinite alternate;
    }
    #vibe2406::after {
      background: conic-gradient(from 120deg at 50% 45%, var(--p3), transparent 70%);
      animation: v2406-wash-b 32s ease-in-out infinite alternate-reverse;
    }

    /* Grain + grid */
    #vibe2406 .grain {
      position: absolute; inset: 0; z-index: 1; pointer-events: none;
      background:
        radial-gradient(140% 80% at 50% 0%, hsl(0 0% 100% / 0.5), transparent 60%) top center / 100% 100% no-repeat,
        repeating-linear-gradient(0deg, hsl(0 0% 100% / 0.02) 0 1px, transparent 1px 34px),
        repeating-linear-gradient(90deg, hsl(0 0% 0% / 0.03) 0 1px, transparent 1px 34px);
      mask: radial-gradient(120% 100% at 50% 20%, black, transparent);
    }

    /* Top bar */
    #vibe2406 .top {
      position: relative; z-index: 3;
      display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 12px;
      margin-bottom: clamp(12px, 3.6vw, 26px);
    }
    #vibe2406 .brand {
      display: inline-grid; grid-auto-flow: column; place-items: center; gap: 12px;
      padding: 10px 14px; border-radius: 14px; border: 1px solid var(--line);
      background: hsl(0 0% 100% / 0.75);
      backdrop-filter: blur(8px) saturate(160%);
      color: var(--fg); font-weight: 900; letter-spacing: 0.08em; text-transform: uppercase; font-size: 12px;
    }
    #vibe2406[data-theme="night"] .brand { background: hsl(0 0% 100% / 0.08); }

    #vibe2406 .loom {
      width: 22px; height: 18px; position: relative; display: inline-block;
      filter: drop-shadow(0 1px 0 hsl(0 0% 0% / 0.15));
    }
    #vibe2406 .loom::before, #vibe2406 .loom::after {
      content:""; position:absolute; inset:0; border-radius:4px;
      background: linear-gradient(90deg, var(--p1), var(--p2), var(--p3));
      mask:
        linear-gradient(#000 0 0) top/100% 24% no-repeat,
        linear-gradient(#000 0 0) 50% 38%/100% 24% no-repeat,
        linear-gradient(#000 0 0) bottom/100% 24% no-repeat;
    }
    #vibe2406 .loom::after{ transform: translateY(1px) scaleY(0.9); opacity:0.75; filter: blur(0.5px); }

    #vibe2406 .ctrls { display: inline-flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    #vibe2406 .seg {
      display: inline-flex; gap: 2px; padding: 4px; border-radius: 999px;
      border: 1px solid var(--line);
      background: hsl(0 0% 100% / 0.75);
      backdrop-filter: blur(8px) saturate(160%);
    }
    #vibe2406[data-theme="night"] .seg { background: hsl(0 0% 100% / 0.08); }

    #vibe2406 .seg button {
      appearance: none; border: 0; background: transparent; color: var(--fg);
      padding: 8px 12px; border-radius: 999px; font-weight: 800; font-size: 12px; cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;
    }
    #vibe2406 .seg button[aria-pressed="true"] {
      color: white;
      background: linear-gradient(90deg, var(--p1), var(--p2), var(--p3));
      text-shadow: 0 1px 0 hsl(0 0% 0% / 0.25);
    }

    #vibe2406 .knob {
      display: inline-grid; grid-template-columns: auto 1fr; align-items: center; gap: 8px;
      padding: 8px 10px; border: 1px solid var(--line); border-radius: 12px;
      background: hsl(0 0% 100% / 0.75); font-size: 12px; color: var(--muted);
      backdrop-filter: blur(8px) saturate(160%);
    }
    #vibe2406[data-theme="night"] .knob { background: hsl(0 0% 100% / 0.08); color: var(--fg); }

    #vibe2406 input[type="range"] {
      -webkit-appearance: none; appearance: none;
      width: 140px; height: 10px; border-radius: 999px;
      background: linear-gradient(90deg, var(--p1), var(--p2), var(--p3));
      border: 1px solid hsl(0 0% 100% / 0.35);
      box-shadow: inset 0 1px 0 hsl(0 0% 100% / 0.45), 0 2px 9px hsl(0 0% 0% / 0.2);
      outline: none; cursor: pointer;
    }
    #vibe2406 input[type="range"]::-webkit-slider-thumb,
    #vibe2406 input[type="range"]::-moz-range-thumb {
      -webkit-appearance: none; appearance: none;
      width: 18px; height: 18px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, hsl(0 0% 100%), hsl(0 0% 92%));
      border: 1px solid hsl(0 0% 100% / 0.65);
      box-shadow: 0 2px 8px hsl(0 0% 0% / 0.35), 0 0 0 6px color-mix(in oklab, var(--p2) 30%, transparent);
    }

    /* Hero: Loom */
    #vibe2406 .hero {
      position: relative; z-index: 2;
      width: min(1200px, 100cqi); aspect-ratio: 16/9;
      border-radius: calc(var(--r) + 12px);
      border: 1px solid var(--line);
      overflow: hidden;
      background: linear-gradient(180deg, hsl(0 0% 100% / 0.86), hsl(0 0% 100% / 0.66));
      backdrop-filter: blur(12px) saturate(160%);
      box-shadow: 0 34px 96px hsl(0 0% 0% / 0.2), inset 0 0 0 1px hsl(0 0% 100% / 0.6);
      display: grid; place-items: center;
    }
    #vibe2406[data-theme="night"] .hero {
      background: linear-gradient(180deg, hsl(0 0% 100% / 0.06), hsl(0 0% 100% / 0.03));
      box-shadow: 0 34px 96px hsl(0 0% 0% / 0.5), inset 0 0 0 1px hsl(0 0% 100% / 0.08);
    }

    /* Dot overlay */
    #vibe2406 .dotgrid {
      position: absolute; inset: 0; z-index: 0; pointer-events: none; opacity: 0.15;
      background:
        radial-gradient(circle at 50% 50%, transparent 0 6%, hsl(0 0% 0% / 0.04) 6.2% 6.6%, transparent 6.8% 12%),
        radial-gradient(circle at 50% 50%, transparent 0 12%, hsl(0 0% 0% / 0.04) 12.2% 12.6%, transparent 12.8% 18%),
        radial-gradient(circle at 50% 50%, transparent 0 18%, hsl(0 0% 0% / 0.04) 18.2% 18.6%, transparent 18.8% 24%);
      mask: radial-gradient(90% 90% at 50% 50%, black, transparent);
    }
    #vibe2406[data-theme="night"] .dotgrid { opacity: 0.35; background:
      radial-gradient(circle at 50% 50%, transparent 0 6%, hsl(0 0% 100% / 0.05) 6.2% 6.6%, transparent 6.8% 12%),
      radial-gradient(circle at 50% 50%, transparent 0 12%, hsl(0 0% 100% / 0.05) 12.2% 12.6%, transparent 12.8% 18%),
      radial-gradient(circle at 50% 50%, transparent 0 18%, hsl(0 0% 100% / 0.05) 18.2% 18.6%, transparent 18.8% 24%);
    }

    #vibe2406 .loom-canvas { position: absolute; inset: 0; width: 100%; height: 100%; display: block; z-index: 1; mix-blend-mode: multiply; }
    #vibe2406[data-theme="night"] .loom-canvas { mix-blend-mode: screen; }

    #vibe2406 .overlay {
      position: relative; z-index: 2; text-align: center; padding: clamp(10px, 5vw, 40px);
      display: grid; gap: 10px; place-items: center;
    }
    #vibe2406 .t {
      margin: 0;
      font-family: ui-serif, Georgia, "Times New Roman", serif;
      font-size: clamp(34px, 9.5cqi, 108px);
      line-height: 0.92; letter-spacing: -0.02em; font-weight: 900;
      background: linear-gradient(90deg, var(--p1), var(--p2), var(--p3));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-shadow: 0 1px 0 hsl(0 0% 0% / 0.16);
      animation: v2406-sheen 9s ease-in-out infinite;
    }
    #vibe2406[data-theme="night"] .t { text-shadow: 0 1px 0 hsl(0 0% 100% / 0.18); }
    #vibe2406 .s { margin: 0; font-size: clamp(13px, 2.6cqi, 22px); color: var(--muted); text-wrap: pretty; }

    /* Ribbon marquee */
    #vibe2406 .marquee {
      position: relative; z-index: 2;
      width: 100%; overflow: hidden;
      border-radius: 12px; border: 1px solid var(--line);
      background: hsl(0 0% 100% / 0.75);
      backdrop-filter: blur(6px) saturate(160%);
      margin-top: clamp(14px, 3.2vw, 26px);
    }
    #vibe2406[data-theme="night"] .marquee { background: hsl(0 0% 100% / 0.08); }
    #vibe2406 .marquee .row {
      display: flex; gap: 20px; align-items: center; white-space: nowrap;
      padding: 10px 12px; font-weight: 800; font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase; color: var(--fg);
      animation: v2406-slide 24s linear infinite;
    }
    #vibe2406 .chip {
      display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px;
      border-radius: 999px; border: 1px solid var(--line);
      background: linear-gradient(90deg, var(--p1), var(--p2), var(--p3));
      color: white; text-shadow: 0 1px 0 hsl(0 0% 0% / 0.25);
    }
    #vibe2406 .dot { width: 8px; height: 8px; border-radius: 50%; background: white; }

    /* Footer */
    #vibe2406 .foot {
      position: relative; z-index: 2; display: grid; place-items: center; text-align: center;
      margin-top: clamp(18px, 4vw, 36px); gap: 10px; color: var(--muted);
    }
    #vibe2406 .foot small {
      font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase;
      border: 1px solid var(--line); padding: 8px 12px; border-radius: 10px; background: hsl(0 0% 100% / 0.75);
    }
    #vibe2406[data-theme="night"] .foot small { background: hsl(0 0% 100% / 0.08); color: var(--fg); }

    /* Keyframes */
    @keyframes v2406-wash-a {
      0% { transform: translate3d(-2%, -3%, 0) rotate(0deg) scale(1); }
      50% { transform: translate3d(2%, 2%, 0) rotate(18deg) scale(1.06); }
      100% { transform: translate3d(-2%, 3%, 0) rotate(26deg) scale(1.02); }
    }
    @keyframes v2406-wash-b {
      0% { transform: translate3d(2%, 1%, 0) rotate(0deg) scale(1.02); }
      50% { transform: translate3d(-2%, -1%, 0) rotate(-12deg) scale(1.09); }
      100% { transform: translate3d(1%, -2%, 0) rotate(-26deg) scale(1.02); }
    }
    @keyframes v2406-sheen {
      0%, 100% { filter: drop-shadow(0 2px 0 hsl(0 0% 0% / 0.12)); }
      50% { filter: drop-shadow(0 6px 12px color-mix(in oklab, var(--p2) 35%, transparent)); }
    }
    @keyframes v2406-slide {
      from { transform: translateX(0); }
      to { transform: translateX(-50%); }
    }

    /* Reduced motion */
    #vibe2406.reduce-motion::before,
    #vibe2406.reduce-motion::after { animation: none !important; }
    #vibe2406.reduce-motion .t { animation: none !important; }
    #vibe2406.reduce-motion .marquee .row { animation-duration: 0s; }
  </style>

  <div class="grain" aria-hidden="true"></div>

  <div class="top">
    <div class="brand" aria-label="Loom Lab">
      <i class="loom" aria-hidden="true"></i>
      <span>Loom Lab</span>
    </div>

    <div class="ctrls" role="group" aria-label="Appearance and motion controls">
      <div class="seg" role="tablist" aria-label="Theme">
        <button class="theme" data-theme="day" aria-pressed="true" role="tab">Day</button>
        <button class="theme" data-theme="dawn" aria-pressed="false" role="tab">Dawn</button>
        <button class="theme" data-theme="night" aria-pressed="false" role="tab">Night</button>
      </div>

      <label class="knob" for="breathe">
        Breathe
        <input id="breathe" type="range" min="0.2" max="2.5" step="0.1" value="1.0" aria-label="Adjust weave speed">
      </label>

      <label class="knob" for="weave">
        Weave
        <input id="weave" type="range" min="14" max="160" step="2" value="64" aria-label="Adjust thread density">
      </label>

      <label class="knob" for="depth">
        Depth
        <input id="depth" type="range" min="0" max="1.6" step="0.1" value="0.8" aria-label="Adjust glow depth">
      </label>
    </div>
  </div>

  <div class="hero" tabindex="0" aria-label="Interactive loom canvas">
    <div class="dotgrid" aria-hidden="true"></div>
    <canvas class="loom-canvas" aria-hidden="true"></canvas>
    <div class="overlay" aria-hidden="true">
      <h1 class="t">Weave ideas, not walls.</h1>
      <p class="s">Threads that breathe with your cursor. Click to pin a ripple.</p>
    </div>
  </div>

  <div class="marquee" aria-hidden="true">
    <div class="row">
      <span class="chip"><i class="dot"></i> Tactile</span>
      <span>Soft systems</span>
      <span class="chip"><i class="dot"></i> Calm</span>
      <span>Clarity by design</span>
      <span class="chip"><i class="dot"></i> Play</span>
      <span>Delight without demand</span>
      <span class="chip"><i class="dot"></i> Care</span>
      <span>Accessible by default</span>
      <!-- loop -->
      <span class="chip"><i class="dot"></i> Tactile</span>
      <span>Soft systems</span>
      <span class="chip"><i class="dot"></i> Calm</span>
      <span>Clarity by design</span>
      <span class="chip"><i class="dot"></i> Play</span>
      <span>Delight without demand</span>
      <span class="chip"><i class="dot"></i> Care</span>
      <span>Accessible by default</span>
    </div>
  </div>

  <div class="foot">
    <small>Design that feels like fabric.</small>
    <span id="last-updated">Last updated: 2026-02-05 06:33:42 EST</span>
  </div>

  <script>
    (function () {
      const root = document.getElementById('vibe2406');
      const hero = root.querySelector('.hero');
      const cvs = root.querySelector('.loom-canvas');
      const ctx = cvs.getContext('2d', { alpha: true });
      const themes = Array.from(root.querySelectorAll('.theme'));
      const breathe = root.querySelector('#breathe');
      const weave = root.querySelector('#weave');
      const depth = root.querySelector('#depth');
      const stamp = root.querySelector('#last-updated');

      // Stamp
      try {
        const now = new Date();
        const fmt = new Intl.DateTimeFormat(undefined, { dateStyle: 'medium', timeStyle: 'medium' });
        stamp.textContent = 'Last updated: ' + fmt.format(now);
      } catch {
        stamp.textContent = 'Last updated: just now';
      }

      // Reduced motion
      const prefersReduce = window.matchMedia ? matchMedia('(prefers-reduced-motion: reduce)') : null;
      const applyReduce = on => root.classList.toggle('reduce-motion', !!on);
      if (prefersReduce) {
        applyReduce(prefersReduce.matches);
        prefersReduce.addEventListener('change', e => applyReduce(e.matches));
      }

      // Theme switching
      const applyTheme = (m) => {
        root.setAttribute('data-theme', m);
        themes.forEach(b => b.setAttribute('aria-pressed', b.dataset.theme === m ? 'true' : 'false'));
        readPalette();
        resize();
        seed();
        start();
      };
      themes.forEach(btn => btn.addEventListener('click', () => applyTheme(btn.dataset.theme)));

      // Canvas setup
      const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      let raf, W = 0, H = 0, T0 = 0, lastT = 0;
      const state = {
        speed: parseFloat(breathe.value),
        count: parseInt(weave.value, 10),
        glow: parseFloat(depth.value),
        t: 0
      };
      const palette = { p1: '#fff', p2: '#fff', p3: '#fff', fg: '#000', theme: 'day' };

      const readPalette = () => {
        const s = getComputedStyle(root);
        palette.p1 = s.getPropertyValue('--p1').trim();
        palette.p2 = s.getPropertyValue('--p2').trim();
        palette.p3 = s.getPropertyValue('--p3').trim();
        palette.fg = s.getPropertyValue('--fg').trim();
        palette.theme = root.getAttribute('data-theme');
      };

      const resize = () => {
        const r = hero.getBoundingClientRect();
        W = Math.floor(r.width);
        H = Math.floor(r.height);
        cvs.width = Math.floor(W * DPR);
        cvs.height = Math.floor(H * DPR);
        cvs.style.width = W + 'px';
        cvs.style.height = H + 'px';
        ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      };

      // Threads
      let threads = [];
      const rand = (min, max) => min + Math.random() * (max - min);

      const gradient = () => {
        const g = ctx.createLinearGradient(0, 0, W, 0);
        g.addColorStop(0, palette.p1);
        g.addColorStop(0.5, palette.p2);
        g.addColorStop(1, palette.p3);
        return g;
      };

      const seed = () => {
        const pad = 36;
        threads = [];
        for (let i = 0; i < state.count; i++) {
          const y = pad + (i / Math.max(1, state.count - 1)) * (H - pad * 2);
          threads.push({
            y,
            base: y,
            amp: rand(8, 34),
            freq: rand(0.004, 0.016),
            phase: rand(0, Math.PI * 2),
            jitter: rand(0.2, 0.8)
          });
        }
        ctx.clearRect(0, 0, W, H);
      };

      // Pins
      let pins = [];
      const spawnPin = (x, y) => {
        pins.push({ x, y, strength: rand(14, 26), life: 200 + Math.floor(Math.random() * 140) });
      };

      hero.addEventListener('pointerdown', (e) => {
        const r = hero.getBoundingClientRect();
        spawnPin(e.clientX - r.left, e.clientY - r.top);
      });

      // Pointer influence
      const pointer = { x: W / 2, y: H / 2, inside: false };
      hero.addEventListener('pointerenter', () => pointer.inside = true);
      hero.addEventListener('pointerleave', () => { pointer.inside = false; pointer.x = W / 2; pointer.y = H / 2; });
      hero.addEventListener('pointermove', (e) => {
        const r = hero.getBoundingClientRect();
        pointer.x = e.clientX - r.left;
        pointer.y = e.clientY - r.top;
      });

      // Draw
      const step = (tms) => {
        if (root.classList.contains('reduce-motion')) {
          drawStatic();
          return;
        }

        if (!T0) T0 = tms, lastT = tms;
        const t = (tms - T0) * 0.001;
        let dt = Math.min(0.05, (tms - lastT) * 0.001);
        lastT = tms;
        state.t = t;

        // Clear
        if (palette.theme === 'night') {
          ctx.fillStyle = 'rgba(0,0,0,0.14)';
        } else {
          ctx.fillStyle = 'rgba(255,255,255,0.14)';
        }
        ctx.fillRect(0, 0, W, H);

        // Shadow/glow
        ctx.shadowColor = palette.p2;
        ctx.shadowBlur = 8 * state.glow;

        // Stroke
        const g = gradient();
        ctx.strokeStyle = g;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        // Update pins
        for (let i = pins.length - 1; i >= 0; i--) {
          const p = pins[i];
          p.life -= 1;
          p.strength *= 0.996;
          if (p.life <= 0 || p.strength < 1) pins.splice(i, 1);
        }

        // Draw threads
        for (let i = 0; i < threads.length; i++) {
          const th = threads[i];
          const stripe = 0.6 + 0.8 * Math.sin((i * 0.08) + t * 0.6);
          ctx.globalAlpha = 0.35 + 0.45 * (1 - Math.abs(0.5 - (i / threads.length))) + 0.1 * stripe;
          ctx.lineWidth = 0.6 + 1.2 * Math.sin((i * 0.1) + t * 1.2);

          ctx.beginPath();
          let first = true;

          // Walk horizontally
          for (let x = 0; x <= W; x += 6) {
            // Base sine motion
            const s = Math.sin((x * th.freq) + (t * state.speed * (1.6 + th.jitter)) + th.phase) * th.amp;

            // Pointer and pins influence (gaussian bumps)
            let bump = 0;
            if (pointer.inside) {
              const dx = x - pointer.x;
              const dy = th.base - pointer.y;
              const d2 = dx * dx + dy * dy + 1;
              bump += 120 * Math.exp(-d2 / 3600) * (palette.theme === 'night' ? 1.1 : 0.9);
            }
            for (let k = 0; k < pins.length; k++) {
              const p = pins[k];
              const dxp = x - p.x;
              const dyp = th.base - p.y;
              const d2p = dxp * dxp + dyp * dyp + 1;
              bump += p.strength * Math.exp(-d2p / 2600);
            }

            const y = th.base + s + bump;
            if (first) { ctx.moveTo(x, y); first = false; }
            else { ctx.lineTo(x, y); }
          }

          ctx.stroke();
        }

        raf = requestAnimationFrame(step);
      };

      const drawStatic = () => {
        ctx.clearRect(0, 0, W, H);
        ctx.shadowColor = palette.p2;
        ctx.shadowBlur = 6 * state.glow;
        const g = gradient();
        ctx.strokeStyle = g;
        ctx.globalAlpha = 0.85;
        ctx.lineWidth = 1;

        const samples = Math.min(24, threads.length);
        for (let i = 0; i < samples; i++) {
          const th = threads[Math.floor(i * (threads.length - 1) / Math.max(1, samples - 1))];
          ctx.beginPath();
          let first = true;
          for (let x = 0; x <= W; x += 8) {
            const y = th.base + Math.sin(x * th.freq + th.phase) * th.amp * 0.6;
            if (first) { ctx.moveTo(x, y); first = false; } else { ctx.lineTo(x, y); }
          }
          ctx.stroke();
        }
      };

      const start = () => {
        cancelAnimationFrame(raf);
        raf = requestAnimationFrame(step);
      };

      // Controls
      breathe.addEventListener('input', e => { state.speed = parseFloat(e.target.value); });
      weave.addEventListener('input', e => { state.count = parseInt(e.target.value, 10); seed(); });
      depth.addEventListener('input', e => { state.glow = parseFloat(e.target.value); });

      // Resize observer
      const ro = new ResizeObserver(() => { resize(); seed(); start(); });
      ro.observe(hero);

      // Init
      readPalette();
      resize();
      seed();
      start();

      // Cleanup if removed
      root.addEventListener('DOMNodeRemoved', () => { cancelAnimationFrame(raf); ro.disconnect(); });

      // Accessibility: keyboard pin
      hero.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          spawnPin(W / 2, H / 2);
        }
      });
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


