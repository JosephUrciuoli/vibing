<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section id="vibe2404" data-mode="dusk" aria-label="Kinetic Garden">
  <style>
    /* Scoped to #vibe2404 only */
    #vibe2404 {
      --r: 24px;

      /* Palette: Dusk (default) */
      --bg: hsl(248 27% 8%);
      --fg: hsl(0 0% 96%);
      --muted: hsl(0 0% 80% / 0.8);
      --line: hsl(0 0% 100% / 0.12);
      --a1: hsl(210 100% 70%);
      --a2: hsl(280 85% 68%);
      --a3: hsl(340 86% 62%);

      position: relative;
      isolation: isolate;
      color: var(--fg);
      background:
        radial-gradient(1200px 840px at 120% -20%, hsl(280 70% 25% / 0.45), transparent 60%),
        radial-gradient(900px 700px at -20% 120%, hsl(210 70% 25% / 0.45), transparent 60%),
        var(--bg);
      border-radius: var(--r);
      border: 1px solid var(--line);
      box-shadow: 0 30px 80px hsl(0 0% 0% / 0.55), inset 0 0 0 1px hsl(0 0% 100% / 0.06);
      min-height: 74vh;
      padding: clamp(18px, 3.6vw, 46px);
      font: 400 15px/1.55 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      overflow: hidden;
      container-type: inline-size;
    }

    /* Dawn */
    #vibe2404[data-mode="dawn"] {
      --bg: hsl(38 60% 97%);
      --fg: hsl(234 24% 15%);
      --muted: hsl(234 12% 40% / 0.85);
      --line: hsl(234 12% 28% / 0.16);
      --a1: hsl(18 90% 62%);
      --a2: hsl(44 92% 56%);
      --a3: hsl(188 75% 52%);
      background:
        radial-gradient(1200px 840px at -20% -20%, hsl(44 82% 80% / 0.60), transparent 60%),
        radial-gradient(1000px 760px at 120% 120%, hsl(188 70% 80% / 0.50), transparent 60%),
        var(--bg);
      box-shadow: 0 24px 64px hsl(234 50% 10% / 0.18), inset 0 0 0 1px hsl(0 0% 100% / 0.6);
    }

    /* Prism (vivid) */
    #vibe2404[data-mode="prism"] {
      --bg: hsl(260 55% 11%);
      --fg: hsl(0 0% 98%);
      --muted: hsl(0 0% 90% / 0.85);
      --line: hsl(0 0% 100% / 0.14);
      --a1: hsl(196 92% 52%);
      --a2: hsl(286 86% 64%);
      --a3: hsl(16 90% 62%);
      background:
        conic-gradient(from 120deg at 10% 10%, hsl(196 80% 20% / 0.55), transparent 30%),
        conic-gradient(from -40deg at 110% 80%, hsl(16 80% 24% / 0.55), transparent 40%),
        var(--bg);
    }

    /* Ambient veils */
    #vibe2404::before,
    #vibe2404::after {
      content: "";
      position: absolute; inset: -35%;
      filter: blur(60px) saturate(130%);
      mix-blend-mode: screen;
      opacity: 0.6;
      pointer-events: none;
      z-index: 0;
    }
    #vibe2404::before {
      background:
        conic-gradient(from 30deg at 30% 70%, var(--a1), transparent 60%),
        conic-gradient(from -60deg at 70% 30%, var(--a2), transparent 60%);
      animation: v2404-wash-a var(--veil-a, 26s) ease-in-out infinite alternate;
    }
    #vibe2404::after {
      background: conic-gradient(from 120deg at 50% 40%, var(--a3), transparent 60%);
      animation: v2404-wash-b var(--veil-b, 34s) ease-in-out infinite alternate-reverse;
    }

    #vibe2404 .grain {
      position: absolute; inset: 0; z-index: 1; pointer-events: none;
      background:
        repeating-linear-gradient(0deg, hsl(0 0% 100% / 0.02) 0 1px, transparent 1px 36px),
        repeating-linear-gradient(90deg, hsl(0 0% 0% / 0.03) 0 1px, transparent 1px 36px);
      mask: radial-gradient(110% 90% at 50% 30%, black, transparent);
    }

    /* Top bar */
    #vibe2404 .top {
      position: relative; z-index: 3;
      display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 12px;
      margin-bottom: clamp(12px, 3.4vw, 28px);
    }
    #vibe2404 .brand {
      display: inline-grid; grid-auto-flow: column; align-items: center; gap: 12px;
      padding: 10px 14px; border-radius: 999px; border: 1px solid var(--line);
      background: hsl(0 0% 100% / 0.06);
      backdrop-filter: blur(8px) saturate(160%);
      color: var(--fg); font-weight: 900; letter-spacing: 0.08em; text-transform: uppercase; font-size: 12px;
    }
    #vibe2404[data-mode="dawn"] .brand { background: hsl(0 0% 100% / 0.76); }
    #vibe2404 .brand .sig {
      width: 18px; height: 18px; border-radius: 50%;
      background:
        radial-gradient(circle at 30% 30%, white 0 30%, transparent 30%),
        conic-gradient(var(--a1), var(--a2), var(--a3), var(--a1));
      box-shadow: inset 0 0 0 1px hsl(0 0% 100% / 0.5), 0 0 0 6px hsl(0 0% 0% / 0.08);
    }

    #vibe2404 .ctrls { display: inline-flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    #vibe2404 .seg {
      display: inline-flex; gap: 2px; padding: 4px; border-radius: 999px;
      border: 1px solid var(--line);
      background: hsl(0 0% 100% / 0.06);
      backdrop-filter: blur(8px) saturate(160%);
    }
    #vibe2404[data-mode="dawn"] .seg { background: hsl(0 0% 100% / 0.72); }
    #vibe2404 .seg button {
      appearance: none; border: 0; background: transparent; color: var(--fg);
      padding: 8px 12px; border-radius: 999px; font-weight: 800; font-size: 12px; cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;
    }
    #vibe2404 .seg button[aria-pressed="true"] {
      color: white;
      background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3));
      text-shadow: 0 1px 0 hsl(0 0% 0% / 0.25);
    }
    #vibe2404 .knob {
      display: inline-grid; grid-template-columns: auto 1fr; align-items: center; gap: 8px;
      padding: 8px 10px; border: 1px solid var(--line); border-radius: 12px;
      background: hsl(0 0% 100% / 0.06); font-size: 12px; color: var(--muted);
      backdrop-filter: blur(8px) saturate(160%);
    }
    #vibe2404[data-mode="dawn"] .knob { background: hsl(0 0% 100% / 0.74); }

    #vibe2404 input[type="range"] {
      -webkit-appearance: none; appearance: none;
      width: 140px; height: 10px; border-radius: 999px;
      background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3));
      border: 1px solid hsl(0 0% 100% / 0.35);
      box-shadow: inset 0 1px 0 hsl(0 0% 100% / 0.5), 0 2px 9px hsl(0 0% 0% / 0.2);
      outline: none; cursor: pointer;
    }
    #vibe2404 input[type="range"]::-webkit-slider-thumb,
    #vibe2404 input[type="range"]::-moz-range-thumb {
      -webkit-appearance: none; appearance: none;
      width: 18px; height: 18px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, hsl(0 0% 100%), hsl(0 0% 90%));
      border: 1px solid hsl(0 0% 100% / 0.65);
      box-shadow: 0 2px 8px hsl(0 0% 0% / 0.35), 0 0 0 6px color-mix(in oklab, var(--a3) 30%, transparent);
    }

    /* Hero frame */
    #vibe2404 .hero {
      --rx: 0deg; --ry: 0deg;
      position: relative; z-index: 2;
      width: min(1100px, 100cqi); aspect-ratio: 21/9;
      border-radius: calc(var(--r) + 10px);
      border: 1px solid var(--line);
      overflow: hidden;
      background: linear-gradient(180deg, hsl(0 0% 100% / 0.07), hsl(0 0% 100% / 0.03));
      backdrop-filter: blur(18px) saturate(160%);
      box-shadow: 0 28px 84px hsl(0 0% 0% / 0.45), inset 0 0 0 1px hsl(0 0% 100% / 0.08);
      transform: perspective(1000px) rotateX(var(--rx)) rotateY(var(--ry));
      display: grid; place-items: center;
    }
    #vibe2404[data-mode="dawn"] .hero {
      background: linear-gradient(180deg, hsl(0 0% 100% / 0.85), hsl(0 0% 100% / 0.62));
      box-shadow: 0 28px 84px hsl(234 50% 10% / 0.18), inset 0 0 0 1px hsl(0 0% 100% / 0.6);
    }
    #vibe2404 .flow { position: absolute; inset: 0; width: 100%; height: 100%; display: block; mix-blend-mode: lighten; }

    #vibe2404 .overlay {
      position: relative; z-index: 1; text-align: center; padding: clamp(10px, 5vw, 40px);
      display: grid; gap: 10px; place-items: center;
    }
    #vibe2404 .t {
      margin: 0;
      font-family: ui-serif, Georgia, "Times New Roman", serif;
      font-size: clamp(36px, 10cqi, 112px);
      line-height: 0.94; letter-spacing: -0.02em; font-weight: 900;
      background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-shadow: 0 1px 0 hsl(0 0% 0% / 0.42);
    }
    #vibe2404[data-mode="dawn"] .t { text-shadow: 0 1px 0 hsl(0 0% 100% / 0.32); }
    #vibe2404 .s { margin: 0; font-size: clamp(13px, 2.6cqi, 22px); color: var(--muted); text-wrap: pretty; }

    /* Chips */
    #vibe2404 .chips {
      list-style: none; padding: 0; margin: clamp(10px, 3.4vw, 24px) 0 0;
      display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
    }
    #vibe2404 .chip {
      display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px;
      border-radius: 999px; border: 1px solid var(--line);
      background: hsl(0 0% 100% / 0.06); color: var(--fg);
      font-weight: 700; font-size: 12px; transition: transform 0.2s ease, background 0.2s ease;
    }
    #vibe2404[data-mode="dawn"] .chip { background: hsl(0 0% 100% / 0.72); }
    #vibe2404 .chip::before {
      content: ""; width: 8px; height: 8px; border-radius: 50%;
      background: radial-gradient(circle at 40% 40%, var(--a1), var(--a2));
      box-shadow: 0 0 10px color-mix(in oklab, var(--a2) 70%, transparent);
    }
    #vibe2404 .chip:hover { transform: translateY(-1px) scale(1.02); background: hsl(0 0% 100% / 0.1); }
    #vibe2404[data-mode="dawn"] .chip:hover { background: hsl(0 0% 100% / 0.9); }

    /* Tiles */
    #vibe2404 .tiles {
      position: relative; z-index: 2;
      display: grid; grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: clamp(12px, 2.6vw, 22px);
      width: min(1100px, 100cqi);
      margin-top: clamp(16px, 4vw, 36px);
    }
    @container (max-width: 980px) { #vibe2404 .tiles { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    @container (max-width: 560px) { #vibe2404 .tiles { grid-template-columns: 1fr; } }

    #vibe2404 .tile {
      --crx: 0deg; --cry: 0deg;
      position: relative; overflow: hidden;
      border-radius: calc(var(--r) - 8px);
      border: 1px solid var(--line);
      background: linear-gradient(180deg, hsl(0 0% 100% / 0.07), hsl(0 0% 100% / 0.03));
      padding: 16px; min-height: 130px; display: grid; align-content: space-between;
      box-shadow: 0 12px 30px hsl(0 0% 0% / 0.18), inset 0 0 0 1px hsl(0 0% 100% / 0.06);
      transform: perspective(600px) rotateX(var(--crx)) rotateY(var(--cry));
      transition: transform 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
    }
    #vibe2404[data-mode="dawn"] .tile { background: linear-gradient(180deg, hsl(0 0% 100% / 0.8), hsl(0 0% 100% / 0.62)); }
    #vibe2404 .tile h3 { margin: 0 0 8px; font-size: 15px; letter-spacing: 0.02em; }
    #vibe2404 .tile p { margin: 0; font-size: 13px; color: var(--muted); }
    #vibe2404 .halo {
      position: absolute; inset: -30% -10% auto auto; height: 140%;
      background: conic-gradient(from 70deg, var(--a1), var(--a2), var(--a3), transparent 70%);
      filter: blur(30px) saturate(130%); opacity: 0.35; mix-blend-mode: plus-lighter; pointer-events: none;
      transform: translateZ(0);
    }
    #vibe2404 .tile:hover { box-shadow: 0 18px 40px color-mix(in oklab, var(--a3) 28%, hsl(0 0% 0% / 0.28)); }

    /* Footer */
    #vibe2404 .foot {
      position: relative; z-index: 2; display: grid; place-items: center; text-align: center;
      margin-top: clamp(16px, 4vw, 36px); gap: 10px; color: var(--muted);
    }
    #vibe2404 .foot small {
      font-size: 12px; letter-spacing: 0.06em; text-transform: uppercase;
      border: 1px solid var(--line); padding: 8px 12px; border-radius: 10px; background: hsl(0 0% 100% / 0.08);
    }
    #vibe2404[data-mode="dawn"] .foot small { background: hsl(0 0% 100% / 0.64); }

    /* Keyframes */
    @keyframes v2404-wash-a {
      0% { transform: translate3d(-1%, -2%, 0) rotate(0deg) scale(1); }
      50% { transform: translate3d(1%, 2%, 0) rotate(14deg) scale(1.06); }
      100% { transform: translate3d(-2%, 2%, 0) rotate(22deg) scale(1.01); }
    }
    @keyframes v2404-wash-b {
      0% { transform: translate3d(2%, 1%, 0) rotate(0deg) scale(1.02); }
      50% { transform: translate3d(-2%, -1%, 0) rotate(-10deg) scale(1.09); }
      100% { transform: translate3d(1%, -2%, 0) rotate(-22deg) scale(1.02); }
    }

    /* Reduced motion */
    #vibe2404.reduce-motion::before,
    #vibe2404.reduce-motion::after { animation: none !important; }
    #vibe2404.reduce-motion .flow { opacity: 0.65; mix-blend-mode: normal; }
  </style>

  <div class="grain" aria-hidden="true"></div>

  <div class="top">
    <div class="brand" aria-label="Kinetic Garden">
      <i class="sig" aria-hidden="true"></i>
      <span>Kinetic Garden</span>
    </div>

    <div class="ctrls" role="group" aria-label="Appearance and motion controls">
      <div class="seg" role="tablist" aria-label="Modes">
        <button class="mode" data-mode="dawn" aria-pressed="false" role="tab">Dawn</button>
        <button class="mode" data-mode="dusk" aria-pressed="true" role="tab">Dusk</button>
        <button class="mode" data-mode="prism" aria-pressed="false" role="tab">Prism</button>
      </div>

      <label class="knob" for="flow">
        Flow
        <input id="flow" type="range" min="0.3" max="3.0" step="0.1" value="1.0" aria-label="Adjust flow speed">
      </label>

      <label class="knob" for="density">
        Density
        <input id="density" type="range" min="200" max="2400" step="100" value="1200" aria-label="Adjust line density">
      </label>

      <label class="knob" for="glow">
        Glow
        <input id="glow" type="range" min="0.2" max="1.6" step="0.1" value="1.0" aria-label="Adjust glow intensity">
      </label>
    </div>
  </div>

  <div class="hero" tabindex="0" aria-label="Interactive flow field canvas">
    <canvas class="flow" aria-hidden="true"></canvas>
    <div class="overlay" aria-hidden="true">
      <h1 class="t">Vapor Lines</h1>
      <p class="s">Quiet motion. Bold clarity.</p>
    </div>
  </div>

  <ul class="chips" aria-label="Principles">
    <li class="chip">Poise</li>
    <li class="chip">Play</li>
    <li class="chip">Precision</li>
    <li class="chip">Purpose</li>
  </ul>

  <div class="tiles" aria-label="Field notes">
    <article class="tile" tabindex="0" aria-label="Note — Scale">
      <div class="halo" aria-hidden="true"></div>
      <h3>Scale with Silence</h3>
      <p>Amplify the signal, not the noise. Emphasize pace over haste.</p>
    </article>
    <article class="tile" tabindex="0" aria-label="Note — Easing">
      <div class="halo" aria-hidden="true"></div>
      <h3>Easing is Empathy</h3>
      <p>Time shapes trust. Choose curves that feel considerate.</p>
    </article>
    <article class="tile" tabindex="0" aria-label="Note — Contrast">
      <div class="halo" aria-hidden="true"></div>
      <h3>Contrast is Care</h3>
      <p>Make meaning legible. Let color carry, not shout.</p>
    </article>
    <article class="tile" tabindex="0" aria-label="Note — Delight">
      <div class="halo" aria-hidden="true"></div>
      <h3>Delight, Lightly</h3>
      <p>Small sparkle; big respect. Joy that never interrupts.</p>
    </article>
  </div>

  <div class="foot">
    <small>Shapes that breathe. Systems that listen.</small>
    <span id="last-updated">Last updated: 2026-02-05 04:41:41 EST</span>
  </div>

  <script>
    (function () {
      const root = document.getElementById('vibe2404');
      const hero = root.querySelector('.hero');
      const cvs = root.querySelector('.flow');
      const ctx = cvs.getContext('2d', { alpha: true });
      const modes = Array.from(root.querySelectorAll('.mode'));
      const flow = root.querySelector('#flow');
      const density = root.querySelector('#density');
      const glow = root.querySelector('#glow');
      const tiles = Array.from(root.querySelectorAll('.tile'));
      const stamp = root.querySelector('#last-updated');

      // Stamp
      try {
        const now = new Date();
        const fmt = new Intl.DateTimeFormat(undefined, { dateStyle: 'medium', timeStyle: 'medium' });
        stamp.textContent = 'Last updated: ' + fmt.format(now);
      } catch {
        stamp.textContent = 'Last updated: just now';
      }

      // Reduced motion
      const prefersReduce = window.matchMedia ? matchMedia('(prefers-reduced-motion: reduce)') : null;
      const applyReduce = on => root.classList.toggle('reduce-motion', !!on);
      if (prefersReduce) {
        applyReduce(prefersReduce.matches);
        prefersReduce.addEventListener('change', e => applyReduce(e.matches));
      }

      // Mode switching
      const applyMode = (m) => {
        root.setAttribute('data-mode', m);
        modes.forEach(b => b.setAttribute('aria-pressed', b.dataset.mode === m ? 'true' : 'false'));
        readPalette();
        resize();
        seed();
        start();
      };
      modes.forEach(btn => btn.addEventListener('click', () => applyMode(btn.dataset.mode)));

      // Tilt hero + tiles
      const tilt = (el, x, y, rx = 8, ry = 10) => {
        const r = el.getBoundingClientRect();
        const mx = (x - r.left) / r.width;
        const my = (y - r.top) / r.height;
        el.style.setProperty('--rx', ((0.5 - my) * rx).toFixed(2) + 'deg');
        el.style.setProperty('--ry', ((mx - 0.5) * ry).toFixed(2) + 'deg');
      };
      root.addEventListener('pointermove', (e) => tilt(hero, e.clientX, e.clientY));
      root.addEventListener('pointerleave', () => { hero.style.setProperty('--rx', '0deg'); hero.style.setProperty('--ry', '0deg'); });
      hero.addEventListener('focus', () => { hero.style.setProperty('--rx', '-2deg'); hero.style.setProperty('--ry', '2deg'); });
      hero.addEventListener('blur', () => { hero.style.setProperty('--rx', '0deg'); hero.style.setProperty('--ry', '0deg'); });

      const micro = (pane, e) => {
        const r = pane.getBoundingClientRect();
        const mx = (e.clientX - r.left) / r.width;
        const my = (e.clientY - r.top) / r.height;
        pane.style.setProperty('--crx', ((0.5 - my) * 6).toFixed(2) + 'deg');
        pane.style.setProperty('--cry', ((mx - 0.5) * 8).toFixed(2) + 'deg');
      };
      tiles.forEach(p => {
        p.addEventListener('pointermove', (e) => micro(p, e));
        p.addEventListener('pointerleave', () => { p.style.setProperty('--crx', '0deg'); p.style.setProperty('--cry', '0deg'); });
        p.addEventListener('focus', () => { p.style.setProperty('--crx', '-2deg'); p.style.setProperty('--cry', '2deg'); });
        p.addEventListener('blur', () => { p.style.setProperty('--crx', '0deg'); p.style.setProperty('--cry', '0deg'); });
      });

      // Canvas setup
      const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      let raf, W = 0, H = 0, T0 = 0;
      const state = {
        speed: parseFloat(flow.value),
        count: parseInt(density.value, 10),
        glow: parseFloat(glow.value),
        t: 0
      };
      const palette = { a1: '#fff', a2: '#fff', a3: '#fff', fg: '#000' };

      const readPalette = () => {
        const s = getComputedStyle(root);
        palette.a1 = s.getPropertyValue('--a1').trim();
        palette.a2 = s.getPropertyValue('--a2').trim();
        palette.a3 = s.getPropertyValue('--a3').trim();
        palette.fg = s.getPropertyValue('--fg').trim();
      };

      const resize = () => {
        const r = hero.getBoundingClientRect();
        W = Math.floor(r.width);
        H = Math.floor(r.height);
        cvs.width = Math.floor(W * DPR);
        cvs.height = Math.floor(H * DPR);
        cvs.style.width = W + 'px';
        cvs.style.height = H + 'px';
        ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      };

      // Particles in a dynamic curl-ish field
      let parts = [];
      const rand = (min, max) => min + Math.random() * (max - min);
      const gradient = () => {
        const g = ctx.createLinearGradient(0, 0, W, H);
        g.addColorStop(0, palette.a1);
        g.addColorStop(0.5, palette.a2);
        g.addColorStop(1, palette.a3);
        return g;
      };

      const spawn = (i = 0) => {
        const angle = Math.random() * Math.PI * 2;
        const radius = Math.pow(Math.random(), 0.7) * Math.min(W, H) * 0.48;
        const cx = W / 2 + Math.cos(angle) * radius * 0.1;
        const cy = H / 2 + Math.sin(angle) * radius * 0.1;
        return {
          x: cx + rand(-W * 0.02, W * 0.02),
          y: cy + rand(-H * 0.02, H * 0.02),
          life: rand(80, 260),
          hue: i / Math.max(1, state.count)
        };
      };

      const seed = () => {
        parts = new Array(state.count).fill(0).map((_, i) => spawn(i));
      };

      // Lightweight pseudo-noise field
      const field = (x, y, t) => {
        const s1 = 0.0022, s2 = 0.0013, s3 = 0.0009;
        const n =
          Math.sin((x * s1) + t * 0.9) +
          Math.cos((y * s1) - t * 0.8) +
          Math.sin((x * s2 + y * s2) * 0.8 - t * 0.5) * 0.8;
        const ang = n * 1.6 + Math.sin((x - W/2) * s3 - (y - H/2) * s3 + t * 0.6) * 0.9;
        return { vx: Math.cos(ang), vy: Math.sin(ang) };
      };

      const drawStatic = () => {
        ctx.clearRect(0, 0, W, H);
        ctx.save();
        ctx.globalAlpha = 0.9;
        ctx.strokeStyle = gradient();
        for (let r = Math.min(W, H) * 0.1; r < Math.min(W, H) * 0.48; r += 16) {
          ctx.beginPath();
          ctx.arc(W / 2, H / 2, r, 0, Math.PI * 2);
          ctx.globalAlpha = 0.06 + 0.25 * Math.pow(1 - r / (Math.min(W, H) * 0.48), 1.6);
          ctx.lineWidth = 1 + (r % 32 === 0 ? 0.6 : 0.2);
          ctx.stroke();
        }
        ctx.restore();
      };

      const step = (tms) => {
        if (root.classList.contains('reduce-motion')) {
          drawStatic();
          return;
        }

        if (!T0) T0 = tms;
        const t = (tms - T0) * 0.001;
        state.t = t;

        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = 'rgba(0,0,0,0.05)';
        if (root.getAttribute('data-mode') === 'dawn') {
          ctx.fillStyle = 'rgba(255,255,255,0.06)';
        }
        ctx.fillRect(0, 0, W, H);

        ctx.globalCompositeOperation = 'lighter';
        ctx.strokeStyle = gradient();
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.shadowColor = palette.a2;
        ctx.shadowBlur = 6 * state.glow;

        const vel = 0.7 * state.speed;
        const len = 0.9 + 1.8 * state.glow;

        for (let i = 0; i < parts.length; i++) {
          const p = parts[i];
          const { vx, vy } = field(p.x, p.y, t);
          const px = p.x;
          const py = p.y;
          p.x += vx * vel;
          p.y += vy * vel;
          p.life -= 1;

          ctx.globalAlpha = 0.06 + 0.6 * (1 - Math.abs(0.5 - p.hue));
          ctx.lineWidth = 0.6 + 1.2 * Math.sin((i * 0.013) + t);
          ctx.beginPath();
          ctx.moveTo(px, py);
          ctx.lineTo(px + vx * len, py + vy * len);
          ctx.stroke();

          if (p.x < -10 || p.x > W + 10 || p.y < -10 || p.y > H + 10 || p.life < 0) {
            parts[i] = spawn(i);
          }
        }

        raf = requestAnimationFrame(step);
      };

      const start = () => {
        cancelAnimationFrame(raf);
        raf = requestAnimationFrame(step);
      };

      // Controls
      flow.addEventListener('input', e => { state.speed = parseFloat(e.target.value); });
      density.addEventListener('input', e => {
        state.count = parseInt(e.target.value, 10);
        seed();
      });
      glow.addEventListener('input', e => { state.glow = parseFloat(e.target.value); });

      // Pointer ripple = brief density surge
      hero.addEventListener('pointerdown', () => {
        const extra = Math.min(400, Math.floor(state.count * 0.25));
        parts.push(...new Array(extra).fill(0).map((_, i) => spawn(i)));
        setTimeout(() => { parts.splice(-extra, extra); }, 380);
      });

      // Resize observer
      const ro = new ResizeObserver(() => { resize(); seed(); start(); });
      ro.observe(hero);

      // Init
      readPalette();
      resize();
      seed();
      start();

      // Cleanup if removed
      root.addEventListener('DOMNodeRemoved', () => { cancelAnimationFrame(raf); ro.disconnect(); });
    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


