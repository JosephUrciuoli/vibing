<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibing</title>
    <style>
      :root {
        --bg: #0f1221;
        --fg: #e6e8f0;
        --muted: #9aa3b2;
        --accent: #8b5cf6;
      }
      html, body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: radial-gradient(1200px 800px at 70% 10%, #1b1f3a, var(--bg));
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card {
        width: min(720px, 92vw);
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 28px 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        letter-spacing: 0.3px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 18px;
      }
      #content {
        font-size: 18px;
        line-height: 1.6;
        background: rgba(255,255,255,0.04);
        border: 1px dashed rgba(255,255,255,0.12);
        border-radius: 12px;
        padding: 16px;
      }
      .footer {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: var(--muted);
      }
      .badge {
        display: inline-block;
        background: rgba(139, 92, 246, 0.18);
        color: #d4c2ff;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid rgba(139, 92, 246, 0.35);
        letter-spacing: 0.2px;
      }
    </style>
  </head>
  <body>
    <!-- BEGIN_EDITABLE -->
      <section id="content">
<section class="vibe1252" role="region" aria-label="AURORA ATLAS 1252 — Kinetic Tapestry">
  <style>
    .vibe1252 {
      --ink:#0f1323;
      --muted:#66708d;
      --edge:#dfe6ff;
      --bg0:#f7fbff;
      --bg1:#eef4ff;
      --glass:rgba(255,255,255,.7);
      --a1:#76e4f7; --a2:#8b7cff; --a3:#ffb088; --a4:#7cf0cc; --a5:#ff92c4;
      --ring:#e7edff;
      --glow: 0 80px 160px rgba(20,28,60,.14);
      color-scheme: light;
      position: relative; isolation: isolate; overflow: hidden;
      padding: clamp(18px, 4.8vw, 54px);
      border-radius: 28px; border: 1px solid var(--edge);
      background:
        radial-gradient(120% 100% at 120% -20%, #d9ecff7a 0 40%, transparent 60%),
        radial-gradient(120% 100% at -20% 120%, #efe5ff66 0 40%, transparent 65%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      box-shadow: var(--glow), inset 0 1px 0 rgba(255,255,255,.8);
    }
    .vibe1252[data-theme="night"]{
      --ink:#eaf2ff; --muted:#9fb0d6; --edge:#243861; --bg0:#0b1226; --bg1:#0e1833;
      --glass: rgba(16,24,46,.55);
      --a1:#6ff3ff; --a2:#89a1ff; --a3:#ffd39c; --a4:#7df3cd; --a5:#ff9bcc;
      --ring:#1e2b4d;
      --glow: 0 100px 220px rgba(0,0,0,.55);
      color-scheme: dark;
      box-shadow: var(--glow), inset 0 1px 0 rgba(255,255,255,.08);
    }
    .vibe1252::before{
      content:"";
      position:absolute; inset:-45%;
      background: conic-gradient(from 220deg,
        color-mix(in oklab, var(--a1), transparent 84%) 0 20%,
        color-mix(in oklab, var(--a2), transparent 84%) 20% 40%,
        color-mix(in oklab, var(--a3), transparent 84%) 40% 60%,
        color-mix(in oklab, var(--a4), transparent 84%) 60% 80%,
        color-mix(in oklab, var(--a5), transparent 84%) 80% 100%);
      filter: blur(140px) saturate(1.05);
      opacity:.32; pointer-events:none;
    }
    .vibe1252::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(700px 540px at var(--mx,50%) var(--my,30%), rgba(140,180,255,.18), transparent 60%),
        linear-gradient(180deg, #0000, #00000008 50%, #0000 90%);
      mix-blend-mode: soft-light; pointer-events: none; opacity:.22;
      mask: radial-gradient(95% 80% at 50% 12%, #000 40%, transparent 100%);
    }

    /* Top bar */
    .vibe1252 .bar{
      display:grid; grid-template-columns:auto minmax(0,1fr) auto; gap:16px; align-items:center;
      padding:12px 14px; border-radius:20px; border:1px solid var(--edge);
      background: linear-gradient(180deg, var(--glass), transparent);
      backdrop-filter: blur(18px) saturate(1.06);
      box-shadow: 0 24px 60px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.5);
      position:relative; z-index:5;
    }
    .vibe1252 .logo{
      --s:64px; width:var(--s); height:var(--s); border-radius:16px; overflow:hidden; display:grid; place-items:center;
      border:1px solid var(--edge);
      background: linear-gradient(180deg, rgba(255,255,255,.88), rgba(255,255,255,.4));
      box-shadow: inset 0 10px 24px rgba(255,255,255,.55), 0 10px 26px rgba(0,0,0,.12);
    }
    .vibe1252[data-theme="night"] .logo{
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      box-shadow: inset 0 10px 24px rgba(255,255,255,.10), 0 10px 26px rgba(0,0,0,.28);
    }
    .vibe1252 .logo svg{ width:78%; height:78%; display:block; }
    .vibe1252 .brand{ min-width:0; }
    .vibe1252 .title{
      font-family: ui-serif, "SF Pro Display", "New York", Georgia, serif;
      font-weight:900; letter-spacing:.004em; line-height:.9; margin:0;
      font-size: clamp(22px, 5vw, 56px); text-wrap:balance;
      background: linear-gradient(95deg, var(--ink), color-mix(in oklab, var(--a2), var(--ink) 44%) 60%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter: drop-shadow(0 16px 42px rgba(180,205,255,.18));
      animation: shimmer 10s linear infinite;
      background-size: 200% 100%;
    }
    @keyframes shimmer{ 0%{background-position:0% 0} 100%{background-position:200% 0} }
    .vibe1252 .sub{
      color:var(--muted); font-weight:800; font-size:11px; letter-spacing:.18em; text-transform:uppercase;
      margin-top:4px;
    }
    .vibe1252 .controls{ display:flex; gap:8px; align-items:center; justify-content:flex-end; flex-wrap:wrap; }
    .vibe1252 .btn{
      appearance:none; cursor:pointer; user-select:none;
      padding:10px 12px; font-size:12px; font-weight:800; letter-spacing:.04em;
      color: var(--ink); border-radius:999px; border:1px solid var(--edge);
      background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.40));
      box-shadow: 0 12px 28px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.58);
      transition: transform .14s ease, box-shadow .22s ease, background .22s ease, opacity .2s ease, outline-color .2s ease;
    }
    .vibe1252[data-theme="night"] .btn{
      color: var(--ink); background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      box-shadow: 0 12px 28px rgba(0,0,0,.28), inset 0 1px 0 rgba(255,255,255,.12);
    }
    .vibe1252 .btn:hover{ transform: translateY(-1px); box-shadow: 0 22px 44px rgba(0,0,0,.22), inset 0 1px 0 rgba(255,255,255,.28); }
    .vibe1252 .btn[aria-pressed="true"]{ outline:2px solid var(--a1); outline-offset:0; }

    /* Stage */
    .vibe1252 .stage{
      position:relative; z-index:1; margin-top:18px;
      border-radius:24px; border:1px solid var(--edge);
      background: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.35));
      box-shadow: 0 50px 160px rgba(0,0,0,.16), inset 0 1px 0 rgba(255,255,255,.70);
      overflow:hidden; display:grid; place-items:center;
      backdrop-filter: blur(10px) saturate(1.04);
      min-height: clamp(560px, 58vw, 980px);
    }
    .vibe1252[data-theme="night"] .stage{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      box-shadow: 0 50px 160px rgba(0,0,0,.32), inset 0 1px 0 rgba(255,255,255,.10);
    }
    .vibe1252 canvas#field{
      width:100%; height:100%; display:block;
      filter: saturate(1.05) contrast(1.02);
    }
    .vibe1252 .motto{
      position:absolute; inset:auto 4vw 4vw 4vw; z-index:3;
      font-family: ui-sans-serif, system-ui, Inter, "SF Pro", Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      font-weight:900; letter-spacing:-.01em; line-height:.92; text-align:center;
      color:var(--ink); text-shadow: 0 1px 0 rgba(255,255,255,.18), 0 24px 64px color-mix(in oklab, var(--a4), transparent 58%);
      font-size: clamp(28px, 5.4vw, 80px); text-wrap:balance;
      mix-blend-mode:luminosity; pointer-events:none;
    }
    .vibe1252 .motto em{
      font-style:normal;
      background: linear-gradient(90deg, var(--a4), var(--a3), var(--a2), var(--a5));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }

    /* Panel */
    .vibe1252 .panel{
      position:relative; z-index:5; margin-top:16px;
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:center;
      padding:10px; border-radius:14px; border:1px solid var(--edge);
      background: var(--glass);
      backdrop-filter: blur(14px) saturate(1.06);
      box-shadow: 0 16px 42px rgba(0,0,0,.16), inset 0 1px 0 rgba(255,255,255,.50);
    }
    .vibe1252[data-theme="night"] .panel{
      background: rgba(255,255,255,.08);
      box-shadow: 0 16px 42px rgba(0,0,0,.20), inset 0 1px 0 rgba(255,255,255,.10);
    }
    .vibe1252 .cluster{ display:flex; align-items:center; gap:10px; }
    .vibe1252 .lab{ color:var(--muted); font-size:12px; font-weight:800; letter-spacing:.12em; text-transform:uppercase; white-space:nowrap; }
    .vibe1252 .knob{ -webkit-appearance:none; appearance:none; width:220px; max-width:35vw; height:30px; background:transparent; cursor:pointer; }
    .vibe1252 .knob::-webkit-slider-thumb{
      -webkit-appearance:none; width:18px; height:18px; border-radius:50%;
      background: linear-gradient(180deg, #f8fbff, #dfe8f7); border:1px solid var(--edge);
      box-shadow: 0 6px 16px rgba(12,20,50,.16);
    }
    .vibe1252[data-theme="night"] .knob::-webkit-slider-thumb{ background: linear-gradient(180deg, #fff, #e9f3ff); }
    .vibe1252 .knob::-webkit-slider-runnable-track{
      height:10px; border-radius:999px; border:1px solid var(--edge);
      background: linear-gradient(90deg, var(--a4), var(--a3), var(--a2), var(--a1), var(--a5));
      opacity:.9;
    }

    /* Meta */
    .vibe1252 .meta{
      position:relative; z-index:5; margin:14px 2px 0; padding:0; list-style:none;
      display:flex; flex-wrap:wrap; gap:12px; align-items:center; color:var(--muted); font-size:12.5px;
    }
    .vibe1252 .chip{
      display:inline-flex; align-items:center; gap:8px; font-weight:800; text-transform:uppercase; letter-spacing:.12em;
      padding:6px 10px; border-radius:999px; border:1px solid var(--edge);
      background: linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.30));
      backdrop-filter: blur(6px);
    }
    .vibe1252[data-theme="night"] .chip{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
    }
    .vibe1252 .grow{ flex:1 1 auto; min-width:160px; text-align:right; }

    /* Prefers reduced motion */
    @media (prefers-reduced-motion: reduce){
      .vibe1252 *{ animation:none !important; transition:none !important; }
    }
  </style>

  <div class="bar">
    <div class="logo" aria-hidden="true">
      <svg viewBox="0 0 100 100" aria-hidden="true">
        <defs>
          <radialGradient id="aurora1252" cx="50%" cy="50%" r="60%">
            <stop offset="0" stop-color="var(--a4)"/>
            <stop offset="1" stop-color="var(--a2)"/>
          </radialGradient>
        </defs>
        <g fill="none" stroke="url(#aurora1252)" stroke-width="6" stroke-linecap="round">
          <path d="M50 16 C72 22, 86 40, 82 60 C78 80, 61 88, 50 88 C39 88, 22 80, 18 60 C14 40, 28 22, 50 16" />
          <circle cx="50" cy="53" r="10" fill="var(--a1)" stroke="none"/>
        </g>
      </svg>
    </div>
    <div class="brand">
      <div class="title">AURORA ATLAS 1252 — Kinetic Tapestry</div>
      <div class="sub">flow • echo • resonance</div>
    </div>
    <div class="controls" role="group" aria-label="Controls">
      <button class="btn" data-act="theme" title="Toggle theme (T)">Day</button>
      <button class="btn" data-act="run" aria-pressed="true" title="Pause/Play (Space)">Pause</button>
      <button class="btn" data-act="palette" title="Palette (P)">Hues</button>
    </div>
  </div>

  <div class="stage" aria-label="A field of luminous threads flowing and weaving">
    <canvas id="field" aria-hidden="true"></canvas>
    <div class="motto">Teach light to <em>flow</em>, and watch it <em>remember</em>.</div>
  </div>

  <div class="panel" role="group" aria-label="Flow controls">
    <div class="cluster">
      <span class="lab">Threads</span>
      <input class="knob" type="range" data-ctrl="count" min="300" max="4000" step="50" value="1600" aria-label="Number of threads (300–4000)" title="Threads">
    </div>
    <div class="cluster">
      <span class="lab">Speed</span>
      <input class="knob" type="range" data-ctrl="speed" min="0.2" max="3" step="0.01" value="1.2" aria-label="Flow speed (0.2–3)" title="Speed">
    </div>
    <div class="cluster">
      <span class="lab">Flow</span>
      <input class="knob" type="range" data-ctrl="flow" min="0.002" max="0.03" step="0.001" value="0.011" aria-label="Field complexity (0.002–0.03)" title="Flow">
    </div>
    <div class="cluster">
      <span class="lab">Trail</span>
      <input class="knob" type="range" data-ctrl="trail" min="0.02" max="0.25" step="0.005" value="0.07" aria-label="Trail persistence (0.02–0.25)" title="Trail">
    </div>
    <div class="cluster">
      <span class="lab">Thickness</span>
      <input class="knob" type="range" data-ctrl="thick" min="0.4" max="2.4" step="0.05" value="0.9" aria-label="Stroke thickness (0.4–2.4)" title="Thickness">
    </div>
  </div>

  <ul class="meta" aria-label="status">
    <li class="chip">live</li>
    <li class="chip">mode <strong id="mode1252">Day</strong></li>
    <li class="chip">palette <strong id="palname1252">Aurora</strong></li>
    <li class="chip">fps <strong id="fps1252">—</strong></li>
    <li class="chip">threads <strong id="count1252">—</strong></li>
    <li class="grow"><span id="last-updated">Last updated: 2025-12-13 00:19:12 EST</span></li>
  </ul>

  <script>
    (function(){
      const root = document.currentScript.closest('.vibe1252');
      const canvas = root.querySelector('#field');
      const ctx = canvas.getContext('2d');
      const ui = {
        theme: root.querySelector('[data-act="theme"]'),
        run: root.querySelector('[data-act="run"]'),
        palette: root.querySelector('[data-act="palette"]'),
        count: root.querySelector('[data-ctrl="count"]'),
        speed: root.querySelector('[data-ctrl="speed"]'),
        flow: root.querySelector('[data-ctrl="flow"]'),
        trail: root.querySelector('[data-ctrl="trail"]'),
        thick: root.querySelector('[data-ctrl="thick"]'),
        mode: root.querySelector('#mode1252'),
        fps: root.querySelector('#fps1252'),
        palname: root.querySelector('#palname1252'),
        countOut: root.querySelector('#count1252'),
        ts: root.querySelector('#last-updated')
      };

      // Timestamp
      try{
        const fmt = new Intl.DateTimeFormat(undefined, { dateStyle:'medium', timeStyle:'short' });
        ui.ts.textContent = 'Updated ' + fmt.format(new Date());
      }catch{
        ui.ts.textContent = 'Updated ' + new Date().toLocaleString();
      }

      // Theme + run
      root.setAttribute('data-theme', 'day');
      root.setAttribute('data-run', 'on');

      // Palettes
      const palettes = [
        { name:'Aurora', colors:['#76E4F7','#8B7CFF','#FFB088','#7CF0CC','#FF92C4'] },
        { name:'Glacier', colors:['#9CD1FF','#8DA0FF','#FFE3A1','#7FF0DC','#FFB0D8'] },
        { name:'Eclipse', colors:['#7AD7F0','#B3A3FF','#FFD28D','#8CF0D2','#FFA0C8'] },
        { name:'Coastal', colors:['#60A5FA','#34D399','#FDE68A','#F472B6','#A78BFA'] },
        { name:'Mint Bloom', colors:['#80F2E3','#71A1F6','#FF9BAA','#8AEE9C','#FBC3FF'] }
      ];
      let palIndex = 0;
      function applyPalette(i){
        const p = palettes[i].colors;
        root.style.setProperty('--a1', p[0]);
        root.style.setProperty('--a2', p[1]);
        root.style.setProperty('--a3', p[2]);
        root.style.setProperty('--a4', p[3]);
        root.style.setProperty('--a5', p[4]);
        ui.palname.textContent = palettes[i].name;
        // Build gradient for strokes
        strokeColors = p.map(c=>c);
      }
      let strokeColors = palettes[0].colors.slice();
      applyPalette(palIndex);

      // Sizing
      let dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));
      let W = 0, H = 0;
      function resize(){
        const r = canvas.getBoundingClientRect();
        W = Math.max(1, Math.floor(r.width));
        H = Math.max(1, Math.floor(r.height));
        const newDpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));
        if (newDpr !== dpr) dpr = newDpr;
        canvas.width = Math.floor(W * dpr);
        canvas.height = Math.floor(H * dpr);
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        clearHard();
      }
      function clearHard(){
        ctx.save();
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = root.getAttribute('data-theme')==='night' ? 'rgba(11,18,38,0.9)' : 'rgba(247,251,255,0.9)';
        ctx.fillRect(0,0,W,H);
        ctx.restore();
      }

      // Particles
      let particles = [];
      let ptr = { x:0, y:0, down:false, inside:false };
      let running = true;

      function rand(a,b){ return a + Math.random()*(b-a); }
      function makeParticle(){
        const x = Math.random()*W;
        const y = Math.random()*H;
        const speed = parseFloat(ui.speed.value);
        const angle = Math.random()*Math.PI*2;
        const v = (speed*0.4 + Math.random()*0.6);
        return {
          x, y, px:x, py:y,
          vx: Math.cos(angle)*v,
          vy: Math.sin(angle)*v,
          hue: strokeColors[Math.floor(Math.random()*strokeColors.length)],
          life: rand(60, 600)
        };
      }
      function rebuild(n){
        particles = new Array(n|0).fill(0).map(makeParticle);
        ui.countOut.textContent = String(n|0);
      }

      // Field (animated trig "curl-ish" field)
      function fieldVector(x, y, t){
        const k = parseFloat(ui.flow.value);
        const s1 = Math.sin((x*k) + t*0.9);
        const c1 = Math.cos((y*k*1.1) - t*0.7);
        const s2 = Math.sin(((x+y)*k*0.5) - t*1.2);
        const a = s1*0.9 + c1*0.6 + s2*0.5;
        return { x: Math.cos(a), y: Math.sin(a) };
      }

      // Draw
      let t0 = performance.now();
      let lastFpsT = t0, frames = 0;
      function step(now){
        if (!running){ raf = requestAnimationFrame(step); return; }
        const dt = Math.max(0.016, Math.min(0.05, (now - t0)/1000));
        t0 = now;
        frames++;
        if (now - lastFpsT > 500){
          const fps = Math.round(frames / ((now - lastFpsT)/1000));
          ui.fps.textContent = String(fps);
          frames = 0; lastFpsT = now;
        }

        // Fade canvas for trails
        const trail = parseFloat(ui.trail.value);
        ctx.save();
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = root.getAttribute('data-theme')==='night'
          ? `rgba(11,18,38,${trail})`
          : `rgba(247,251,255,${trail})`;
        ctx.fillRect(0,0,W,H);
        ctx.restore();

        const sp = parseFloat(ui.speed.value) * 0.9;
        const thick = parseFloat(ui.thick.value);
        const time = now*0.001;

        ctx.save();
        ctx.globalCompositeOperation = 'lighter';
        for (let i=0; i<particles.length; i++){
          const p = particles[i];
          p.px = p.x; p.py = p.y;

          // Flow vector
          const f = fieldVector(p.x, p.y, time);
          // Pointer influence
          if (ptr.inside){
            const dx = ptr.x - p.x, dy = ptr.y - p.y;
            const d2 = Math.max(9, dx*dx + dy*dy);
            const force = (ptr.down ? 1200 : 400) / d2;
            p.vx += dx * force * dt;
            p.vy += dy * force * dt;
          }
          // Integrate
          p.vx += f.x * sp * dt;
          p.vy += f.y * sp * dt;

          // Limit velocity slightly
          const maxV = 3.2 * sp;
          const vv = Math.hypot(p.vx, p.vy);
          if (vv > maxV){ p.vx = p.vx / vv * maxV; p.vy = p.vy / vv * maxV; }

          p.x += p.vx;
          p.y += p.vy;

          // Wrap
          if (p.x < -2) p.x = W+2, p.px = p.x;
          if (p.x > W+2) p.x = -2, p.px = p.x;
          if (p.y < -2) p.y = H+2, p.py = p.y;
          if (p.y > H+2) p.y = -2, p.py = p.y;

          // Age
          if (--p.life <= 0){
            const np = makeParticle();
            p.x=np.x; p.y=np.y; p.px=p.x; p.py=p.y; p.vx=np.vx; p.vy=np.vy; p.hue = np.hue; p.life = np.life;
          }

          // Stroke
          ctx.strokeStyle = p.hue;
          ctx.lineWidth = thick;
          ctx.beginPath();
          ctx.moveTo(p.px, p.py);
          ctx.lineTo(p.x, p.y);
          ctx.stroke();
        }
        ctx.restore();

        raf = requestAnimationFrame(step);
      }
      let raf = requestAnimationFrame(step);

      // Pointer handling and soft spotlight
      function updatePointerVars(e){
        const r = canvas.getBoundingClientRect();
        const x = e.clientX - r.left;
        const y = e.clientY - r.top;
        root.style.setProperty('--mx', x + 'px');
        root.style.setProperty('--my', y + 'px');
        ptr.x = x; ptr.y = y;
      }
      canvas.addEventListener('pointerenter', (e)=>{ ptr.inside = true; updatePointerVars(e); }, { passive:true });
      canvas.addEventListener('pointermove', (e)=>{ updatePointerVars(e); }, { passive:true });
      canvas.addEventListener('pointerleave', ()=>{ ptr.inside = false; }, { passive:true });
      canvas.addEventListener('pointerdown', (e)=>{ ptr.down = true; updatePointerVars(e); }, { passive:true });
      window.addEventListener('pointerup', ()=>{ ptr.down = false; }, { passive:true });

      // UI interactions
      ui.theme.addEventListener('click', ()=>{
        const next = root.getAttribute('data-theme')==='night' ? 'day' : 'night';
        root.setAttribute('data-theme', next);
        ui.theme.textContent = next==='day' ? 'Day' : 'Night';
        ui.mode.textContent = next==='day' ? 'Day' : 'Night';
        clearHard();
      });
      ui.run.addEventListener('click', ()=>{
        running = !running;
        root.setAttribute('data-run', running? 'on':'off');
        ui.run.setAttribute('aria-pressed', running? 'true':'false');
        ui.run.textContent = running? 'Pause':'Play';
      });
      ui.palette.addEventListener('click', ()=>{
        palIndex = (palIndex + 1) % palettes.length;
        applyPalette(palIndex);
      });

      ui.count.addEventListener('input', ()=> rebuild(parseInt(ui.count.value,10)));
      ui.speed.addEventListener('input', ()=>{/* reactive via loop */});
      ui.flow.addEventListener('input', ()=>{/* reactive via loop */});
      ui.trail.addEventListener('input', ()=>{/* reactive via loop */});
      ui.thick.addEventListener('input', ()=>{/* reactive via loop */});

      // Keyboard shortcuts
      root.tabIndex = 0;
      root.addEventListener('keydown', (e)=>{
        const k = e.key.toLowerCase();
        if (k==='t') ui.theme.click();
        else if (k===' ') { e.preventDefault(); ui.run.click(); }
        else if (k==='p') ui.palette.click();
        else if (k==='['){ ui.speed.value = String(Math.max(0.2, parseFloat(ui.speed.value)-0.06)); }
        else if (k===']'){ ui.speed.value = String(Math.min(3.0, parseFloat(ui.speed.value)+0.06)); }
        else if (k==='-'){ ui.trail.value = String(Math.max(0.02, parseFloat(ui.trail.value)-0.01)); }
        else if (k==='='){ ui.trail.value = String(Math.min(0.25, parseFloat(ui.trail.value)+0.01)); }
      });

      // Init
      function init(){
        resize();
        rebuild(parseInt(ui.count.value,10));
        clearHard();
      }
      init();
      window.addEventListener('resize', resize, { passive:true });

      // Respect reduced motion: dampen parameters
      try{
        if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches){
          ui.trail.value = '0.12';
          ui.speed.value = '0.7';
        }
      }catch{}

    })();
  </script>
</section>
      </section>
      <!-- END_EDITABLE -->
    <script>
      // Only show a local placeholder if the agent hasn't written a timestamp yet
      const el = document.getElementById('last-updated');
      if (el && (!el.textContent || el.textContent.includes('not yet'))) {
        const now = new Date();
        el.textContent = `Last updated: ${now.toLocaleString(undefined, { hour12: false })}`;
      }
    </script>
  </body>
  </html>


